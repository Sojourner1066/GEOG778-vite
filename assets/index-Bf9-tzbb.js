var y_=Object.defineProperty;var v_=(n,t,e)=>t in n?y_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var v=(n,t,e)=>v_(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();function b_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xi={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var w_=xi.exports,Rl;function T_(){return Rl||(Rl=1,function(n,t){(function(e,i){i(t)})(w_,function(e){var i="1.9.4";function s(o){var c,u,p,g;for(u=1,p=arguments.length;u<p;u++){g=arguments[u];for(c in g)o[c]=g[c]}return o}var r=Object.create||function(){function o(){}return function(c){return o.prototype=c,new o}}();function a(o,c){var u=Array.prototype.slice;if(o.bind)return o.bind.apply(o,u.call(arguments,1));var p=u.call(arguments,2);return function(){return o.apply(c,p.length?p.concat(u.call(arguments)):arguments)}}var l=0;function h(o){return"_leaflet_id"in o||(o._leaflet_id=++l),o._leaflet_id}function f(o,c,u){var p,g,y,x;return x=function(){p=!1,g&&(y.apply(u,g),g=!1)},y=function(){p?g=arguments:(o.apply(u,arguments),setTimeout(x,c),p=!0)},y}function d(o,c,u){var p=c[1],g=c[0],y=p-g;return o===p&&u?o:((o-g)%y+y)%y+g}function _(){return!1}function m(o,c){if(c===!1)return o;var u=Math.pow(10,c===void 0?6:c);return Math.round(o*u)/u}function w(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function A(o){return w(o).split(/\s+/)}function S(o,c){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?r(o.options):{});for(var u in c)o.options[u]=c[u];return o.options}function k(o,c,u){var p=[];for(var g in o)p.push(encodeURIComponent(u?g.toUpperCase():g)+"="+encodeURIComponent(o[g]));return(!c||c.indexOf("?")===-1?"?":"&")+p.join("&")}var B=/\{ *([\w_ -]+) *\}/g;function F(o,c){return o.replace(B,function(u,p){var g=c[p];if(g===void 0)throw new Error("No value provided for variable "+u);return typeof g=="function"&&(g=g(c)),g})}var M=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function D(o,c){for(var u=0;u<o.length;u++)if(o[u]===c)return u;return-1}var H="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function W(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var at=0;function Y(o){var c=+new Date,u=Math.max(0,16-(c-at));return at=c+u,window.setTimeout(o,u)}var J=window.requestAnimationFrame||W("RequestAnimationFrame")||Y,rt=window.cancelAnimationFrame||W("CancelAnimationFrame")||W("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function X(o,c,u){if(u&&J===Y)o.call(c);else return J.call(window,a(o,c))}function ot(o){o&&rt.call(window,o)}var Bt={__proto__:null,extend:s,create:r,bind:a,get lastId(){return l},stamp:h,throttle:f,wrapNum:d,falseFn:_,formatNum:m,trim:w,splitWords:A,setOptions:S,getParamString:k,template:F,isArray:M,indexOf:D,emptyImageUrl:H,requestFn:J,cancelFn:rt,requestAnimFrame:X,cancelAnimFrame:ot};function tt(){}tt.extend=function(o){var c=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},u=c.__super__=this.prototype,p=r(u);p.constructor=c,c.prototype=p;for(var g in this)Object.prototype.hasOwnProperty.call(this,g)&&g!=="prototype"&&g!=="__super__"&&(c[g]=this[g]);return o.statics&&s(c,o.statics),o.includes&&(ye(o.includes),s.apply(null,[p].concat(o.includes))),s(p,o),delete p.statics,delete p.includes,p.options&&(p.options=u.options?r(u.options):{},s(p.options,o.options)),p._initHooks=[],p.callInitHooks=function(){if(!this._initHooksCalled){u.callInitHooks&&u.callInitHooks.call(this),this._initHooksCalled=!0;for(var y=0,x=p._initHooks.length;y<x;y++)p._initHooks[y].call(this)}},c},tt.include=function(o){var c=this.prototype.options;return s(this.prototype,o),o.options&&(this.prototype.options=c,this.mergeOptions(o.options)),this},tt.mergeOptions=function(o){return s(this.prototype.options,o),this},tt.addInitHook=function(o){var c=Array.prototype.slice.call(arguments,1),u=typeof o=="function"?o:function(){this[o].apply(this,c)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(u),this};function ye(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=M(o)?o:[o];for(var c=0;c<o.length;c++)o[c]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Qt={on:function(o,c,u){if(typeof o=="object")for(var p in o)this._on(p,o[p],c);else{o=A(o);for(var g=0,y=o.length;g<y;g++)this._on(o[g],c,u)}return this},off:function(o,c,u){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var p in o)this._off(p,o[p],c);else{o=A(o);for(var g=arguments.length===1,y=0,x=o.length;y<x;y++)g?this._off(o[y]):this._off(o[y],c,u)}return this},_on:function(o,c,u,p){if(typeof c!="function"){console.warn("wrong listener type: "+typeof c);return}if(this._listens(o,c,u)===!1){u===this&&(u=void 0);var g={fn:c,ctx:u};p&&(g.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push(g)}},_off:function(o,c,u){var p,g,y;if(this._events&&(p=this._events[o],!!p)){if(arguments.length===1){if(this._firingCount)for(g=0,y=p.length;g<y;g++)p[g].fn=_;delete this._events[o];return}if(typeof c!="function"){console.warn("wrong listener type: "+typeof c);return}var x=this._listens(o,c,u);if(x!==!1){var O=p[x];this._firingCount&&(O.fn=_,this._events[o]=p=p.slice()),p.splice(x,1)}}},fire:function(o,c,u){if(!this.listens(o,u))return this;var p=s({},c,{type:o,target:this,sourceTarget:c&&c.sourceTarget||this});if(this._events){var g=this._events[o];if(g){this._firingCount=this._firingCount+1||1;for(var y=0,x=g.length;y<x;y++){var O=g[y],N=O.fn;O.once&&this.off(o,N,O.ctx),N.call(O.ctx||this,p)}this._firingCount--}}return u&&this._propagateEvent(p),this},listens:function(o,c,u,p){typeof o!="string"&&console.warn('"string" type argument expected');var g=c;typeof c!="function"&&(p=!!c,g=void 0,u=void 0);var y=this._events&&this._events[o];if(y&&y.length&&this._listens(o,g,u)!==!1)return!0;if(p){for(var x in this._eventParents)if(this._eventParents[x].listens(o,c,u,p))return!0}return!1},_listens:function(o,c,u){if(!this._events)return!1;var p=this._events[o]||[];if(!c)return!!p.length;u===this&&(u=void 0);for(var g=0,y=p.length;g<y;g++)if(p[g].fn===c&&p[g].ctx===u)return g;return!1},once:function(o,c,u){if(typeof o=="object")for(var p in o)this._on(p,o[p],c,!0);else{o=A(o);for(var g=0,y=o.length;g<y;g++)this._on(o[g],c,u,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[h(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[h(o)],this},_propagateEvent:function(o){for(var c in this._eventParents)this._eventParents[c].fire(o.type,s({layer:o.target,propagatedFrom:o.target},o),!0)}};Qt.addEventListener=Qt.on,Qt.removeEventListener=Qt.clearAllEventListeners=Qt.off,Qt.addOneTimeEventListener=Qt.once,Qt.fireEvent=Qt.fire,Qt.hasEventListeners=Qt.listens;var si=tt.extend(Qt);function et(o,c,u){this.x=u?Math.round(o):o,this.y=u?Math.round(c):c}var gc=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};et.prototype={clone:function(){return new et(this.x,this.y)},add:function(o){return this.clone()._add(Q(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(Q(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new et(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new et(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=gc(this.x),this.y=gc(this.y),this},distanceTo:function(o){o=Q(o);var c=o.x-this.x,u=o.y-this.y;return Math.sqrt(c*c+u*u)},equals:function(o){return o=Q(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=Q(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+m(this.x)+", "+m(this.y)+")"}};function Q(o,c,u){return o instanceof et?o:M(o)?new et(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new et(o.x,o.y):new et(o,c,u)}function Tt(o,c){if(o)for(var u=c?[o,c]:o,p=0,g=u.length;p<g;p++)this.extend(u[p])}Tt.prototype={extend:function(o){var c,u;if(!o)return this;if(o instanceof et||typeof o[0]=="number"||"x"in o)c=u=Q(o);else if(o=qt(o),c=o.min,u=o.max,!c||!u)return this;return!this.min&&!this.max?(this.min=c.clone(),this.max=u.clone()):(this.min.x=Math.min(c.x,this.min.x),this.max.x=Math.max(u.x,this.max.x),this.min.y=Math.min(c.y,this.min.y),this.max.y=Math.max(u.y,this.max.y)),this},getCenter:function(o){return Q((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return Q(this.min.x,this.max.y)},getTopRight:function(){return Q(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var c,u;return typeof o[0]=="number"||o instanceof et?o=Q(o):o=qt(o),o instanceof Tt?(c=o.min,u=o.max):c=u=o,c.x>=this.min.x&&u.x<=this.max.x&&c.y>=this.min.y&&u.y<=this.max.y},intersects:function(o){o=qt(o);var c=this.min,u=this.max,p=o.min,g=o.max,y=g.x>=c.x&&p.x<=u.x,x=g.y>=c.y&&p.y<=u.y;return y&&x},overlaps:function(o){o=qt(o);var c=this.min,u=this.max,p=o.min,g=o.max,y=g.x>c.x&&p.x<u.x,x=g.y>c.y&&p.y<u.y;return y&&x},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var c=this.min,u=this.max,p=Math.abs(c.x-u.x)*o,g=Math.abs(c.y-u.y)*o;return qt(Q(c.x-p,c.y-g),Q(u.x+p,u.y+g))},equals:function(o){return o?(o=qt(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function qt(o,c){return!o||o instanceof Tt?o:new Tt(o,c)}function Kt(o,c){if(o)for(var u=c?[o,c]:o,p=0,g=u.length;p<g;p++)this.extend(u[p])}Kt.prototype={extend:function(o){var c=this._southWest,u=this._northEast,p,g;if(o instanceof pt)p=o,g=o;else if(o instanceof Kt){if(p=o._southWest,g=o._northEast,!p||!g)return this}else return o?this.extend(ct(o)||Pt(o)):this;return!c&&!u?(this._southWest=new pt(p.lat,p.lng),this._northEast=new pt(g.lat,g.lng)):(c.lat=Math.min(p.lat,c.lat),c.lng=Math.min(p.lng,c.lng),u.lat=Math.max(g.lat,u.lat),u.lng=Math.max(g.lng,u.lng)),this},pad:function(o){var c=this._southWest,u=this._northEast,p=Math.abs(c.lat-u.lat)*o,g=Math.abs(c.lng-u.lng)*o;return new Kt(new pt(c.lat-p,c.lng-g),new pt(u.lat+p,u.lng+g))},getCenter:function(){return new pt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new pt(this.getNorth(),this.getWest())},getSouthEast:function(){return new pt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof pt||"lat"in o?o=ct(o):o=Pt(o);var c=this._southWest,u=this._northEast,p,g;return o instanceof Kt?(p=o.getSouthWest(),g=o.getNorthEast()):p=g=o,p.lat>=c.lat&&g.lat<=u.lat&&p.lng>=c.lng&&g.lng<=u.lng},intersects:function(o){o=Pt(o);var c=this._southWest,u=this._northEast,p=o.getSouthWest(),g=o.getNorthEast(),y=g.lat>=c.lat&&p.lat<=u.lat,x=g.lng>=c.lng&&p.lng<=u.lng;return y&&x},overlaps:function(o){o=Pt(o);var c=this._southWest,u=this._northEast,p=o.getSouthWest(),g=o.getNorthEast(),y=g.lat>c.lat&&p.lat<u.lat,x=g.lng>c.lng&&p.lng<u.lng;return y&&x},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,c){return o?(o=Pt(o),this._southWest.equals(o.getSouthWest(),c)&&this._northEast.equals(o.getNorthEast(),c)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Pt(o,c){return o instanceof Kt?o:new Kt(o,c)}function pt(o,c,u){if(isNaN(o)||isNaN(c))throw new Error("Invalid LatLng object: ("+o+", "+c+")");this.lat=+o,this.lng=+c,u!==void 0&&(this.alt=+u)}pt.prototype={equals:function(o,c){if(!o)return!1;o=ct(o);var u=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return u<=(c===void 0?1e-9:c)},toString:function(o){return"LatLng("+m(this.lat,o)+", "+m(this.lng,o)+")"},distanceTo:function(o){return Ve.distance(this,ct(o))},wrap:function(){return Ve.wrapLatLng(this)},toBounds:function(o){var c=180*o/40075017,u=c/Math.cos(Math.PI/180*this.lat);return Pt([this.lat-c,this.lng-u],[this.lat+c,this.lng+u])},clone:function(){return new pt(this.lat,this.lng,this.alt)}};function ct(o,c,u){return o instanceof pt?o:M(o)&&typeof o[0]!="object"?o.length===3?new pt(o[0],o[1],o[2]):o.length===2?new pt(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new pt(o.lat,"lng"in o?o.lng:o.lon,o.alt):c===void 0?null:new pt(o,c,u)}var Me={latLngToPoint:function(o,c){var u=this.projection.project(o),p=this.scale(c);return this.transformation._transform(u,p)},pointToLatLng:function(o,c){var u=this.scale(c),p=this.transformation.untransform(o,u);return this.projection.unproject(p)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var c=this.projection.bounds,u=this.scale(o),p=this.transformation.transform(c.min,u),g=this.transformation.transform(c.max,u);return new Tt(p,g)},infinite:!1,wrapLatLng:function(o){var c=this.wrapLng?d(o.lng,this.wrapLng,!0):o.lng,u=this.wrapLat?d(o.lat,this.wrapLat,!0):o.lat,p=o.alt;return new pt(u,c,p)},wrapLatLngBounds:function(o){var c=o.getCenter(),u=this.wrapLatLng(c),p=c.lat-u.lat,g=c.lng-u.lng;if(p===0&&g===0)return o;var y=o.getSouthWest(),x=o.getNorthEast(),O=new pt(y.lat-p,y.lng-g),N=new pt(x.lat-p,x.lng-g);return new Kt(O,N)}},Ve=s({},Me,{wrapLng:[-180,180],R:6371e3,distance:function(o,c){var u=Math.PI/180,p=o.lat*u,g=c.lat*u,y=Math.sin((c.lat-o.lat)*u/2),x=Math.sin((c.lng-o.lng)*u/2),O=y*y+Math.cos(p)*Math.cos(g)*x*x,N=2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O));return this.R*N}}),mc=6378137,kr={R:mc,MAX_LATITUDE:85.0511287798,project:function(o){var c=Math.PI/180,u=this.MAX_LATITUDE,p=Math.max(Math.min(u,o.lat),-u),g=Math.sin(p*c);return new et(this.R*o.lng*c,this.R*Math.log((1+g)/(1-g))/2)},unproject:function(o){var c=180/Math.PI;return new pt((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*c,o.x*c/this.R)},bounds:function(){var o=mc*Math.PI;return new Tt([-o,-o],[o,o])}()};function Nr(o,c,u,p){if(M(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=c,this._c=u,this._d=p}Nr.prototype={transform:function(o,c){return this._transform(o.clone(),c)},_transform:function(o,c){return c=c||1,o.x=c*(this._a*o.x+this._b),o.y=c*(this._c*o.y+this._d),o},untransform:function(o,c){return c=c||1,new et((o.x/c-this._b)/this._a,(o.y/c-this._d)/this._c)}};function ri(o,c,u,p){return new Nr(o,c,u,p)}var Dr=s({},Ve,{code:"EPSG:3857",projection:kr,transformation:function(){var o=.5/(Math.PI*kr.R);return ri(o,.5,-o,.5)}()}),Yd=s({},Dr,{code:"EPSG:900913"});function yc(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function vc(o,c){var u="",p,g,y,x,O,N;for(p=0,y=o.length;p<y;p++){for(O=o[p],g=0,x=O.length;g<x;g++)N=O[g],u+=(g?"L":"M")+N.x+" "+N.y;u+=c?Z.svg?"z":"x":""}return u||"M0 0"}var Br=document.documentElement.style,Ki="ActiveXObject"in window,qd=Ki&&!document.addEventListener,bc="msLaunchUri"in navigator&&!("documentMode"in document),Fr=ve("webkit"),wc=ve("android"),Tc=ve("android 2")||ve("android 3"),Kd=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Jd=wc&&ve("Google")&&Kd<537&&!("AudioNode"in window),Lr=!!window.opera,xc=!bc&&ve("chrome"),Ac=ve("gecko")&&!Fr&&!Lr&&!Ki,Qd=!xc&&ve("safari"),Sc=ve("phantom"),Ec="OTransition"in Br,Gd=navigator.platform.indexOf("Win")===0,Rc=Ki&&"transition"in Br,Ur="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Tc,Pc="MozPerspective"in Br,tp=!window.L_DISABLE_3D&&(Rc||Ur||Pc)&&!Ec&&!Sc,oi=typeof orientation<"u"||ve("mobile"),ep=oi&&Fr,np=oi&&Ur,Ic=!window.PointerEvent&&window.MSPointerEvent,Cc=!!(window.PointerEvent||Ic),Mc="ontouchstart"in window||!!window.TouchEvent,ip=!window.L_NO_TOUCH&&(Mc||Cc),sp=oi&&Lr,rp=oi&&Ac,op=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ap=function(){var o=!1;try{var c=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",_,c),window.removeEventListener("testPassiveEventSupport",_,c)}catch{}return o}(),cp=function(){return!!document.createElement("canvas").getContext}(),Vr=!!(document.createElementNS&&yc("svg").createSVGRect),lp=!!Vr&&function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),hp=!Vr&&function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var c=o.firstChild;return c.style.behavior="url(#default#VML)",c&&typeof c.adj=="object"}catch{return!1}}(),up=navigator.platform.indexOf("Mac")===0,fp=navigator.platform.indexOf("Linux")===0;function ve(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var Z={ie:Ki,ielt9:qd,edge:bc,webkit:Fr,android:wc,android23:Tc,androidStock:Jd,opera:Lr,chrome:xc,gecko:Ac,safari:Qd,phantom:Sc,opera12:Ec,win:Gd,ie3d:Rc,webkit3d:Ur,gecko3d:Pc,any3d:tp,mobile:oi,mobileWebkit:ep,mobileWebkit3d:np,msPointer:Ic,pointer:Cc,touch:ip,touchNative:Mc,mobileOpera:sp,mobileGecko:rp,retina:op,passiveEvents:ap,canvas:cp,svg:Vr,vml:hp,inlineSvg:lp,mac:up,linux:fp},Oc=Z.msPointer?"MSPointerDown":"pointerdown",kc=Z.msPointer?"MSPointerMove":"pointermove",Nc=Z.msPointer?"MSPointerUp":"pointerup",Dc=Z.msPointer?"MSPointerCancel":"pointercancel",zr={touchstart:Oc,touchmove:kc,touchend:Nc,touchcancel:Dc},Bc={touchstart:yp,touchmove:Ji,touchend:Ji,touchcancel:Ji},An={},Fc=!1;function dp(o,c,u){return c==="touchstart"&&mp(),Bc[c]?(u=Bc[c].bind(this,u),o.addEventListener(zr[c],u,!1),u):(console.warn("wrong event specified:",c),_)}function pp(o,c,u){if(!zr[c]){console.warn("wrong event specified:",c);return}o.removeEventListener(zr[c],u,!1)}function _p(o){An[o.pointerId]=o}function gp(o){An[o.pointerId]&&(An[o.pointerId]=o)}function Lc(o){delete An[o.pointerId]}function mp(){Fc||(document.addEventListener(Oc,_p,!0),document.addEventListener(kc,gp,!0),document.addEventListener(Nc,Lc,!0),document.addEventListener(Dc,Lc,!0),Fc=!0)}function Ji(o,c){if(c.pointerType!==(c.MSPOINTER_TYPE_MOUSE||"mouse")){c.touches=[];for(var u in An)c.touches.push(An[u]);c.changedTouches=[c],o(c)}}function yp(o,c){c.MSPOINTER_TYPE_TOUCH&&c.pointerType===c.MSPOINTER_TYPE_TOUCH&&Ut(c),Ji(o,c)}function vp(o){var c={},u,p;for(p in o)u=o[p],c[p]=u&&u.bind?u.bind(o):u;return o=c,c.type="dblclick",c.detail=2,c.isTrusted=!1,c._simulated=!0,c}var bp=200;function wp(o,c){o.addEventListener("dblclick",c);var u=0,p;function g(y){if(y.detail!==1){p=y.detail;return}if(!(y.pointerType==="mouse"||y.sourceCapabilities&&!y.sourceCapabilities.firesTouchEvents)){var x=Hc(y);if(!(x.some(function(N){return N instanceof HTMLLabelElement&&N.attributes.for})&&!x.some(function(N){return N instanceof HTMLInputElement||N instanceof HTMLSelectElement}))){var O=Date.now();O-u<=bp?(p++,p===2&&c(vp(y))):p=1,u=O}}}return o.addEventListener("click",g),{dblclick:c,simDblclick:g}}function Tp(o,c){o.removeEventListener("dblclick",c.dblclick),o.removeEventListener("click",c.simDblclick)}var Wr=ts(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ai=ts(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Uc=ai==="webkitTransition"||ai==="OTransition"?ai+"End":"transitionend";function Vc(o){return typeof o=="string"?document.getElementById(o):o}function ci(o,c){var u=o.style[c]||o.currentStyle&&o.currentStyle[c];if((!u||u==="auto")&&document.defaultView){var p=document.defaultView.getComputedStyle(o,null);u=p?p[c]:null}return u==="auto"?null:u}function ht(o,c,u){var p=document.createElement(o);return p.className=c||"",u&&u.appendChild(p),p}function xt(o){var c=o.parentNode;c&&c.removeChild(o)}function Qi(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function Sn(o){var c=o.parentNode;c&&c.lastChild!==o&&c.appendChild(o)}function En(o){var c=o.parentNode;c&&c.firstChild!==o&&c.insertBefore(o,c.firstChild)}function Hr(o,c){if(o.classList!==void 0)return o.classList.contains(c);var u=Gi(o);return u.length>0&&new RegExp("(^|\\s)"+c+"(\\s|$)").test(u)}function it(o,c){if(o.classList!==void 0)for(var u=A(c),p=0,g=u.length;p<g;p++)o.classList.add(u[p]);else if(!Hr(o,c)){var y=Gi(o);$r(o,(y?y+" ":"")+c)}}function Rt(o,c){o.classList!==void 0?o.classList.remove(c):$r(o,w((" "+Gi(o)+" ").replace(" "+c+" "," ")))}function $r(o,c){o.className.baseVal===void 0?o.className=c:o.className.baseVal=c}function Gi(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function ne(o,c){"opacity"in o.style?o.style.opacity=c:"filter"in o.style&&xp(o,c)}function xp(o,c){var u=!1,p="DXImageTransform.Microsoft.Alpha";try{u=o.filters.item(p)}catch{if(c===1)return}c=Math.round(c*100),u?(u.Enabled=c!==100,u.Opacity=c):o.style.filter+=" progid:"+p+"(opacity="+c+")"}function ts(o){for(var c=document.documentElement.style,u=0;u<o.length;u++)if(o[u]in c)return o[u];return!1}function nn(o,c,u){var p=c||new et(0,0);o.style[Wr]=(Z.ie3d?"translate("+p.x+"px,"+p.y+"px)":"translate3d("+p.x+"px,"+p.y+"px,0)")+(u?" scale("+u+")":"")}function It(o,c){o._leaflet_pos=c,Z.any3d?nn(o,c):(o.style.left=c.x+"px",o.style.top=c.y+"px")}function sn(o){return o._leaflet_pos||new et(0,0)}var li,hi,jr;if("onselectstart"in document)li=function(){nt(window,"selectstart",Ut)},hi=function(){yt(window,"selectstart",Ut)};else{var ui=ts(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);li=function(){if(ui){var o=document.documentElement.style;jr=o[ui],o[ui]="none"}},hi=function(){ui&&(document.documentElement.style[ui]=jr,jr=void 0)}}function Xr(){nt(window,"dragstart",Ut)}function Zr(){yt(window,"dragstart",Ut)}var es,Yr;function qr(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(ns(),es=o,Yr=o.style.outlineStyle,o.style.outlineStyle="none",nt(window,"keydown",ns))}function ns(){es&&(es.style.outlineStyle=Yr,es=void 0,Yr=void 0,yt(window,"keydown",ns))}function zc(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function Kr(o){var c=o.getBoundingClientRect();return{x:c.width/o.offsetWidth||1,y:c.height/o.offsetHeight||1,boundingClientRect:c}}var Ap={__proto__:null,TRANSFORM:Wr,TRANSITION:ai,TRANSITION_END:Uc,get:Vc,getStyle:ci,create:ht,remove:xt,empty:Qi,toFront:Sn,toBack:En,hasClass:Hr,addClass:it,removeClass:Rt,setClass:$r,getClass:Gi,setOpacity:ne,testProp:ts,setTransform:nn,setPosition:It,getPosition:sn,get disableTextSelection(){return li},get enableTextSelection(){return hi},disableImageDrag:Xr,enableImageDrag:Zr,preventOutline:qr,restoreOutline:ns,getSizedParentNode:zc,getScale:Kr};function nt(o,c,u,p){if(c&&typeof c=="object")for(var g in c)Qr(o,g,c[g],u);else{c=A(c);for(var y=0,x=c.length;y<x;y++)Qr(o,c[y],u,p)}return this}var be="_leaflet_events";function yt(o,c,u,p){if(arguments.length===1)Wc(o),delete o[be];else if(c&&typeof c=="object")for(var g in c)Gr(o,g,c[g],u);else if(c=A(c),arguments.length===2)Wc(o,function(O){return D(c,O)!==-1});else for(var y=0,x=c.length;y<x;y++)Gr(o,c[y],u,p);return this}function Wc(o,c){for(var u in o[be]){var p=u.split(/\d/)[0];(!c||c(p))&&Gr(o,p,null,null,u)}}var Jr={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Qr(o,c,u,p){var g=c+h(u)+(p?"_"+h(p):"");if(o[be]&&o[be][g])return this;var y=function(O){return u.call(p||o,O||window.event)},x=y;!Z.touchNative&&Z.pointer&&c.indexOf("touch")===0?y=dp(o,c,y):Z.touch&&c==="dblclick"?y=wp(o,y):"addEventListener"in o?c==="touchstart"||c==="touchmove"||c==="wheel"||c==="mousewheel"?o.addEventListener(Jr[c]||c,y,Z.passiveEvents?{passive:!1}:!1):c==="mouseenter"||c==="mouseleave"?(y=function(O){O=O||window.event,eo(o,O)&&x(O)},o.addEventListener(Jr[c],y,!1)):o.addEventListener(c,x,!1):o.attachEvent("on"+c,y),o[be]=o[be]||{},o[be][g]=y}function Gr(o,c,u,p,g){g=g||c+h(u)+(p?"_"+h(p):"");var y=o[be]&&o[be][g];if(!y)return this;!Z.touchNative&&Z.pointer&&c.indexOf("touch")===0?pp(o,c,y):Z.touch&&c==="dblclick"?Tp(o,y):"removeEventListener"in o?o.removeEventListener(Jr[c]||c,y,!1):o.detachEvent("on"+c,y),o[be][g]=null}function rn(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function to(o){return Qr(o,"wheel",rn),this}function fi(o){return nt(o,"mousedown touchstart dblclick contextmenu",rn),o._leaflet_disable_click=!0,this}function Ut(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function on(o){return Ut(o),rn(o),this}function Hc(o){if(o.composedPath)return o.composedPath();for(var c=[],u=o.target;u;)c.push(u),u=u.parentNode;return c}function $c(o,c){if(!c)return new et(o.clientX,o.clientY);var u=Kr(c),p=u.boundingClientRect;return new et((o.clientX-p.left)/u.x-c.clientLeft,(o.clientY-p.top)/u.y-c.clientTop)}var Sp=Z.linux&&Z.chrome?window.devicePixelRatio:Z.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function jc(o){return Z.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/Sp:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function eo(o,c){var u=c.relatedTarget;if(!u)return!0;try{for(;u&&u!==o;)u=u.parentNode}catch{return!1}return u!==o}var Ep={__proto__:null,on:nt,off:yt,stopPropagation:rn,disableScrollPropagation:to,disableClickPropagation:fi,preventDefault:Ut,stop:on,getPropagationPath:Hc,getMousePosition:$c,getWheelDelta:jc,isExternalTarget:eo,addListener:nt,removeListener:yt},Xc=si.extend({run:function(o,c,u,p){this.stop(),this._el=o,this._inProgress=!0,this._duration=u||.25,this._easeOutPower=1/Math.max(p||.5,.2),this._startPos=sn(o),this._offset=c.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=X(this._animate,this),this._step()},_step:function(o){var c=+new Date-this._startTime,u=this._duration*1e3;c<u?this._runFrame(this._easeOut(c/u),o):(this._runFrame(1),this._complete())},_runFrame:function(o,c){var u=this._startPos.add(this._offset.multiplyBy(o));c&&u._round(),It(this._el,u),this.fire("step")},_complete:function(){ot(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),lt=si.extend({options:{crs:Dr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,c){c=S(this,c),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),c.maxBounds&&this.setMaxBounds(c.maxBounds),c.zoom!==void 0&&(this._zoom=this._limitZoom(c.zoom)),c.center&&c.zoom!==void 0&&this.setView(ct(c.center),c.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ai&&Z.any3d&&!Z.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),nt(this._proxy,Uc,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,c,u){if(c=c===void 0?this._zoom:this._limitZoom(c),o=this._limitCenter(ct(o),c,this.options.maxBounds),u=u||{},this._stop(),this._loaded&&!u.reset&&u!==!0){u.animate!==void 0&&(u.zoom=s({animate:u.animate},u.zoom),u.pan=s({animate:u.animate,duration:u.duration},u.pan));var p=this._zoom!==c?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,c,u.zoom):this._tryAnimatedPan(o,u.pan);if(p)return clearTimeout(this._sizeTimer),this}return this._resetView(o,c,u.pan&&u.pan.noMoveStart),this},setZoom:function(o,c){return this._loaded?this.setView(this.getCenter(),o,{zoom:c}):(this._zoom=o,this)},zoomIn:function(o,c){return o=o||(Z.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,c)},zoomOut:function(o,c){return o=o||(Z.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,c)},setZoomAround:function(o,c,u){var p=this.getZoomScale(c),g=this.getSize().divideBy(2),y=o instanceof et?o:this.latLngToContainerPoint(o),x=y.subtract(g).multiplyBy(1-1/p),O=this.containerPointToLatLng(g.add(x));return this.setView(O,c,{zoom:u})},_getBoundsCenterZoom:function(o,c){c=c||{},o=o.getBounds?o.getBounds():Pt(o);var u=Q(c.paddingTopLeft||c.padding||[0,0]),p=Q(c.paddingBottomRight||c.padding||[0,0]),g=this.getBoundsZoom(o,!1,u.add(p));if(g=typeof c.maxZoom=="number"?Math.min(c.maxZoom,g):g,g===1/0)return{center:o.getCenter(),zoom:g};var y=p.subtract(u).divideBy(2),x=this.project(o.getSouthWest(),g),O=this.project(o.getNorthEast(),g),N=this.unproject(x.add(O).divideBy(2).add(y),g);return{center:N,zoom:g}},fitBounds:function(o,c){if(o=Pt(o),!o.isValid())throw new Error("Bounds are not valid.");var u=this._getBoundsCenterZoom(o,c);return this.setView(u.center,u.zoom,c)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,c){return this.setView(o,this._zoom,{pan:c})},panBy:function(o,c){if(o=Q(o).round(),c=c||{},!o.x&&!o.y)return this.fire("moveend");if(c.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Xc,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),c.noMoveStart||this.fire("movestart"),c.animate!==!1){it(this._mapPane,"leaflet-pan-anim");var u=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,u,c.duration||.25,c.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,c,u){if(u=u||{},u.animate===!1||!Z.any3d)return this.setView(o,c,u);this._stop();var p=this.project(this.getCenter()),g=this.project(o),y=this.getSize(),x=this._zoom;o=ct(o),c=c===void 0?x:c;var O=Math.max(y.x,y.y),N=O*this.getZoomScale(x,c),V=g.distanceTo(p)||1,j=1.42,K=j*j;function st(Ct){var ps=Ct?-1:1,p_=Ct?N:O,__=N*N-O*O+ps*K*K*V*V,g_=2*p_*K*V,fo=__/g_,El=Math.sqrt(fo*fo+1)-fo,m_=El<1e-9?-18:Math.log(El);return m_}function Xt(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Ft(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}function se(Ct){return Xt(Ct)/Ft(Ct)}var Jt=st(0);function On(Ct){return O*(Ft(Jt)/Ft(Jt+j*Ct))}function h_(Ct){return O*(Ft(Jt)*se(Jt+j*Ct)-Xt(Jt))/K}function u_(Ct){return 1-Math.pow(1-Ct,1.5)}var f_=Date.now(),Al=(st(1)-Jt)/j,d_=u.duration?1e3*u.duration:1e3*Al*.8;function Sl(){var Ct=(Date.now()-f_)/d_,ps=u_(Ct)*Al;Ct<=1?(this._flyToFrame=X(Sl,this),this._move(this.unproject(p.add(g.subtract(p).multiplyBy(h_(ps)/V)),x),this.getScaleZoom(O/On(ps),x),{flyTo:!0})):this._move(o,c)._moveEnd(!0)}return this._moveStart(!0,u.noMoveStart),Sl.call(this),this},flyToBounds:function(o,c){var u=this._getBoundsCenterZoom(o,c);return this.flyTo(u.center,u.zoom,c)},setMaxBounds:function(o){return o=Pt(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var c=this.options.minZoom;return this.options.minZoom=o,this._loaded&&c!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var c=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&c!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,c){this._enforcingBounds=!0;var u=this.getCenter(),p=this._limitCenter(u,this._zoom,Pt(o));return u.equals(p)||this.panTo(p,c),this._enforcingBounds=!1,this},panInside:function(o,c){c=c||{};var u=Q(c.paddingTopLeft||c.padding||[0,0]),p=Q(c.paddingBottomRight||c.padding||[0,0]),g=this.project(this.getCenter()),y=this.project(o),x=this.getPixelBounds(),O=qt([x.min.add(u),x.max.subtract(p)]),N=O.getSize();if(!O.contains(y)){this._enforcingBounds=!0;var V=y.subtract(O.getCenter()),j=O.extend(y).getSize().subtract(N);g.x+=V.x<0?-j.x:j.x,g.y+=V.y<0?-j.y:j.y,this.panTo(this.unproject(g),c),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=s({animate:!1,pan:!0},o===!0?{animate:!0}:o);var c=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var u=this.getSize(),p=c.divideBy(2).round(),g=u.divideBy(2).round(),y=p.subtract(g);return!y.x&&!y.y?this:(o.animate&&o.pan?this.panBy(y):(o.pan&&this._rawPanBy(y),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:c,newSize:u}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=s({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var c=a(this._handleGeolocationResponse,this),u=a(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(c,u,o):navigator.geolocation.getCurrentPosition(c,u,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var c=o.code,u=o.message||(c===1?"permission denied":c===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:c,message:"Geolocation error: "+u+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var c=o.coords.latitude,u=o.coords.longitude,p=new pt(c,u),g=p.toBounds(o.coords.accuracy*2),y=this._locateOptions;if(y.setView){var x=this.getBoundsZoom(g);this.setView(p,y.maxZoom?Math.min(x,y.maxZoom):x)}var O={latlng:p,bounds:g,timestamp:o.timestamp};for(var N in o.coords)typeof o.coords[N]=="number"&&(O[N]=o.coords[N]);this.fire("locationfound",O)}},addHandler:function(o,c){if(!c)return this;var u=this[o]=new c(this);return this._handlers.push(u),this.options[o]&&u.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),xt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ot(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)xt(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,c){var u="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),p=ht("div",u,c||this._mapPane);return o&&(this._panes[o]=p),p},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),c=this.unproject(o.getBottomLeft()),u=this.unproject(o.getTopRight());return new Kt(c,u)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,c,u){o=Pt(o),u=Q(u||[0,0]);var p=this.getZoom()||0,g=this.getMinZoom(),y=this.getMaxZoom(),x=o.getNorthWest(),O=o.getSouthEast(),N=this.getSize().subtract(u),V=qt(this.project(O,p),this.project(x,p)).getSize(),j=Z.any3d?this.options.zoomSnap:1,K=N.x/V.x,st=N.y/V.y,Xt=c?Math.max(K,st):Math.min(K,st);return p=this.getScaleZoom(Xt,p),j&&(p=Math.round(p/(j/100))*(j/100),p=c?Math.ceil(p/j)*j:Math.floor(p/j)*j),Math.max(g,Math.min(y,p))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new et(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,c){var u=this._getTopLeftPoint(o,c);return new Tt(u,u.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,c){var u=this.options.crs;return c=c===void 0?this._zoom:c,u.scale(o)/u.scale(c)},getScaleZoom:function(o,c){var u=this.options.crs;c=c===void 0?this._zoom:c;var p=u.zoom(o*u.scale(c));return isNaN(p)?1/0:p},project:function(o,c){return c=c===void 0?this._zoom:c,this.options.crs.latLngToPoint(ct(o),c)},unproject:function(o,c){return c=c===void 0?this._zoom:c,this.options.crs.pointToLatLng(Q(o),c)},layerPointToLatLng:function(o){var c=Q(o).add(this.getPixelOrigin());return this.unproject(c)},latLngToLayerPoint:function(o){var c=this.project(ct(o))._round();return c._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(ct(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(Pt(o))},distance:function(o,c){return this.options.crs.distance(ct(o),ct(c))},containerPointToLayerPoint:function(o){return Q(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return Q(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var c=this.containerPointToLayerPoint(Q(o));return this.layerPointToLatLng(c)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ct(o)))},mouseEventToContainerPoint:function(o){return $c(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var c=this._container=Vc(o);if(c){if(c._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");nt(c,"scroll",this._onScroll,this),this._containerId=h(c)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&Z.any3d,it(o,"leaflet-container"+(Z.touch?" leaflet-touch":"")+(Z.retina?" leaflet-retina":"")+(Z.ielt9?" leaflet-oldie":"")+(Z.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var c=ci(o,"position");c!=="absolute"&&c!=="relative"&&c!=="fixed"&&c!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),It(this._mapPane,new et(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(it(o.markerPane,"leaflet-zoom-hide"),it(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,c,u){It(this._mapPane,new et(0,0));var p=!this._loaded;this._loaded=!0,c=this._limitZoom(c),this.fire("viewprereset");var g=this._zoom!==c;this._moveStart(g,u)._move(o,c)._moveEnd(g),this.fire("viewreset"),p&&this.fire("load")},_moveStart:function(o,c){return o&&this.fire("zoomstart"),c||this.fire("movestart"),this},_move:function(o,c,u,p){c===void 0&&(c=this._zoom);var g=this._zoom!==c;return this._zoom=c,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),p?u&&u.pinch&&this.fire("zoom",u):((g||u&&u.pinch)&&this.fire("zoom",u),this.fire("move",u)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ot(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){It(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[h(this._container)]=this;var c=o?yt:nt;c(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&c(window,"resize",this._onResize,this),Z.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ot(this._resizeRequest),this._resizeRequest=X(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,c){for(var u=[],p,g=c==="mouseout"||c==="mouseover",y=o.target||o.srcElement,x=!1;y;){if(p=this._targets[h(y)],p&&(c==="click"||c==="preclick")&&this._draggableMoved(p)){x=!0;break}if(p&&p.listens(c,!0)&&(g&&!eo(y,o)||(u.push(p),g))||y===this._container)break;y=y.parentNode}return!u.length&&!x&&!g&&this.listens(c,!0)&&(u=[this]),u},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var c=o.target||o.srcElement;if(!(!this._loaded||c._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(c))){var u=o.type;u==="mousedown"&&qr(c),this._fireDOMEvent(o,u)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,c,u){if(o.type==="click"){var p=s({},o);p.type="preclick",this._fireDOMEvent(p,p.type,u)}var g=this._findEventTargets(o,c);if(u){for(var y=[],x=0;x<u.length;x++)u[x].listens(c,!0)&&y.push(u[x]);g=y.concat(g)}if(g.length){c==="contextmenu"&&Ut(o);var O=g[0],N={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var V=O.getLatLng&&(!O._radius||O._radius<=10);N.containerPoint=V?this.latLngToContainerPoint(O.getLatLng()):this.mouseEventToContainerPoint(o),N.layerPoint=this.containerPointToLayerPoint(N.containerPoint),N.latlng=V?O.getLatLng():this.layerPointToLatLng(N.layerPoint)}for(x=0;x<g.length;x++)if(g[x].fire(c,N,!0),N.originalEvent._stopped||g[x].options.bubblingMouseEvents===!1&&D(this._mouseEvents,c)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,c=this._handlers.length;o<c;o++)this._handlers[o].disable()},whenReady:function(o,c){return this._loaded?o.call(c||this,{target:this}):this.on("load",o,c),this},_getMapPanePos:function(){return sn(this._mapPane)||new et(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,c){var u=o&&c!==void 0?this._getNewPixelOrigin(o,c):this.getPixelOrigin();return u.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,c){var u=this.getSize()._divideBy(2);return this.project(o,c)._subtract(u)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,c,u){var p=this._getNewPixelOrigin(u,c);return this.project(o,c)._subtract(p)},_latLngBoundsToNewLayerBounds:function(o,c,u){var p=this._getNewPixelOrigin(u,c);return qt([this.project(o.getSouthWest(),c)._subtract(p),this.project(o.getNorthWest(),c)._subtract(p),this.project(o.getSouthEast(),c)._subtract(p),this.project(o.getNorthEast(),c)._subtract(p)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,c,u){if(!u)return o;var p=this.project(o,c),g=this.getSize().divideBy(2),y=new Tt(p.subtract(g),p.add(g)),x=this._getBoundsOffset(y,u,c);return Math.abs(x.x)<=1&&Math.abs(x.y)<=1?o:this.unproject(p.add(x),c)},_limitOffset:function(o,c){if(!c)return o;var u=this.getPixelBounds(),p=new Tt(u.min.add(o),u.max.add(o));return o.add(this._getBoundsOffset(p,c))},_getBoundsOffset:function(o,c,u){var p=qt(this.project(c.getNorthEast(),u),this.project(c.getSouthWest(),u)),g=p.min.subtract(o.min),y=p.max.subtract(o.max),x=this._rebound(g.x,-y.x),O=this._rebound(g.y,-y.y);return new et(x,O)},_rebound:function(o,c){return o+c>0?Math.round(o-c)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(c))},_limitZoom:function(o){var c=this.getMinZoom(),u=this.getMaxZoom(),p=Z.any3d?this.options.zoomSnap:1;return p&&(o=Math.round(o/p)*p),Math.max(c,Math.min(u,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Rt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,c){var u=this._getCenterOffset(o)._trunc();return(c&&c.animate)!==!0&&!this.getSize().contains(u)?!1:(this.panBy(u,c),!0)},_createAnimProxy:function(){var o=this._proxy=ht("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(c){var u=Wr,p=this._proxy.style[u];nn(this._proxy,this.project(c.center,c.zoom),this.getZoomScale(c.zoom,1)),p===this._proxy.style[u]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){xt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),c=this.getZoom();nn(this._proxy,this.project(o,c),this.getZoomScale(c,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,c,u){if(this._animatingZoom)return!0;if(u=u||{},!this._zoomAnimated||u.animate===!1||this._nothingToAnimate()||Math.abs(c-this._zoom)>this.options.zoomAnimationThreshold)return!1;var p=this.getZoomScale(c),g=this._getCenterOffset(o)._divideBy(1-1/p);return u.animate!==!0&&!this.getSize().contains(g)?!1:(X(function(){this._moveStart(!0,u.noMoveStart||!1)._animateZoom(o,c,!0)},this),!0)},_animateZoom:function(o,c,u,p){this._mapPane&&(u&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=c,it(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:c,noUpdate:p}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Rt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Rp(o,c){return new lt(o,c)}var ue=tt.extend({options:{position:"topright"},initialize:function(o){S(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var c=this._map;return c&&c.removeControl(this),this.options.position=o,c&&c.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var c=this._container=this.onAdd(o),u=this.getPosition(),p=o._controlCorners[u];return it(c,"leaflet-control"),u.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(xt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),di=function(o){return new ue(o)};lt.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},c="leaflet-",u=this._controlContainer=ht("div",c+"control-container",this._container);function p(g,y){var x=c+g+" "+c+y;o[g+y]=ht("div",x,u)}p("top","left"),p("top","right"),p("bottom","left"),p("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)xt(this._controlCorners[o]);xt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Zc=ue.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,c,u,p){return u<p?-1:p<u?1:0}},initialize:function(o,c,u){S(this,u),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var p in o)this._addLayer(o[p],p);for(p in c)this._addLayer(c[p],p,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var c=0;c<this._layers.length;c++)this._layers[c].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return ue.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,c){return this._addLayer(o,c),this._map?this._update():this},addOverlay:function(o,c){return this._addLayer(o,c,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var c=this._getLayer(h(o));return c&&this._layers.splice(this._layers.indexOf(c),1),this._map?this._update():this},expand:function(){it(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(it(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):Rt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Rt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",c=this._container=ht("div",o),u=this.options.collapsed;c.setAttribute("aria-haspopup",!0),fi(c),to(c);var p=this._section=ht("section",o+"-list");u&&(this._map.on("click",this.collapse,this),nt(c,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var g=this._layersLink=ht("a",o+"-toggle",c);g.href="#",g.title="Layers",g.setAttribute("role","button"),nt(g,{keydown:function(y){y.keyCode===13&&this._expandSafely()},click:function(y){Ut(y),this._expandSafely()}},this),u||this.expand(),this._baseLayersList=ht("div",o+"-base",p),this._separator=ht("div",o+"-separator",p),this._overlaysList=ht("div",o+"-overlays",p),c.appendChild(p)},_getLayer:function(o){for(var c=0;c<this._layers.length;c++)if(this._layers[c]&&h(this._layers[c].layer)===o)return this._layers[c]},_addLayer:function(o,c,u){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:c,overlay:u}),this.options.sortLayers&&this._layers.sort(a(function(p,g){return this.options.sortFunction(p.layer,g.layer,p.name,g.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Qi(this._baseLayersList),Qi(this._overlaysList),this._layerControlInputs=[];var o,c,u,p,g=0;for(u=0;u<this._layers.length;u++)p=this._layers[u],this._addItem(p),c=c||p.overlay,o=o||!p.overlay,g+=p.overlay?0:1;return this.options.hideSingleBase&&(o=o&&g>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=c&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var c=this._getLayer(h(o.target)),u=c.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;u&&this._map.fire(u,c)},_createRadioElement:function(o,c){var u='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(c?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=u,p.firstChild},_addItem:function(o){var c=document.createElement("label"),u=this._map.hasLayer(o.layer),p;o.overlay?(p=document.createElement("input"),p.type="checkbox",p.className="leaflet-control-layers-selector",p.defaultChecked=u):p=this._createRadioElement("leaflet-base-layers_"+h(this),u),this._layerControlInputs.push(p),p.layerId=h(o.layer),nt(p,"click",this._onInputClick,this);var g=document.createElement("span");g.innerHTML=" "+o.name;var y=document.createElement("span");c.appendChild(y),y.appendChild(p),y.appendChild(g);var x=o.overlay?this._overlaysList:this._baseLayersList;return x.appendChild(c),this._checkDisabledLayers(),c},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,c,u,p=[],g=[];this._handlingClick=!0;for(var y=o.length-1;y>=0;y--)c=o[y],u=this._getLayer(c.layerId).layer,c.checked?p.push(u):c.checked||g.push(u);for(y=0;y<g.length;y++)this._map.hasLayer(g[y])&&this._map.removeLayer(g[y]);for(y=0;y<p.length;y++)this._map.hasLayer(p[y])||this._map.addLayer(p[y]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,c,u,p=this._map.getZoom(),g=o.length-1;g>=0;g--)c=o[g],u=this._getLayer(c.layerId).layer,c.disabled=u.options.minZoom!==void 0&&p<u.options.minZoom||u.options.maxZoom!==void 0&&p>u.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,nt(o,"click",Ut),this.expand();var c=this;setTimeout(function(){yt(o,"click",Ut),c._preventClick=!1})}}),Pp=function(o,c,u){return new Zc(o,c,u)},no=ue.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var c="leaflet-control-zoom",u=ht("div",c+" leaflet-bar"),p=this.options;return this._zoomInButton=this._createButton(p.zoomInText,p.zoomInTitle,c+"-in",u,this._zoomIn),this._zoomOutButton=this._createButton(p.zoomOutText,p.zoomOutTitle,c+"-out",u,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),u},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,c,u,p,g){var y=ht("a",u,p);return y.innerHTML=o,y.href="#",y.title=c,y.setAttribute("role","button"),y.setAttribute("aria-label",c),fi(y),nt(y,"click",on),nt(y,"click",g,this),nt(y,"click",this._refocusOnMap,this),y},_updateDisabled:function(){var o=this._map,c="leaflet-disabled";Rt(this._zoomInButton,c),Rt(this._zoomOutButton,c),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(it(this._zoomOutButton,c),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(it(this._zoomInButton,c),this._zoomInButton.setAttribute("aria-disabled","true"))}});lt.mergeOptions({zoomControl:!0}),lt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new no,this.addControl(this.zoomControl))});var Ip=function(o){return new no(o)},Yc=ue.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var c="leaflet-control-scale",u=ht("div",c),p=this.options;return this._addScales(p,c+"-line",u),o.on(p.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),u},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,c,u){o.metric&&(this._mScale=ht("div",c,u)),o.imperial&&(this._iScale=ht("div",c,u))},_update:function(){var o=this._map,c=o.getSize().y/2,u=o.distance(o.containerPointToLatLng([0,c]),o.containerPointToLatLng([this.options.maxWidth,c]));this._updateScales(u)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var c=this._getRoundNum(o),u=c<1e3?c+" m":c/1e3+" km";this._updateScale(this._mScale,u,c/o)},_updateImperial:function(o){var c=o*3.2808399,u,p,g;c>5280?(u=c/5280,p=this._getRoundNum(u),this._updateScale(this._iScale,p+" mi",p/u)):(g=this._getRoundNum(c),this._updateScale(this._iScale,g+" ft",g/c))},_updateScale:function(o,c,u){o.style.width=Math.round(this.options.maxWidth*u)+"px",o.innerHTML=c},_getRoundNum:function(o){var c=Math.pow(10,(Math.floor(o)+"").length-1),u=o/c;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,c*u}}),Cp=function(o){return new Yc(o)},Mp='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',io=ue.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Z.inlineSvg?Mp+" ":"")+"Leaflet</a>"},initialize:function(o){S(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=ht("div","leaflet-control-attribution"),fi(this._container);for(var c in o._layers)o._layers[c].getAttribution&&this.addAttribution(o._layers[c].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var c in this._attributions)this._attributions[c]&&o.push(c);var u=[];this.options.prefix&&u.push(this.options.prefix),o.length&&u.push(o.join(", ")),this._container.innerHTML=u.join(' <span aria-hidden="true">|</span> ')}}});lt.mergeOptions({attributionControl:!0}),lt.addInitHook(function(){this.options.attributionControl&&new io().addTo(this)});var Op=function(o){return new io(o)};ue.Layers=Zc,ue.Zoom=no,ue.Scale=Yc,ue.Attribution=io,di.layers=Pp,di.zoom=Ip,di.scale=Cp,di.attribution=Op;var we=tt.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});we.addTo=function(o,c){return o.addHandler(c,this),this};var kp={Events:Qt},qc=Z.touch?"touchstart mousedown":"mousedown",ze=si.extend({options:{clickTolerance:3},initialize:function(o,c,u,p){S(this,p),this._element=o,this._dragStartTarget=c||o,this._preventOutline=u},enable:function(){this._enabled||(nt(this._dragStartTarget,qc,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ze._dragging===this&&this.finishDrag(!0),yt(this._dragStartTarget,qc,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!Hr(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){ze._dragging===this&&this.finishDrag();return}if(!(ze._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(ze._dragging=this,this._preventOutline&&qr(this._element),Xr(),li(),!this._moving)){this.fire("down");var c=o.touches?o.touches[0]:o,u=zc(this._element);this._startPoint=new et(c.clientX,c.clientY),this._startPos=sn(this._element),this._parentScale=Kr(u);var p=o.type==="mousedown";nt(document,p?"mousemove":"touchmove",this._onMove,this),nt(document,p?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var c=o.touches&&o.touches.length===1?o.touches[0]:o,u=new et(c.clientX,c.clientY)._subtract(this._startPoint);!u.x&&!u.y||Math.abs(u.x)+Math.abs(u.y)<this.options.clickTolerance||(u.x/=this._parentScale.x,u.y/=this._parentScale.y,Ut(o),this._moved||(this.fire("dragstart"),this._moved=!0,it(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),it(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(u),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),It(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){Rt(document.body,"leaflet-dragging"),this._lastTarget&&(Rt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),yt(document,"mousemove touchmove",this._onMove,this),yt(document,"mouseup touchend touchcancel",this._onUp,this),Zr(),hi();var c=this._moved&&this._moving;this._moving=!1,ze._dragging=!1,c&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function Kc(o,c,u){var p,g=[1,4,2,8],y,x,O,N,V,j,K,st;for(y=0,j=o.length;y<j;y++)o[y]._code=an(o[y],c);for(O=0;O<4;O++){for(K=g[O],p=[],y=0,j=o.length,x=j-1;y<j;x=y++)N=o[y],V=o[x],N._code&K?V._code&K||(st=is(V,N,K,c,u),st._code=an(st,c),p.push(st)):(V._code&K&&(st=is(V,N,K,c,u),st._code=an(st,c),p.push(st)),p.push(N));o=p}return o}function Jc(o,c){var u,p,g,y,x,O,N,V,j;if(!o||o.length===0)throw new Error("latlngs not passed");ie(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var K=ct([0,0]),st=Pt(o),Xt=st.getNorthWest().distanceTo(st.getSouthWest())*st.getNorthEast().distanceTo(st.getNorthWest());Xt<1700&&(K=so(o));var Ft=o.length,se=[];for(u=0;u<Ft;u++){var Jt=ct(o[u]);se.push(c.project(ct([Jt.lat-K.lat,Jt.lng-K.lng])))}for(O=N=V=0,u=0,p=Ft-1;u<Ft;p=u++)g=se[u],y=se[p],x=g.y*y.x-y.y*g.x,N+=(g.x+y.x)*x,V+=(g.y+y.y)*x,O+=x*3;O===0?j=se[0]:j=[N/O,V/O];var On=c.unproject(Q(j));return ct([On.lat+K.lat,On.lng+K.lng])}function so(o){for(var c=0,u=0,p=0,g=0;g<o.length;g++){var y=ct(o[g]);c+=y.lat,u+=y.lng,p++}return ct([c/p,u/p])}var Np={__proto__:null,clipPolygon:Kc,polygonCenter:Jc,centroid:so};function Qc(o,c){if(!c||!o.length)return o.slice();var u=c*c;return o=Fp(o,u),o=Bp(o,u),o}function Gc(o,c,u){return Math.sqrt(pi(o,c,u,!0))}function Dp(o,c,u){return pi(o,c,u)}function Bp(o,c){var u=o.length,p=typeof Uint8Array<"u"?Uint8Array:Array,g=new p(u);g[0]=g[u-1]=1,ro(o,g,c,0,u-1);var y,x=[];for(y=0;y<u;y++)g[y]&&x.push(o[y]);return x}function ro(o,c,u,p,g){var y=0,x,O,N;for(O=p+1;O<=g-1;O++)N=pi(o[O],o[p],o[g],!0),N>y&&(x=O,y=N);y>u&&(c[x]=1,ro(o,c,u,p,x),ro(o,c,u,x,g))}function Fp(o,c){for(var u=[o[0]],p=1,g=0,y=o.length;p<y;p++)Lp(o[p],o[g])>c&&(u.push(o[p]),g=p);return g<y-1&&u.push(o[y-1]),u}var tl;function el(o,c,u,p,g){var y=p?tl:an(o,u),x=an(c,u),O,N,V;for(tl=x;;){if(!(y|x))return[o,c];if(y&x)return!1;O=y||x,N=is(o,c,O,u,g),V=an(N,u),O===y?(o=N,y=V):(c=N,x=V)}}function is(o,c,u,p,g){var y=c.x-o.x,x=c.y-o.y,O=p.min,N=p.max,V,j;return u&8?(V=o.x+y*(N.y-o.y)/x,j=N.y):u&4?(V=o.x+y*(O.y-o.y)/x,j=O.y):u&2?(V=N.x,j=o.y+x*(N.x-o.x)/y):u&1&&(V=O.x,j=o.y+x*(O.x-o.x)/y),new et(V,j,g)}function an(o,c){var u=0;return o.x<c.min.x?u|=1:o.x>c.max.x&&(u|=2),o.y<c.min.y?u|=4:o.y>c.max.y&&(u|=8),u}function Lp(o,c){var u=c.x-o.x,p=c.y-o.y;return u*u+p*p}function pi(o,c,u,p){var g=c.x,y=c.y,x=u.x-g,O=u.y-y,N=x*x+O*O,V;return N>0&&(V=((o.x-g)*x+(o.y-y)*O)/N,V>1?(g=u.x,y=u.y):V>0&&(g+=x*V,y+=O*V)),x=o.x-g,O=o.y-y,p?x*x+O*O:new et(g,y)}function ie(o){return!M(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function nl(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ie(o)}function il(o,c){var u,p,g,y,x,O,N,V;if(!o||o.length===0)throw new Error("latlngs not passed");ie(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var j=ct([0,0]),K=Pt(o),st=K.getNorthWest().distanceTo(K.getSouthWest())*K.getNorthEast().distanceTo(K.getNorthWest());st<1700&&(j=so(o));var Xt=o.length,Ft=[];for(u=0;u<Xt;u++){var se=ct(o[u]);Ft.push(c.project(ct([se.lat-j.lat,se.lng-j.lng])))}for(u=0,p=0;u<Xt-1;u++)p+=Ft[u].distanceTo(Ft[u+1])/2;if(p===0)V=Ft[0];else for(u=0,y=0;u<Xt-1;u++)if(x=Ft[u],O=Ft[u+1],g=x.distanceTo(O),y+=g,y>p){N=(y-p)/g,V=[O.x-N*(O.x-x.x),O.y-N*(O.y-x.y)];break}var Jt=c.unproject(Q(V));return ct([Jt.lat+j.lat,Jt.lng+j.lng])}var Up={__proto__:null,simplify:Qc,pointToSegmentDistance:Gc,closestPointOnSegment:Dp,clipSegment:el,_getEdgeIntersection:is,_getBitCode:an,_sqClosestPointOnSegment:pi,isFlat:ie,_flat:nl,polylineCenter:il},oo={project:function(o){return new et(o.lng,o.lat)},unproject:function(o){return new pt(o.y,o.x)},bounds:new Tt([-180,-90],[180,90])},ao={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Tt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var c=Math.PI/180,u=this.R,p=o.lat*c,g=this.R_MINOR/u,y=Math.sqrt(1-g*g),x=y*Math.sin(p),O=Math.tan(Math.PI/4-p/2)/Math.pow((1-x)/(1+x),y/2);return p=-u*Math.log(Math.max(O,1e-10)),new et(o.lng*c*u,p)},unproject:function(o){for(var c=180/Math.PI,u=this.R,p=this.R_MINOR/u,g=Math.sqrt(1-p*p),y=Math.exp(-o.y/u),x=Math.PI/2-2*Math.atan(y),O=0,N=.1,V;O<15&&Math.abs(N)>1e-7;O++)V=g*Math.sin(x),V=Math.pow((1-V)/(1+V),g/2),N=Math.PI/2-2*Math.atan(y*V)-x,x+=N;return new pt(x*c,o.x*c/u)}},Vp={__proto__:null,LonLat:oo,Mercator:ao,SphericalMercator:kr},zp=s({},Ve,{code:"EPSG:3395",projection:ao,transformation:function(){var o=.5/(Math.PI*ao.R);return ri(o,.5,-o,.5)}()}),sl=s({},Ve,{code:"EPSG:4326",projection:oo,transformation:ri(1/180,1,-1/180,.5)}),Wp=s({},Me,{projection:oo,transformation:ri(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,c){var u=c.lng-o.lng,p=c.lat-o.lat;return Math.sqrt(u*u+p*p)},infinite:!0});Me.Earth=Ve,Me.EPSG3395=zp,Me.EPSG3857=Dr,Me.EPSG900913=Yd,Me.EPSG4326=sl,Me.Simple=Wp;var fe=si.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[h(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[h(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var c=o.target;if(c.hasLayer(this)){if(this._map=c,this._zoomAnimated=c._zoomAnimated,this.getEvents){var u=this.getEvents();c.on(u,this),this.once("remove",function(){c.off(u,this)},this)}this.onAdd(c),this.fire("add"),c.fire("layeradd",{layer:this})}}});lt.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var c=h(o);return this._layers[c]?this:(this._layers[c]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var c=h(o);return this._layers[c]?(this._loaded&&o.onRemove(this),delete this._layers[c],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return h(o)in this._layers},eachLayer:function(o,c){for(var u in this._layers)o.call(c,this._layers[u]);return this},_addLayers:function(o){o=o?M(o)?o:[o]:[];for(var c=0,u=o.length;c<u;c++)this.addLayer(o[c])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[h(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var c=h(o);this._zoomBoundLayers[c]&&(delete this._zoomBoundLayers[c],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,c=-1/0,u=this._getZoomSpan();for(var p in this._zoomBoundLayers){var g=this._zoomBoundLayers[p].options;o=g.minZoom===void 0?o:Math.min(o,g.minZoom),c=g.maxZoom===void 0?c:Math.max(c,g.maxZoom)}this._layersMaxZoom=c===-1/0?void 0:c,this._layersMinZoom=o===1/0?void 0:o,u!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Rn=fe.extend({initialize:function(o,c){S(this,c),this._layers={};var u,p;if(o)for(u=0,p=o.length;u<p;u++)this.addLayer(o[u])},addLayer:function(o){var c=this.getLayerId(o);return this._layers[c]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var c=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[c]&&this._map.removeLayer(this._layers[c]),delete this._layers[c],this},hasLayer:function(o){var c=typeof o=="number"?o:this.getLayerId(o);return c in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var c=Array.prototype.slice.call(arguments,1),u,p;for(u in this._layers)p=this._layers[u],p[o]&&p[o].apply(p,c);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,c){for(var u in this._layers)o.call(c,this._layers[u]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return h(o)}}),Hp=function(o,c){return new Rn(o,c)},Oe=Rn.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),Rn.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),Rn.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new Kt;for(var c in this._layers){var u=this._layers[c];o.extend(u.getBounds?u.getBounds():u.getLatLng())}return o}}),$p=function(o,c){return new Oe(o,c)},Pn=tt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){S(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,c){var u=this._getIconUrl(o);if(!u){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var p=this._createImg(u,c&&c.tagName==="IMG"?c:null);return this._setIconStyles(p,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),p},_setIconStyles:function(o,c){var u=this.options,p=u[c+"Size"];typeof p=="number"&&(p=[p,p]);var g=Q(p),y=Q(c==="shadow"&&u.shadowAnchor||u.iconAnchor||g&&g.divideBy(2,!0));o.className="leaflet-marker-"+c+" "+(u.className||""),y&&(o.style.marginLeft=-y.x+"px",o.style.marginTop=-y.y+"px"),g&&(o.style.width=g.x+"px",o.style.height=g.y+"px")},_createImg:function(o,c){return c=c||document.createElement("img"),c.src=o,c},_getIconUrl:function(o){return Z.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function jp(o){return new Pn(o)}var _i=Pn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof _i.imagePath!="string"&&(_i.imagePath=this._detectIconPath()),(this.options.imagePath||_i.imagePath)+Pn.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var c=function(u,p,g){var y=p.exec(u);return y&&y[g]};return o=c(o,/^url\((['"])?(.+)\1\)$/,2),o&&c(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=ht("div","leaflet-default-icon-path",document.body),c=ci(o,"background-image")||ci(o,"backgroundImage");if(document.body.removeChild(o),c=this._stripUrl(c),c)return c;var u=document.querySelector('link[href$="leaflet.css"]');return u?u.href.substring(0,u.href.length-11-1):""}}),rl=we.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new ze(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),it(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Rt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var c=this._marker,u=c._map,p=this._marker.options.autoPanSpeed,g=this._marker.options.autoPanPadding,y=sn(c._icon),x=u.getPixelBounds(),O=u.getPixelOrigin(),N=qt(x.min._subtract(O).add(g),x.max._subtract(O).subtract(g));if(!N.contains(y)){var V=Q((Math.max(N.max.x,y.x)-N.max.x)/(x.max.x-N.max.x)-(Math.min(N.min.x,y.x)-N.min.x)/(x.min.x-N.min.x),(Math.max(N.max.y,y.y)-N.max.y)/(x.max.y-N.max.y)-(Math.min(N.min.y,y.y)-N.min.y)/(x.min.y-N.min.y)).multiplyBy(p);u.panBy(V,{animate:!1}),this._draggable._newPos._add(V),this._draggable._startPos._add(V),It(c._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=X(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(ot(this._panRequest),this._panRequest=X(this._adjustPan.bind(this,o)))},_onDrag:function(o){var c=this._marker,u=c._shadow,p=sn(c._icon),g=c._map.layerPointToLatLng(p);u&&It(u,p),c._latlng=g,o.latlng=g,o.oldLatLng=this._oldLatLng,c.fire("move",o).fire("drag",o)},_onDragEnd:function(o){ot(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),ss=fe.extend({options:{icon:new _i,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,c){S(this,c),this._latlng=ct(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var c=this._latlng;return this._latlng=ct(o),this.update(),this.fire("move",{oldLatLng:c,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,c="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),u=o.icon.createIcon(this._icon),p=!1;u!==this._icon&&(this._icon&&this._removeIcon(),p=!0,o.title&&(u.title=o.title),u.tagName==="IMG"&&(u.alt=o.alt||"")),it(u,c),o.keyboard&&(u.tabIndex="0",u.setAttribute("role","button")),this._icon=u,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&nt(u,"focus",this._panOnFocus,this);var g=o.icon.createShadow(this._shadow),y=!1;g!==this._shadow&&(this._removeShadow(),y=!0),g&&(it(g,c),g.alt=""),this._shadow=g,o.opacity<1&&this._updateOpacity(),p&&this.getPane().appendChild(this._icon),this._initInteraction(),g&&y&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&yt(this._icon,"focus",this._panOnFocus,this),xt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&xt(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&It(this._icon,o),this._shadow&&It(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(c)},_initInteraction:function(){if(this.options.interactive&&(it(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),rl)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new rl(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&ne(this._icon,o),this._shadow&&ne(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var c=this.options.icon.options,u=c.iconSize?Q(c.iconSize):Q(0,0),p=c.iconAnchor?Q(c.iconAnchor):Q(0,0);o.panInside(this._latlng,{paddingTopLeft:p,paddingBottomRight:u.subtract(p)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Xp(o,c){return new ss(o,c)}var We=fe.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return S(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),rs=We.extend({options:{fill:!0,radius:10},initialize:function(o,c){S(this,c),this._latlng=ct(o),this._radius=this.options.radius},setLatLng:function(o){var c=this._latlng;return this._latlng=ct(o),this.redraw(),this.fire("move",{oldLatLng:c,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var c=o&&o.radius||this._radius;return We.prototype.setStyle.call(this,o),this.setRadius(c),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,c=this._radiusY||o,u=this._clickTolerance(),p=[o+u,c+u];this._pxBounds=new Tt(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Zp(o,c){return new rs(o,c)}var co=rs.extend({initialize:function(o,c,u){if(typeof c=="number"&&(c=s({},u,{radius:c})),S(this,c),this._latlng=ct(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new Kt(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:We.prototype.setStyle,_project:function(){var o=this._latlng.lng,c=this._latlng.lat,u=this._map,p=u.options.crs;if(p.distance===Ve.distance){var g=Math.PI/180,y=this._mRadius/Ve.R/g,x=u.project([c+y,o]),O=u.project([c-y,o]),N=x.add(O).divideBy(2),V=u.unproject(N).lat,j=Math.acos((Math.cos(y*g)-Math.sin(c*g)*Math.sin(V*g))/(Math.cos(c*g)*Math.cos(V*g)))/g;(isNaN(j)||j===0)&&(j=y/Math.cos(Math.PI/180*c)),this._point=N.subtract(u.getPixelOrigin()),this._radius=isNaN(j)?0:N.x-u.project([V,o-j]).x,this._radiusY=N.y-x.y}else{var K=p.unproject(p.project(this._latlng).subtract([this._mRadius,0]));this._point=u.latLngToLayerPoint(this._latlng),this._radius=this._point.x-u.latLngToLayerPoint(K).x}this._updateBounds()}});function Yp(o,c,u){return new co(o,c,u)}var ke=We.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,c){S(this,c),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var c=1/0,u=null,p=pi,g,y,x=0,O=this._parts.length;x<O;x++)for(var N=this._parts[x],V=1,j=N.length;V<j;V++){g=N[V-1],y=N[V];var K=p(o,g,y,!0);K<c&&(c=K,u=p(o,g,y))}return u&&(u.distance=Math.sqrt(c)),u},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return il(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,c){return c=c||this._defaultShape(),o=ct(o),c.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new Kt,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return ie(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var c=[],u=ie(o),p=0,g=o.length;p<g;p++)u?(c[p]=ct(o[p]),this._bounds.extend(c[p])):c[p]=this._convertLatLngs(o[p]);return c},_project:function(){var o=new Tt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),c=new et(o,o);this._rawPxBounds&&(this._pxBounds=new Tt([this._rawPxBounds.min.subtract(c),this._rawPxBounds.max.add(c)]))},_projectLatlngs:function(o,c,u){var p=o[0]instanceof pt,g=o.length,y,x;if(p){for(x=[],y=0;y<g;y++)x[y]=this._map.latLngToLayerPoint(o[y]),u.extend(x[y]);c.push(x)}else for(y=0;y<g;y++)this._projectLatlngs(o[y],c,u)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var c=this._parts,u,p,g,y,x,O,N;for(u=0,g=0,y=this._rings.length;u<y;u++)for(N=this._rings[u],p=0,x=N.length;p<x-1;p++)O=el(N[p],N[p+1],o,p,!0),O&&(c[g]=c[g]||[],c[g].push(O[0]),(O[1]!==N[p+1]||p===x-2)&&(c[g].push(O[1]),g++))}},_simplifyPoints:function(){for(var o=this._parts,c=this.options.smoothFactor,u=0,p=o.length;u<p;u++)o[u]=Qc(o[u],c)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,c){var u,p,g,y,x,O,N=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(u=0,y=this._parts.length;u<y;u++)for(O=this._parts[u],p=0,x=O.length,g=x-1;p<x;g=p++)if(!(!c&&p===0)&&Gc(o,O[g],O[p])<=N)return!0;return!1}});function qp(o,c){return new ke(o,c)}ke._flat=nl;var In=ke.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jc(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var c=ke.prototype._convertLatLngs.call(this,o),u=c.length;return u>=2&&c[0]instanceof pt&&c[0].equals(c[u-1])&&c.pop(),c},_setLatLngs:function(o){ke.prototype._setLatLngs.call(this,o),ie(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ie(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,c=this.options.weight,u=new et(c,c);if(o=new Tt(o.min.subtract(u),o.max.add(u)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var p=0,g=this._rings.length,y;p<g;p++)y=Kc(this._rings[p],o,!0),y.length&&this._parts.push(y)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var c=!1,u,p,g,y,x,O,N,V;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(y=0,N=this._parts.length;y<N;y++)for(u=this._parts[y],x=0,V=u.length,O=V-1;x<V;O=x++)p=u[x],g=u[O],p.y>o.y!=g.y>o.y&&o.x<(g.x-p.x)*(o.y-p.y)/(g.y-p.y)+p.x&&(c=!c);return c||ke.prototype._containsPoint.call(this,o,!0)}});function Kp(o,c){return new In(o,c)}var Ne=Oe.extend({initialize:function(o,c){S(this,c),this._layers={},o&&this.addData(o)},addData:function(o){var c=M(o)?o:o.features,u,p,g;if(c){for(u=0,p=c.length;u<p;u++)g=c[u],(g.geometries||g.geometry||g.features||g.coordinates)&&this.addData(g);return this}var y=this.options;if(y.filter&&!y.filter(o))return this;var x=os(o,y);return x?(x.feature=ls(o),x.defaultOptions=x.options,this.resetStyle(x),y.onEachFeature&&y.onEachFeature(o,x),this.addLayer(x)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=s({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(c){this._setLayerStyle(c,o)},this)},_setLayerStyle:function(o,c){o.setStyle&&(typeof c=="function"&&(c=c(o.feature)),o.setStyle(c))}});function os(o,c){var u=o.type==="Feature"?o.geometry:o,p=u?u.coordinates:null,g=[],y=c&&c.pointToLayer,x=c&&c.coordsToLatLng||lo,O,N,V,j;if(!p&&!u)return null;switch(u.type){case"Point":return O=x(p),ol(y,o,O,c);case"MultiPoint":for(V=0,j=p.length;V<j;V++)O=x(p[V]),g.push(ol(y,o,O,c));return new Oe(g);case"LineString":case"MultiLineString":return N=as(p,u.type==="LineString"?0:1,x),new ke(N,c);case"Polygon":case"MultiPolygon":return N=as(p,u.type==="Polygon"?1:2,x),new In(N,c);case"GeometryCollection":for(V=0,j=u.geometries.length;V<j;V++){var K=os({geometry:u.geometries[V],type:"Feature",properties:o.properties},c);K&&g.push(K)}return new Oe(g);case"FeatureCollection":for(V=0,j=u.features.length;V<j;V++){var st=os(u.features[V],c);st&&g.push(st)}return new Oe(g);default:throw new Error("Invalid GeoJSON object.")}}function ol(o,c,u,p){return o?o(c,u):new ss(u,p&&p.markersInheritOptions&&p)}function lo(o){return new pt(o[1],o[0],o[2])}function as(o,c,u){for(var p=[],g=0,y=o.length,x;g<y;g++)x=c?as(o[g],c-1,u):(u||lo)(o[g]),p.push(x);return p}function ho(o,c){return o=ct(o),o.alt!==void 0?[m(o.lng,c),m(o.lat,c),m(o.alt,c)]:[m(o.lng,c),m(o.lat,c)]}function cs(o,c,u,p){for(var g=[],y=0,x=o.length;y<x;y++)g.push(c?cs(o[y],ie(o[y])?0:c-1,u,p):ho(o[y],p));return!c&&u&&g.length>0&&g.push(g[0].slice()),g}function Cn(o,c){return o.feature?s({},o.feature,{geometry:c}):ls(c)}function ls(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var uo={toGeoJSON:function(o){return Cn(this,{type:"Point",coordinates:ho(this.getLatLng(),o)})}};ss.include(uo),co.include(uo),rs.include(uo),ke.include({toGeoJSON:function(o){var c=!ie(this._latlngs),u=cs(this._latlngs,c?1:0,!1,o);return Cn(this,{type:(c?"Multi":"")+"LineString",coordinates:u})}}),In.include({toGeoJSON:function(o){var c=!ie(this._latlngs),u=c&&!ie(this._latlngs[0]),p=cs(this._latlngs,u?2:c?1:0,!0,o);return c||(p=[p]),Cn(this,{type:(u?"Multi":"")+"Polygon",coordinates:p})}}),Rn.include({toMultiPoint:function(o){var c=[];return this.eachLayer(function(u){c.push(u.toGeoJSON(o).geometry.coordinates)}),Cn(this,{type:"MultiPoint",coordinates:c})},toGeoJSON:function(o){var c=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(c==="MultiPoint")return this.toMultiPoint(o);var u=c==="GeometryCollection",p=[];return this.eachLayer(function(g){if(g.toGeoJSON){var y=g.toGeoJSON(o);if(u)p.push(y.geometry);else{var x=ls(y);x.type==="FeatureCollection"?p.push.apply(p,x.features):p.push(x)}}}),u?Cn(this,{geometries:p,type:"GeometryCollection"}):{type:"FeatureCollection",features:p}}});function al(o,c){return new Ne(o,c)}var Jp=al,hs=fe.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,c,u){this._url=o,this._bounds=Pt(c),S(this,u)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(it(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){xt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&Sn(this._image),this},bringToBack:function(){return this._map&&En(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=Pt(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",c=this._image=o?this._url:ht("img");if(it(c,"leaflet-image-layer"),this._zoomAnimated&&it(c,"leaflet-zoom-animated"),this.options.className&&it(c,this.options.className),c.onselectstart=_,c.onmousemove=_,c.onload=a(this.fire,this,"load"),c.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(c.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=c.src;return}c.src=this._url,c.alt=this.options.alt},_animateZoom:function(o){var c=this._map.getZoomScale(o.zoom),u=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;nn(this._image,u,c)},_reset:function(){var o=this._image,c=new Tt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),u=c.getSize();It(o,c.min),o.style.width=u.x+"px",o.style.height=u.y+"px"},_updateOpacity:function(){ne(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),Qp=function(o,c,u){return new hs(o,c,u)},cl=hs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",c=this._image=o?this._url:ht("video");if(it(c,"leaflet-image-layer"),this._zoomAnimated&&it(c,"leaflet-zoom-animated"),this.options.className&&it(c,this.options.className),c.onselectstart=_,c.onmousemove=_,c.onloadeddata=a(this.fire,this,"load"),o){for(var u=c.getElementsByTagName("source"),p=[],g=0;g<u.length;g++)p.push(u[g].src);this._url=u.length>0?p:[c.src];return}M(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(c.style,"objectFit")&&(c.style.objectFit="fill"),c.autoplay=!!this.options.autoplay,c.loop=!!this.options.loop,c.muted=!!this.options.muted,c.playsInline=!!this.options.playsInline;for(var y=0;y<this._url.length;y++){var x=ht("source");x.src=this._url[y],c.appendChild(x)}}});function Gp(o,c,u){return new cl(o,c,u)}var ll=hs.extend({_initImage:function(){var o=this._image=this._url;it(o,"leaflet-image-layer"),this._zoomAnimated&&it(o,"leaflet-zoom-animated"),this.options.className&&it(o,this.options.className),o.onselectstart=_,o.onmousemove=_}});function t_(o,c,u){return new ll(o,c,u)}var Te=fe.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,c){o&&(o instanceof pt||M(o))?(this._latlng=ct(o),S(this,c)):(S(this,o),this._source=c),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&ne(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&ne(this._container,1),this.bringToFront(),this.options.interactive&&(it(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?(ne(this._container,0),this._removeTimeout=setTimeout(a(xt,void 0,this._container),200)):xt(this._container),this.options.interactive&&(Rt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=ct(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Sn(this._container),this},bringToBack:function(){return this._map&&En(this._container),this},_prepareOpen:function(o){var c=this._source;if(!c._map)return!1;if(c instanceof Oe){c=null;var u=this._source._layers;for(var p in u)if(u[p]._map){c=u[p];break}if(!c)return!1;this._source=c}if(!o)if(c.getCenter)o=c.getCenter();else if(c.getLatLng)o=c.getLatLng();else if(c.getBounds)o=c.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,c=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof c=="string")o.innerHTML=c;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(c)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),c=Q(this.options.offset),u=this._getAnchor();this._zoomAnimated?It(this._container,o.add(u)):c=c.add(o).add(u);var p=this._containerBottom=-c.y,g=this._containerLeft=-Math.round(this._containerWidth/2)+c.x;this._container.style.bottom=p+"px",this._container.style.left=g+"px"}},_getAnchor:function(){return[0,0]}});lt.include({_initOverlay:function(o,c,u,p){var g=c;return g instanceof o||(g=new o(p).setContent(c)),u&&g.setLatLng(u),g}}),fe.include({_initOverlay:function(o,c,u,p){var g=u;return g instanceof o?(S(g,p),g._source=this):(g=c&&!p?c:new o(p,this),g.setContent(u)),g}});var us=Te.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,Te.prototype.openOn.call(this,o)},onAdd:function(o){Te.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof We||this._source.on("preclick",rn))},onRemove:function(o){Te.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof We||this._source.off("preclick",rn))},getEvents:function(){var o=Te.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",c=this._container=ht("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),u=this._wrapper=ht("div",o+"-content-wrapper",c);if(this._contentNode=ht("div",o+"-content",u),fi(c),to(this._contentNode),nt(c,"contextmenu",rn),this._tipContainer=ht("div",o+"-tip-container",c),this._tip=ht("div",o+"-tip",this._tipContainer),this.options.closeButton){var p=this._closeButton=ht("a",o+"-close-button",c);p.setAttribute("role","button"),p.setAttribute("aria-label","Close popup"),p.href="#close",p.innerHTML='<span aria-hidden="true">&#215;</span>',nt(p,"click",function(g){Ut(g),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,c=o.style;c.width="",c.whiteSpace="nowrap";var u=o.offsetWidth;u=Math.min(u,this.options.maxWidth),u=Math.max(u,this.options.minWidth),c.width=u+1+"px",c.whiteSpace="",c.height="";var p=o.offsetHeight,g=this.options.maxHeight,y="leaflet-popup-scrolled";g&&p>g?(c.height=g+"px",it(o,y)):Rt(o,y),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),u=this._getAnchor();It(this._container,c.add(u))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,c=parseInt(ci(this._container,"marginBottom"),10)||0,u=this._container.offsetHeight+c,p=this._containerWidth,g=new et(this._containerLeft,-u-this._containerBottom);g._add(sn(this._container));var y=o.layerPointToContainerPoint(g),x=Q(this.options.autoPanPadding),O=Q(this.options.autoPanPaddingTopLeft||x),N=Q(this.options.autoPanPaddingBottomRight||x),V=o.getSize(),j=0,K=0;y.x+p+N.x>V.x&&(j=y.x+p-V.x+N.x),y.x-j-O.x<0&&(j=y.x-O.x),y.y+u+N.y>V.y&&(K=y.y+u-V.y+N.y),y.y-K-O.y<0&&(K=y.y-O.y),(j||K)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([j,K]))}},_getAnchor:function(){return Q(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),e_=function(o,c){return new us(o,c)};lt.mergeOptions({closePopupOnClick:!0}),lt.include({openPopup:function(o,c,u){return this._initOverlay(us,o,c,u).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),fe.include({bindPopup:function(o,c){return this._popup=this._initOverlay(us,this._popup,o,c),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof Oe||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){on(o);var c=o.layer||o.target;if(this._popup._source===c&&!(c instanceof We)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=c,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var fs=Te.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){Te.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){Te.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=Te.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",c=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ht("div",c),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+h(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var c,u,p=this._map,g=this._container,y=p.latLngToContainerPoint(p.getCenter()),x=p.layerPointToContainerPoint(o),O=this.options.direction,N=g.offsetWidth,V=g.offsetHeight,j=Q(this.options.offset),K=this._getAnchor();O==="top"?(c=N/2,u=V):O==="bottom"?(c=N/2,u=0):O==="center"?(c=N/2,u=V/2):O==="right"?(c=0,u=V/2):O==="left"?(c=N,u=V/2):x.x<y.x?(O="right",c=0,u=V/2):(O="left",c=N+(j.x+K.x)*2,u=V/2),o=o.subtract(Q(c,u,!0)).add(j).add(K),Rt(g,"leaflet-tooltip-right"),Rt(g,"leaflet-tooltip-left"),Rt(g,"leaflet-tooltip-top"),Rt(g,"leaflet-tooltip-bottom"),it(g,"leaflet-tooltip-"+O),It(g,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&ne(this._container,o)},_animateZoom:function(o){var c=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(c)},_getAnchor:function(){return Q(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),n_=function(o,c){return new fs(o,c)};lt.include({openTooltip:function(o,c,u){return this._initOverlay(fs,o,c,u).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),fe.include({bindTooltip:function(o,c){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(fs,this._tooltip,o,c),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var c=o?"off":"on",u={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?u.add=this._openTooltip:(u.mouseover=this._openTooltip,u.mouseout=this.closeTooltip,u.click=this._openTooltip,this._map?this._addFocusListeners():u.add=this._addFocusListeners),this._tooltip.options.sticky&&(u.mousemove=this._moveTooltip),this[c](u),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof Oe||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var c=typeof o.getElement=="function"&&o.getElement();c&&(nt(c,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),nt(c,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var c=typeof o.getElement=="function"&&o.getElement();c&&c.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var c=this;this._map.once("moveend",function(){c._openOnceFlag=!1,c._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var c=o.latlng,u,p;this._tooltip.options.sticky&&o.originalEvent&&(u=this._map.mouseEventToContainerPoint(o.originalEvent),p=this._map.containerPointToLayerPoint(u),c=this._map.layerPointToLatLng(p)),this._tooltip.setLatLng(c)}});var hl=Pn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var c=o&&o.tagName==="DIV"?o:document.createElement("div"),u=this.options;if(u.html instanceof Element?(Qi(c),c.appendChild(u.html)):c.innerHTML=u.html!==!1?u.html:"",u.bgPos){var p=Q(u.bgPos);c.style.backgroundPosition=-p.x+"px "+-p.y+"px"}return this._setIconStyles(c,"icon"),c},createShadow:function(){return null}});function i_(o){return new hl(o)}Pn.Default=_i;var gi=fe.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Z.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){S(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),xt(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Sn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(En(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof et?o:new et(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var c=this.getPane().children,u=-o(-1/0,1/0),p=0,g=c.length,y;p<g;p++)y=c[p].style.zIndex,c[p]!==this._container&&y&&(u=o(u,+y));isFinite(u)&&(this.options.zIndex=u+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Z.ielt9){ne(this._container,this.options.opacity);var o=+new Date,c=!1,u=!1;for(var p in this._tiles){var g=this._tiles[p];if(!(!g.current||!g.loaded)){var y=Math.min(1,(o-g.loaded)/200);ne(g.el,y),y<1?c=!0:(g.active?u=!0:this._onOpaqueTile(g),g.active=!0)}}u&&!this._noPrune&&this._pruneTiles(),c&&(ot(this._fadeFrame),this._fadeFrame=X(this._updateOpacity,this))}},_onOpaqueTile:_,_initContainer:function(){this._container||(this._container=ht("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,c=this.options.maxZoom;if(o!==void 0){for(var u in this._levels)u=Number(u),this._levels[u].el.children.length||u===o?(this._levels[u].el.style.zIndex=c-Math.abs(o-u),this._onUpdateLevel(u)):(xt(this._levels[u].el),this._removeTilesAtZoom(u),this._onRemoveLevel(u),delete this._levels[u]);var p=this._levels[o],g=this._map;return p||(p=this._levels[o]={},p.el=ht("div","leaflet-tile-container leaflet-zoom-animated",this._container),p.el.style.zIndex=c,p.origin=g.project(g.unproject(g.getPixelOrigin()),o).round(),p.zoom=o,this._setZoomTransform(p,g.getCenter(),g.getZoom()),_(p.el.offsetWidth),this._onCreateLevel(p)),this._level=p,p}},_onUpdateLevel:_,_onRemoveLevel:_,_onCreateLevel:_,_pruneTiles:function(){if(this._map){var o,c,u=this._map.getZoom();if(u>this.options.maxZoom||u<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)c=this._tiles[o],c.retain=c.current;for(o in this._tiles)if(c=this._tiles[o],c.current&&!c.active){var p=c.coords;this._retainParent(p.x,p.y,p.z,p.z-5)||this._retainChildren(p.x,p.y,p.z,p.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var c in this._tiles)this._tiles[c].coords.z===o&&this._removeTile(c)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)xt(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,c,u,p){var g=Math.floor(o/2),y=Math.floor(c/2),x=u-1,O=new et(+g,+y);O.z=+x;var N=this._tileCoordsToKey(O),V=this._tiles[N];return V&&V.active?(V.retain=!0,!0):(V&&V.loaded&&(V.retain=!0),x>p?this._retainParent(g,y,x,p):!1)},_retainChildren:function(o,c,u,p){for(var g=2*o;g<2*o+2;g++)for(var y=2*c;y<2*c+2;y++){var x=new et(g,y);x.z=u+1;var O=this._tileCoordsToKey(x),N=this._tiles[O];if(N&&N.active){N.retain=!0;continue}else N&&N.loaded&&(N.retain=!0);u+1<p&&this._retainChildren(g,y,u+1,p)}},_resetView:function(o){var c=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),c,c)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var c=this.options;return c.minNativeZoom!==void 0&&o<c.minNativeZoom?c.minNativeZoom:c.maxNativeZoom!==void 0&&c.maxNativeZoom<o?c.maxNativeZoom:o},_setView:function(o,c,u,p){var g=Math.round(c);this.options.maxZoom!==void 0&&g>this.options.maxZoom||this.options.minZoom!==void 0&&g<this.options.minZoom?g=void 0:g=this._clampZoom(g);var y=this.options.updateWhenZooming&&g!==this._tileZoom;(!p||y)&&(this._tileZoom=g,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),g!==void 0&&this._update(o),u||this._pruneTiles(),this._noPrune=!!u),this._setZoomTransforms(o,c)},_setZoomTransforms:function(o,c){for(var u in this._levels)this._setZoomTransform(this._levels[u],o,c)},_setZoomTransform:function(o,c,u){var p=this._map.getZoomScale(u,o.zoom),g=o.origin.multiplyBy(p).subtract(this._map._getNewPixelOrigin(c,u)).round();Z.any3d?nn(o.el,g,p):It(o.el,g)},_resetGrid:function(){var o=this._map,c=o.options.crs,u=this._tileSize=this.getTileSize(),p=this._tileZoom,g=this._map.getPixelWorldBounds(this._tileZoom);g&&(this._globalTileRange=this._pxBoundsToTileRange(g)),this._wrapX=c.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,c.wrapLng[0]],p).x/u.x),Math.ceil(o.project([0,c.wrapLng[1]],p).x/u.y)],this._wrapY=c.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([c.wrapLat[0],0],p).y/u.x),Math.ceil(o.project([c.wrapLat[1],0],p).y/u.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var c=this._map,u=c._animatingZoom?Math.max(c._animateToZoom,c.getZoom()):c.getZoom(),p=c.getZoomScale(u,this._tileZoom),g=c.project(o,this._tileZoom).floor(),y=c.getSize().divideBy(p*2);return new Tt(g.subtract(y),g.add(y))},_update:function(o){var c=this._map;if(c){var u=this._clampZoom(c.getZoom());if(o===void 0&&(o=c.getCenter()),this._tileZoom!==void 0){var p=this._getTiledPixelBounds(o),g=this._pxBoundsToTileRange(p),y=g.getCenter(),x=[],O=this.options.keepBuffer,N=new Tt(g.getBottomLeft().subtract([O,-O]),g.getTopRight().add([O,-O]));if(!(isFinite(g.min.x)&&isFinite(g.min.y)&&isFinite(g.max.x)&&isFinite(g.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var V in this._tiles){var j=this._tiles[V].coords;(j.z!==this._tileZoom||!N.contains(new et(j.x,j.y)))&&(this._tiles[V].current=!1)}if(Math.abs(u-this._tileZoom)>1){this._setView(o,u);return}for(var K=g.min.y;K<=g.max.y;K++)for(var st=g.min.x;st<=g.max.x;st++){var Xt=new et(st,K);if(Xt.z=this._tileZoom,!!this._isValidTile(Xt)){var Ft=this._tiles[this._tileCoordsToKey(Xt)];Ft?Ft.current=!0:x.push(Xt)}}if(x.sort(function(Jt,On){return Jt.distanceTo(y)-On.distanceTo(y)}),x.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var se=document.createDocumentFragment();for(st=0;st<x.length;st++)this._addTile(x[st],se);this._level.el.appendChild(se)}}}},_isValidTile:function(o){var c=this._map.options.crs;if(!c.infinite){var u=this._globalTileRange;if(!c.wrapLng&&(o.x<u.min.x||o.x>u.max.x)||!c.wrapLat&&(o.y<u.min.y||o.y>u.max.y))return!1}if(!this.options.bounds)return!0;var p=this._tileCoordsToBounds(o);return Pt(this.options.bounds).overlaps(p)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var c=this._map,u=this.getTileSize(),p=o.scaleBy(u),g=p.add(u),y=c.unproject(p,o.z),x=c.unproject(g,o.z);return[y,x]},_tileCoordsToBounds:function(o){var c=this._tileCoordsToNwSe(o),u=new Kt(c[0],c[1]);return this.options.noWrap||(u=this._map.wrapLatLngBounds(u)),u},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var c=o.split(":"),u=new et(+c[0],+c[1]);return u.z=+c[2],u},_removeTile:function(o){var c=this._tiles[o];c&&(xt(c.el),delete this._tiles[o],this.fire("tileunload",{tile:c.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){it(o,"leaflet-tile");var c=this.getTileSize();o.style.width=c.x+"px",o.style.height=c.y+"px",o.onselectstart=_,o.onmousemove=_,Z.ielt9&&this.options.opacity<1&&ne(o,this.options.opacity)},_addTile:function(o,c){var u=this._getTilePos(o),p=this._tileCoordsToKey(o),g=this.createTile(this._wrapCoords(o),a(this._tileReady,this,o));this._initTile(g),this.createTile.length<2&&X(a(this._tileReady,this,o,null,g)),It(g,u),this._tiles[p]={el:g,coords:o,current:!0},c.appendChild(g),this.fire("tileloadstart",{tile:g,coords:o})},_tileReady:function(o,c,u){c&&this.fire("tileerror",{error:c,tile:u,coords:o});var p=this._tileCoordsToKey(o);u=this._tiles[p],u&&(u.loaded=+new Date,this._map._fadeAnimated?(ne(u.el,0),ot(this._fadeFrame),this._fadeFrame=X(this._updateOpacity,this)):(u.active=!0,this._pruneTiles()),c||(it(u.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:u.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Z.ielt9||!this._map._fadeAnimated?X(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var c=new et(this._wrapX?d(o.x,this._wrapX):o.x,this._wrapY?d(o.y,this._wrapY):o.y);return c.z=o.z,c},_pxBoundsToTileRange:function(o){var c=this.getTileSize();return new Tt(o.min.unscaleBy(c).floor(),o.max.unscaleBy(c).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function s_(o){return new gi(o)}var Mn=gi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,c){this._url=o,c=S(this,c),c.detectRetina&&Z.retina&&c.maxZoom>0?(c.tileSize=Math.floor(c.tileSize/2),c.zoomReverse?(c.zoomOffset--,c.minZoom=Math.min(c.maxZoom,c.minZoom+1)):(c.zoomOffset++,c.maxZoom=Math.max(c.minZoom,c.maxZoom-1)),c.minZoom=Math.max(0,c.minZoom)):c.zoomReverse?c.minZoom=Math.min(c.maxZoom,c.minZoom):c.maxZoom=Math.max(c.minZoom,c.maxZoom),typeof c.subdomains=="string"&&(c.subdomains=c.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,c){return this._url===o&&c===void 0&&(c=!0),this._url=o,c||this.redraw(),this},createTile:function(o,c){var u=document.createElement("img");return nt(u,"load",a(this._tileOnLoad,this,c,u)),nt(u,"error",a(this._tileOnError,this,c,u)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(u.referrerPolicy=this.options.referrerPolicy),u.alt="",u.src=this.getTileUrl(o),u},getTileUrl:function(o){var c={r:Z.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var u=this._globalTileRange.max.y-o.y;this.options.tms&&(c.y=u),c["-y"]=u}return F(this._url,s(c,this.options))},_tileOnLoad:function(o,c){Z.ielt9?setTimeout(a(o,this,null,c),0):o(null,c)},_tileOnError:function(o,c,u){var p=this.options.errorTileUrl;p&&c.getAttribute("src")!==p&&(c.src=p),o(u,c)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,c=this.options.maxZoom,u=this.options.zoomReverse,p=this.options.zoomOffset;return u&&(o=c-o),o+p},_getSubdomain:function(o){var c=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[c]},_abortLoading:function(){var o,c;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(c=this._tiles[o].el,c.onload=_,c.onerror=_,!c.complete)){c.src=H;var u=this._tiles[o].coords;xt(c),delete this._tiles[o],this.fire("tileabort",{tile:c,coords:u})}},_removeTile:function(o){var c=this._tiles[o];if(c)return c.el.setAttribute("src",H),gi.prototype._removeTile.call(this,o)},_tileReady:function(o,c,u){if(!(!this._map||u&&u.getAttribute("src")===H))return gi.prototype._tileReady.call(this,o,c,u)}});function ul(o,c){return new Mn(o,c)}var fl=Mn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,c){this._url=o;var u=s({},this.defaultWmsParams);for(var p in c)p in this.options||(u[p]=c[p]);c=S(this,c);var g=c.detectRetina&&Z.retina?2:1,y=this.getTileSize();u.width=y.x*g,u.height=y.y*g,this.wmsParams=u},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var c=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[c]=this._crs.code,Mn.prototype.onAdd.call(this,o)},getTileUrl:function(o){var c=this._tileCoordsToNwSe(o),u=this._crs,p=qt(u.project(c[0]),u.project(c[1])),g=p.min,y=p.max,x=(this._wmsVersion>=1.3&&this._crs===sl?[g.y,g.x,y.y,y.x]:[g.x,g.y,y.x,y.y]).join(","),O=Mn.prototype.getTileUrl.call(this,o);return O+k(this.wmsParams,O,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+x},setParams:function(o,c){return s(this.wmsParams,o),c||this.redraw(),this}});function r_(o,c){return new fl(o,c)}Mn.WMS=fl,ul.wms=r_;var De=fe.extend({options:{padding:.1},initialize:function(o){S(this,o),h(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),it(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,c){var u=this._map.getZoomScale(c,this._zoom),p=this._map.getSize().multiplyBy(.5+this.options.padding),g=this._map.project(this._center,c),y=p.multiplyBy(-u).add(g).subtract(this._map._getNewPixelOrigin(o,c));Z.any3d?nn(this._container,y,u):It(this._container,y)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,c=this._map.getSize(),u=this._map.containerPointToLayerPoint(c.multiplyBy(-o)).round();this._bounds=new Tt(u,u.add(c.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),dl=De.extend({options:{tolerance:0},getEvents:function(){var o=De.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){De.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");nt(o,"mousemove",this._onMouseMove,this),nt(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),nt(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){ot(this._redrawRequest),delete this._ctx,xt(this._container),yt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var c in this._layers)o=this._layers[c],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){De.prototype._update.call(this);var o=this._bounds,c=this._container,u=o.getSize(),p=Z.retina?2:1;It(c,o.min),c.width=p*u.x,c.height=p*u.y,c.style.width=u.x+"px",c.style.height=u.y+"px",Z.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){De.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[h(o)]=o;var c=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=c),this._drawLast=c,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var c=o._order,u=c.next,p=c.prev;u?u.prev=p:this._drawLast=p,p?p.next=u:this._drawFirst=u,delete o._order,delete this._layers[h(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var c=o.options.dashArray.split(/[, ]+/),u=[],p,g;for(g=0;g<c.length;g++){if(p=Number(c[g]),isNaN(p))return;u.push(p)}o.options._dashArray=u}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||X(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var c=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Tt,this._redrawBounds.extend(o._pxBounds.min.subtract([c,c])),this._redrawBounds.extend(o._pxBounds.max.add([c,c]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var c=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,c.x,c.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,c=this._redrawBounds;if(this._ctx.save(),c){var u=c.getSize();this._ctx.beginPath(),this._ctx.rect(c.min.x,c.min.y,u.x,u.y),this._ctx.clip()}this._drawing=!0;for(var p=this._drawFirst;p;p=p.next)o=p.layer,(!c||o._pxBounds&&o._pxBounds.intersects(c))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,c){if(this._drawing){var u,p,g,y,x=o._parts,O=x.length,N=this._ctx;if(O){for(N.beginPath(),u=0;u<O;u++){for(p=0,g=x[u].length;p<g;p++)y=x[u][p],N[p?"lineTo":"moveTo"](y.x,y.y);c&&N.closePath()}this._fillStroke(N,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var c=o._point,u=this._ctx,p=Math.max(Math.round(o._radius),1),g=(Math.max(Math.round(o._radiusY),1)||p)/p;g!==1&&(u.save(),u.scale(1,g)),u.beginPath(),u.arc(c.x,c.y/g,p,0,Math.PI*2,!1),g!==1&&u.restore(),this._fillStroke(u,o)}},_fillStroke:function(o,c){var u=c.options;u.fill&&(o.globalAlpha=u.fillOpacity,o.fillStyle=u.fillColor||u.color,o.fill(u.fillRule||"evenodd")),u.stroke&&u.weight!==0&&(o.setLineDash&&o.setLineDash(c.options&&c.options._dashArray||[]),o.globalAlpha=u.opacity,o.lineWidth=u.weight,o.strokeStyle=u.color,o.lineCap=u.lineCap,o.lineJoin=u.lineJoin,o.stroke())},_onClick:function(o){for(var c=this._map.mouseEventToLayerPoint(o),u,p,g=this._drawFirst;g;g=g.next)u=g.layer,u.options.interactive&&u._containsPoint(c)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(u))&&(p=u);this._fireEvent(p?[p]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var c=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,c)}},_handleMouseOut:function(o){var c=this._hoveredLayer;c&&(Rt(this._container,"leaflet-interactive"),this._fireEvent([c],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,c){if(!this._mouseHoverThrottled){for(var u,p,g=this._drawFirst;g;g=g.next)u=g.layer,u.options.interactive&&u._containsPoint(c)&&(p=u);p!==this._hoveredLayer&&(this._handleMouseOut(o),p&&(it(this._container,"leaflet-interactive"),this._fireEvent([p],o,"mouseover"),this._hoveredLayer=p)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,c,u){this._map._fireDOMEvent(c,u||c.type,o)},_bringToFront:function(o){var c=o._order;if(c){var u=c.next,p=c.prev;if(u)u.prev=p;else return;p?p.next=u:u&&(this._drawFirst=u),c.prev=this._drawLast,this._drawLast.next=c,c.next=null,this._drawLast=c,this._requestRedraw(o)}},_bringToBack:function(o){var c=o._order;if(c){var u=c.next,p=c.prev;if(p)p.next=u;else return;u?u.prev=p:p&&(this._drawLast=p),c.prev=null,c.next=this._drawFirst,this._drawFirst.prev=c,this._drawFirst=c,this._requestRedraw(o)}}});function pl(o){return Z.canvas?new dl(o):null}var mi=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),o_={_initContainer:function(){this._container=ht("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(De.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var c=o._container=mi("shape");it(c,"leaflet-vml-shape "+(this.options.className||"")),c.coordsize="1 1",o._path=mi("path"),c.appendChild(o._path),this._updateStyle(o),this._layers[h(o)]=o},_addPath:function(o){var c=o._container;this._container.appendChild(c),o.options.interactive&&o.addInteractiveTarget(c)},_removePath:function(o){var c=o._container;xt(c),o.removeInteractiveTarget(c),delete this._layers[h(o)]},_updateStyle:function(o){var c=o._stroke,u=o._fill,p=o.options,g=o._container;g.stroked=!!p.stroke,g.filled=!!p.fill,p.stroke?(c||(c=o._stroke=mi("stroke")),g.appendChild(c),c.weight=p.weight+"px",c.color=p.color,c.opacity=p.opacity,p.dashArray?c.dashStyle=M(p.dashArray)?p.dashArray.join(" "):p.dashArray.replace(/( *, *)/g," "):c.dashStyle="",c.endcap=p.lineCap.replace("butt","flat"),c.joinstyle=p.lineJoin):c&&(g.removeChild(c),o._stroke=null),p.fill?(u||(u=o._fill=mi("fill")),g.appendChild(u),u.color=p.fillColor||p.color,u.opacity=p.fillOpacity):u&&(g.removeChild(u),o._fill=null)},_updateCircle:function(o){var c=o._point.round(),u=Math.round(o._radius),p=Math.round(o._radiusY||u);this._setPath(o,o._empty()?"M0 0":"AL "+c.x+","+c.y+" "+u+","+p+" 0,"+65535*360)},_setPath:function(o,c){o._path.v=c},_bringToFront:function(o){Sn(o._container)},_bringToBack:function(o){En(o._container)}},ds=Z.vml?mi:yc,yi=De.extend({_initContainer:function(){this._container=ds("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ds("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){xt(this._container),yt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){De.prototype._update.call(this);var o=this._bounds,c=o.getSize(),u=this._container;(!this._svgSize||!this._svgSize.equals(c))&&(this._svgSize=c,u.setAttribute("width",c.x),u.setAttribute("height",c.y)),It(u,o.min),u.setAttribute("viewBox",[o.min.x,o.min.y,c.x,c.y].join(" ")),this.fire("update")}},_initPath:function(o){var c=o._path=ds("path");o.options.className&&it(c,o.options.className),o.options.interactive&&it(c,"leaflet-interactive"),this._updateStyle(o),this._layers[h(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){xt(o._path),o.removeInteractiveTarget(o._path),delete this._layers[h(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var c=o._path,u=o.options;c&&(u.stroke?(c.setAttribute("stroke",u.color),c.setAttribute("stroke-opacity",u.opacity),c.setAttribute("stroke-width",u.weight),c.setAttribute("stroke-linecap",u.lineCap),c.setAttribute("stroke-linejoin",u.lineJoin),u.dashArray?c.setAttribute("stroke-dasharray",u.dashArray):c.removeAttribute("stroke-dasharray"),u.dashOffset?c.setAttribute("stroke-dashoffset",u.dashOffset):c.removeAttribute("stroke-dashoffset")):c.setAttribute("stroke","none"),u.fill?(c.setAttribute("fill",u.fillColor||u.color),c.setAttribute("fill-opacity",u.fillOpacity),c.setAttribute("fill-rule",u.fillRule||"evenodd")):c.setAttribute("fill","none"))},_updatePoly:function(o,c){this._setPath(o,vc(o._parts,c))},_updateCircle:function(o){var c=o._point,u=Math.max(Math.round(o._radius),1),p=Math.max(Math.round(o._radiusY),1)||u,g="a"+u+","+p+" 0 1,0 ",y=o._empty()?"M0 0":"M"+(c.x-u)+","+c.y+g+u*2+",0 "+g+-u*2+",0 ";this._setPath(o,y)},_setPath:function(o,c){o._path.setAttribute("d",c)},_bringToFront:function(o){Sn(o._path)},_bringToBack:function(o){En(o._path)}});Z.vml&&yi.include(o_);function _l(o){return Z.svg||Z.vml?new yi(o):null}lt.include({getRenderer:function(o){var c=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return c||(c=this._renderer=this._createRenderer()),this.hasLayer(c)||this.addLayer(c),c},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var c=this._paneRenderers[o];return c===void 0&&(c=this._createRenderer({pane:o}),this._paneRenderers[o]=c),c},_createRenderer:function(o){return this.options.preferCanvas&&pl(o)||_l(o)}});var gl=In.extend({initialize:function(o,c){In.prototype.initialize.call(this,this._boundsToLatLngs(o),c)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=Pt(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function a_(o,c){return new gl(o,c)}yi.create=ds,yi.pointsToPath=vc,Ne.geometryToLayer=os,Ne.coordsToLatLng=lo,Ne.coordsToLatLngs=as,Ne.latLngToCoords=ho,Ne.latLngsToCoords=cs,Ne.getFeature=Cn,Ne.asFeature=ls,lt.mergeOptions({boxZoom:!0});var ml=we.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){nt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){yt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){xt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),li(),Xr(),this._startPoint=this._map.mouseEventToContainerPoint(o),nt(document,{contextmenu:on,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=ht("div","leaflet-zoom-box",this._container),it(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var c=new Tt(this._point,this._startPoint),u=c.getSize();It(this._box,c.min),this._box.style.width=u.x+"px",this._box.style.height=u.y+"px"},_finish:function(){this._moved&&(xt(this._box),Rt(this._container,"leaflet-crosshair")),hi(),Zr(),yt(document,{contextmenu:on,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var c=new Kt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(c).fire("boxzoomend",{boxZoomBounds:c})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});lt.addInitHook("addHandler","boxZoom",ml),lt.mergeOptions({doubleClickZoom:!0});var yl=we.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var c=this._map,u=c.getZoom(),p=c.options.zoomDelta,g=o.originalEvent.shiftKey?u-p:u+p;c.options.doubleClickZoom==="center"?c.setZoom(g):c.setZoomAround(o.containerPoint,g)}});lt.addInitHook("addHandler","doubleClickZoom",yl),lt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var vl=we.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new ze(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}it(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Rt(this._map._container,"leaflet-grab"),Rt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var c=Pt(this._map.options.maxBounds);this._offsetLimit=qt(this._map.latLngToContainerPoint(c.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(c.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var c=this._lastTime=+new Date,u=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(u),this._times.push(c),this._prunePositions(c)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),c=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=c.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,c){return o-(o-c)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),c=this._offsetLimit;o.x<c.min.x&&(o.x=this._viscousLimit(o.x,c.min.x)),o.y<c.min.y&&(o.y=this._viscousLimit(o.y,c.min.y)),o.x>c.max.x&&(o.x=this._viscousLimit(o.x,c.max.x)),o.y>c.max.y&&(o.y=this._viscousLimit(o.y,c.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,c=Math.round(o/2),u=this._initialWorldOffset,p=this._draggable._newPos.x,g=(p-c+u)%o+c-u,y=(p+c+u)%o-c-u,x=Math.abs(g+u)<Math.abs(y+u)?g:y;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=x},_onDragEnd:function(o){var c=this._map,u=c.options,p=!u.inertia||o.noInertia||this._times.length<2;if(c.fire("dragend",o),p)c.fire("moveend");else{this._prunePositions(+new Date);var g=this._lastPos.subtract(this._positions[0]),y=(this._lastTime-this._times[0])/1e3,x=u.easeLinearity,O=g.multiplyBy(x/y),N=O.distanceTo([0,0]),V=Math.min(u.inertiaMaxSpeed,N),j=O.multiplyBy(V/N),K=V/(u.inertiaDeceleration*x),st=j.multiplyBy(-K/2).round();!st.x&&!st.y?c.fire("moveend"):(st=c._limitOffset(st,c.options.maxBounds),X(function(){c.panBy(st,{duration:K,easeLinearity:x,noMoveStart:!0,animate:!0})}))}}});lt.addInitHook("addHandler","dragging",vl),lt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var bl=we.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),nt(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),yt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,c=document.documentElement,u=o.scrollTop||c.scrollTop,p=o.scrollLeft||c.scrollLeft;this._map._container.focus(),window.scrollTo(p,u)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var c=this._panKeys={},u=this.keyCodes,p,g;for(p=0,g=u.left.length;p<g;p++)c[u.left[p]]=[-1*o,0];for(p=0,g=u.right.length;p<g;p++)c[u.right[p]]=[o,0];for(p=0,g=u.down.length;p<g;p++)c[u.down[p]]=[0,o];for(p=0,g=u.up.length;p<g;p++)c[u.up[p]]=[0,-1*o]},_setZoomDelta:function(o){var c=this._zoomKeys={},u=this.keyCodes,p,g;for(p=0,g=u.zoomIn.length;p<g;p++)c[u.zoomIn[p]]=o;for(p=0,g=u.zoomOut.length;p<g;p++)c[u.zoomOut[p]]=-o},_addHooks:function(){nt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){yt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var c=o.keyCode,u=this._map,p;if(c in this._panKeys){if(!u._panAnim||!u._panAnim._inProgress)if(p=this._panKeys[c],o.shiftKey&&(p=Q(p).multiplyBy(3)),u.options.maxBounds&&(p=u._limitOffset(Q(p),u.options.maxBounds)),u.options.worldCopyJump){var g=u.wrapLatLng(u.unproject(u.project(u.getCenter()).add(p)));u.panTo(g)}else u.panBy(p)}else if(c in this._zoomKeys)u.setZoom(u.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[c]);else if(c===27&&u._popup&&u._popup.options.closeOnEscapeKey)u.closePopup();else return;on(o)}}});lt.addInitHook("addHandler","keyboard",bl),lt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var wl=we.extend({addHooks:function(){nt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){yt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var c=jc(o),u=this._map.options.wheelDebounceTime;this._delta+=c,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var p=Math.max(u-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),p),on(o)},_performZoom:function(){var o=this._map,c=o.getZoom(),u=this._map.options.zoomSnap||0;o._stop();var p=this._delta/(this._map.options.wheelPxPerZoomLevel*4),g=4*Math.log(2/(1+Math.exp(-Math.abs(p))))/Math.LN2,y=u?Math.ceil(g/u)*u:g,x=o._limitZoom(c+(this._delta>0?y:-y))-c;this._delta=0,this._startTime=null,x&&(o.options.scrollWheelZoom==="center"?o.setZoom(c+x):o.setZoomAround(this._lastMousePos,c+x))}});lt.addInitHook("addHandler","scrollWheelZoom",wl);var c_=600;lt.mergeOptions({tapHold:Z.touchNative&&Z.safari&&Z.mobile,tapTolerance:15});var Tl=we.extend({addHooks:function(){nt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){yt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var c=o.touches[0];this._startPos=this._newPos=new et(c.clientX,c.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(nt(document,"touchend",Ut),nt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",c))},this),c_),nt(document,"touchend touchcancel contextmenu",this._cancel,this),nt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){yt(document,"touchend",Ut),yt(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),yt(document,"touchend touchcancel contextmenu",this._cancel,this),yt(document,"touchmove",this._onMove,this)},_onMove:function(o){var c=o.touches[0];this._newPos=new et(c.clientX,c.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,c){var u=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:c.screenX,screenY:c.screenY,clientX:c.clientX,clientY:c.clientY});u._simulated=!0,c.target.dispatchEvent(u)}});lt.addInitHook("addHandler","tapHold",Tl),lt.mergeOptions({touchZoom:Z.touch,bounceAtZoomLimits:!0});var xl=we.extend({addHooks:function(){it(this._map._container,"leaflet-touch-zoom"),nt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Rt(this._map._container,"leaflet-touch-zoom"),yt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var c=this._map;if(!(!o.touches||o.touches.length!==2||c._animatingZoom||this._zooming)){var u=c.mouseEventToContainerPoint(o.touches[0]),p=c.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=c.getSize()._divideBy(2),this._startLatLng=c.containerPointToLatLng(this._centerPoint),c.options.touchZoom!=="center"&&(this._pinchStartLatLng=c.containerPointToLatLng(u.add(p)._divideBy(2))),this._startDist=u.distanceTo(p),this._startZoom=c.getZoom(),this._moved=!1,this._zooming=!0,c._stop(),nt(document,"touchmove",this._onTouchMove,this),nt(document,"touchend touchcancel",this._onTouchEnd,this),Ut(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var c=this._map,u=c.mouseEventToContainerPoint(o.touches[0]),p=c.mouseEventToContainerPoint(o.touches[1]),g=u.distanceTo(p)/this._startDist;if(this._zoom=c.getScaleZoom(g,this._startZoom),!c.options.bounceAtZoomLimits&&(this._zoom<c.getMinZoom()&&g<1||this._zoom>c.getMaxZoom()&&g>1)&&(this._zoom=c._limitZoom(this._zoom)),c.options.touchZoom==="center"){if(this._center=this._startLatLng,g===1)return}else{var y=u._add(p)._divideBy(2)._subtract(this._centerPoint);if(g===1&&y.x===0&&y.y===0)return;this._center=c.unproject(c.project(this._pinchStartLatLng,this._zoom).subtract(y),this._zoom)}this._moved||(c._moveStart(!0,!1),this._moved=!0),ot(this._animRequest);var x=a(c._move,c,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=X(x,this,!0),Ut(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ot(this._animRequest),yt(document,"touchmove",this._onTouchMove,this),yt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});lt.addInitHook("addHandler","touchZoom",xl),lt.BoxZoom=ml,lt.DoubleClickZoom=yl,lt.Drag=vl,lt.Keyboard=bl,lt.ScrollWheelZoom=wl,lt.TapHold=Tl,lt.TouchZoom=xl,e.Bounds=Tt,e.Browser=Z,e.CRS=Me,e.Canvas=dl,e.Circle=co,e.CircleMarker=rs,e.Class=tt,e.Control=ue,e.DivIcon=hl,e.DivOverlay=Te,e.DomEvent=Ep,e.DomUtil=Ap,e.Draggable=ze,e.Evented=si,e.FeatureGroup=Oe,e.GeoJSON=Ne,e.GridLayer=gi,e.Handler=we,e.Icon=Pn,e.ImageOverlay=hs,e.LatLng=pt,e.LatLngBounds=Kt,e.Layer=fe,e.LayerGroup=Rn,e.LineUtil=Up,e.Map=lt,e.Marker=ss,e.Mixin=kp,e.Path=We,e.Point=et,e.PolyUtil=Np,e.Polygon=In,e.Polyline=ke,e.Popup=us,e.PosAnimation=Xc,e.Projection=Vp,e.Rectangle=gl,e.Renderer=De,e.SVG=yi,e.SVGOverlay=ll,e.TileLayer=Mn,e.Tooltip=fs,e.Transformation=Nr,e.Util=Bt,e.VideoOverlay=cl,e.bind=a,e.bounds=qt,e.canvas=pl,e.circle=Yp,e.circleMarker=Zp,e.control=di,e.divIcon=i_,e.extend=s,e.featureGroup=$p,e.geoJSON=al,e.geoJson=Jp,e.gridLayer=s_,e.icon=jp,e.imageOverlay=Qp,e.latLng=ct,e.latLngBounds=Pt,e.layerGroup=Hp,e.map=Rp,e.marker=Xp,e.point=Q,e.polygon=Kp,e.polyline=qp,e.popup=e_,e.rectangle=a_,e.setOptions=S,e.stamp=h,e.svg=_l,e.svgOverlay=t_,e.tileLayer=ul,e.tooltip=n_,e.transformation=ri,e.version=i,e.videoOverlay=Gp;var l_=window.L;e.noConflict=function(){return window.L=l_,this},window.L=e})}(xi,xi.exports)),xi.exports}var x_=T_();const Fa=b_(x_);function Ds(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const La=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Pl=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Pl&&parseFloat(Pl[1]);const _s=globalThis,kn=globalThis.process||{},A_=globalThis.navigator||{};function Pu(n){var i,s;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function wn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||Pu()}function S_(n){return wn()?Pu()?"Electron":(A_.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Iu="4.1.0";function E_(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class R_{constructor(t,e,i="sessionStorage"){this.storage=E_(i),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function P_(n){let t;return n<10?t=`${n.toFixed(2)}ms`:n<100?t=`${n.toFixed(1)}ms`:n<1e3?t=`${n.toFixed(0)}ms`:t=`${(n/1e3).toFixed(2)}s`,t}function I_(n,t=8){const e=Math.max(t-n.length,0);return`${" ".repeat(e)}${n}`}var Bs;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Bs||(Bs={}));const C_=10;function Il(n){return typeof n!="string"?n:(n=n.toUpperCase(),Bs[n]||Bs.WHITE)}function M_(n,t,e){return!wn&&typeof n=="string"&&(t&&(n=`\x1B[${Il(t)}m${n}\x1B[39m`),e&&(n=`\x1B[${Il(e)+C_}m${n}\x1B[49m`)),n}function O_(n,t=["constructor"]){const e=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(e),s=n;for(const r of i){const a=s[r];typeof a=="function"&&(t.find(l=>r===l)||(s[r]=a.bind(n)))}}function Ua(n,t){if(!n)throw new Error("Assertion failed")}function Nn(){var t,e,i;let n;if(wn()&&_s.performance)n=(e=(t=_s==null?void 0:_s.performance)==null?void 0:t.now)==null?void 0:e.call(t);else if("hrtime"in kn){const s=(i=kn==null?void 0:kn.hrtime)==null?void 0:i.call(kn);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const Dn={debug:wn()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},k_={enabled:!0,level:0};function Bn(){}const Cl={},Ml={once:!0};class $i{constructor({id:t}={id:""}){this.VERSION=Iu,this._startTs=Nn(),this._deltaTs=Nn(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new R_(`__probe-${this.id}__`,k_),this.timeStamp(`${this.id} started`),O_(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Nn()-this._startTs).toPrecision(10))}getDelta(){return Number((Nn()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Dn.warn,arguments,Ml)}error(t){return this._getLogFunction(0,t,Dn.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Dn.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Dn.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Dn.debug||Dn.info,arguments,Ml)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||Bn,i&&[i],{tag:D_(e)}):Bn}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Bn)}group(t,e,i={collapsed:!1}){const s=Ol({logLevel:t,message:e,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e,i={}){return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Bn)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Cu(t)}_getLogFunction(t,e,i,s,r){if(this._shouldLog(t)){r=Ol({logLevel:t,message:e,args:s,opts:r}),i=i||r.method,Ua(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Nn();const a=r.tag||r.message;if(r.once&&a)if(!Cl[a])Cl[a]=Nn();else return Bn;return e=N_(this.id,r.message,r),i.bind(console,e,...r.args)}return Bn}}$i.VERSION=Iu;function Cu(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return Ua(Number.isFinite(t)&&t>=0),t}function Ol(n){const{logLevel:t,message:e}=n;n.logLevel=Cu(t);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&i.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Ua(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function N_(n,t,e){if(typeof t=="string"){const i=e.time?I_(P_(e.total)):"";t=e.time?`${n}: ${i}  ${t}`:`${n}: ${t}`,t=M_(t,e.color,e.background)}return t}function D_(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}const po="4.3.2",B_=po[0]>="0"&&po[0]<="9"?`v${po}`:"";function F_(){const n=new $i({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=B_,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const L_=F_();function U_(n,t){return Mu(n||{},t)}function Mu(n,t,e=0){if(e>3)return t;const i={...n};for(const[s,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?i[s]=Mu(i[s]||{},t[s],e+1):i[s]=t[s];return i}const V_="latest";function z_(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const W_=z_();function en(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const dn=typeof process!="object"||String(process)!=="[object process]"||process.browser,H_=typeof window<"u"&&typeof window.orientation<"u",kl=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);kl&&parseFloat(kl[1]);class $_{constructor(t,e){v(this,"name");v(this,"workerThread");v(this,"isRunning",!0);v(this,"result");v(this,"_resolve",()=>{});v(this,"_reject",()=>{});this.name=t,this.workerThread=e,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){en(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){en(this.isRunning),this.isRunning=!1,this._reject(t)}}class _o{terminate(){}}const go=new Map;function j_(n){en(n.source&&!n.url||!n.source&&n.url);let t=go.get(n.source||n.url);return t||(n.url&&(t=X_(n.url),go.set(n.url,t)),n.source&&(t=Ou(n.source),go.set(n.source,t))),en(t),t}function X_(n){if(!n.startsWith("http"))return n;const t=Z_(n);return Ou(t)}function Ou(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function Z_(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function ku(n,t=!0,e){const i=e||new Set;if(n){if(Nl(n))i.add(n);else if(Nl(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(t&&typeof n=="object")for(const s in n)ku(n[s],t,i)}}return e===void 0?Array.from(i):[]}function Nl(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const mo=()=>{};class Yo{constructor(t){v(this,"name");v(this,"source");v(this,"url");v(this,"terminated",!1);v(this,"worker");v(this,"onMessage");v(this,"onError");v(this,"_loadableURL","");const{name:e,source:i,url:s}=t;en(i||s),this.name=e,this.source=i,this.url=s,this.onMessage=mo,this.onError=r=>console.log(r),this.worker=dn?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&dn||typeof _o<"u"&&!dn}destroy(){this.onMessage=mo,this.onError=mo,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||ku(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=j_({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new _o(i,{eval:!1})}else if(this.source)t=new _o(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class Y_{constructor(t){v(this,"name","unnamed");v(this,"source");v(this,"url");v(this,"maxConcurrency",1);v(this,"maxMobileConcurrency",1);v(this,"onDebug",()=>{});v(this,"reuseWorkers",!0);v(this,"props",{});v(this,"jobQueue",[]);v(this,"idleQueue",[]);v(this,"count",0);v(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return Yo.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(s,r,a)=>s.done(a),i=(s,r)=>s.error(r)){const s=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new $_(e.name,t);t.onMessage=s=>e.onMessage(i,s.type,s.payload),t.onError=s=>e.onError(i,s),e.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!dn||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Yo({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return H_?this.maxMobileConcurrency:this.maxConcurrency}}const q_={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ye=class Ye{constructor(t){v(this,"props");v(this,"workerPools",new Map);this.props={...q_},this.setProps(t),this.workerPools=new Map}static isSupported(){return Yo.isSupported()}static getWorkerFarm(t={}){return Ye._workerFarm=Ye._workerFarm||new Ye({}),Ye._workerFarm.setProps(t),Ye._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:s}=t;let r=this.workerPools.get(e);return r||(r=new Y_({name:e,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};v(Ye,"_workerFarm");let Fs=Ye;function K_(n,t={}){const e=t[n.id]||{},i=dn?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=e.workerUrl;if(!s&&n.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(dn?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let r=n.version;r==="latest"&&(r=V_);const a=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${a}/dist/${i}`}return en(s),s}function J_(n,t=W_){en(n,"no worker provided");const e=n.version;return!(!t||!e)}function Q_(n,t){return!Fs.isSupported()||!dn&&!(t!=null&&t._nodeWorkers)?!1:n.worker&&(t==null?void 0:t.worker)}async function G_(n,t,e,i,s){const r=n.id,a=K_(n,e),h=Fs.getWorkerFarm(e).getWorkerPool({name:r,url:a});e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i||{}));const f=await h.startJob("process-on-worker",tg.bind(null,s));return f.postMessage("process",{input:t,options:e,context:i}),await(await f.result).result}async function tg(n,t,e,i){switch(e){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:s,input:r,options:a}=i;try{const l=await n(r,a);t.postMessage("done",{id:s,result:l})}catch(l){const h=l instanceof Error?l.message:"unknown error";t.postMessage("error",{id:s,error:h})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function eg(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const i=new Uint8Array(n),s=new Uint8Array(t);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}function ng(...n){return ig(n)}function ig(n){const t=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),e=t.reduce((r,a)=>r+a.byteLength,0),i=new Uint8Array(e);let s=0;for(const r of t)i.set(r,s),s+=r.byteLength;return i.buffer}async function sg(n){const t=[];for await(const e of n)t.push(e);return ng(...t)}function Dl(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class Bl{constructor(t,e){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Dl(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Dl()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Ar{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,e="count"){return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(e=>this._getOrCreate(e))}_getOrCreate(t){const{name:e,type:i}=t;let s=this.stats[e];return s||(t instanceof Bl?s=t:s=new Bl(e,i),this.stats[e]=s),s}}let rg="";const Fl={};function og(n){for(const t in Fl)if(n.startsWith(t)){const e=Fl[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${rg}${n}`),n}function ag(n){return n&&typeof n=="object"&&n.isBuffer}function Nu(n){if(ag(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Du(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(t+1):""}function cg(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}const lg=n=>typeof n=="boolean",Ii=n=>typeof n=="function",ji=n=>n!==null&&typeof n=="object",Ll=n=>ji(n)&&n.constructor==={}.constructor,hg=n=>!!n&&typeof n[Symbol.iterator]=="function",ug=n=>n&&typeof n[Symbol.asyncIterator]=="function",Tn=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,xn=n=>typeof Blob<"u"&&n instanceof Blob,fg=n=>n&&typeof n=="object"&&n.isBuffer,dg=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||ji(n)&&Ii(n.tee)&&Ii(n.cancel)&&Ii(n.getReader),pg=n=>ji(n)&&Ii(n.read)&&Ii(n.pipe)&&lg(n.readable),Bu=n=>dg(n)||pg(n);class _g extends Error{constructor(e,i){super(e);v(this,"reason");v(this,"url");v(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const gg=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,mg=/^([-\w.]+\/[-\w.+]+)/;function Ul(n,t){return n.toLowerCase()===t.toLowerCase()}function yg(n){const t=mg.exec(n);return t?t[1]:n}function Vl(n){const t=gg.exec(n);return t?t[1]:""}const Fu=/\?.*/;function vg(n){const t=n.match(Fu);return t&&t[0]}function Va(n){return n.replace(Fu,"")}function bg(n){if(n.length<50)return n;const t=n.slice(n.length-15);return`${n.substr(0,32)}...${t}`}function Sr(n){return Tn(n)?n.url:xn(n)?n.name||"":typeof n=="string"?n:""}function za(n){if(Tn(n)){const t=n,e=t.headers.get("content-type")||"",i=Va(t.url);return yg(e)||Vl(i)}return xn(n)?n.type||"":typeof n=="string"?Vl(n):""}function wg(n){return Tn(n)?n.headers["content-length"]||-1:xn(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Lu(n){if(Tn(n))return n;const t={},e=wg(n);e>=0&&(t["content-length"]=String(e));const i=Sr(n),s=za(n);s&&(t["content-type"]=s);const r=await Ag(n);r&&(t["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const a=new Response(n,{headers:t});return Object.defineProperty(a,"url",{value:i}),a}async function Tg(n){if(!n.ok)throw await xg(n)}async function xg(n){const t=bg(n.url);let e=`Failed to fetch resource (${n.status}) ${n.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new _g(e,i)}async function Ag(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const e=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=r=>{var a;return i((a=r==null?void 0:r.target)==null?void 0:a.result)},s.readAsDataURL(e)})}if(n instanceof ArrayBuffer){const e=n.slice(0,5);return`data:base64,${Sg(e)}`}return null}function Sg(n){let t="";const e=new Uint8Array(n);for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function Eg(n){return!Rg(n)&&!Pg(n)}function Rg(n){return n.startsWith("http:")||n.startsWith("https:")}function Pg(n){return n.startsWith("data:")}async function zl(n,t){var e,i;if(typeof n=="string"){const s=og(n);return Eg(s)&&(e=globalThis.loaders)!=null&&e.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(s,t):await fetch(s,t)}return await Lu(n)}const Wl=new $i({id:"loaders.gl"});class Ig{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Cg{constructor(){v(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const Uu={fetch:null,mimeType:void 0,nothrow:!1,log:new Cg,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:La,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Mg={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Vu(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function zu(){const n=Vu();return n.globalOptions=n.globalOptions||{...Uu},n.globalOptions}function Og(n,t,e,i){return e=e||[],e=Array.isArray(e)?e:[e],kg(n,e),Dg(t,n,i)}function kg(n,t){Hl(n,null,Uu,Mg,t);for(const e of t){const i=n&&n[e.id]||{},s=e.options&&e.options[e.id]||{},r=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};Hl(i,e.id,s,r,t)}}function Hl(n,t,e,i,s){const r=t||"Top level",a=t?`${t}.`:"";for(const l in n){const h=!t&&ji(n[l]),f=l==="baseUri"&&!t,d=l==="workerUrl"&&t;if(!(l in e)&&!f&&!d){if(l in i)Wl.warn(`${r} loader option '${a}${l}' no longer supported, use '${i[l]}'`)();else if(!h){const _=Ng(l,s);Wl.warn(`${r} loader option '${a}${l}' not recognized. ${_}`)()}}}}function Ng(n,t){const e=n.toLowerCase();let i="";for(const s of t)for(const r in s.options){if(n===r)return`Did you mean '${s.id}.${r}'?`;const a=r.toLowerCase();(e.startsWith(a)||a.startsWith(e))&&(i=i||`Did you mean '${s.id}.${r}'?`)}return i}function Dg(n,t,e){const s={...n.options||{}};return Bg(s,e),s.log===null&&(s.log=new Ig),$l(s,zu()),$l(s,t),s}function $l(n,t){for(const e in t)if(e in t){const i=t[e];Ll(i)&&Ll(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function Bg(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function Wa(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Ha(n){Ds(n,"null loader"),Ds(Wa(n),"invalid loader");let t;return Array.isArray(n)&&(t=n[1],n=n[0],n={...n,options:{...n.options,...t}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Wu=()=>{const n=Vu();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Fg(n){const t=Wu();n=Array.isArray(n)?n:[n];for(const e of n){const i=Ha(e);t.find(s=>i===s)||t.unshift(i)}}function Lg(){return Wu()}const Ug=/\.([^.]+)$/;async function Vg(n,t=[],e,i){if(!Hu(n))return null;let s=jl(n,t,{...e,nothrow:!0},i);if(s)return s;if(xn(n)&&(n=await n.slice(0,10).arrayBuffer(),s=jl(n,t,e,i)),!s&&!(e!=null&&e.nothrow))throw new Error($u(n));return s}function jl(n,t=[],e,i){if(!Hu(n))return null;if(t&&!Array.isArray(t))return Ha(t);let s=[];t&&(s=s.concat(t)),e!=null&&e.ignoreRegisteredLoaders||s.push(...Lg()),Wg(s);const r=zg(n,s,e,i);if(!r&&!(e!=null&&e.nothrow))throw new Error($u(n));return r}function zg(n,t,e,i){const s=Sr(n),r=za(n),a=Va(s)||(i==null?void 0:i.url);let l=null,h="";return e!=null&&e.mimeType&&(l=yo(t,e==null?void 0:e.mimeType),h=`match forced by supplied MIME type ${e==null?void 0:e.mimeType}`),l=l||Hg(t,a),h=h||(l?`matched url ${a}`:""),l=l||yo(t,r),h=h||(l?`matched MIME type ${r}`:""),l=l||jg(t,n),h=h||(l?`matched initial data ${ju(n)}`:""),e!=null&&e.fallbackMimeType&&(l=l||yo(t,e==null?void 0:e.fallbackMimeType),h=h||(l?`matched fallback MIME type ${r}`:"")),h&&L_.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${h}.`),l}function Hu(n){return!(n instanceof Response&&n.status===204)}function $u(n){const t=Sr(n),e=za(n);let i="No valid loader found (";i+=t?`${Du(t)}, `:"no url provided, ",i+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const s=n?ju(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function Wg(n){for(const t of n)Ha(t)}function Hg(n,t){const e=t&&Ug.exec(t),i=e&&e[1];return i?$g(n,i):null}function $g(n,t){t=t.toLowerCase();for(const e of n)for(const i of e.extensions)if(i.toLowerCase()===t)return e;return null}function yo(n,t){var e;for(const i of n)if((e=i.mimeTypes)!=null&&e.some(s=>Ul(t,s))||Ul(t,`application/x.${i.id}`))return i;return null}function jg(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(Xg(t,e))return e}else if(ArrayBuffer.isView(t)){if(Xl(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&Xl(t,0,e))return e;return null}function Xg(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>n.startsWith(i))}function Xl(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>Zg(n,t,e,s))}function Zg(n,t,e,i){if(i instanceof ArrayBuffer)return eg(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=qo(n,t,i.length);return i===s;default:return!1}}function ju(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?qo(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?qo(n,0,t):""}function qo(n,t,e){if(n.byteLength<t+e)return"";const i=new DataView(n);let s="";for(let r=0;r<e;r++)s+=String.fromCharCode(i.getUint8(t+r));return s}const Yg=256*1024;function*qg(n,t){const e=(t==null?void 0:t.chunkSize)||Yg;let i=0;const s=new TextEncoder;for(;i<n.length;){const r=Math.min(n.length-i,e),a=n.slice(i,i+r);i+=r,yield s.encode(a)}}const Kg=256*1024;function*Jg(n,t={}){const{chunkSize:e=Kg}=t;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,e),r=new ArrayBuffer(s),a=new Uint8Array(n,i,s);new Uint8Array(r).set(a),i+=s,yield r}}const Qg=1024*1024;async function*Gg(n,t){const e=(t==null?void 0:t.chunkSize)||Qg;let i=0;for(;i<n.size;){const s=i+e,r=await n.slice(i,s).arrayBuffer();i=s,yield r}}function Zl(n,t){return La?tm(n,t):em(n)}async function*tm(n,t){const e=n.getReader();let i;try{for(;;){const s=i||e.read();t!=null&&t._streamReadAhead&&(i=e.read());const{done:r,value:a}=await s;if(r)return;yield Nu(a)}}catch{e.releaseLock()}}async function*em(n,t){for await(const e of n)yield Nu(e)}function nm(n,t){if(typeof n=="string")return qg(n,t);if(n instanceof ArrayBuffer)return Jg(n,t);if(xn(n))return Gg(n,t);if(Bu(n))return Zl(n,t);if(Tn(n))return Zl(n.body,t);throw new Error("makeIterator")}const Xu="Cannot convert supplied data type";function im(n,t,e){if(t.text&&typeof n=="string")return n;if(fg(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(Xu)}async function sm(n,t,e){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return im(n,t);if(xn(n)&&(n=await Lu(n)),Tn(n)){const s=n;return await Tg(s),t.binary?await s.arrayBuffer():await s.text()}if(Bu(n)&&(n=nm(n,e)),hg(n)||ug(n))return sg(n);throw new Error(Xu)}function Zu(n,t){const e=zu(),i=n||e;return typeof i.fetch=="function"?i.fetch:ji(i.fetch)?s=>zl(s,i.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:zl}function rm(n,t,e){if(e)return e;const i={fetch:Zu(t,n),...n};if(i.url){const s=Va(i.url);i.baseUrl=s,i.queryString=vg(i.url),i.filename=Du(s),i.baseUrl=cg(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function om(n,t){if(n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...i]:i}return e&&e.length?e:void 0}async function Ls(n,t,e,i){t&&!Array.isArray(t)&&!Wa(t)&&(i=void 0,e=t,t=void 0),n=await n,e=e||{};const s=Sr(n),a=om(t,i),l=await Vg(n,a,e);return l?(e=Og(e,l,a,s),i=rm({url:s,_parse:Ls,loaders:a},e,i||null),await am(l,n,e,i)):null}async function am(n,t,e,i){if(J_(n),e=U_(n.options,e),Tn(t)){const r=t,{ok:a,redirected:l,status:h,statusText:f,type:d,url:_}=r,m=Object.fromEntries(r.headers.entries());i.response={headers:m,ok:a,redirected:l,status:h,statusText:f,type:d,url:_}}t=await sm(t,n,e);const s=n;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,e,i);if(Q_(n,e))return await G_(n,t,e,i,Ls);if(s.parseText&&typeof t=="string")return await s.parseText(t,e,i);if(s.parse)return await s.parse(t,e,i);throw en(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Ko(n,t,e,i){let s,r;!Array.isArray(t)&&!Wa(t)?(s=[],r=t):(s=t,r=e);const a=Zu(r);let l=n;return typeof n=="string"&&(l=await a(n)),xn(n)&&(l=await a(n)),Array.isArray(s)?await Ls(l,s,r):await Ls(l,s,r)}const cm="4.3.2";var Ru;const lm=(Ru=globalThis.loaders)==null?void 0:Ru.parseImageNode,Jo=typeof Image<"u",Qo=typeof ImageBitmap<"u",hm=!!lm,Go=La?!0:hm;function um(n){switch(n){case"auto":return Qo||Jo||Go;case"imagebitmap":return Qo;case"image":return Jo;case"data":return Go;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function fm(){if(Qo)return"imagebitmap";if(Jo)return"image";if(Go)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function dm(n){const t=_m(n);if(!t)throw new Error("Not an image");return t}function pm(n){switch(dm(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function _m(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const gm=/^data:image\/svg\+xml/,mm=/\.svg((\?|#).*)?$/;function $a(n){return n&&(gm.test(n)||mm.test(n))}function ym(n,t){if($a(t)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Yu(n,t)}function Yu(n,t){if($a(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function qu(n,t,e){const i=ym(n,e),s=self.URL||self.webkitURL,r=typeof i!="string"&&s.createObjectURL(i);try{return await vm(r||i,t)}finally{r&&s.revokeObjectURL(r)}}async function vm(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,s)=>{try{e.onload=()=>i(e),e.onerror=r=>{const a=r instanceof Error?r.message:"error";s(new Error(a))}}catch(r){s(r)}})}const bm={};let Yl=!0;async function wm(n,t,e){let i;$a(e)?i=await qu(n,t,e):i=Yu(n,e);const s=t&&t.imagebitmap;return await Tm(i,s)}async function Tm(n,t=null){if((xm(t)||!Yl)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),Yl=!1}return await createImageBitmap(n)}function xm(n){for(const t in n||bm)return!1;return!0}function Am(n){return!Pm(n,"ftyp",4)||(n[8]&96)===0?null:Sm(n)}function Sm(n){switch(Em(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Em(n,t,e){return String.fromCharCode(...n.slice(t,e))}function Rm(n){return[...n].map(t=>t.charCodeAt(0))}function Pm(n,t,e=0){const i=Rm(t);for(let s=0;s<i.length;++s)if(i[s]!==n[s+e])return!1;return!0}const Ee=!1,Ci=!0;function Ku(n){const t=Xi(n);return Cm(t)||km(t)||Mm(t)||Om(t)||Im(t)}function Im(n){const t=new Uint8Array(n instanceof DataView?n.buffer:n),e=Am(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function Cm(n){const t=Xi(n);return t.byteLength>=24&&t.getUint32(0,Ee)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ee),height:t.getUint32(20,Ee)}:null}function Mm(n){const t=Xi(n);return t.byteLength>=10&&t.getUint32(0,Ee)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Ci),height:t.getUint16(8,Ci)}:null}function Om(n){const t=Xi(n);return t.byteLength>=14&&t.getUint16(0,Ee)===16973&&t.getUint32(2,Ci)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ci),height:t.getUint32(22,Ci)}:null}function km(n){const t=Xi(n);if(!(t.byteLength>=3&&t.getUint16(0,Ee)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=Nm();let r=2;for(;r+9<t.byteLength;){const a=t.getUint16(r,Ee);if(s.has(a))return{mimeType:"image/jpeg",height:t.getUint16(r+5,Ee),width:t.getUint16(r+7,Ee)};if(!i.has(a))return null;r+=2,r+=t.getUint16(r,Ee)}return null}function Nm(){const n=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)n.add(e);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Xi(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function Dm(n,t){var s;const{mimeType:e}=Ku(n)||{},i=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return Ds(i),await i(n,e)}async function Bm(n,t,e){t=t||{};const s=(t.image||{}).type||"auto",{url:r}=e||{},a=Fm(s);let l;switch(a){case"imagebitmap":l=await wm(n,t,r);break;case"image":l=await qu(n,t,r);break;case"data":l=await Dm(n);break;default:Ds(!1)}return s==="data"&&(l=pm(l)),l}function Fm(n){switch(n){case"auto":case"data":return fm();default:return um(n),n}}const Lm=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Um=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Vm={image:{type:"auto",decode:!0}},zm={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:cm,mimeTypes:Um,extensions:Lm,parse:Bm,tests:[n=>!!Ku(new DataView(n))],options:Vm},vt=new $i({id:"deck"});let ta={};function Wm(n){ta=n}function Yt(n,t,e,i){vt.level>0&&ta[n]&&ta[n].call(null,t,e,i)}function Hm(n){const t=n[0],e=n[n.length-1];return t==="{"&&e==="}"||t==="["&&e==="]"}const $m={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Hm,parseTextSync:JSON.parse};function jm(){const n="9.1.7",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==n)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${n}`);return t||(vt.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:vt,_registerLoggers:Wm},Fg([$m,[zm,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const Xm=jm();function ja(n,t){if(!n)throw new Error(t||"shadertools: assertion failed.")}const vo={number:{type:"number",validate(n,t){return Number.isFinite(n)&&typeof t=="object"&&(t.max===void 0||n<=t.max)&&(t.min===void 0||n>=t.min)}},array:{type:"array",validate(n,t){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function Zm(n){const t={};for(const[e,i]of Object.entries(n))t[e]=Ym(i);return t}function Ym(n){let t=ql(n);if(t!=="object")return{value:n,...vo[t],type:t};if(typeof n=="object")return n?n.type!==void 0?{...n,...vo[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(t=ql(n.value),{...n,...vo[t],type:t}):{type:"object",value:null};throw new Error("props")}function ql(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const qm=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Km=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,Jm={vertex:qm,fragment:Km},Kl=/void\s+main\s*\([^)]*\)\s*\{\n?/,Jl=/}\n?[^{}]*$/,bo=[],Is="__LUMA_INJECT_DECLARATIONS__";function Qm(n){const t={vertex:{},fragment:{}};for(const e in n){let i=n[e];const s=Gm(e);typeof i=="string"&&(i={order:0,injection:i}),t[s][e]=i}return t}function Gm(n){const t=n.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Us(n,t,e,i=!1){const s=t==="vertex";for(const r in e){const a=e[r];a.sort((h,f)=>h.order-f.order),bo.length=a.length;for(let h=0,f=a.length;h<f;++h)bo[h]=a[h].injection;const l=`${bo.join(`
`)}
`;switch(r){case"vs:#decl":s&&(n=n.replace(Is,l));break;case"vs:#main-start":s&&(n=n.replace(Kl,h=>h+l));break;case"vs:#main-end":s&&(n=n.replace(Jl,h=>l+h));break;case"fs:#decl":s||(n=n.replace(Is,l));break;case"fs:#main-start":s||(n=n.replace(Kl,h=>h+l));break;case"fs:#main-end":s||(n=n.replace(Jl,h=>l+h));break;default:n=n.replace(r,h=>h+l)}}return n=n.replace(Is,""),i&&(n=n.replace(/\}\s*$/,r=>r+Jm[t])),n}function Vs(n){n.map(t=>ty(t))}function ty(n){if(n.instance)return;Vs(n.dependencies||[]);const{propTypes:t={},deprecations:e=[],inject:i={}}=n,s={normalizedInjections:Qm(i),parsedDeprecations:ey(e)};t&&(s.propValidators=Zm(t)),n.instance=s;let r={};t&&(r=Object.entries(t).reduce((a,[l,h])=>{const f=h==null?void 0:h.value;return f&&(a[l]=f),a},{})),n.defaultUniforms={...n.defaultUniforms,...r}}function Ju(n,t,e){var i;(i=n.deprecations)==null||i.forEach(s=>{var r;(r=s.regex)!=null&&r.test(t)&&(s.deprecated?e.deprecated(s.old,s.new)():e.removed(s.old,s.new)())})}function ey(n){return n.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),n}function Xa(n){Vs(n);const t={},e={};Qu({modules:n,level:0,moduleMap:t,moduleDepth:e});const i=Object.keys(e).sort((s,r)=>e[r]-e[s]).map(s=>t[s]);return Vs(i),i}function Qu(n){const{modules:t,level:e,moduleMap:i,moduleDepth:s}=n;if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)i[r.name]=r,(s[r.name]===void 0||s[r.name]<e)&&(s[r.name]=e);for(const r of t)r.dependencies&&Qu({modules:r.dependencies,level:e+1,moduleMap:i,moduleDepth:s})}function ny(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function iy(n,t){var i;if(Number(((i=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return n=Ql(n,sy),n;case"fragment":return n=Ql(n,ry),n;default:throw new Error(t)}}const Gu=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],sy=[...Gu,[ea("attribute"),"in $1"],[ea("varying"),"out $1"]],ry=[...Gu,[ea("varying"),"in $1"]];function Ql(n,t){for(const[e,i]of t)n=n.replace(e,i);return n}function ea(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function tf(n,t){let e="";for(const i in n){const s=n[i];if(e+=`void ${s.signature} {
`,s.header&&(e+=`  ${s.header}`),t[i]){const r=t[i];r.sort((a,l)=>a.order-l.order);for(const a of r)e+=`  ${a.injection}
`}s.footer&&(e+=`  ${s.footer}`),e+=`}
`}return e}function ef(n){const t={vertex:{},fragment:{}};for(const e of n){let i,s;typeof e!="string"?(i=e,s=i.hook):(i={},s=e),s=s.trim();const[r,a]=s.split(":"),l=s.replace(/\(.+/,""),h=Object.assign(i,{signature:a});switch(r){case"vs":t.vertex[l]=h;break;case"fs":t.fragment[l]=h;break;default:throw new Error(r)}}return t}function oy(n,t){return{name:ay(n,t),language:"glsl",version:cy(n)}}function ay(n,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:t}function cy(n){let t=100;const e=n.match(/[^\s]+/g);if(e&&e.length>=2&&e[0]==="#version"){const i=parseInt(e[1],10);Number.isFinite(i)&&(t=i)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const nf=`

${Is}
`,ly=`precision highp float;
`;function hy(n){const t=Xa(n.modules||[]);return{source:fy(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:t}),getUniforms:sf(t)}}function uy(n){const{vs:t,fs:e}=n,i=Xa(n.modules||[]);return{vs:Gl(n.platformInfo,{...n,source:t,stage:"vertex",modules:i}),fs:Gl(n.platformInfo,{...n,source:e,stage:"fragment",modules:i}),getUniforms:sf(i)}}function fy(n,t){var S;const{source:e,stage:i,modules:s,hookFunctions:r=[],inject:a={},log:l}=t;ja(typeof e=="string","shader source must be a string");const h=e;let f="";const d=ef(r),_={},m={},w={};for(const k in a){const B=typeof a[k]=="string"?{injection:a[k],order:0}:a[k],F=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(F){const M=F[2],D=F[3];M?D==="decl"?m[k]=[B]:w[k]=[B]:_[k]=[B]}else w[k]=[B]}const A=s;for(const k of A){l&&Ju(k,h,l);const B=rf(k,"wgsl");f+=B;const F=((S=k.injections)==null?void 0:S[i])||{};for(const M in F){const D=/^(v|f)s:#([\w-]+)$/.exec(M);if(D){const W=D[2]==="decl"?m:w;W[M]=W[M]||[],W[M].push(F[M])}else _[M]=_[M]||[],_[M].push(F[M])}}return f+=nf,f=Us(f,i,m),f+=tf(d[i],_),f+=h,f=Us(f,i,w),f}function Gl(n,t){var at;const{id:e,source:i,stage:s,language:r="glsl",modules:a,defines:l={},hookFunctions:h=[],inject:f={},prologue:d=!0,log:_}=t;ja(typeof i=="string","shader source must be a string");const m=r==="glsl"?oy(i).version:-1,w=n.shaderLanguageVersion,A=m===100?"#version 100":"#version 300 es",k=i.split(`
`).slice(1).join(`
`),B={};a.forEach(Y=>{Object.assign(B,Y.defines)}),Object.assign(B,l);let F="";switch(r){case"wgsl":break;case"glsl":F=d?`${A}

// ----- PROLOGUE -------------------------
${dy({id:e,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${ny(n)}
${s==="fragment"?ly:""}

// ----- APPLICATION DEFINES -------------------------

${py(B)}

`:`${A}
`;break}const M=ef(h),D={},H={},W={};for(const Y in f){const J=typeof f[Y]=="string"?{injection:f[Y],order:0}:f[Y],rt=/^(v|f)s:(#)?([\w-]+)$/.exec(Y);if(rt){const X=rt[2],ot=rt[3];X?ot==="decl"?H[Y]=[J]:W[Y]=[J]:D[Y]=[J]}else W[Y]=[J]}for(const Y of a){_&&Ju(Y,k,_);const J=rf(Y,s);F+=J;const rt=((at=Y.instance)==null?void 0:at.normalizedInjections[s])||{};for(const X in rt){const ot=/^(v|f)s:#([\w-]+)$/.exec(X);if(ot){const tt=ot[2]==="decl"?H:W;tt[X]=tt[X]||[],tt[X].push(rt[X])}else D[X]=D[X]||[],D[X].push(rt[X])}}return F+="// ----- MAIN SHADER SOURCE -------------------------",F+=nf,F=Us(F,s,H),F+=tf(M[s],D),F+=k,F=Us(F,s,W),r==="glsl"&&m!==w&&(F=iy(F,s)),F.trim()}function sf(n){return function(e){var s;const i={};for(const r of n){const a=(s=r.getUniforms)==null?void 0:s.call(r,e,i);Object.assign(i,a)}return i}}function dy(n){const{id:t,source:e,stage:i}=n;return t&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${i}`:""}function py(n={}){let t="";for(const e in n){const i=n[e];(i||Number.isFinite(i))&&(t+=`#define ${e.toUpperCase()} ${n[e]}
`)}return t}function rf(n,t){let e;switch(t){case"vertex":e=n.vs||"";break;case"fragment":e=n.fs||"";break;case"wgsl":e=n.source||"";break;default:ja(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return t!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${e}
`,s}const _y=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,gy=/^\s*\#\s*endif\s*$/;function my(n,t){var a;const e=n.split(`
`),i=[];let s=!0,r=null;for(const l of e){const h=l.match(_y),f=l.match(gy);h?(r=h[1],s=!!((a=t==null?void 0:t.defines)!=null&&a[r])):f?s=!0:s&&i.push(l)}return i.join(`
`)}const un=class un{constructor(){v(this,"_hookFunctions",[]);v(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return un.defaultShaderAssembler=un.defaultShaderAssembler||new un,un.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(e=>e.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const e=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==e)}addShaderHook(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const e=this._getModuleList(t.modules),i=this._hookFunctions,{source:s,getUniforms:r}=hy({...t,source:t.source,modules:e,hookFunctions:i});return{source:t.platformInfo.shaderLanguage==="wgsl"?my(s):s,getUniforms:r,modules:e}}assembleGLSLShaderPair(t){const e=this._getModuleList(t.modules),i=this._hookFunctions;return{...uy({...t,vs:t.vs,fs:t.fs,modules:e,hookFunctions:i}),modules:e}}_getModuleList(t=[]){const e=new Array(this._defaultModules.length+t.length),i={};let s=0;for(let r=0,a=this._defaultModules.length;r<a;++r){const l=this._defaultModules[r],h=l.name;e[s++]=l,i[h]=!0}for(let r=0,a=t.length;r<a;++r){const l=t[r],h=l.name;i[h]||(e[s++]=l,i[h]=!0)}return e.length=s,Vs(e),e}};v(un,"defaultShaderAssembler");let zs=un;const yy=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,vy=`#version 300 es
${yy}`;function by(n){const{input:t,inputChannels:e,output:i}={};if(!t)return vy;if(!e)throw new Error("inputChannels");const s=wy(e),r=Ty(t,e);return`#version 300 es
in ${s} ${t};
out vec4 ${i};
void main() {
  ${i} = ${r};
}`}function wy(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function Ty(n,t){switch(t){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${t}`)}}class xy{constructor(){v(this,"stats",new Map)}getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Ar({id:t})),this.stats.get(t)}}const of=new xy,z=new $i({id:"luma.gl"}),wo={};function Er(n="id"){wo[n]=wo[n]||1;const t=wo[n]++;return`${n}-${t}`}var Zo;let gt=(Zo=class{constructor(t,e,i){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"_device");v(this,"destroyed",!1);v(this,"allocatedBytes",0);v(this,"_attachedResources",new Set);if(!t)throw new Error("no device");this._device=t,this.props=Ay(e,i);const s=this.props.id!=="undefined"?this.props.id:Er(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(t),i.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}},v(Zo,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Zo);function Ay(n,t){const e={...t};for(const i in n)n[i]!==void 0&&(e[i]=n[i]);return e}const Vt=class Vt extends gt{constructor(e,i){const s={...i};(i.usage||0)&Vt.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?s.indexType="uint32":i.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(e,s,Vt.defaultProps);v(this,"usage");v(this,"indexType");v(this,"updateTimestamp");v(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,i){throw new Error("not implemented")}_setDebugData(e,i,s){const r=ArrayBuffer.isView(e)?e.buffer:e,a=Math.min(e?e.byteLength:s,Vt.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(a):i===0&&s===r.byteLength?this.debugData=r.slice(0,a):this.debugData=r.slice(i,i+a)}};v(Vt,"defaultProps",{...gt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),v(Vt,"MAP_READ",1),v(Vt,"MAP_WRITE",2),v(Vt,"COPY_SRC",4),v(Vt,"COPY_DST",8),v(Vt,"INDEX",16),v(Vt,"VERTEX",32),v(Vt,"UNIFORM",64),v(Vt,"STORAGE",128),v(Vt,"INDIRECT",256),v(Vt,"QUERY_RESOLVE",512),v(Vt,"DEBUG_DATA_MAX_LENGTH",32);let bt=Vt;function af(n){const t=th[n],e=Sy(t),i=n.includes("norm"),s=!i&&!n.startsWith("float"),r=n.startsWith("s");return{dataType:th[n],byteLength:e,integer:s,signed:r,normalized:i}}function Sy(n){return Ey[n]}const th={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Ey={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Wt="texture-compression-bc",_t="texture-compression-astc",xe="texture-compression-etc2",Ry="texture-compression-etc1-webgl",gs="texture-compression-pvrtc-webgl",To="texture-compression-atc-webgl",ms="float32-renderable-webgl",xo="float16-renderable-webgl",Py="rgb9e5ufloat-renderable-webgl",Ao="snorm8-renderable-webgl",vi="norm16-renderable-webgl",So="snorm16-renderable-webgl",ys="float32-filterable",eh="float16-filterable-webgl";function cf(n){const t=Iy[n];if(!t)throw new Error(`Unsupported texture format ${n}`);return t}const Iy={r8unorm:{},r8snorm:{render:Ao},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Ao},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:xo,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:vi},"r16snorm-webgl":{f:So},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Ao},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:xo,filter:eh},"rg16unorm-webgl":{render:vi},"rg16snorm-webgl":{render:So},r32uint:{},r32sint:{},r32float:{render:ms,filter:ys},rgb9e5ufloat:{channels:"rgb",packed:!0,render:Py},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:ms},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:vi},"rgb16snorm-webgl":{f:vi},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:ys},rgba16uint:{},rgba16sint:{},rgba16float:{render:xo,filter:eh},"rgba16unorm-webgl":{render:vi},"rgba16snorm-webgl":{render:So},"rgb32float-webgl":{render:ms,filter:ys},rgba32uint:{},rgba32sint:{},rgba32float:{render:ms,filter:ys},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Wt},"bc1-rgb-unorm-srgb-webgl":{f:Wt},"bc1-rgba-unorm":{f:Wt},"bc1-rgba-unorm-srgb":{f:Wt},"bc2-rgba-unorm":{f:Wt},"bc2-rgba-unorm-srgb":{f:Wt},"bc3-rgba-unorm":{f:Wt},"bc3-rgba-unorm-srgb":{f:Wt},"bc4-r-unorm":{f:Wt},"bc4-r-snorm":{f:Wt},"bc5-rg-unorm":{f:Wt},"bc5-rg-snorm":{f:Wt},"bc6h-rgb-ufloat":{f:Wt},"bc6h-rgb-float":{f:Wt},"bc7-rgba-unorm":{f:Wt},"bc7-rgba-unorm-srgb":{f:Wt},"etc2-rgb8unorm":{f:xe},"etc2-rgb8unorm-srgb":{f:xe},"etc2-rgb8a1unorm":{f:xe},"etc2-rgb8a1unorm-srgb":{f:xe},"etc2-rgba8unorm":{f:xe},"etc2-rgba8unorm-srgb":{f:xe},"eac-r11unorm":{f:xe},"eac-r11snorm":{f:xe},"eac-rg11unorm":{f:xe},"eac-rg11snorm":{f:xe},"astc-4x4-unorm":{f:_t},"astc-4x4-unorm-srgb":{f:_t},"astc-5x4-unorm":{f:_t},"astc-5x4-unorm-srgb":{f:_t},"astc-5x5-unorm":{f:_t},"astc-5x5-unorm-srgb":{f:_t},"astc-6x5-unorm":{f:_t},"astc-6x5-unorm-srgb":{f:_t},"astc-6x6-unorm":{f:_t},"astc-6x6-unorm-srgb":{f:_t},"astc-8x5-unorm":{f:_t},"astc-8x5-unorm-srgb":{f:_t},"astc-8x6-unorm":{f:_t},"astc-8x6-unorm-srgb":{f:_t},"astc-8x8-unorm":{f:_t},"astc-8x8-unorm-srgb":{f:_t},"astc-10x5-unorm":{f:_t},"astc-10x5-unorm-srgb":{f:_t},"astc-10x6-unorm":{f:_t},"astc-10x6-unorm-srgb":{f:_t},"astc-10x8-unorm":{f:_t},"astc-10x8-unorm-srgb":{f:_t},"astc-10x10-unorm":{f:_t},"astc-10x10-unorm-srgb":{f:_t},"astc-12x10-unorm":{f:_t},"astc-12x10-unorm-srgb":{f:_t},"astc-12x12-unorm":{f:_t},"astc-12x12-unorm-srgb":{f:_t},"pvrtc-rgb4unorm-webgl":{f:gs},"pvrtc-rgba4unorm-webgl":{f:gs},"pvrtc-rbg2unorm-webgl":{f:gs},"pvrtc-rgba2unorm-webgl":{f:gs},"etc1-rbg-unorm-webgl":{f:Ry},"atc-rgb-unorm-webgl":{f:To},"atc-rgba-unorm-webgl":{f:To},"atc-rgbai-unorm-webgl":{f:To}},Cy=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],My=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function lf(n){return Cy.some(t=>n.startsWith(t))}function Za(n){let t=Oy(n);if(lf(n)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const i=ky(n);i&&(t.blockWidth=i.blockWidth,t.blockHeight=i.blockHeight)}const e=My.exec(n);if(e){const[,i,s,r,a,l]=e,h=`${r}${s}`,f=af(h),d=f.byteLength*8,_=i.length,m=[d,_>=2?d:0,_>=3?d:0,_>=4?d:0];t={format:n,attachment:t.attachment,dataType:f.dataType,components:_,channels:i,integer:f.integer,signed:f.signed,normalized:f.normalized,bitsPerChannel:m,bytesPerPixel:f.byteLength*i.length,packed:t.packed,srgb:t.srgb},l==="-webgl"&&(t.webgl=!0),a==="-srgb"&&(t.srgb=!0)}return n.endsWith("-webgl")&&(t.webgl=!0),n.endsWith("-srgb")&&(t.srgb=!0),t}function Oy(n){var r;const t=cf(n),e=t.bytesPerPixel||1,i=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:n,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||((r=t.channels)==null?void 0:r.length)||1,bytesPerPixel:e,bitsPerChannel:i,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function ky(n){const e=/.*-(\d+)x(\d+)-.*/.exec(n);if(e){const[,i,s]=e;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function Ny(n){const t=cf(n),e={format:n,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=Za(n),s=n.startsWith("depth")||n.startsWith("stencil"),r=i==null?void 0:i.signed,a=i==null?void 0:i.integer,l=i==null?void 0:i.webgl;return e.render&&(e.render=!r),e.filter&&(e.filter=!s&&!r&&!a&&!l),e}class Dy{}class By{constructor(t=[],e){v(this,"features");v(this,"disabledFeatures");this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){var e;return!((e=this.disabledFeatures)!=null&&e[t])&&this.features.has(t)}}const lr=class lr{constructor(t){v(this,"id");v(this,"props");v(this,"userData",{});v(this,"statsManager",of);v(this,"timestamp",0);v(this,"_reused",!1);v(this,"_lumaData",{});this.props={...lr.defaultProps,...t},this.id=this.props.id||Er(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(t){const e=Ny(t),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,s=i(e.create),r={format:t,create:s,render:s&&i(e.render),filter:s&&i(e.filter),blend:s&&i(e.blend),store:s&&i(e.store)};return this._getDeviceSpecificTextureFormatCapabilities(r)}isTextureFormatSupported(t,e){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return lf(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};return(t.usage||0)&bt.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array?e.indexType="uint16":z.warn("indices buffer content must be of integer type")()),e}};v(lr,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:t=>z.error(t.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:z.get("debug")||void 0,debugShaders:z.get("debug-shaders")||void 0,debugFramebuffers:!!z.get("debug-framebuffers"),debugWebGL:!!z.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Ge=lr;const Fy=wn()&&typeof document<"u",Ly=()=>Fy&&document.readyState==="complete",Uy="set luma.log.level=1 (or higher) to trace rendering",nh="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",qe=class qe{constructor(){v(this,"stats",of);v(this,"log",z);v(this,"VERSION","9.1.5");v(this,"spector");v(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw z.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),z.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");z.error("This version of luma.gl has already been initialized")()}z.log(1,`${this.VERSION} - ${Uy}`)(),globalThis.luma=this}registerAdapters(t){for(const e of t)this.preregisteredAdapters.set(e.type,e)}getSupportedAdapters(t=[]){const e=this.getAdapterMap(t);return Array.from(e).map(([,i])=>i).filter(i=>{var s;return(s=i.isSupported)==null?void 0:s.call(i)}).map(i=>i.type)}getBestAvailableAdapter(t=[]){var i,s,r,a;const e=this.getAdapterMap(t);return(s=(i=e.get("webgpu"))==null?void 0:i.isSupported)!=null&&s.call(i)?"webgpu":(a=(r=e.get("webgl"))==null?void 0:r.isSupported)!=null&&a.call(r)?"webgl":null}setDefaultDeviceProps(t){Object.assign(qe.defaultProps,t)}async createDevice(t={}){var l;t={...qe.defaultProps,...t},t.waitForPageLoad&&await qe.pageLoaded;const e=this.getAdapterMap(t.adapters);let i=t.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(t.adapters)||i);const r=(this.getAdapterMap(t.adapters)||e).get(i),a=await((l=r==null?void 0:r.create)==null?void 0:l.call(r,t));if(a)return a;throw new Error(nh)}async attachDevice(t){var a;const e=this.getAdapterMap(t.adapters);let i="";t.handle instanceof WebGL2RenderingContext&&(i="webgl"),t.createCanvasContext&&await qe.pageLoaded,t.handle===null&&(i="unknown");const s=e.get(i),r=await((a=s==null?void 0:s.attach)==null?void 0:a.call(s,null));if(r)return r;throw new Error(nh)}enforceWebGL2(t=!0,e=[]){var r;const s=this.getAdapterMap(e).get("webgl");s||z.warn("enforceWebGL2: webgl adapter not found")(),(r=s==null?void 0:s.enforceWebGL2)==null||r.call(s,t)}getAdapterMap(t=[]){const e=new Map(this.preregisteredAdapters);for(const i of t)e.set(i.type,i);return e}registerDevices(t){z.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const e of t){const i=e.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}};v(qe,"defaultProps",{...Ge.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),v(qe,"pageLoaded",Vy().then(()=>{z.probe(2,"DOM is loaded")()}));let na=qe;const ia=new na;function Vy(){return Ly()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class zy{}const hr=class hr{constructor(t){v(this,"id");v(this,"props");v(this,"canvas");v(this,"htmlCanvas");v(this,"offscreenCanvas");v(this,"type");v(this,"width",1);v(this,"height",1);v(this,"resizeObserver");v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...hr.defaultProps,...t},t=this.props,!wn()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=Hy(t.canvas):this.canvas=t.canvas;else{const e=$y(t),i=Wy((t==null?void 0:t.container)||null);i.insertBefore(e,i.firstChild),this.canvas=e,t!=null&&t.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(e=>{for(const i of e)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),e=this.canvas;return e.parentElement?[e.clientWidth*t,e.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,e]=this.getPixelSize();return t/e}cssToDeviceRatio(){var t;try{const[e]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||((t=this.htmlCanvas)==null?void 0:t.clientWidth);return i?e/i:1}catch{return 1}}cssToDevicePixels(t,e=!0){const i=this.cssToDeviceRatio(),[s,r]=this.getDrawingBufferSize();return jy(t,i,s,r,e)}setDevicePixelRatio(t,e={}){if(!this.htmlCanvas)return;let i="width"in e?e.width:this.htmlCanvas.clientWidth,s="height"in e?e.height:this.htmlCanvas.clientHeight;(!i||!s)&&(z.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==i||r.clientHeight!==s||r.devicePixelRatio!==t){let a=t;const l=Math.floor(i*a),h=Math.floor(s*a);if(this.htmlCanvas.width=l,this.htmlCanvas.height=h,this.device.gl){const[d,_]=this.getDrawingBufferSize();(d!==l||_!==h)&&(a=Math.min(d/i,_/s),this.htmlCanvas.width=Math.floor(i*a),this.htmlCanvas.height=Math.floor(s*a),z.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){const t=this.device.gl;return t?[t.drawingBufferWidth,t.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(t){var e;((e=this.htmlCanvas)==null?void 0:e.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}};v(hr,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let sa=hr;function Wy(n){if(typeof n=="string"){const t=document.getElementById(n);if(!t)throw new Error(`${n} is not an HTML element`);return t}else if(n)return n;return document.body}function Hy(n){const t=document.getElementById(n);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function $y(n){const{width:t,height:e}=n,i=document.createElement("canvas");return i.id=Er("lumagl-auto-created-canvas"),i.width=t||1,i.height=e||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(e)?`${e}px`:"100%",i}function jy(n,t,e,i,s){const r=n,a=ih(r[0],t,e);let l=sh(r[1],t,i,s),h=ih(r[0]+1,t,e);const f=h===e-1?h:h-1;h=sh(r[1]+1,t,i,s);let d;return s?(h=h===0?h:h+1,d=l,l=h):d=h===i-1?h:h-1,{x:a,y:l,width:Math.max(f-a+1,1),height:Math.max(d-l+1,1)}}function ih(n,t,e){return Math.min(Math.round(n*t),e-1)}function sh(n,t,e,i){return i?Math.max(0,e-1-Math.round(n*t)):Math.min(Math.round(n*t),e-1)}const zt=class zt extends gt{constructor(e,i){i=zt.normalizeProps(e,i);super(e,i,zt.defaultProps);v(this,"dimension");v(this,"format");v(this,"width");v(this,"height");v(this,"depth");v(this,"mipLevels");v(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=zt.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?zt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const i=e==null?void 0:e.data;return ArrayBuffer.isView(i)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return zt.getTextureDataSize(e[0]);if(zt.isExternalImage(e))return zt.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const s=Object.values(e)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,i){let s;return ArrayBuffer.isView(e)?s=[{data:e,width:i.width,height:i.height}]:Array.isArray(e)?s=e:s=[e],s}static getMipLevelCount(e,i){return Math.floor(Math.log2(Math.max(e,i)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static normalizeProps(e,i){var h,f;const s={...i},r=((f=(h=e==null?void 0:e.props)==null?void 0:h._resourceDefaults)==null?void 0:f.texture)||{};Object.assign(s,r);const{width:a,height:l}=s;return typeof a=="number"&&(s.width=Math.max(1,Math.ceil(a))),typeof l=="number"&&(s.height=Math.max(1,Math.ceil(l))),s}};v(zt,"COPY_SRC",1),v(zt,"COPY_DST",2),v(zt,"TEXTURE",4),v(zt,"STORAGE",8),v(zt,"RENDER_ATTACHMENT",16),v(zt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),v(zt,"defaultProps",{...gt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),v(zt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let St=zt;const ur=class ur extends gt{get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,ur.defaultProps)}};v(ur,"defaultProps",{...gt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Ws=ur;function Xy(n,t,e){let i="";const s=t.split(/\r?\n/),r=n.slice().sort((a,l)=>a.lineNum-l.lineNum);switch((e==null?void 0:e.showSourceCode)||"no"){case"all":let a=0;for(let l=1;l<=s.length;l++)for(i+=hf(s[l-1],l,e);r.length>a&&r[a].lineNum===l;){const h=r[a++];i+=rh(h,s,h.lineNum,{...e,inlineSource:!1})}return i;case"issues":case"no":for(const l of n)i+=rh(l,s,l.lineNum,{inlineSource:(e==null?void 0:e.showSourceCode)!=="no"});return i}}function rh(n,t,e,i){if(i!=null&&i.inlineSource){const r=Zy(t,e),a=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${r}${a}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function Zy(n,t,e){let i="";for(let s=t-2;s<=t;s++){const r=n[s-1];r!==void 0&&(i+=hf(r,t,e))}return i}function hf(n,t,e){const i=e!=null&&e.html?qy(n):n;return`${Yy(String(t),4)}: ${i}${e!=null&&e.html?"<br/>":`
`}`}function Yy(n,t){let e="";for(let i=n.length;i<t;++i)e+=" ";return e+n}function qy(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const fr=class fr extends gt{constructor(e,i){i={...i,debugShaders:i.debugShaders||e.props.debugShaders||"errors"};super(e,{id:Ky(i),...i},fr.defaultProps);v(this,"stage");v(this,"source");v(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();e==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(e){var f;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=uf(this.source),s=`${this.stage} ${i}`;let r=Xy(e,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l),(f=document.getElementsByClassName("luma-compiler-log-error")[0])==null||f.scrollIntoView(),l.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}};v(fr,"defaultProps",{...gt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Hs=fr;function Ky(n){return uf(n.source)||n.id||Er(`unnamed ${n.stage}-shader`)}function uf(n,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:t}const Bi=class Bi extends gt{get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){e=Bi.normalizeProps(t,e),super(t,e,Bi.defaultProps)}static normalizeProps(t,e){var r,a;const i=((a=(r=t==null?void 0:t.props)==null?void 0:r._resourceDefaults)==null?void 0:a.sampler)||{};return{...e,...i}}};v(Bi,"defaultProps",{...gt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let $s=Bi;const dr=class dr extends gt{constructor(e,i={}){super(e,i,dr.defaultProps);v(this,"width");v(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(e){const i=this.colorAttachments.map(r=>r.texture.clone(e)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:s})}resize(e){let i=!e;if(e){const[s,r]=Array.isArray(e)?e:[e.width,e.height];i=i||r!==this.height||s!==this.width,this.width=s,this.height=r}i&&(z.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,s)=>{if(typeof i=="string"){const r=this.createColorTexture(i,s);return this.attachResource(r),r.view}return i instanceof St?i.view:i});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const i=this.createDepthStencilTexture(e);this.attachResource(i),this.depthStencilAttachment=i.view}else e instanceof St?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:St.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:St.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,i){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const r=this.colorAttachments[s].texture.clone({width:e,height:i});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:e,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};v(dr,"defaultProps",{...gt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let js=dr;const pr=class pr extends gt{constructor(e,i){super(e,i,pr.defaultProps);v(this,"shaderLayout");v(this,"bufferLayout");v(this,"linkStatus","pending");v(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};v(pr,"defaultProps",{...gt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let qn=pr;const _e=class _e extends gt{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){e=_e.normalizeProps(t,e),super(t,e,_e.defaultProps)}static normalizeProps(t,e){var r;return{...(r=t.props._resourceDefaults)==null?void 0:r.renderPass,...e}}};v(_e,"defaultClearColor",[0,0,0,1]),v(_e,"defaultClearDepth",1),v(_e,"defaultClearStencil",0),v(_e,"defaultProps",{...gt.defaultProps,framebuffer:null,parameters:void 0,clearColor:_e.defaultClearColor,clearColors:void 0,clearDepth:_e.defaultClearDepth,clearStencil:_e.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let ra=_e;const _r=class _r extends gt{constructor(e,i){super(e,i,_r.defaultProps);v(this,"hash","");v(this,"shaderLayout");this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};v(_r,"defaultProps",{...gt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Xs=_r;const gr=class gr extends gt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,gr.defaultProps)}};v(gr,"defaultProps",{...gt.defaultProps,measureExecutionTime:void 0});let oa=gr;const mr=class mr extends gt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,mr.defaultProps)}};v(mr,"defaultProps",{...gt.defaultProps});let aa=mr;function Jy(n){const[t,e]=Gy[n],i=t==="i32"||t==="u32",s=t!=="u32",r=tv[t]*e,a=Qy(t,e);return{dataType:t,components:e,defaultVertexFormat:a,byteLength:r,integer:i,signed:s}}function Qy(n,t){let e;switch(n){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?e:`${e}x${t}`}const Gy={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},tv={f32:4,f16:2,i32:4,u32:4};function ff(n){let t;n.endsWith("-webgl")&&(n.replace("-webgl",""),t=!0);const[e,i]=n.split("x"),s=e,r=i?parseInt(i):1,a=af(s),l={type:s,components:r,byteLength:a.byteLength*r,integer:a.integer,signed:a.signed,normalized:a.normalized};return t&&(l.webglOnly=!0),l}function df(n,t){const e={};for(const i of n.attributes){const s=nv(n,t,i.name);s&&(e[i.name]=s)}return e}function ev(n,t,e=16){const i=df(n,t),s=new Array(e).fill(null);for(const r of Object.values(i))s[r.location]=r;return s}function nv(n,t,e){const i=iv(n,e),s=sv(t,e);if(!i)return null;const r=Jy(i.type),a=(s==null?void 0:s.vertexFormat)||r.defaultVertexFormat,l=ff(a);return{attributeName:(s==null?void 0:s.attributeName)||i.name,bufferName:(s==null?void 0:s.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:r.dataType,shaderComponents:r.components,vertexFormat:a,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:r.integer,stepMode:(s==null?void 0:s.stepMode)||i.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function iv(n,t){const e=n.attributes.find(i=>i.name===t);return e||z.warn(`shader layout attribute "${t}" not present in shader`),e||null}function sv(n,t){rv(n);let e=ov(n,t);return e||(e=av(n,t),e)?e:(z.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function rv(n){for(const t of n)(t.attributes&&t.format||!t.attributes&&!t.format)&&z.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function ov(n,t){for(const e of n)if(e.format&&e.name===t)return{attributeName:e.name,bufferName:t,stepMode:e.stepMode,vertexFormat:e.format,byteOffset:0,byteStride:e.byteStride||0};return null}function av(n,t){var e;for(const i of n){let s=i.byteStride;if(typeof i.byteStride!="number")for(const a of i.attributes||[]){const l=ff(a.format);s+=l.byteLength}const r=(e=i.attributes)==null?void 0:e.find(a=>a.attribute===t);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:s}}return null}const yr=class yr extends gt{constructor(e,i){super(e,i,yr.defaultProps);v(this,"maxVertexAttributes");v(this,"attributeInfos");v(this,"indexBuffer",null);v(this,"attributes");this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:r}=i.renderPipeline||{};if(!s||!r)throw new Error("VertexArray");this.attributeInfos=ev(s,r,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(e,i){this.device.reportError(new Error("constant attributes not supported"))}};v(yr,"defaultProps",{...gt.defaultProps,renderPipeline:null});let ca=yr;const vr=class vr extends gt{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,vr.defaultProps)}};v(vr,"defaultProps",{...gt.defaultProps,layout:void 0,buffers:{}});let la=vr;const br=class br extends gt{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,br.defaultProps)}};v(br,"defaultProps",{...gt.defaultProps,type:void 0,count:void 0});let ha=br;const cv={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function lv(n){return cv[n]}function hv(n,t){switch(t){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let vs;function pf(n){return(!vs||vs.byteLength<n)&&(vs=new ArrayBuffer(n)),vs}function uv(n,t){const e=pf(n.BYTES_PER_ELEMENT*t);return new n(e,0,t)}function fv(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Zs(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":fv(n)}const oh=1024;class dv{constructor(t){v(this,"layout",{});v(this,"byteLength");let e=0;for(const[s,r]of Object.entries(t)){const a=lv(r),{type:l,components:h}=a;e=hv(e,h);const f=e;e+=h,this.layout[s]={type:l,size:h,offset:f}}e+=(4-e%4)%4;const i=e*4;this.byteLength=Math.max(i,oh)}getData(t){const e=Math.max(this.byteLength,oh),i=pf(e),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[r,a]of Object.entries(t)){const l=this.layout[r];if(!l){z.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:h,size:f,offset:d}=l,_=s[h];if(f===1){if(typeof a!="number"&&typeof a!="boolean"){z.warn(`Supplied value for single component uniform ${r} is not a number: ${a}`)();continue}_[d]=Number(a)}else{if(!Zs(a)){z.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${a}`)();continue}_.set(a,d)}}return new Uint8Array(i)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function pv(n,t,e=16){if(n!==t)return!1;const i=n,s=t;if(!Zs(i))return!1;if(Zs(s)&&i.length===s.length){for(let r=0;r<i.length;++r)if(s[r]!==i[r])return!1}return!0}function _v(n){return Zs(n)?n.slice():n}class gv{constructor(t){v(this,"name");v(this,"uniforms",{});v(this,"modifiedUniforms",{});v(this,"modified",!0);v(this,"bindingLayout",{});v(this,"needsRedraw","initialized");var e;if(this.name=(t==null?void 0:t.name)||"unnamed",t!=null&&t.name&&(t!=null&&t.shaderLayout)){const i=(e=t==null?void 0:t.shaderLayout.bindings)==null?void 0:e.find(r=>r.type==="uniform"&&r.name===(t==null?void 0:t.name));if(!i)throw new Error(t==null?void 0:t.name);const s=i;for(const r of s.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(t){for(const[e,i]of Object.entries(t))this._setUniform(e,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${i}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){pv(this.uniforms[t],e)||(this.uniforms[t]=_v(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class mv{constructor(t){v(this,"uniformBlocks",new Map);v(this,"uniformBufferLayouts",new Map);v(this,"uniformBuffers",new Map);for(const[e,i]of Object.entries(t)){const s=e,r=new dv(i.uniformTypes||{});this.uniformBufferLayouts.set(s,r);const a=new gv({name:e});a.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,a)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){var e;for(const[i,s]of Object.entries(t))(e=this.uniformBlocks.get(i))==null||e.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(t){var e;return((e=this.uniformBufferLayouts.get(t))==null?void 0:e.byteLength)||0}getUniformBufferData(t){var i,s;const e=((i=this.uniformBlocks.get(t))==null?void 0:i.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(t))==null?void 0:s.getData(e)}createUniformBuffer(t,e,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(e),r=t.createBuffer({usage:bt.UNIFORM|bt.COPY_DST,byteLength:s}),a=this.getUniformBufferData(e);return r.write(a),r}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const i=this.getUniformBufferByteLength(e),s=t.createBuffer({usage:bt.UNIFORM|bt.COPY_DST,byteLength:i});this.uniformBuffers.set(e,s)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(e);t||(t=i)}return t&&z.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){var r;const e=this.uniformBlocks.get(t);let i=this.uniformBuffers.get(t),s=!1;if(i&&(e!=null&&e.needsRedraw)){s||(s=e.needsRedraw);const a=this.getUniformBufferData(t);i=this.uniformBuffers.get(t),i==null||i.write(a);const l=(r=this.uniformBlocks.get(t))==null?void 0:r.getAllUniforms();z.log(4,`Writing to uniform buffer ${String(t)}`,a,l)()}return s}}function _f(n){const t=ArrayBuffer.isView(n)?n.constructor:n;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function gf(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function yv(n,t,e){if(!t||t>4)throw new Error(`size ${t}`);const i=t;let s=_f(n);if(s==="uint8"&&e&&i===1)return"unorm8-webgl";if(s==="uint8"&&e&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${t}`);return e&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${t}`);return e&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class Eo{constructor(t){v(this,"bufferLayouts");this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(e=>e.name===t)||null}getAttributeNamesForBuffer(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}mergeBufferLayouts(t,e){const i=[...t];for(const s of e){const r=i.findIndex(a=>a.name===s.name);r<0?i.push(s):i[r]=s}return i}}class oe{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class ah{constructor(t,e,i){this.name=t,this.type=e,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ke extends oe{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class tn extends oe{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class yn extends oe{constructor(t,e,i,s){super(t,i),this.format=e,this.access=s}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var Ze;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ze||(Ze={}));class bs{constructor(t,e,i,s,r,a,l){this.name=t,this.type=e,this.group=i,this.binding=s,this.attributes=r,this.resourceType=a,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class vv{constructor(t,e){this.name=t,this.type=e}}class bv{constructor(t,e,i,s){this.name=t,this.type=e,this.locationType=i,this.location=s,this.interpolation=null}}class ch{constructor(t,e,i,s){this.name=t,this.type=e,this.locationType=i,this.location=s}}class wv{constructor(t,e,i,s){this.name=t,this.type=e,this.attributes=i,this.id=s}}class Tv{constructor(t,e,i){this.name=t,this.type=e,this.attributes=i}}class xv{constructor(t,e=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e,this.attributes=i}}class Av{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const mf=new Float32Array(1),Sv=new Int32Array(mf.buffer),Ht=new Uint16Array(1);function Ev(n){mf[0]=n;const t=Sv[0],e=t>>31&1;let i=t>>23&255,s=8388607&t;if(i===255)return Ht[0]=e<<15|31744|(s!==0?512:0),Ht[0];if(i===0){if(s===0)return Ht[0]=e<<15,Ht[0];s|=8388608;let r=113;for(;!(8388608&s);)s<<=1,r--;return i=127-r,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Ht[0]=e<<15|i<<10|s>>13,Ht[0]):(Ht[0]=e<<15,Ht[0])}return i=i-127+15,i>=31?(Ht[0]=e<<15|31744,Ht[0]):i<=0?i<-10?(Ht[0]=e<<15,Ht[0]):(s=(8388608|s)>>1-i,Ht[0]=e<<15|s>>13,Ht[0]):(s>>=13,Ht[0]=e<<15|i<<10|s,Ht[0])}const Ya=new Uint32Array(1),yf=new Float32Array(Ya.buffer,0,1);function lh(n){const t=112+(n>>6&31)<<23|(63&n)<<17;return Ya[0]=t,yf[0]}function Rv(n,t,e,i,s,r,a,l,h){const f=i*(a>>=s)*(r>>=s)+e*a+t*l;switch(h){case"r8unorm":return[ut(n,f,"8unorm",1)[0]];case"r8snorm":return[ut(n,f,"8snorm",1)[0]];case"r8uint":return[ut(n,f,"8uint",1)[0]];case"r8sint":return[ut(n,f,"8sint",1)[0]];case"rg8unorm":{const d=ut(n,f,"8unorm",2);return[d[0],d[1]]}case"rg8snorm":{const d=ut(n,f,"8snorm",2);return[d[0],d[1]]}case"rg8uint":{const d=ut(n,f,"8uint",2);return[d[0],d[1]]}case"rg8sint":{const d=ut(n,f,"8sint",2);return[d[0],d[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const d=ut(n,f,"8unorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8snorm":{const d=ut(n,f,"8snorm",4);return[d[0],d[1],d[2],d[3]]}case"rgba8uint":{const d=ut(n,f,"8uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba8sint":{const d=ut(n,f,"8sint",4);return[d[0],d[1],d[2],d[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const d=ut(n,f,"8unorm",4);return[d[2],d[1],d[0],d[3]]}case"r16uint":return[ut(n,f,"16uint",1)[0]];case"r16sint":return[ut(n,f,"16sint",1)[0]];case"r16float":return[ut(n,f,"16float",1)[0]];case"rg16uint":{const d=ut(n,f,"16uint",2);return[d[0],d[1]]}case"rg16sint":{const d=ut(n,f,"16sint",2);return[d[0],d[1]]}case"rg16float":{const d=ut(n,f,"16float",2);return[d[0],d[1]]}case"rgba16uint":{const d=ut(n,f,"16uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16sint":{const d=ut(n,f,"16sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba16float":{const d=ut(n,f,"16float",4);return[d[0],d[1],d[2],d[3]]}case"r32uint":return[ut(n,f,"32uint",1)[0]];case"r32sint":return[ut(n,f,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ut(n,f,"32float",1)[0]];case"rg32uint":{const d=ut(n,f,"32uint",2);return[d[0],d[1]]}case"rg32sint":{const d=ut(n,f,"32sint",2);return[d[0],d[1]]}case"rg32float":{const d=ut(n,f,"32float",2);return[d[0],d[1]]}case"rgba32uint":{const d=ut(n,f,"32uint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32sint":{const d=ut(n,f,"32sint",4);return[d[0],d[1],d[2],d[3]]}case"rgba32float":{const d=ut(n,f,"32float",4);return[d[0],d[1],d[2],d[3]]}case"rg11b10ufloat":{const d=new Uint32Array(n.buffer,f,1)[0],_=(4192256&d)>>11,m=(4290772992&d)>>22;return[lh(2047&d),lh(_),function(w){const A=112+(w>>5&31)<<23|(31&w)<<18;return Ya[0]=A,yf[0]}(m),1]}}return null}function ut(n,t,e,i){const s=[0,0,0,0];for(let f=0;f<i;++f)switch(e){case"8unorm":s[f]=n[t]/255,t++;break;case"8snorm":s[f]=n[t]/255*2-1,t++;break;case"8uint":s[f]=n[t],t++;break;case"8sint":s[f]=n[t]-127,t++;break;case"16uint":s[f]=n[t]|n[t+1]<<8,t+=2;break;case"16sint":s[f]=(n[t]|n[t+1]<<8)-32768,t+=2;break;case"16float":s[f]=(r=n[t]|n[t+1]<<8,a=void 0,l=void 0,h=void 0,a=(32768&r)>>15,h=1023&r,(l=(31744&r)>>10)==0?(a?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):l==31?h?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,l-15)*(1+h/Math.pow(2,10))),t+=2;break;case"32uint":case"32sint":s[f]=n[t]|n[t+1]<<8|n[t+2]<<16|n[t+3]<<24,t+=4;break;case"32float":s[f]=new Float32Array(n.buffer,t,1)[0],t+=4}var r,a,l,h;return s}function dt(n,t,e,i,s){for(let r=0;r<i;++r)switch(e){case"8unorm":n[t]=255*s[r],t++;break;case"8snorm":n[t]=.5*(s[r]+1)*255,t++;break;case"8uint":n[t]=s[r],t++;break;case"8sint":n[t]=s[r]+127,t++;break;case"16uint":new Uint16Array(n.buffer,t,1)[0]=s[r],t+=2;break;case"16sint":new Int16Array(n.buffer,t,1)[0]=s[r],t+=2;break;case"16float":{const a=Ev(s[r]);new Uint16Array(n.buffer,t,1)[0]=a,t+=2;break}case"32uint":new Uint32Array(n.buffer,t,1)[0]=s[r],t+=4;break;case"32sint":new Int32Array(n.buffer,t,1)[0]=s[r],t+=4;break;case"32float":new Float32Array(n.buffer,t,1)[0]=s[r],t+=4}return s}const Ro={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class he{constructor(){this.id=he._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,e){if(t){e(Ys.instance);for(const i of t)i instanceof Array?this.searchBlock(i,e):i.search(e);e(qs.instance)}}constEvaluate(t,e){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}}he._id=0;class Ys extends he{}Ys.instance=new Ys;class qs extends he{}qs.instance=new qs;const vf=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class wt extends he{constructor(){super()}}let Li=class extends wt{constructor(t,e,i,s,r,a){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=i,this.body=s,this.startLine=r,this.endLine=a}get astNodeType(){return"function"}search(t){if(this.attributes)for(const e of this.attributes)t(e);t(this);for(const e of this.args)t(e);this.searchBlock(this.body,t)}};class Pv extends wt{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class bf extends wt{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class ua extends wt{constructor(t,e){super(),this.body=t,this.loopId=e}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class wf extends wt{constructor(t,e,i,s){super(),this.init=t,this.condition=e,this.increment=i,this.body=s}get astNodeType(){return"for"}search(t){var e,i,s;(e=this.init)===null||e===void 0||e.search(t),(i=this.condition)===null||i===void 0||i.search(t),(s=this.increment)===null||s===void 0||s.search(t),this.searchBlock(this.body,t)}}class Le extends wt{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class qa extends wt{constructor(t,e,i){super(),this.attributes=null,this.name=t,this.type=e,this.value=i}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Mi extends wt{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Cs extends wt{constructor(t,e,i,s,r){super(),this.attributes=null,this.name=t,this.type=e,this.storage=i,this.access=s,this.value=r}get astNodeType(){return"const"}constEvaluate(t,e){return this.value.constEvaluate(t,e)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var zn,Ai,C,R;(n=>{n.increment="++",n.decrement="--"})(zn||(zn={})),(n=>{n.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for IncrementOperator");return n[e]}})(zn||(zn={}));class Tf extends wt{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Ai||(Ai={})),(n=>{n.parse=function(t){const e=t;if(e=="parse")throw new Error("Invalid value for AssignOperator");return e}})(Ai||(Ai={}));class xf extends wt{constructor(t,e,i){super(),this.operator=t,this.variable=e,this.value=i}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class Ka extends wt{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}isBuiltin(){return vf.has(this.name)}search(t){for(const e of this.args)e.search(t);t(this)}}class Af extends wt{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class Sf extends wt{constructor(t,e){super(),this.condition=t,this.cases=e}get astNodeType(){return"switch"}}class Ef extends wt{constructor(t,e,i,s){super(),this.condition=t,this.body=e,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class Rf extends wt{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Iv extends wt{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class Cv extends wt{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class Pf extends wt{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class Ja extends wt{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Mv extends wt{constructor(){super()}get astNodeType(){return"discard"}}class If extends wt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Cf extends wt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class U extends wt{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let e=t[0];if(e.name==="f32")return e;for(let i=1;i<t.length;++i){const s=U._priority.get(e.name);U._priority.get(t[i].name)<s&&(e=t[i])}return e.name==="x32"?U.i32:e}getTypeName(){return this.name}}U.x32=new U("x32"),U.f32=new U("f32"),U.i32=new U("i32"),U.u32=new U("u32"),U.f16=new U("f16"),U.bool=new U("bool"),U.void=new U("void"),U._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class hh extends U{constructor(t){super(t)}}class Be extends U{constructor(t,e,i,s){super(t),this.members=e,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}search(t){for(const e of this.members)t(e)}}class I extends U{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}I.vec2f=new I("vec2",U.f32,null),I.vec3f=new I("vec3",U.f32,null),I.vec4f=new I("vec4",U.f32,null),I.vec2i=new I("vec2",U.i32,null),I.vec3i=new I("vec3",U.i32,null),I.vec4i=new I("vec4",U.i32,null),I.vec2u=new I("vec2",U.u32,null),I.vec3u=new I("vec3",U.u32,null),I.vec4u=new I("vec4",U.u32,null),I.vec2h=new I("vec2",U.f16,null),I.vec3h=new I("vec3",U.f16,null),I.vec4h=new I("vec4",U.f16,null),I.vec2b=new I("vec2",U.bool,null),I.vec3b=new I("vec3",U.bool,null),I.vec4b=new I("vec4",U.bool,null),I.mat2x2f=new I("mat2x2",U.f32,null),I.mat2x3f=new I("mat2x3",U.f32,null),I.mat2x4f=new I("mat2x4",U.f32,null),I.mat3x2f=new I("mat3x2",U.f32,null),I.mat3x3f=new I("mat3x3",U.f32,null),I.mat3x4f=new I("mat3x4",U.f32,null),I.mat4x2f=new I("mat4x2",U.f32,null),I.mat4x3f=new I("mat4x3",U.f32,null),I.mat4x4f=new I("mat4x4",U.f32,null),I.mat2x2h=new I("mat2x2",U.f16,null),I.mat2x3h=new I("mat2x3",U.f16,null),I.mat2x4h=new I("mat2x4",U.f16,null),I.mat3x2h=new I("mat3x2",U.f16,null),I.mat3x3h=new I("mat3x3",U.f16,null),I.mat3x4h=new I("mat3x4",U.f16,null),I.mat4x2h=new I("mat4x2",U.f16,null),I.mat4x3h=new I("mat4x3",U.f16,null),I.mat4x4h=new I("mat4x4",U.f16,null),I.mat2x2i=new I("mat2x2",U.i32,null),I.mat2x3i=new I("mat2x3",U.i32,null),I.mat2x4i=new I("mat2x4",U.i32,null),I.mat3x2i=new I("mat3x2",U.i32,null),I.mat3x3i=new I("mat3x3",U.i32,null),I.mat3x4i=new I("mat3x4",U.i32,null),I.mat4x2i=new I("mat4x2",U.i32,null),I.mat4x3i=new I("mat4x3",U.i32,null),I.mat4x4i=new I("mat4x4",U.i32,null),I.mat2x2u=new I("mat2x2",U.u32,null),I.mat2x3u=new I("mat2x3",U.u32,null),I.mat2x4u=new I("mat2x4",U.u32,null),I.mat3x2u=new I("mat3x2",U.u32,null),I.mat3x3u=new I("mat3x3",U.u32,null),I.mat3x4u=new I("mat3x4",U.u32,null),I.mat4x2u=new I("mat4x2",U.u32,null),I.mat4x3u=new I("mat4x3",U.u32,null),I.mat4x4u=new I("mat4x4",U.u32,null);class Po extends U{constructor(t,e,i,s){super(t),this.storage=e,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Oi extends U{constructor(t,e,i,s){super(t),this.attributes=e,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Si extends U{constructor(t,e,i){super(t),this.format=e,this.access=i}get astNodeType(){return"sampler"}}class Ce extends he{constructor(){super(),this.postfix=null}}class vn extends Ce{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Se extends Ce{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}constEvaluate(t,e){return e&&(e[0]=this.type),t.evalExpression(this,t.context)}}class Qa extends Ce{constructor(t,e){super(),this.cachedReturnValue=null,this.name=t,this.args=e}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return vf.has(this.name)}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){for(const e of this.args)e.search(t);t(this)}}class ee extends Ce{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,e){return t.evalExpression(this,t.context)}}class Mf extends Ce{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}constEvaluate(t,e){if(this.initializer){const i=t.evalExpression(this.initializer,t.context);return i!==null&&this.postfix?i.getSubData(t,this.postfix,t.context):i}return null}search(t){this.initializer.search(t)}}class Nt extends Ce{constructor(t,e){super(),this.value=t,this.type=e}get astNodeType(){return"literalExpr"}constEvaluate(t,e){return e!==void 0&&(e[0]=this.type),this.value}get isScalar(){return this.value instanceof E}get isVector(){return this.value instanceof T||this.value instanceof q}get scalarValue(){return this.value instanceof E?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof T||this.value instanceof q?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Of extends Ce{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Kn extends Ce{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class kf extends Ce{constructor(){super()}}class Ot extends kf{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class pe extends kf{constructor(t,e,i){super(),this.operator=t,this.left=e,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(t,e){return t.name===e.name?t:t.name==="f32"||e.name==="f32"?U.f32:t.name==="u32"||e.name==="u32"?U.u32:U.i32}constEvaluate(t,e){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class Nf extends he{constructor(t){super(),this.body=t}}class Ms extends Ce{constructor(){super()}get astNodeType(){return"default"}}class Df extends Nf{constructor(t,e){super(e),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class Bf extends Nf{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class uh extends he{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"argument"}}class Ov extends he{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class fh extends he{constructor(t,e,i){super(),this.name=t,this.type=e,this.attributes=i}get astNodeType(){return"member"}}class Ff extends he{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}class le{constructor(t,e){this.parent=null,this.typeInfo=t,this.parent=e,this.id=le._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,e,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,e,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}le._id=0;class fa extends le{constructor(){super(new oe("void",null),null)}toString(){return"void"}}fa.void=new fa;class Fn extends le{constructor(t){super(new oe("pointer",null),null),this.reference=t}clone(){return this}setDataValue(t,e,i,s){this.reference.setDataValue(t,e,i,s)}getSubData(t,e,i){return e?this.reference.getSubData(t,e,i):this}}class E extends le{constructor(t,e,i=null){super(e,i),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!=0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",e)}clone(){if(this.data instanceof Float32Array)return new E(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new E(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new E(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,e,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(e instanceof E))return void console.error("SetDataValue: Invalid value",e);let r=e.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?r=Math.floor(r):this.typeInfo.name==="bool"&&(r=r?1:0),this.data[0]=r}getSubData(t,e,i){return e?(console.error("getSubData: Scalar data does not support postfix",e),null):this}toString(){return`${this.value}`}}function kv(n,t,e){const i=t.length;return i===2?e==="f32"?new T(new Float32Array(t),n.getTypeInfo("vec2f")):e==="i32"||e==="bool"?new T(new Int32Array(t),n.getTypeInfo("vec2i")):e==="u32"?new T(new Uint32Array(t),n.getTypeInfo("vec2u")):e==="f16"?new T(new Float32Array(t),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${e}`),null):i===3?e==="f32"?new T(new Float32Array(t),n.getTypeInfo("vec3f")):e==="i32"||e==="bool"?new T(new Int32Array(t),n.getTypeInfo("vec3i")):e==="u32"?new T(new Uint32Array(t),n.getTypeInfo("vec3u")):e==="f16"?new T(new Float32Array(t),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${e}`),null):i===4?e==="f32"?new T(new Float32Array(t),n.getTypeInfo("vec4f")):e==="i32"||e==="bool"?new T(new Int32Array(t),n.getTypeInfo("vec4i")):e==="u32"?new T(new Uint32Array(t),n.getTypeInfo("vec4u")):e==="f16"?new T(new Float32Array(t),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${e}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class T extends le{constructor(t,e,i=null){if(super(e,i),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(t):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(t):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(t):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(t):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(t):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new T(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new T(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new T(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,e,i,s){i instanceof vn?console.error("TODO: Set vector postfix"):e instanceof T?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,i){if(e===null)return this;let s=t.getTypeInfo("f32");if(this.typeInfo instanceof yn)s=this.typeInfo.format||s;else{const a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?s=t.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?s=t.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?s=t.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?s=t.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?s=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let r=this;for(;e!==null&&r!==null;){if(e instanceof Kn){const a=e.index;let l=-1;if(a instanceof Nt){if(!(a.value instanceof E))return console.error(`GetSubData: Invalid array index ${a.value}`),null;l=a.value.value}else{const h=t.evalExpression(a,i);if(!(h instanceof E))return console.error("GetSubData: Unknown index type",a),null;l=h.value}if(l<0||l>=r.data.length)return console.error("GetSubData: Index out of range",l),null;if(r.data instanceof Float32Array){const h=new Float32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new E(h,s)}if(r.data instanceof Int32Array){const h=new Int32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new E(h,s)}if(r.data instanceof Uint32Array){const h=new Uint32Array(r.data.buffer,r.data.byteOffset+4*l,1);return new E(h,s)}throw"GetSubData: Invalid data type"}if(!(e instanceof vn))return console.error("GetSubData: Unknown postfix",e),null;{const a=e.value.toLowerCase();if(a.length===1){let h=0;if(a==="x"||a==="r")h=0;else if(a==="y"||a==="g")h=1;else if(a==="z"||a==="b")h=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;h=3}if(this.data instanceof Float32Array){let f=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new E(f,s,this)}if(this.data instanceof Int32Array){let f=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new E(f,s,this)}if(this.data instanceof Uint32Array){let f=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new E(f,s,this)}}const l=[];for(const h of a)h==="x"||h==="r"?l.push(this.data[0]):h==="y"||h==="g"?l.push(this.data[1]):h==="z"||h==="b"?l.push(this.data[2]):h==="w"||h==="a"?l.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);r=kv(t,l,s.name)}e=e.postfix}return r}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class q extends le{constructor(t,e,i=null){super(e,i),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new q(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,e,i,s){i instanceof vn?console.error("TODO: Set matrix postfix"):e instanceof q?this.data=e.data:console.error("SetDataValue: Invalid value",e)}getSubData(t,e,i){if(e===null)return this;const s=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof yn)this.typeInfo.format;else if(s.endsWith("f"))t.getTypeInfo("f32");else if(s.endsWith("i"))t.getTypeInfo("i32");else if(s.endsWith("u"))t.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;t.getTypeInfo("f16")}if(e instanceof Kn){const r=e.index;let a=-1;if(r instanceof Nt){if(!(r.value instanceof E))return console.error(`GetDataValue: Invalid array index ${r.value}`),null;a=r.value.value}else{const f=t.evalExpression(r,i);if(!(f instanceof E))return console.error("GetDataValue: Unknown index type",r),null;a=f.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;const l=s.endsWith("h")?"h":"f";let h;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")h=new T(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),t.getTypeInfo(`vec2${l}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")h=new T(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),t.getTypeInfo(`vec3${l}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;h=new T(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),t.getTypeInfo(`vec4${l}`))}return e.postfix?h.getSubData(t,e.postfix,i):h}return console.error("GetDataValue: Invalid postfix",e),null}toString(){let t=`${this.data[0]}`;for(let e=1;e<this.data.length;++e)t+=`, ${this.data[e]}`;return t}}class Et extends le{constructor(t,e,i=0,s=null){super(e,s),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=i}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Et(t.buffer,this.typeInfo,0,null)}setDataValue(t,e,i,s){if(e===null)return void console.log("setDataValue: NULL data.");let r=this.offset,a=this.typeInfo;for(;i;){if(i instanceof Kn)if(a instanceof tn){const l=i.index;if(l instanceof Nt){if(!(l.value instanceof E))return void console.error(`SetDataValue: Invalid index type ${l.value}`);r+=l.value.value*a.stride}else{const h=t.evalExpression(l,s);if(!(h instanceof E))return void console.error("SetDataValue: Unknown index type",l);r+=h.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(i instanceof vn))return void console.error("SetDataValue: Unknown postfix type",i);{const l=i.value;if(a instanceof Ke){let h=!1;for(const f of a.members)if(f.name===l){r+=f.offset,a=f.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${l} not found`)}else if(a instanceof oe){const h=a.getTypeName();let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return void console.error(`SetDataValue: Unknown member ${l}`);f=3}if(!(e instanceof E))return void console.error("SetDataValue: Invalid value",e);const d=e.value;return h==="vec2f"?void(new Float32Array(this.buffer,r,2)[f]=d):h==="vec3f"?void(new Float32Array(this.buffer,r,3)[f]=d):h==="vec4f"?void(new Float32Array(this.buffer,r,4)[f]=d):h==="vec2i"?void(new Int32Array(this.buffer,r,2)[f]=d):h==="vec3i"?void(new Int32Array(this.buffer,r,3)[f]=d):h==="vec4i"?void(new Int32Array(this.buffer,r,4)[f]=d):h==="vec2u"?void(new Uint32Array(this.buffer,r,2)[f]=d):h==="vec3u"?void(new Uint32Array(this.buffer,r,3)[f]=d):h==="vec4u"?void(new Uint32Array(this.buffer,r,4)[f]=d):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(t,e,a,r,s)}setData(t,e,i,s,r){const a=i.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(e instanceof Et){if(i===e.typeInfo)return void new Uint8Array(this.buffer,s,e.buffer.byteLength).set(new Uint8Array(e.buffer));console.error("SetDataValue: Type mismatch",a,e.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`);else{const l=new Float32Array(this.buffer,s,16);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11],l[12]=e.data[12],l[13]=e.data[13],l[14]=e.data[14],l[15]=e.data[15]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11],l[12]=e[12],l[13]=e[13],l[14]=e[14],l[15]=e[15])}else{const l=new Float32Array(this.buffer,s,12);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11])}else{const l=new Float32Array(this.buffer,s,8);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7])}else{const l=new Float32Array(this.buffer,s,12);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8],l[9]=e.data[9],l[10]=e.data[10],l[11]=e.data[11]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8],l[9]=e[9],l[10]=e[10],l[11]=e[11])}else{const l=new Float32Array(this.buffer,s,9);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7],l[8]=e.data[8]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7],l[8]=e[8])}else{const l=new Float32Array(this.buffer,s,6);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5])}else{const l=new Float32Array(this.buffer,s,8);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5],l[6]=e.data[6],l[7]=e.data[7]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5],l[6]=e[6],l[7]=e[7])}else{const l=new Float32Array(this.buffer,s,6);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3],l[4]=e.data[4],l[5]=e.data[5]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3],l[4]=e[4],l[5]=e[5])}else{const l=new Float32Array(this.buffer,s,4);e instanceof q?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3])}else{const l=new Uint32Array(this.buffer,s,4);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3])}else{const l=new Uint32Array(this.buffer,s,3);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2])}else{const l=new Uint32Array(this.buffer,s,2);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1])}else{const l=new Uint32Array(this.buffer,s,4);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3])}else{const l=new Uint32Array(this.buffer,s,3);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2])}else{const l=new Uint32Array(this.buffer,s,2);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1])}else{const l=new Int32Array(this.buffer,s,4);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3])}else{const l=new Int32Array(this.buffer,s,3);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2])}else{const l=new Int32Array(this.buffer,s,2);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1])}else{const l=new Float32Array(this.buffer,s,4);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2],l[3]=e.data[3]):(l[0]=e[0],l[1]=e[1],l[2]=e[2],l[3]=e[3])}else{const l=new Float32Array(this.buffer,s,3);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1],l[2]=e.data[2]):(l[0]=e[0],l[1]=e[1],l[2]=e[2])}else{const l=new Float32Array(this.buffer,s,2);e instanceof T?(l[0]=e.data[0],l[1]=e.data[1]):(l[0]=e[0],l[1]=e[1])}else e instanceof E&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof E&&(new Uint32Array(this.buffer,s,1)[0]=e.value);else e instanceof E&&(new Int32Array(this.buffer,s,1)[0]=e.value);else e instanceof E&&(new Float32Array(this.buffer,s,1)[0]=e.value)}getSubData(t,e,i){var s,r,a;if(e===null)return this;let l=this.offset,h=this.typeInfo;for(;e;){if(e instanceof Kn){const d=e.index,_=t.evalExpression(d,i);let m=0;if(_ instanceof E?m=_.value:console.error("GetDataValue: Invalid index type",d),h instanceof tn)l+=m*h.stride,h=h.format;else{const w=h.getTypeName();w==="mat4x4"||w==="mat4x4f"||w==="mat4x4h"?(l+=16*m,h=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(e instanceof vn))return console.error("GetDataValue: Unknown postfix type",e),null;{const d=e.value;if(h instanceof Ke){let _=!1;for(const m of h.members)if(m.name===d){l+=m.offset,h=m.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${d} not found`),null}else if(h instanceof oe){const _=h.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(d.length>0&&d.length<5){let m="f";const w=[];for(let A=0;A<d.length;++A){const S=d[A].toLowerCase();let k=0;if(S==="x"||S==="r")k=0;else if(S==="y"||S==="g")k=1;else if(S==="z"||S==="b")k=2;else{if(S!=="w"&&S!=="a")return console.error(`Unknown member ${d}`),null;k=3}if(d.length===1){if(_.endsWith("f"))return this.buffer.byteLength<l+4*k+4?(console.log("Insufficient buffer data"),null):new E(new Float32Array(this.buffer,l+4*k,1),t.getTypeInfo("f32"),this);if(_.endsWith("h"))return new E(new Float32Array(this.buffer,l+4*k,1),t.getTypeInfo("f16"),this);if(_.endsWith("i"))return new E(new Int32Array(this.buffer,l+4*k,1),t.getTypeInfo("i32"),this);if(_.endsWith("b"))return new E(new Int32Array(this.buffer,l+4*k,1),t.getTypeInfo("bool"),this);if(_.endsWith("u"))return new E(new Uint32Array(this.buffer,l+4*k,1),t.getTypeInfo("i32"),this)}if(_==="vec2f")w.push(new Float32Array(this.buffer,l,2)[k]);else if(_==="vec3f"){if(l+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const B=new Float32Array(this.buffer,l,3);w.push(B[k])}else if(_==="vec4f")w.push(new Float32Array(this.buffer,l,4)[k]);else if(_==="vec2i")m="i",w.push(new Int32Array(this.buffer,l,2)[k]);else if(_==="vec3i")m="i",w.push(new Int32Array(this.buffer,l,3)[k]);else if(_==="vec4i")m="i",w.push(new Int32Array(this.buffer,l,4)[k]);else if(_==="vec2u"){m="u";const B=new Uint32Array(this.buffer,l,2);w.push(B[k])}else _==="vec3u"?(m="u",w.push(new Uint32Array(this.buffer,l,3)[k])):_==="vec4u"&&(m="u",w.push(new Uint32Array(this.buffer,l,4)[k]))}return w.length===2?h=t.getTypeInfo(`vec2${m}`):w.length===3?h=t.getTypeInfo(`vec3${m}`):w.length===4?h=t.getTypeInfo(`vec4${m}`):console.error(`GetDataValue: Invalid vector length ${w.length}`),new T(w,h,null)}return console.error(`GetDataValue: Unknown member ${d}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}e=e.postfix}const f=h.getTypeName();return f==="f32"?new E(new Float32Array(this.buffer,l,1),h,this):f==="i32"?new E(new Int32Array(this.buffer,l,1),h,this):f==="u32"?new E(new Uint32Array(this.buffer,l,1),h,this):f==="vec2f"?new T(new Float32Array(this.buffer,l,2),h,this):f==="vec3f"?new T(new Float32Array(this.buffer,l,3),h,this):f==="vec4f"?new T(new Float32Array(this.buffer,l,4),h,this):f==="vec2i"?new T(new Int32Array(this.buffer,l,2),h,this):f==="vec3i"?new T(new Int32Array(this.buffer,l,3),h,this):f==="vec4i"?new T(new Int32Array(this.buffer,l,4),h,this):f==="vec2u"?new T(new Uint32Array(this.buffer,l,2),h,this):f==="vec3u"?new T(new Uint32Array(this.buffer,l,3),h,this):f==="vec4u"?new T(new Uint32Array(this.buffer,l,4),h,this):h instanceof yn&&h.name==="atomic"?((s=h.format)===null||s===void 0?void 0:s.name)==="u32"?new E(new Uint32Array(this.buffer,l,1)[0],h.format,this):((r=h.format)===null||r===void 0?void 0:r.name)==="i32"?new E(new Int32Array(this.buffer,l,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=h.format)===null||a===void 0?void 0:a.name}`),null):new Et(this.buffer,h,l,this)}toString(){let t="";if(this.typeInfo instanceof tn)if(this.typeInfo.format.name==="f32"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="i32"){const e=new Int32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="u32"){const e=new Uint32Array(this.buffer,this.offset);t=`[${e[0]}`;for(let i=1;i<e.length;++i)t+=`, ${e[i]}`}else if(this.typeInfo.format.name==="vec2f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}]`;for(let i=1;i<e.length/2;++i)t+=`, [${e[2*i]}, ${e[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}]`;for(let i=4;i<e.length;i+=4)t+=`, [${e[i]}, ${e[i+1]}, ${e[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const e=new Float32Array(this.buffer,this.offset);t=`[${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}]`;for(let i=4;i<e.length;i+=4)t+=`, [${e[i]}, ${e[i+1]}, ${e[i+2]}, ${e[i+3]}]`}else t="[...]";else this.typeInfo instanceof Ke?t+="{...}":t="[...]";return t}}class Fe extends le{constructor(t,e,i,s){super(e,null),this.data=t,this.descriptor=i,this.view=s}clone(){return new Fe(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(t=i[0])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.width)!==null&&e!==void 0?e:0}get height(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(t=i[1])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.height)!==null&&e!==void 0?e:0}get depthOrArrayLayers(){var t,e;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(t=i[2])!==null&&t!==void 0?t:0:i instanceof Object&&(e=i.depthOrArrayLayers)!==null&&e!==void 0?e:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const e=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<e.length;++i)e[i]=Math.max(1,e[i]>>t);return e}get texelByteSize(){const t=this.format,e=Ro[t];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,e=Ro[t];return!!e&&e.isDepthStencil}getGpuSize(){const t=this.format,e=Ro[t],i=this.width;if(!t||i<=0||!e)return-1;const s=this.height,r=this.depthOrArrayLayers,a=this.dimension;return i/e.blockWidth*(a==="1d"?1:s/e.blockHeight)*e.bytesPerBlock*r}getPixel(t,e,i=0,s=0){const r=this.texelByteSize,a=this.bytesPerRow,l=this.height,h=this.data[s];return Rv(new Uint8Array(h),t,e,i,s,l,a,r,this.format)}setPixel(t,e,i,s,r){const a=this.texelByteSize,l=this.bytesPerRow,h=this.height,f=this.data[s];(function(d,_,m,w,A,S,k,B,F,M){const D=w*(k>>=A)*(S>>=A)+m*k+_*B;switch(F){case"r8unorm":return void dt(d,D,"8unorm",1,M);case"r8snorm":return void dt(d,D,"8snorm",1,M);case"r8uint":return void dt(d,D,"8uint",1,M);case"r8sint":return void dt(d,D,"8sint",1,M);case"rg8unorm":return void dt(d,D,"8unorm",2,M);case"rg8snorm":return void dt(d,D,"8snorm",2,M);case"rg8uint":return void dt(d,D,"8uint",2,M);case"rg8sint":return void dt(d,D,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void dt(d,D,"8unorm",4,M);case"rgba8snorm":return void dt(d,D,"8snorm",4,M);case"rgba8uint":return void dt(d,D,"8uint",4,M);case"rgba8sint":return void dt(d,D,"8sint",4,M);case"r16uint":return void dt(d,D,"16uint",1,M);case"r16sint":return void dt(d,D,"16sint",1,M);case"r16float":return void dt(d,D,"16float",1,M);case"rg16uint":return void dt(d,D,"16uint",2,M);case"rg16sint":return void dt(d,D,"16sint",2,M);case"rg16float":return void dt(d,D,"16float",2,M);case"rgba16uint":return void dt(d,D,"16uint",4,M);case"rgba16sint":return void dt(d,D,"16sint",4,M);case"rgba16float":return void dt(d,D,"16float",4,M);case"r32uint":return void dt(d,D,"32uint",1,M);case"r32sint":return void dt(d,D,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void dt(d,D,"32float",1,M);case"rg32uint":return void dt(d,D,"32uint",2,M);case"rg32sint":return void dt(d,D,"32sint",2,M);case"rg32float":return void dt(d,D,"32float",2,M);case"rgba32uint":return void dt(d,D,"32uint",4,M);case"rgba32sint":return void dt(d,D,"32sint",4,M);case"rgba32float":return void dt(d,D,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(f),t,e,i,s,h,l,a,this.format,r)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(R||(R={}));class P{constructor(t,e,i){this.name=t,this.type=e,this.rule=i}toString(){return this.name}}class b{}C=b,b.none=new P("",R.reserved,""),b.eof=new P("EOF",R.token,""),b.reserved={asm:new P("asm",R.reserved,"asm"),bf16:new P("bf16",R.reserved,"bf16"),do:new P("do",R.reserved,"do"),enum:new P("enum",R.reserved,"enum"),f16:new P("f16",R.reserved,"f16"),f64:new P("f64",R.reserved,"f64"),handle:new P("handle",R.reserved,"handle"),i8:new P("i8",R.reserved,"i8"),i16:new P("i16",R.reserved,"i16"),i64:new P("i64",R.reserved,"i64"),mat:new P("mat",R.reserved,"mat"),premerge:new P("premerge",R.reserved,"premerge"),regardless:new P("regardless",R.reserved,"regardless"),typedef:new P("typedef",R.reserved,"typedef"),u8:new P("u8",R.reserved,"u8"),u16:new P("u16",R.reserved,"u16"),u64:new P("u64",R.reserved,"u64"),unless:new P("unless",R.reserved,"unless"),using:new P("using",R.reserved,"using"),vec:new P("vec",R.reserved,"vec"),void:new P("void",R.reserved,"void")},b.keywords={array:new P("array",R.keyword,"array"),atomic:new P("atomic",R.keyword,"atomic"),bool:new P("bool",R.keyword,"bool"),f32:new P("f32",R.keyword,"f32"),i32:new P("i32",R.keyword,"i32"),mat2x2:new P("mat2x2",R.keyword,"mat2x2"),mat2x3:new P("mat2x3",R.keyword,"mat2x3"),mat2x4:new P("mat2x4",R.keyword,"mat2x4"),mat3x2:new P("mat3x2",R.keyword,"mat3x2"),mat3x3:new P("mat3x3",R.keyword,"mat3x3"),mat3x4:new P("mat3x4",R.keyword,"mat3x4"),mat4x2:new P("mat4x2",R.keyword,"mat4x2"),mat4x3:new P("mat4x3",R.keyword,"mat4x3"),mat4x4:new P("mat4x4",R.keyword,"mat4x4"),ptr:new P("ptr",R.keyword,"ptr"),sampler:new P("sampler",R.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",R.keyword,"sampler_comparison"),struct:new P("struct",R.keyword,"struct"),texture_1d:new P("texture_1d",R.keyword,"texture_1d"),texture_2d:new P("texture_2d",R.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",R.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",R.keyword,"texture_3d"),texture_cube:new P("texture_cube",R.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",R.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",R.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",R.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",R.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",R.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",R.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",R.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",R.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",R.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",R.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",R.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",R.keyword,"texture_external"),u32:new P("u32",R.keyword,"u32"),vec2:new P("vec2",R.keyword,"vec2"),vec3:new P("vec3",R.keyword,"vec3"),vec4:new P("vec4",R.keyword,"vec4"),bitcast:new P("bitcast",R.keyword,"bitcast"),block:new P("block",R.keyword,"block"),break:new P("break",R.keyword,"break"),case:new P("case",R.keyword,"case"),continue:new P("continue",R.keyword,"continue"),continuing:new P("continuing",R.keyword,"continuing"),default:new P("default",R.keyword,"default"),diagnostic:new P("diagnostic",R.keyword,"diagnostic"),discard:new P("discard",R.keyword,"discard"),else:new P("else",R.keyword,"else"),enable:new P("enable",R.keyword,"enable"),fallthrough:new P("fallthrough",R.keyword,"fallthrough"),false:new P("false",R.keyword,"false"),fn:new P("fn",R.keyword,"fn"),for:new P("for",R.keyword,"for"),function:new P("function",R.keyword,"function"),if:new P("if",R.keyword,"if"),let:new P("let",R.keyword,"let"),const:new P("const",R.keyword,"const"),loop:new P("loop",R.keyword,"loop"),while:new P("while",R.keyword,"while"),private:new P("private",R.keyword,"private"),read:new P("read",R.keyword,"read"),read_write:new P("read_write",R.keyword,"read_write"),return:new P("return",R.keyword,"return"),requires:new P("requires",R.keyword,"requires"),storage:new P("storage",R.keyword,"storage"),switch:new P("switch",R.keyword,"switch"),true:new P("true",R.keyword,"true"),alias:new P("alias",R.keyword,"alias"),type:new P("type",R.keyword,"type"),uniform:new P("uniform",R.keyword,"uniform"),var:new P("var",R.keyword,"var"),override:new P("override",R.keyword,"override"),workgroup:new P("workgroup",R.keyword,"workgroup"),write:new P("write",R.keyword,"write"),r8unorm:new P("r8unorm",R.keyword,"r8unorm"),r8snorm:new P("r8snorm",R.keyword,"r8snorm"),r8uint:new P("r8uint",R.keyword,"r8uint"),r8sint:new P("r8sint",R.keyword,"r8sint"),r16uint:new P("r16uint",R.keyword,"r16uint"),r16sint:new P("r16sint",R.keyword,"r16sint"),r16float:new P("r16float",R.keyword,"r16float"),rg8unorm:new P("rg8unorm",R.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",R.keyword,"rg8snorm"),rg8uint:new P("rg8uint",R.keyword,"rg8uint"),rg8sint:new P("rg8sint",R.keyword,"rg8sint"),r32uint:new P("r32uint",R.keyword,"r32uint"),r32sint:new P("r32sint",R.keyword,"r32sint"),r32float:new P("r32float",R.keyword,"r32float"),rg16uint:new P("rg16uint",R.keyword,"rg16uint"),rg16sint:new P("rg16sint",R.keyword,"rg16sint"),rg16float:new P("rg16float",R.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",R.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",R.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",R.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",R.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",R.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",R.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",R.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",R.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",R.keyword,"rg11b10float"),rg32uint:new P("rg32uint",R.keyword,"rg32uint"),rg32sint:new P("rg32sint",R.keyword,"rg32sint"),rg32float:new P("rg32float",R.keyword,"rg32float"),rgba16uint:new P("rgba16uint",R.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",R.keyword,"rgba16sint"),rgba16float:new P("rgba16float",R.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",R.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",R.keyword,"rgba32sint"),rgba32float:new P("rgba32float",R.keyword,"rgba32float"),static_assert:new P("static_assert",R.keyword,"static_assert")},b.tokens={decimal_float_literal:new P("decimal_float_literal",R.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new P("hex_float_literal",R.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new P("int_literal",R.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",R.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new P("name",R.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new P("ident",R.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",R.token,"&"),and_and:new P("and_and",R.token,"&&"),arrow:new P("arrow ",R.token,"->"),attr:new P("attr",R.token,"@"),forward_slash:new P("forward_slash",R.token,"/"),bang:new P("bang",R.token,"!"),bracket_left:new P("bracket_left",R.token,"["),bracket_right:new P("bracket_right",R.token,"]"),brace_left:new P("brace_left",R.token,"{"),brace_right:new P("brace_right",R.token,"}"),colon:new P("colon",R.token,":"),comma:new P("comma",R.token,","),equal:new P("equal",R.token,"="),equal_equal:new P("equal_equal",R.token,"=="),not_equal:new P("not_equal",R.token,"!="),greater_than:new P("greater_than",R.token,">"),greater_than_equal:new P("greater_than_equal",R.token,">="),shift_right:new P("shift_right",R.token,">>"),less_than:new P("less_than",R.token,"<"),less_than_equal:new P("less_than_equal",R.token,"<="),shift_left:new P("shift_left",R.token,"<<"),modulo:new P("modulo",R.token,"%"),minus:new P("minus",R.token,"-"),minus_minus:new P("minus_minus",R.token,"--"),period:new P("period",R.token,"."),plus:new P("plus",R.token,"+"),plus_plus:new P("plus_plus",R.token,"++"),or:new P("or",R.token,"|"),or_or:new P("or_or",R.token,"||"),paren_left:new P("paren_left",R.token,"("),paren_right:new P("paren_right",R.token,")"),semicolon:new P("semicolon",R.token,";"),star:new P("star",R.token,"*"),tilde:new P("tilde",R.token,"~"),underscore:new P("underscore",R.token,"_"),xor:new P("xor",R.token,"^"),plus_equal:new P("plus_equal",R.token,"+="),minus_equal:new P("minus_equal",R.token,"-="),times_equal:new P("times_equal",R.token,"*="),division_equal:new P("division_equal",R.token,"/="),modulo_equal:new P("modulo_equal",R.token,"%="),and_equal:new P("and_equal",R.token,"&="),or_equal:new P("or_equal",R.token,"|="),xor_equal:new P("xor_equal",R.token,"^="),shift_right_equal:new P("shift_right_equal",R.token,">>="),shift_left_equal:new P("shift_left_equal",R.token,"<<=")},b.simpleTokens={"@":C.tokens.attr,"{":C.tokens.brace_left,"}":C.tokens.brace_right,":":C.tokens.colon,",":C.tokens.comma,"(":C.tokens.paren_left,")":C.tokens.paren_right,";":C.tokens.semicolon},b.literalTokens={"&":C.tokens.and,"&&":C.tokens.and_and,"->":C.tokens.arrow,"/":C.tokens.forward_slash,"!":C.tokens.bang,"[":C.tokens.bracket_left,"]":C.tokens.bracket_right,"=":C.tokens.equal,"==":C.tokens.equal_equal,"!=":C.tokens.not_equal,">":C.tokens.greater_than,">=":C.tokens.greater_than_equal,">>":C.tokens.shift_right,"<":C.tokens.less_than,"<=":C.tokens.less_than_equal,"<<":C.tokens.shift_left,"%":C.tokens.modulo,"-":C.tokens.minus,"--":C.tokens.minus_minus,".":C.tokens.period,"+":C.tokens.plus,"++":C.tokens.plus_plus,"|":C.tokens.or,"||":C.tokens.or_or,"*":C.tokens.star,"~":C.tokens.tilde,_:C.tokens.underscore,"^":C.tokens.xor,"+=":C.tokens.plus_equal,"-=":C.tokens.minus_equal,"*=":C.tokens.times_equal,"/=":C.tokens.division_equal,"%=":C.tokens.modulo_equal,"&=":C.tokens.and_equal,"|=":C.tokens.or_equal,"^=":C.tokens.xor_equal,">>=":C.tokens.shift_right_equal,"<<=":C.tokens.shift_left_equal},b.regexTokens={decimal_float_literal:C.tokens.decimal_float_literal,hex_float_literal:C.tokens.hex_float_literal,int_literal:C.tokens.int_literal,uint_literal:C.tokens.uint_literal,ident:C.tokens.ident},b.storage_class=[C.keywords.function,C.keywords.private,C.keywords.workgroup,C.keywords.uniform,C.keywords.storage],b.access_mode=[C.keywords.read,C.keywords.write,C.keywords.read_write],b.sampler_type=[C.keywords.sampler,C.keywords.sampler_comparison],b.sampled_texture_type=[C.keywords.texture_1d,C.keywords.texture_2d,C.keywords.texture_2d_array,C.keywords.texture_3d,C.keywords.texture_cube,C.keywords.texture_cube_array],b.multisampled_texture_type=[C.keywords.texture_multisampled_2d],b.storage_texture_type=[C.keywords.texture_storage_1d,C.keywords.texture_storage_2d,C.keywords.texture_storage_2d_array,C.keywords.texture_storage_3d],b.depth_texture_type=[C.keywords.texture_depth_2d,C.keywords.texture_depth_2d_array,C.keywords.texture_depth_cube,C.keywords.texture_depth_cube_array,C.keywords.texture_depth_multisampled_2d],b.texture_external_type=[C.keywords.texture_external],b.any_texture_type=[...C.sampled_texture_type,...C.multisampled_texture_type,...C.storage_texture_type,...C.depth_texture_type,...C.texture_external_type],b.texel_format=[C.keywords.r8unorm,C.keywords.r8snorm,C.keywords.r8uint,C.keywords.r8sint,C.keywords.r16uint,C.keywords.r16sint,C.keywords.r16float,C.keywords.rg8unorm,C.keywords.rg8snorm,C.keywords.rg8uint,C.keywords.rg8sint,C.keywords.r32uint,C.keywords.r32sint,C.keywords.r32float,C.keywords.rg16uint,C.keywords.rg16sint,C.keywords.rg16float,C.keywords.rgba8unorm,C.keywords.rgba8unorm_srgb,C.keywords.rgba8snorm,C.keywords.rgba8uint,C.keywords.rgba8sint,C.keywords.bgra8unorm,C.keywords.bgra8unorm_srgb,C.keywords.rgb10a2unorm,C.keywords.rg11b10float,C.keywords.rg32uint,C.keywords.rg32sint,C.keywords.rg32float,C.keywords.rgba16uint,C.keywords.rgba16sint,C.keywords.rgba16float,C.keywords.rgba32uint,C.keywords.rgba32sint,C.keywords.rgba32float],b.const_literal=[C.tokens.int_literal,C.tokens.uint_literal,C.tokens.decimal_float_literal,C.tokens.hex_float_literal,C.keywords.true,C.keywords.false],b.literal_or_ident=[C.tokens.ident,C.tokens.int_literal,C.tokens.uint_literal,C.tokens.decimal_float_literal,C.tokens.hex_float_literal,C.tokens.name],b.element_count_expression=[C.tokens.int_literal,C.tokens.uint_literal,C.tokens.ident],b.template_types=[C.keywords.vec2,C.keywords.vec3,C.keywords.vec4,C.keywords.mat2x2,C.keywords.mat2x3,C.keywords.mat2x4,C.keywords.mat3x2,C.keywords.mat3x3,C.keywords.mat3x4,C.keywords.mat4x2,C.keywords.mat4x3,C.keywords.mat4x4,C.keywords.atomic,C.keywords.bitcast,...C.any_texture_type],b.attribute_name=[C.tokens.ident,C.keywords.block,C.keywords.diagnostic],b.assignment_operators=[C.tokens.equal,C.tokens.plus_equal,C.tokens.minus_equal,C.tokens.times_equal,C.tokens.division_equal,C.tokens.modulo_equal,C.tokens.and_equal,C.tokens.or_equal,C.tokens.xor_equal,C.tokens.shift_right_equal,C.tokens.shift_left_equal],b.increment_operators=[C.tokens.plus_plus,C.tokens.minus_minus];class dh{constructor(t,e,i,s,r){this.type=t,this.lexeme=e,this.line=i,this.start=s,this.end=r}toString(){return this.lexeme}isTemplateType(){return b.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==b.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Nv{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new dh(b.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}const e=b.simpleTokens[t];if(e)return this._addToken(e),!0;let i=b.none;const s=this._isAlpha(t),r=t==="_";if(this._isAlphaNumeric(t)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)t+=this._advance(),a=this._peekAhead()}if(s){const a=b.keywords[t];if(a)return this._addToken(a),!0}if(s||r)return this._addToken(b.tokens.ident),!0;for(;;){let a=this._findType(t);const l=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(l=="=")return this._current++,t+=l,this._addToken(b.tokens.minus_equal),!0;if(l=="-")return this._current++,t+=l,this._addToken(b.tokens.minus_minus),!0;const h=this._tokens.length-1;if((b.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==b.tokens.paren_right)&&l!=">")return this._addToken(a),!0}if(t==">"&&(l==">"||l=="=")){let h=!1,f=this._tokens.length-1;for(let d=0;d<5&&f>=0&&b.assignment_operators.indexOf(this._tokens[f].type)===-1;++d,--f)if(this._tokens[f].type===b.tokens.less_than){f>0&&this._tokens[f-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(a),!0}if(a===b.none){let h=t,f=0;const d=2;for(let _=0;_<d;++_)if(h+=this._peekAhead(_),a=this._findType(h),a!==b.none){f=_;break}if(a===b.none)return i!==b.none&&(this._current--,this._addToken(i),!0);t=h,this._current+=f+1}if(i=a,this._isAtEnd())break;t+=this._advance()}return i!==b.none&&(this._addToken(i),!0)}_findType(t){for(const i in b.regexTokens){const s=b.regexTokens[i];if(this._match(t,s.rule))return s}return b.literalTokens[t]||b.none}_match(t,e){const i=e.exec(t);return i&&i.index==0&&i[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new dh(t,e,this._line,this._start,this._current))}}function $(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const Ks=new Float32Array(1),Dv=new Uint32Array(Ks.buffer),Bv=new Uint32Array(Ks.buffer),Js=new Int32Array(1),Fv=new Float32Array(Js.buffer),Lv=new Uint32Array(Js.buffer),Qs=new Uint32Array(1),Uv=new Float32Array(Qs.buffer),Vv=new Int32Array(Qs.buffer);function ph(n,t,e){if(t===e)return n;if(t==="f32"){if(e==="i32"||e==="x32")return Ks[0]=n,Dv[0];if(e==="u32")return Ks[0]=n,Bv[0]}else if(t==="i32"||t==="x32"){if(e==="f32")return Js[0]=n,Fv[0];if(e==="u32")return Js[0]=n,Lv[0]}else if(t==="u32"){if(e==="f32")return Qs[0]=n,Uv[0];if(e==="i32"||e==="x32")return Qs[0]=n,Vv[0]}return console.error(`Unsupported cast from ${t} to ${e}`),n}class zv{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class ws{constructor(t,e){this.align=t,this.size=e}}class Re{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Av,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const e of t)e instanceof Li&&this._functions.set(e.name,new zv(e));for(const e of t)if(e instanceof Be){const i=this.getTypeInfo(e,null);i instanceof Ke&&this.structs.push(i)}for(const e of t)if(e instanceof Ja)this.aliases.push(this._getAliasInfo(e));else if(e instanceof qa){const i=e,s=this._getAttributeNum(i.attributes,"id",0),r=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new wv(i.name,r,i.attributes,s))}else if(this._isUniformVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),l=new bs(i.name,a,s,r,i.attributes,Ze.Uniform,i.access);l.access||(l.access="read"),this.uniforms.push(l)}else if(this._isStorageVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(a),h=new bs(i.name,a,s,r,i.attributes,l?Ze.StorageTexture:Ze.Storage,i.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(a),h=new bs(i.name,a,s,r,i.attributes,l?Ze.StorageTexture:Ze.Texture,i.access);h.access||(h.access="read"),l?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(e)){const i=e,s=this._getAttributeNum(i.attributes,"group",0),r=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),l=new bs(i.name,a,s,r,i.attributes,Ze.Sampler,i.access);this.samplers.push(l)}else if(e instanceof Li){const i=this._getAttribute(e,"vertex"),s=this._getAttribute(e,"fragment"),r=this._getAttribute(e,"compute"),a=i||s||r,l=new xv(e.name,a==null?void 0:a.name,e.attributes);l.attributes=e.attributes,l.startLine=e.startLine,l.endLine=e.endLine,this.functions.push(l),this._functions.get(e.name).info=l,a&&(this._functions.get(e.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(e,!!a),l.inputs=this._getInputs(e.args),l.outputs=this._getOutputs(e.returnType),this.entry[a.name].push(l)),l.arguments=e.args.map(h=>new Tv(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),l.returnType=e.returnType?this.getTypeInfo(e.returnType,e.attributes):null}for(const e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(const e of this._functions.values())e.node.search(i=>{var s,r,a;if(i instanceof Ff){if(i.value)if($(i.value))for(const l of i.value)for(const h of this.overrides)l===h.name&&((s=e.info)===null||s===void 0||s.overrides.push(h));else for(const l of this.overrides)i.value===l.name&&((r=e.info)===null||r===void 0||r.overrides.push(l))}else if(i instanceof ee)for(const l of this.overrides)i.name===l.name&&((a=e.info)===null||a===void 0||a.overrides.push(l))});for(const e of this.uniforms)this._markStructsInUse(e.type);for(const e of this.storage)this._markStructsInUse(e.type)}getStructInfo(t){for(const e of this.structs)if(e.name==t)return e;return null}getOverrideInfo(t){for(const e of this.overrides)if(e.name==t)return e;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var i;for(const s of t.calls){const r=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;r&&e.add(r)}}findResource(t,e,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.vertex)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}for(const s of this.entry.fragment)if(s.name===i){for(const r of s.resources)if(r.group==t&&r.binding==e)return r}}for(const s of this.uniforms)if(s.group==t&&s.binding==e)return s;for(const s of this.storage)if(s.group==t&&s.binding==e)return s;for(const s of this.textures)if(s.group==t&&s.binding==e)return s;for(const s of this.samplers)if(s.group==t&&s.binding==e)return s;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this.getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const i=[],s=this,r=[];return t.search(a=>{if(a instanceof Ys)r.push({});else if(a instanceof qs)r.pop();else if(a instanceof Le){const l=a;e&&l.type!==null&&this._markStructsFromAST(l.type),r.length>0&&(r[r.length-1][l.name]=l)}else if(a instanceof Se){const l=a;e&&l.type!==null&&this._markStructsFromAST(l.type)}else if(a instanceof Mi){const l=a;e&&l.type!==null&&this._markStructsFromAST(l.type),r.length>0&&(r[r.length-1][l.name]=l)}else if(a instanceof ee){const l=a;if(r.length>0&&r[r.length-1][l.name])return;const h=s._findResource(l.name);h&&i.push(h)}else if(a instanceof Qa){const l=a,h=s._functions.get(l.name);h&&(e&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,e)),i.push(...h.resources))}else if(a instanceof Ka){const l=a,h=s._functions.get(l.name);h&&(e&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,e)),i.push(...h.resources))}}),[...new Map(i.map(a=>[a.name,a])).values()]}getBindGroups(){const t=[];function e(i,s){i>=t.length&&(t.length=i+1),t[i]===void 0&&(t[i]=[]),s>=t[i].length&&(t[i].length=s+1)}for(const i of this.uniforms)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.storage)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.textures)e(i.group,i.binding),t[i.group][i.binding]=i;for(const i of this.samplers)e(i.group,i.binding),t[i.group][i.binding]=i;return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Be)this._getStructOutputs(t,e);else{const i=this._getOutputInfo(t);i!==null&&e.push(i)}return e}_getStructOutputs(t,e){for(const i of t.members)if(i.type instanceof Be)this._getStructOutputs(i.type,e);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const r=this.getTypeInfo(i.type,i.type.attributes),a=this._parseInt(s.value),l=new ch(i.name,r,s.name,a);e.push(l)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this.getTypeInfo(t,t.attributes),s=this._parseInt(e.value);return new ch("",i,e.name,s)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const i of t)if(i.type instanceof Be)this._getStructInputs(i.type,e);else{const s=this._getInputInfo(i);s!==null&&e.push(s)}return e}_getStructInputs(t,e){for(const i of t.members)if(i.type instanceof Be)this._getStructInputs(i.type,e);else{const s=this._getInputInfo(i);s!==null&&e.push(s)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const i=this._getAttribute(t,"interpolation"),s=this.getTypeInfo(t.type,t.attributes),r=this._parseInt(e.value),a=new bv(t.name,s,e.name,r);return i!==null&&(a.interpolation=this._parseString(i.value)),a}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new vv(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const e of this.structs)if(e.name==t)return e;for(const e of this.aliases)if(e.name==t)return e.type;return null}getTypeInfo(t,e=null){if(this._types.has(t))return this._types.get(t);if(t instanceof Oi){const s=t,r=s.format?this.getTypeInfo(s.format,s.attributes):null,a=new tn(s.name,e);return a.format=r,a.count=s.count,this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof Be){const s=t,r=new Ke(s.name,e);r.startLine=s.startLine,r.endLine=s.endLine;for(const a of s.members){const l=this.getTypeInfo(a.type,a.attributes);r.members.push(new ah(a.name,l,a.attributes))}return this._types.set(t,r),this._updateTypeInfo(r),r}if(t instanceof Si){const s=t,r=s.format instanceof U,a=s.format?r?this.getTypeInfo(s.format,null):new oe(s.format,null):null,l=new yn(s.name,a,e,s.access);return this._types.set(t,l),this._updateTypeInfo(l),l}if(t instanceof I){const s=t,r=s.format?this.getTypeInfo(s.format,null):null,a=new yn(s.name,r,e,s.access);return this._types.set(t,a),this._updateTypeInfo(a),a}const i=new oe(t.name,e);return this._types.set(t,i),this._updateTypeInfo(i),i}_updateTypeInfo(t){var e,i,s;const r=this._getTypeSize(t);if(t.size=(e=r==null?void 0:r.size)!==null&&e!==void 0?e:0,t instanceof tn&&t.format){const a=this._getTypeSize(t.format);t.stride=Math.max((i=a==null?void 0:a.size)!==null&&i!==void 0?i:0,(s=a==null?void 0:a.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(t.format)}t instanceof Ke&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let i=0,s=0,r=0,a=0;for(let l=0,h=t.members.length;l<h;++l){const f=t.members[l],d=this._getTypeSize(f);if(!d)continue;(e=this._getAlias(f.type.name))!==null&&e!==void 0||f.type;const _=d.align,m=d.size;i=this._roundUp(_,i+s),s=m,r=i,a=Math.max(a,_),f.offset=i,f.size=m,this._updateTypeInfo(f.type)}t.size=this._roundUp(a,r+s),t.align=a}_getTypeSize(t){var e,i;if(t==null)return null;const s=this._getAttributeNum(t.attributes,"size",0),r=this._getAttributeNum(t.attributes,"align",0);if(t instanceof ah&&(t=t.type),t instanceof oe){const a=this._getAlias(t.name);a!==null&&(t=a)}{const a=Re._typeInfo[t.name];if(a!==void 0){const l=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new ws(Math.max(r,a.align/l),Math.max(s,a.size/l))}}{const a=Re._typeInfo[t.name.substring(0,t.name.length-1)];if(a){const l=t.name[t.name.length-1]==="h"?2:1;return new ws(Math.max(r,a.align/l),Math.max(s,a.size/l))}}if(t instanceof tn){let a=t,l=8,h=8;const f=this._getTypeSize(a.format);return f!==null&&(h=f.size,l=f.align),h=a.count*this._getAttributeNum((i=t==null?void 0:t.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(l,h)),s&&(h=s),new ws(Math.max(r,l),Math.max(s,h))}if(t instanceof Ke){let a=0,l=0,h=0,f=0,d=0;for(const _ of t.members){const m=this._getTypeSize(_.type);m!==null&&(a=Math.max(m.align,a),h=this._roundUp(m.align,h+f),f=m.size,d=h)}return l=this._roundUp(a,d+f),new ws(Math.max(r,a),Math.max(s,l))}return null}_isUniformVar(t){return t instanceof Le&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Le&&t.storage=="storage"}_isTextureVar(t){return t instanceof Le&&t.type!==null&&Re._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Le&&t.type!==null&&Re._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const i=t;if(!i||!i.attributes)return null;const s=i.attributes;for(let r of s)if(r.name==e)return r;return null}_getAttributeNum(t,e,i){if(t===null)return i;for(let s of t)if(s.name==e){let r=s!==null&&s.value!==null?s.value:i;return r instanceof Array&&(r=r[0]),typeof r=="number"?r:typeof r=="string"?parseInt(r):i}return i}_roundUp(t,e){return Math.ceil(e/t)*t}}Re._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Re._textureTypes=b.any_texture_type.map(n=>n.name),Re._samplerTypes=b.sampler_type.map(n=>n.name);class Ga{constructor(t,e,i){this.name=t,this.value=e,this.node=i}clone(){return new Ga(this.name,this.value,this.node)}}class tc{constructor(t){this.name=t.name,this.node=t}clone(){return new tc(this.node)}}class ec{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var e;return this.variables.has(t)?(e=this.variables.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var e;return this.functions.has(t)?(e=this.functions.get(t))!==null&&e!==void 0?e:null:this.parent?this.parent.getFunction(t):null}createVariable(t,e,i){this.variables.set(t,new Ga(t,e,i??null))}setVariable(t,e,i){const s=this.getVariable(t);s!==null?s.value=e:this.createVariable(t,e,i)}getVariableValue(t){var e;const i=this.getVariable(t);return(e=i==null?void 0:i.value)!==null&&e!==void 0?e:null}clone(){return new ec(this)}}class Wv{evalExpression(t,e){return null}getTypeInfo(t){return null}getVariableName(t,e){return""}}class Hv{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,e){const i=this.exec.evalExpression(t.args[0],e);let s=!0;if(i instanceof T)return i.data.forEach(r=>{r||(s=!1)}),new E(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T){const s=i.data.some(r=>r);return new E(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,e){const i=this.exec.evalExpression(t.args[2],e);if(!(i instanceof E))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return i.value?this.exec.evalExpression(t.args[1],e):this.exec.evalExpression(t.args[0],e)}ArrayLength(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.evalExpression(i,e);if(s instanceof Et&&s.typeInfo.size===0){const r=s.typeInfo,a=s.buffer.byteLength/r.stride;return new E(a,this.getTypeInfo("u32"))}return new E(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.abs(r)),i.typeInfo);const s=i;return new E(Math.abs(s.value),s.typeInfo)}Acos(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.acos(r)),i.typeInfo);const s=i;return new E(Math.acos(s.value),i.typeInfo)}Acosh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.acosh(r)),i.typeInfo);const s=i;return new E(Math.acosh(s.value),i.typeInfo)}Asin(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.asin(r)),i.typeInfo);const s=i;return new E(Math.asin(s.value),i.typeInfo)}Asinh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.asinh(r)),i.typeInfo);const s=i;return new E(Math.asinh(s.value),i.typeInfo)}Atan(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.atan(r)),i.typeInfo);const s=i;return new E(Math.atan(s.value),i.typeInfo)}Atanh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.atanh(r)),i.typeInfo);const s=i;return new E(Math.atanh(s.value),i.typeInfo)}Atan2(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T)return new T(i.data.map((l,h)=>Math.atan2(l,s.data[h])),i.typeInfo);const r=i,a=s;return new E(Math.atan2(r.value,a.value),i.typeInfo)}Ceil(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.ceil(r)),i.typeInfo);const s=i;return new E(Math.ceil(s.value),i.typeInfo)}_clamp(t,e,i){return Math.min(Math.max(t,e),i)}Clamp(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof T&&s instanceof T&&r instanceof T)return new T(i.data.map((f,d)=>this._clamp(f,s.data[d],r.data[d])),i.typeInfo);const a=i,l=s,h=r;return new E(this._clamp(a.value,l.value,h.value),i.typeInfo)}Cos(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.cos(r)),i.typeInfo);const s=i;return new E(Math.cos(s.value),i.typeInfo)}Cosh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.cosh(r)),i.typeInfo);const s=i;return new E(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.clz32(r)),i.typeInfo);const s=i;return new E(Math.clz32(s.value),i.typeInfo)}_countOneBits(t){let e=0;for(;t!==0;)1&t&&e++,t>>=1;return e}CountOneBits(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>this._countOneBits(r)),i.typeInfo);const s=i;return new E(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let e=0;for(;!(1&t);)t>>=1,e++;return e}CountTrailingZeros(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>this._countTrailingZeros(r)),i.typeInfo);const s=i;return new E(this._countTrailingZeros(s.value),i.typeInfo)}Cross(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const r=i.data,a=s.data;return new T([r[1]*a[2]-a[1]*r[2],r[2]*a[0]-a[2]*r[0],r[0]*a[1]-a[0]*r[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,e){const i=this.exec.evalExpression(t.args[0],e),s=180/Math.PI;return i instanceof T?new T(i.data.map(r=>r*s),i.typeInfo):new E(i.value*s,this.getTypeInfo("f32"))}Determinant(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof q){const s=i.data,r=i.typeInfo.getTypeName(),a=r.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h")return new E(s[0]*s[3]-s[1]*s[2],a);if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h")return new E(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),a);if(r==="mat2x4"||r==="mat2x4f"||r==="mat2x4h")console.error(`TODO: Determinant for ${r}`);else if(r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h")console.error(`TODO: Determinant for ${r}`);else{if(r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h")return new E(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),a);r==="mat3x4"||r==="mat3x4f"||r==="mat3x4h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h"?console.error(`TODO: Determinant for ${r}`):r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h"||console.error(`TODO: Determinant for ${r}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T){let l=0;for(let h=0;h<i.data.length;++h)l+=(i.data[h]-s.data[h])*(i.data[h]-s.data[h]);return new E(Math.sqrt(l),this.getTypeInfo("f32"))}const r=i,a=s;return new E(Math.abs(r.value-a.value),i.typeInfo)}_dot(t,e){let i=0;for(let s=0;s<t.length;++s)i+=e[s]*t[s];return i}Dot(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);return i instanceof T&&s instanceof T?new E(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,e){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,e){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.exp(r)),i.typeInfo);const s=i;return new E(Math.exp(s.value),i.typeInfo)}Exp2(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.pow(2,r)),i.typeInfo);const s=i;return new E(Math.pow(2,s.value),i.typeInfo)}ExtractBits(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const a=s.value,l=r.value;if(i instanceof T)return new T(i.data.map(f=>f>>a&(1<<l)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const h=i.value;return new E(h>>a&(1<<l)-1,this.getTypeInfo("i32"))}FaceForward(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof T&&s instanceof T&&r instanceof T){const a=this._dot(s.data,r.data);return new T(a<0?Array.from(i.data):i.data.map(l=>-l),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>this._firstLeadingBit(r)),i.typeInfo);const s=i;return new E(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>this._firstTrailingBit(r)),i.typeInfo);const s=i;return new E(this._firstTrailingBit(s.value),i.typeInfo)}Floor(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.floor(r)),i.typeInfo);const s=i;return new E(Math.floor(s.value),i.typeInfo)}Fma(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof T&&s instanceof T&&r instanceof T)return i.data.length!==s.data.length||i.data.length!==r.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new T(i.data.map((f,d)=>f*s.data[d]+r.data[d]),i.typeInfo);const a=i,l=s,h=r;return new E(a.value*l.value+h.value,a.typeInfo)}Fract(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>r-Math.floor(r)),i.typeInfo);const s=i;return new E(s.value-Math.floor(s.value),i.typeInfo)}Frexp(t,e){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e),a=this.exec.evalExpression(t.args[3],e);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const l=r.value,h=(1<<a.value)-1<<l,f=~h;if(i instanceof T&&s instanceof T)return new T(i.data.map((m,w)=>m&f|s.data[w]<<l&h),i.typeInfo);const d=i.value,_=s.value;return new E(d&f|_<<l&h,i.typeInfo)}InverseSqrt(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>1/Math.sqrt(r)),i.typeInfo);const s=i;return new E(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(t,e){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T){let r=0;return i.data.forEach(a=>{r+=a*a}),new E(Math.sqrt(r),this.getTypeInfo("f32"))}const s=i;return new E(Math.abs(s.value),i.typeInfo)}Log(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.log(r)),i.typeInfo);const s=i;return new E(Math.log(s.value),i.typeInfo)}Log2(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.log2(r)),i.typeInfo);const s=i;return new E(Math.log2(s.value),i.typeInfo)}Max(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T)return new T(i.data.map((l,h)=>Math.max(l,s.data[h])),i.typeInfo);const r=i,a=s;return new E(Math.max(r.value,a.value),i.typeInfo)}Min(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T)return new T(i.data.map((l,h)=>Math.min(l,s.data[h])),i.typeInfo);const r=i,a=s;return new E(Math.min(r.value,a.value),i.typeInfo)}Mix(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof T&&s instanceof T&&r instanceof T)return new T(i.data.map((h,f)=>i.data[f]*(1-r.data[f])+s.data[f]*r.data[f]),i.typeInfo);const a=s,l=r;return new E(i.value*(1-l.value)+a.value*l.value,i.typeInfo)}Modf(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T)return new T(i.data.map((a,l)=>a%s.data[l]),i.typeInfo);const r=s;return new E(i.value%r.value,i.typeInfo)}Normalize(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T){const s=this.Length(t,e).value;return new T(i.data.map(r=>r/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T)return new T(i.data.map((l,h)=>Math.pow(l,s.data[h])),i.typeInfo);const r=i,a=s;return new E(Math.pow(r.value,a.value),i.typeInfo)}QuantizeToF16(t,e){const i=this.exec.evalExpression(t.args[0],e);return i instanceof T?new T(i.data.map(s=>s),i.typeInfo):new E(i.value,i.typeInfo)}Radians(t,e){const i=this.exec.evalExpression(t.args[0],e);return i instanceof T?new T(i.data.map(s=>s*Math.PI/180),i.typeInfo):new E(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,e){let i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(i instanceof T&&s instanceof T){const r=this._dot(i.data,s.data);return new T(i.data.map((a,l)=>a-2*r*s.data[l]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,e){let i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(i instanceof T&&s instanceof T&&r instanceof E){const a=this._dot(s.data,i.data);return new T(i.data.map((l,h)=>{const f=1-r.value*r.value*(1-a*a);if(f<0)return 0;const d=Math.sqrt(f);return r.value*l-(r.value*a+d)*s.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,e){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.round(r)),i.typeInfo);const s=i;return new E(Math.round(s.value),i.typeInfo)}Saturate(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.min(Math.max(r,0),1)),i.typeInfo);const s=i;return new E(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.sign(r)),i.typeInfo);const s=i;return new E(Math.sign(s.value),i.typeInfo)}Sin(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.sin(r)),i.typeInfo);const s=i;return new E(Math.sin(s.value),i.typeInfo)}Sinh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.sinh(r)),i.typeInfo);const s=i;return new E(Math.sinh(s.value),i.typeInfo)}_smoothstep(t,e,i){const s=Math.min(Math.max((i-t)/(e-t),0),1);return s*s*(3-2*s)}SmoothStep(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e),r=this.exec.evalExpression(t.args[2],e);if(r instanceof T&&i instanceof T&&s instanceof T)return new T(r.data.map((f,d)=>this._smoothstep(i.data[d],s.data[d],f)),r.typeInfo);const a=i,l=s,h=r;return new E(this._smoothstep(a.value,l.value,h.value),r.typeInfo)}Sqrt(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.sqrt(r)),i.typeInfo);const s=i;return new E(Math.sqrt(s.value),i.typeInfo)}Step(t,e){const i=this.exec.evalExpression(t.args[0],e),s=this.exec.evalExpression(t.args[1],e);if(s instanceof T&&i instanceof T)return new T(s.data.map((a,l)=>a<i.data[l]?0:1),s.typeInfo);const r=i;return new E(s.value<r.value?0:1,r.typeInfo)}Tan(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.tan(r)),i.typeInfo);const s=i;return new E(Math.tan(s.value),i.typeInfo)}Tanh(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.tanh(r)),i.typeInfo);const s=i;return new E(Math.tanh(s.value),i.typeInfo)}_getTransposeType(t){const e=t.getTypeName();return e==="mat2x2f"||e==="mat2x2h"?t:e==="mat2x3f"?this.getTypeInfo("mat3x2f"):e==="mat2x3h"?this.getTypeInfo("mat3x2h"):e==="mat2x4f"?this.getTypeInfo("mat4x2f"):e==="mat2x4h"?this.getTypeInfo("mat4x2h"):e==="mat3x2f"?this.getTypeInfo("mat2x3f"):e==="mat3x2h"?this.getTypeInfo("mat2x3h"):e==="mat3x3f"||e==="mat3x3h"?t:e==="mat3x4f"?this.getTypeInfo("mat4x3f"):e==="mat3x4h"?this.getTypeInfo("mat4x3h"):e==="mat4x2f"?this.getTypeInfo("mat2x4f"):e==="mat4x2h"?this.getTypeInfo("mat2x4h"):e==="mat4x3f"?this.getTypeInfo("mat3x4f"):e==="mat4x3h"?this.getTypeInfo("mat3x4h"):(e==="mat4x4f"||e==="mat4x4h"||console.error(`Invalid matrix type ${e}`),t)}Transpose(t,e){const i=this.exec.evalExpression(t.args[0],e);if(!(i instanceof q))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const r=i.data;return new q([r[0],r[2],r[1],r[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const r=i.data;return new q([r[0],r[3],r[6],r[1],r[4],r[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const r=i.data;return new q([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const r=i.data;return new q([r[0],r[3],r[1],r[4],r[2],r[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const r=i.data;return new q([r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const r=i.data;return new q([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const r=i.data;return new q([r[0],r[4],r[1],r[5],r[2],r[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const r=i.data;return new q([r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const r=i.data;return new q([r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(t,e){const i=this.exec.evalExpression(t.args[0],e);if(i instanceof T)return new T(i.data.map(r=>Math.trunc(r)),i.typeInfo);const s=i;return new E(Math.trunc(s.value),i.typeInfo)}Dpdx(t,e){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,e){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,e){return console.error("TODO: dpdxFine"),null}Dpdy(t,e){return console.error("TODO: dpdy"),null}DpdyCoarse(t,e){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,e){return console.error("TODO: dpdyFine"),null}Fwidth(t,e){return console.error("TODO: fwidth"),null}FwidthCoarse(t,e){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,e){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,e){const i=t.args[0],s=t.args.length>1?this.exec.evalExpression(t.args[1],e).value:0;if(i instanceof ee){const r=i.name,a=e.getVariableValue(r);if(a instanceof Fe){if(s<0||s>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const l=a.getMipLevelSize(s),h=a.dimension;return h==="1d"?new E(l[0],this.getTypeInfo("u32")):h==="3d"?new T(l,this.getTypeInfo("vec3u")):h==="2d"?new T(l.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${t.line}`),null)}return console.error(`Texture ${r} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,e){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,e){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,e){const i=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length>2?this.exec.evalExpression(t.args[2],e).value:0;if(!(s instanceof T)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(i instanceof ee){const a=i.name,l=e.getVariableValue(a);if(l instanceof Fe){const h=Math.floor(s.data[0]),f=Math.floor(s.data[1]);if(h<0||h>=l.width||f<0||f>=l.height)return console.error(`Texture ${a} out of bounds. Line ${t.line}`),null;const d=l.getPixel(h,f,0,r);return d===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new T(d,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,e){const i=t.args[0];if(i instanceof ee){const s=i.name,r=e.getVariableValue(s);return r instanceof Fe?new E(r.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,e){const i=t.args[0];if(i instanceof ee){const s=i.name,r=e.getVariableValue(s);return r instanceof Fe?new E(r.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,e){const i=t.args[0];if(i instanceof ee){const s=i.name,r=e.getVariableValue(s);return r instanceof Fe?new E(r.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,e){return console.error("TODO: textureSample"),null}TextureSampleBias(t,e){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,e){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,e){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,e){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,e){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,e){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,e){const i=t.args[0],s=this.exec.evalExpression(t.args[1],e),r=t.args.length===4?this.exec.evalExpression(t.args[2],e).value:0,a=t.args.length===4?this.exec.evalExpression(t.args[3],e).data:this.exec.evalExpression(t.args[2],e).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(s instanceof T)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(i instanceof ee){const l=i.name,h=e.getVariableValue(l);if(h instanceof Fe){const f=h.getMipLevelSize(0),d=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return d<0||d>=f[0]||_<0||_>=f[1]?(console.error(`Texture ${l} out of bounds. Line ${t.line}`),null):(h.setPixel(d,_,0,r,Array.from(a)),null)}return console.error(`Texture ${l} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e);return e.getVariable(s).value.getSubData(this.exec,i.postfix,e)}AtomicStore(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e);return h instanceof E&&l instanceof E&&(h.value=l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),null}AtomicAdd(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value+=l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicSub(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value-=l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicMax(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=Math.max(h.value,l.value)),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicMin(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=Math.min(h.value,l.value)),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicAnd(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=h.value&l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicOr(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=h.value|l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicXor(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=h.value^l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicExchange(t,e){let i=t.args[0];i instanceof Ot&&(i=i.right);const s=this.exec.getVariableName(i,e),r=e.getVariable(s);let a=t.args[1];const l=this.exec.evalExpression(a,e),h=r.value.getSubData(this.exec,i.postfix,e),f=new E(h.value,h.typeInfo);return h instanceof E&&l instanceof E&&(h.value=l.value),r.value instanceof Et&&r.value.setDataValue(this.exec,h,i.postfix,e),f}AtomicCompareExchangeWeak(t,e){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,e){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,e){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,e){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,e){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,e){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,e){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,e){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,e){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,e){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,e){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,e){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,e){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,e){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,e){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,e){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,e){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,e){return null}TextureBarrier(t,e){return null}WorkgroupBarrier(t,e){return null}WorkgroupUniformLoad(t,e){return null}SubgroupAdd(t,e){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,e){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,e){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,e){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,e){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,e){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,e){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,e){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,e){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,e){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,e){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,e){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,e){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,e){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,e){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,e){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,e){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,e){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,e){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,e){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,e){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,e){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,e){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,e){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,e){return console.error("TODO: quadSwapY"),null}}const Io={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Zt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class $t extends Wv{constructor(t,e){var i;super(),this.ast=t??[],this.reflection=new Re,this.reflection.updateAST(this.ast),this.context=(i=e==null?void 0:e.clone())!==null&&i!==void 0?i:new ec,this.builtins=new Hv(this),this.typeInfo={bool:this.getTypeInfo(U.bool),i32:this.getTypeInfo(U.i32),u32:this.getTypeInfo(U.u32),f32:this.getTypeInfo(U.f32),f16:this.getTypeInfo(U.f16),vec2f:this.getTypeInfo(I.vec2f),vec2u:this.getTypeInfo(I.vec2u),vec2i:this.getTypeInfo(I.vec2i),vec2h:this.getTypeInfo(I.vec2h),vec3f:this.getTypeInfo(I.vec3f),vec3u:this.getTypeInfo(I.vec3u),vec3i:this.getTypeInfo(I.vec3i),vec3h:this.getTypeInfo(I.vec3h),vec4f:this.getTypeInfo(I.vec4f),vec4u:this.getTypeInfo(I.vec4u),vec4i:this.getTypeInfo(I.vec4i),vec4h:this.getTypeInfo(I.vec4h),mat2x2f:this.getTypeInfo(I.mat2x2f),mat2x3f:this.getTypeInfo(I.mat2x3f),mat2x4f:this.getTypeInfo(I.mat2x4f),mat3x2f:this.getTypeInfo(I.mat3x2f),mat3x3f:this.getTypeInfo(I.mat3x3f),mat3x4f:this.getTypeInfo(I.mat3x4f),mat4x2f:this.getTypeInfo(I.mat4x2f),mat4x3f:this.getTypeInfo(I.mat4x3f),mat4x4f:this.getTypeInfo(I.mat4x4f)}}getVariableValue(t){var e,i;const s=(i=(e=this.context.getVariable(t))===null||e===void 0?void 0:e.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof E)return s.value;if(s instanceof T||s instanceof q)return Array.from(s.data);if(s instanceof Et&&s.typeInfo instanceof tn){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,e,i,s){const r=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,r),this._execStatements(this.ast,r);const a=r.getFunction(t);if(!a)return void console.error(`Function ${t} not found`);if(typeof e=="number")e=[e,1,1];else{if(e.length===0)return void console.error("Invalid dispatch count");e.length===1?e=[e[0],1,1]:e.length===2?e=[e[0],e[1],1]:e.length>3&&(e=[e[0],e[1],e[2]])}const l=e[0],h=e[1],f=e[2],d=this.getTypeInfo("vec3u");r.setVariable("@num_workgroups",new T(e,d));for(const _ in i)for(const m in i[_]){const w=i[_][m];r.variables.forEach(A=>{var S;const k=A.node;if(k!=null&&k.attributes){let B=null,F=null;for(const M of k.attributes)M.name==="binding"?B=M.value:M.name==="group"&&(F=M.value);if(m==B&&_==F)if(w.texture!==void 0&&w.descriptor!==void 0){const M=new Fe(w.texture,this.getTypeInfo(k.type),w.descriptor,(S=w.texture.view)!==null&&S!==void 0?S:null);A.value=M}else w.uniform!==void 0?A.value=new Et(w.uniform,this.getTypeInfo(k.type)):A.value=new Et(w,this.getTypeInfo(k.type))}})}for(let _=0;_<f;++_)for(let m=0;m<h;++m)for(let w=0;w<l;++w)r.setVariable("@workgroup_id",new T([w,m,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[w,m,_],r)}execStatement(t,e){if(t instanceof Rf)return this.evalExpression(t.value,e);if(t instanceof If){if(t.condition){const i=this.evalExpression(t.condition,e);if(!(i instanceof E))throw new Error("Invalid break-if condition");if(!i.value)return null}return $t._breakObj}if(t instanceof Cf)return $t._continueObj;if(t instanceof Mi)this._let(t,e);else if(t instanceof Le)this._var(t,e);else if(t instanceof Cs)this._const(t,e);else if(t instanceof Li)this._function(t,e);else{if(t instanceof Ef)return this._if(t,e);if(t instanceof Sf)return this._switch(t,e);if(t instanceof wf)return this._for(t,e);if(t instanceof bf)return this._while(t,e);if(t instanceof Af)return this._loop(t,e);if(t instanceof ua){const i=e.clone();return i.currentFunctionName=e.currentFunctionName,this._execStatements(t.body,i)}if(t instanceof xf)this._assign(t,e);else if(t instanceof Tf)this._increment(t,e);else{if(t instanceof Be)return null;if(t instanceof qa){const i=t.name;e.getVariable(i)===null&&e.setVariable(i,new E(0,this.getTypeInfo("u32")))}else if(t instanceof Ka)this._call(t,e);else{if(t instanceof Pf||t instanceof Ja)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,e){return t instanceof pe?this._evalBinaryOp(t,e):t instanceof Nt?this._evalLiteral(t,e):t instanceof ee?this._evalVariable(t,e):t instanceof Qa?this._evalCall(t,e):t instanceof Se?this._evalCreate(t,e):t instanceof Mf?this._evalConst(t,e):t instanceof Of?this._evalBitcast(t,e):t instanceof Ot?this._evalUnaryOp(t,e):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var e;if(t instanceof U){const s=this.reflection.getTypeInfo(t);if(s!==null)return s}let i=(e=this.typeInfo[t])!==null&&e!==void 0?e:null;return i!==null||(i=this.reflection.getTypeInfoByName(t)),i}_setOverrides(t,e){for(const i in t){const s=t[i],r=this.reflection.getOverrideInfo(i);r!==null?(r.type===null&&(r.type=this.getTypeInfo("u32")),r.type.name==="u32"||r.type.name==="i32"||r.type.name==="f32"||r.type.name==="f16"?e.setVariable(i,new E(s,r.type)):r.type.name==="bool"?e.setVariable(i,new E(s?1:0,r.type)):r.type.name==="vec2"||r.type.name==="vec3"||r.type.name==="vec4"||r.type.name==="vec2f"||r.type.name==="vec3f"||r.type.name==="vec4f"||r.type.name==="vec2i"||r.type.name==="vec3i"||r.type.name==="vec4i"||r.type.name==="vec2u"||r.type.name==="vec3u"||r.type.name==="vec4u"||r.type.name==="vec2h"||r.type.name==="vec3h"||r.type.name==="vec4h"?e.setVariable(i,new T(s,r.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(t,e,i){const s=[1,1,1];for(const d of t.node.attributes)if(d.name==="workgroup_size"){if(d.value.length>0){const _=i.getVariableValue(d.value[0]);s[0]=_ instanceof E?_.value:parseInt(d.value[0])}if(d.value.length>1){const _=i.getVariableValue(d.value[1]);s[1]=_ instanceof E?_.value:parseInt(d.value[1])}if(d.value.length>2){const _=i.getVariableValue(d.value[2]);s[2]=_ instanceof E?_.value:parseInt(d.value[2])}}const r=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new T(s,r));const l=s[0],h=s[1],f=s[2];for(let d=0,_=0;d<f;++d)for(let m=0;m<h;++m)for(let w=0;w<l;++w,++_){const A=[w,m,d],S=[w+e[0]*s[0],m+e[1]*s[1],d+e[2]*s[2]];i.setVariable("@local_invocation_id",new T(A,r)),i.setVariable("@global_invocation_id",new T(S,r)),i.setVariable("@local_invocation_index",new E(_,a)),this._dispatchExec(t,i)}}_dispatchExec(t,e){for(const i of t.node.args)for(const s of i.attributes)if(s.name==="builtin"){const r=`@${s.value}`,a=e.getVariable(r);a!==void 0&&e.variables.set(i.name,a)}this._execStatements(t.node.body,e)}getVariableName(t,e){for(;t instanceof Ot;)t=t.right;return t instanceof ee?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,e){for(const i of t){if(i instanceof Array){const r=e.clone(),a=this._execStatements(i,r);if(a)return a;continue}const s=this.execStatement(i,e);if(s)return s}return null}_call(t,e){const i=e.clone();i.currentFunctionName=t.name;const s=e.getFunction(t.name);if(s){for(let r=0;r<s.node.args.length;++r){const a=s.node.args[r],l=this.evalExpression(t.args[r],i);i.setVariable(a.name,l,a)}this._execStatements(s.node.body,i)}else t.isBuiltin?this._callBuiltinFunction(t,i):this.getTypeInfo(t.name)&&this._evalCreate(t,e)}_increment(t,e){const i=this.getVariableName(t.variable,e),s=e.getVariable(i);s?t.operator==="++"?s.value instanceof E?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${t.line}`):t.operator==="--"?s.value instanceof E?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${i} not found. Line ${t.line}`)}_getVariableData(t,e){if(t instanceof ee){const i=this.getVariableName(t,e),s=e.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${t.line}`),null):s.value.getSubData(this,t.postfix,e)}if(t instanceof Ot){if(t.operator==="*"){const i=this._getVariableData(t.right,e);return i instanceof Fn?i.reference.getSubData(this,t.postfix,e):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const i=this._getVariableData(t.right,e);return new Fn(i)}}return null}_assign(t,e){let i=null,s="<var>",r=null;if(t.variable instanceof Ot){const h=this._getVariableData(t.variable,e),f=this.evalExpression(t.value,e),d=t.operator;if(d==="="){if(h instanceof E||h instanceof T||h instanceof q){if(f instanceof E||f instanceof T||f instanceof q&&h.data.length===f.data.length)return void h.data.set(f.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(h instanceof Et&&f instanceof Et&&h.buffer.byteLength-h.offset>=f.buffer.byteLength-f.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(f.buffer,f.offset,f.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(d==="+=")return h instanceof E||h instanceof T||h instanceof q?f instanceof E||f instanceof T||f instanceof q?void h.data.set(f.data.map((_,m)=>h.data[m]+_)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(d==="-=")return(h instanceof E||h instanceof T||h instanceof q)&&(f instanceof E||f instanceof T||f instanceof q)?void h.data.set(f.data.map((_,m)=>h.data[m]-_)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof Ot){if(t.variable.operator==="*"){s=this.getVariableName(t.variable.right,e);const h=e.getVariable(s);if(!(h&&h.value instanceof Fn))return void console.error(`Variable ${s} is not a pointer. Line ${t.line}`);i=h.value.reference;let f=t.variable.postfix;if(!f){let d=t.variable.right;for(;d instanceof Ot;){if(d.postfix){f=d.postfix;break}d=d.right}}f&&(i=i.getSubData(this,f,e))}}else{r=t.variable.postfix,s=this.getVariableName(t.variable,e);const h=e.getVariable(s);if(h===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);i=h.value}if(i instanceof Fn&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${t.line}`);const a=this.evalExpression(t.value,e),l=t.operator;if(l==="=")if(i instanceof Et)i.setDataValue(this,a,r,e);else if(r){if(!(i instanceof T||i instanceof q))return void console.error(`Variable ${s} is not a vector or matrix. Line ${t.line}`);if(r instanceof Kn){const h=this.evalExpression(r.index,e).value;if(i instanceof T){if(!(a instanceof E))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[h]=a.value}else{if(!(i instanceof q))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const f=this.evalExpression(r.index,e).value;if(f<0)return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(a instanceof T))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);{const d=i.typeInfo.getTypeName();if(d==="mat2x2"||d==="mat2x2f"||d==="mat2x2h"){if(!(f<2&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*f]=a.data[0],i.data[2*f+1]=a.data[1]}else if(d==="mat2x3"||d==="mat2x3f"||d==="mat2x3h"){if(!(f<2&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*f]=a.data[0],i.data[3*f+1]=a.data[1],i.data[3*f+2]=a.data[2]}else if(d==="mat2x4"||d==="mat2x4f"||d==="mat2x4h"){if(!(f<2&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*f]=a.data[0],i.data[4*f+1]=a.data[1],i.data[4*f+2]=a.data[2],i.data[4*f+3]=a.data[3]}else if(d==="mat3x2"||d==="mat3x2f"||d==="mat3x2h"){if(!(f<3&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*f]=a.data[0],i.data[2*f+1]=a.data[1]}else if(d==="mat3x3"||d==="mat3x3f"||d==="mat3x3h"){if(!(f<3&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*f]=a.data[0],i.data[3*f+1]=a.data[1],i.data[3*f+2]=a.data[2]}else if(d==="mat3x4"||d==="mat3x4f"||d==="mat3x4h"){if(!(f<3&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*f]=a.data[0],i.data[4*f+1]=a.data[1],i.data[4*f+2]=a.data[2],i.data[4*f+3]=a.data[3]}else if(d==="mat4x2"||d==="mat4x2f"||d==="mat4x2h"){if(!(f<4&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[2*f]=a.data[0],i.data[2*f+1]=a.data[1]}else if(d==="mat4x3"||d==="mat4x3f"||d==="mat4x3h"){if(!(f<4&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[3*f]=a.data[0],i.data[3*f+1]=a.data[1],i.data[3*f+2]=a.data[2]}else{if(d!=="mat4x4"&&d!=="mat4x4f"&&d!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(!(f<4&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);i.data[4*f]=a.data[0],i.data[4*f+1]=a.data[1],i.data[4*f+2]=a.data[2],i.data[4*f+3]=a.data[3]}}}}}else if(r instanceof vn){const h=r.value;if(!(i instanceof T))return void console.error(`Invalid assignment to ${h}. Variable ${s} is not a vector. Line ${t.line}`);if(a instanceof E){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${t.line}`);if(h==="x")i.data[0]=a.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${t.line}`);i.data[1]=a.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${t.line}`);i.data[2]=a.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${t.line}`);i.data[3]=a.value}}else{if(!(a instanceof T))return void console.error(`Invalid assignment to ${s}. Line ${t.line}`);if(h.length!==a.data.length)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${t.line}`);for(let f=0;f<h.length;++f){const d=h[f];if(d==="x"||d==="r")i.data[0]=a.data[f];else if(d==="y"||d==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${d} for variable ${s}. Line ${t.line}`);i.data[1]=a.data[f]}else if(d==="z"||d==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${d} for variable ${s}. Line ${t.line}`);i.data[2]=a.data[f]}else{if(d!=="w"&&d!=="a")return void console.error(`Invalid assignment to ${d} for variable ${s}. Line ${t.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${d} for variable ${s}. Line ${t.line}`);i.data[3]=a.data[f]}}}}}else i instanceof E&&a instanceof E?i.value=a.value:i instanceof T&&a instanceof T||i instanceof q&&a instanceof q?i.data.set(a.data):console.error(`Invalid assignment to ${s}. Line ${t.line}`);else{const h=i.getSubData(this,r,e);if(h instanceof T&&a instanceof E){const f=h.data,d=a.value;if(l==="+=")for(let _=0;_<f.length;++_)f[_]+=d;else if(l==="-=")for(let _=0;_<f.length;++_)f[_]-=d;else if(l==="*=")for(let _=0;_<f.length;++_)f[_]*=d;else if(l==="/=")for(let _=0;_<f.length;++_)f[_]/=d;else if(l==="%=")for(let _=0;_<f.length;++_)f[_]%=d;else if(l==="&=")for(let _=0;_<f.length;++_)f[_]&=d;else if(l==="|=")for(let _=0;_<f.length;++_)f[_]|=d;else if(l==="^=")for(let _=0;_<f.length;++_)f[_]^=d;else if(l==="<<=")for(let _=0;_<f.length;++_)f[_]<<=d;else if(l===">>=")for(let _=0;_<f.length;++_)f[_]>>=d;else console.error(`Invalid operator ${l}. Line ${t.line}`)}else if(h instanceof T&&a instanceof T){const f=h.data,d=a.data;if(f.length!==d.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(l==="+=")for(let _=0;_<f.length;++_)f[_]+=d[_];else if(l==="-=")for(let _=0;_<f.length;++_)f[_]-=d[_];else if(l==="*=")for(let _=0;_<f.length;++_)f[_]*=d[_];else if(l==="/=")for(let _=0;_<f.length;++_)f[_]/=d[_];else if(l==="%=")for(let _=0;_<f.length;++_)f[_]%=d[_];else if(l==="&=")for(let _=0;_<f.length;++_)f[_]&=d[_];else if(l==="|=")for(let _=0;_<f.length;++_)f[_]|=d[_];else if(l==="^=")for(let _=0;_<f.length;++_)f[_]^=d[_];else if(l==="<<=")for(let _=0;_<f.length;++_)f[_]<<=d[_];else if(l===">>=")for(let _=0;_<f.length;++_)f[_]>>=d[_];else console.error(`Invalid operator ${l}. Line ${t.line}`)}else{if(!(h instanceof E&&a instanceof E))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);l==="+="?h.value+=a.value:l==="-="?h.value-=a.value:l==="*="?h.value*=a.value:l==="/="?h.value/=a.value:l==="%="?h.value%=a.value:l==="&="?h.value&=a.value:l==="|="?h.value|=a.value:l==="^="?h.value^=a.value:l==="<<="?h.value<<=a.value:l===">>="?h.value>>=a.value:console.error(`Invalid operator ${l}. Line ${t.line}`)}i instanceof Et&&i.setDataValue(this,h,r,e)}}_function(t,e){const i=new tc(t);e.functions.set(t.name,i)}_const(t,e){let i=null;t.value!==null&&(i=this.evalExpression(t.value,e)),e.createVariable(t.name,i,t)}_let(t,e){let i=null;if(t.value!==null){if(i=this.evalExpression(t.value,e),i===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ot||(i=i.clone())}else{const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const r=new Se(t.type,[]);i=this._evalCreate(r,e)}}e.createVariable(t.name,i,t)}_var(t,e){let i=null;if(t.value!==null){if(i=this.evalExpression(t.value,e),i===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof Ot||(i=i.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const s=t.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||t.type instanceof Oi||t.type instanceof Be||t.type instanceof I){const r=new Se(t.type,[]);i=this._evalCreate(r,e)}}e.createVariable(t.name,i,t)}_switch(t,e){e=e.clone();const i=this.evalExpression(t.condition,e);if(!(i instanceof E))return console.error(`Invalid if condition. Line ${t.line}`),null;let s=null;for(const r of t.cases)if(r instanceof Df)for(const a of r.selectors){if(a instanceof Ms){s=r;continue}const l=this.evalExpression(a,e);if(!(l instanceof E))return console.error(`Invalid case selector. Line ${t.line}`),null;if(l.value===i.value)return this._execStatements(r.body,e)}else r instanceof Bf&&(s=r);return s?this._execStatements(s.body,e):null}_if(t,e){e=e.clone();const i=this.evalExpression(t.condition,e);if(!(i instanceof E))return console.error(`Invalid if condition. Line ${t.line}`),null;if(i.value)return this._execStatements(t.body,e);for(const s of t.elseif){const r=this.evalExpression(s.condition,e);if(!(r instanceof E))return console.error(`Invalid if condition. Line ${t.line}`),null;if(r.value)return this._execStatements(s.body,e)}return t.else?this._execStatements(t.else,e):null}_getScalarValue(t){return t instanceof E?t.value:(console.error("Expected scalar value.",t),0)}_for(t,e){for(e=e.clone(),this.execStatement(t.init,e);this._getScalarValue(this.evalExpression(t.condition,e));){const i=this._execStatements(t.body,e);if(i===$t._breakObj)break;if(i!==null&&i!==$t._continueObj)return i;this.execStatement(t.increment,e)}return null}_loop(t,e){for(e=e.clone();;){const i=this._execStatements(t.body,e);if(i===$t._breakObj)break;if(i===$t._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,e)===$t._breakObj)break}else if(i!==null)return i}return null}_while(t,e){for(e=e.clone();this._getScalarValue(this.evalExpression(t.condition,e));){const i=this._execStatements(t.body,e);if(i===$t._breakObj)break;if(i!==$t._continueObj&&i!==null)return i}return null}_evalBitcast(t,e){const i=this.evalExpression(t.value,e),s=t.type;if(i instanceof E){const r=ph(i.value,i.typeInfo.name,s.name);return new E(r,this.getTypeInfo(s))}if(i instanceof T){const r=i.typeInfo.getTypeName();let a="";if(r.endsWith("f"))a="f32";else if(r.endsWith("i"))a="i32";else if(r.endsWith("u"))a="u32";else if(r.endsWith("b"))a="bool";else{if(!r.endsWith("h"))return console.error(`Unknown vector type ${r}. Line ${t.line}`),null;a="f16"}const l=s.getTypeName();let h="";if(l.endsWith("f"))h="f32";else if(l.endsWith("i"))h="i32";else if(l.endsWith("u"))h="u32";else if(l.endsWith("b"))h="bool";else{if(!l.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${t.line}`),null;h="f16"}const f=function(d,_,m){if(_===m)return d;const w=new Array(d.length);for(let A=0;A<d.length;A++)w[A]=ph(d[A],_,m);return w}(Array.from(i.data),a,h);return new T(f,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,e){return e.getVariableValue(t.name).clone().getSubData(this,t.postfix,e)}_evalCreate(t,e){var i;if(t instanceof Se){if(t.type===null)return fa.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,e);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,e);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,e)}}const s=t instanceof Se?t.type.name:t.name,r=t instanceof Se?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(r===null)return console.error(`Unknown type ${s}. Line ${t.line}`),null;if(r.size===0)return null;const a=new Et(new ArrayBuffer(r.size),r,0);if(r instanceof Ke){if(t.args)for(let l=0;l<t.args.length;++l){const h=r.members[l],f=t.args[l],d=this.evalExpression(f,e);a.setData(this,d,h.type,h.offset,e)}}else if(r instanceof tn){let l=0;if(t.args)for(let h=0;h<t.args.length;++h){const f=t.args[h],d=this.evalExpression(f,e);r.format===null&&(((i=d.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?r.format=this.getTypeInfo("i32"):r.format=d.typeInfo),a.setData(this,d,r.format,l,e),l+=r.stride}}else console.error(`Unknown type "${s}". Line ${t.line}`);return t instanceof Se?a.getSubData(this,t.postfix,e):a}_evalLiteral(t,e){const i=this.getTypeInfo(t.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new E(t.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(t,e):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(t,e):t.value}_evalVariable(t,e){const i=e.getVariableValue(t.name);return i===null?i:i.getSubData(this,t.postfix,e)}_maxFormatTypeInfo(t){let e=t[0];if(e.name==="f32")return e;for(let i=1;i<t.length;++i){const s=$t._priority.get(e.name);$t._priority.get(t[i].name)<s&&(e=t[i])}return e.name==="x32"?this.getTypeInfo("i32"):e}_evalUnaryOp(t,e){const i=this.evalExpression(t.right,e);if(t.operator==="&")return new Fn(i);if(t.operator==="*")return i instanceof Fn?i.reference.getSubData(this,t.postfix,e):(console.error(`Invalid dereference. Line ${t.line}`),null);const s=i instanceof E?i.value:i instanceof T?Array.from(i.data):null;switch(t.operator){case"+":{if($(s)){const l=s.map((h,f)=>+h);return new T(l,i.typeInfo)}const r=s,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new E(+r,a)}case"-":{if($(s)){const l=s.map((h,f)=>-h);return new T(l,i.typeInfo)}const r=s,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new E(-r,a)}case"!":{if($(s)){const l=s.map((h,f)=>h?0:1);return new T(l,i.typeInfo)}const r=s,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new E(r?0:1,a)}case"~":{if($(s)){const l=s.map((h,f)=>~h);return new T(l,i.typeInfo)}const r=s,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new E(~r,a)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,e){const i=this.evalExpression(t.left,e),s=this.evalExpression(t.right,e),r=i instanceof E?i.value:i instanceof T||i instanceof q?Array.from(i.data):null,a=s instanceof E?s.value:s instanceof T||s instanceof q?Array.from(s.data):null;switch(t.operator){case"+":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w+_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m+d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d+m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l+h,f)}case"-":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w-_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m-d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d-m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l-h,f)}case"*":{if($(r)&&$(a)){const d=r,_=a;if(i instanceof q&&s instanceof q){const m=function(k,B,F,M){if(Zt[B.name]===void 0||Zt[M.name]===void 0)return null;const D=Zt[B.name][0],H=Zt[B.name][1],W=Zt[M.name][0];if(D!==Zt[M.name][1])return null;const at=new Array(W*H);for(let Y=0;Y<H;Y++)for(let J=0;J<W;J++){let rt=0;for(let X=0;X<D;X++)rt+=k[X*H+Y]*F[J*D+X];at[Y*W+J]=rt}return at}(d,i.typeInfo,_,s.typeInfo);if(m===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const w=Zt[s.typeInfo.name][0],A=Zt[i.typeInfo.name][1],S=this.getTypeInfo(`mat${w}x${A}f`);return new q(m,S)}if(i instanceof q&&s instanceof T){const m=function(w,A,S,k){if(Zt[A.name]===void 0||Io[k.name]===void 0)return null;const B=Zt[A.name][0],F=Zt[A.name][1];if(B!==S.length)return null;const M=new Array(F);for(let D=0;D<F;D++){let H=0;for(let W=0;W<B;W++)H+=w[W*F+D]*S[W];M[D]=H}return M}(d,i.typeInfo,_,s.typeInfo);return m===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new T(m,s.typeInfo)}if(i instanceof T&&s instanceof q){const m=function(w,A,S,k){if(Io[A.name]===void 0||Zt[k.name]===void 0)return null;const B=Zt[k.name][0],F=Zt[k.name][1];if(F!==w.length)return null;const M=[];for(let D=0;D<B;D++){let H=0;for(let W=0;W<F;W++)H+=w[W]*S[W*B+D];M[D]=H}return M}(d,i.typeInfo,_,s.typeInfo);return m===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new T(m,i.typeInfo)}{if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w*_[A]);return new T(m,i.typeInfo)}}if($(r)){const d=a,_=r.map((m,w)=>m*d);return i instanceof q?new q(_,i.typeInfo):new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d*m);return s instanceof q?new q(_,s.typeInfo):new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l*h,f)}case"%":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w%_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m%d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d%m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l%h,f)}case"/":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w/_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m/d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d/m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l/h,f)}case"&":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w&_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m&d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d&m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l&h,f)}case"|":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w|_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m|d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d|m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l|h,f)}case"^":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w^_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m^d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d^m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l^h,f)}case"<<":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w<<_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m<<d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d<<m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l<<h,f)}case">>":{if($(r)&&$(a)){const d=r,_=a;if(d.length!==_.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const m=d.map((w,A)=>w>>_[A]);return new T(m,i.typeInfo)}if($(r)){const d=a,_=r.map((m,w)=>m>>d);return new T(_,i.typeInfo)}if($(a)){const d=r,_=a.map((m,w)=>d>>m);return new T(_,s.typeInfo)}const l=r,h=a,f=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new E(l>>h,f)}case">":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d>h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f>l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l>f?1:0);return new T(h,s.typeInfo)}return new E(r>a?1:0,this.getTypeInfo("bool"));case"<":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d<h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f<l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l<f?1:0);return new T(h,s.typeInfo)}return new E(r<a?1:0,this.getTypeInfo("bool"));case"==":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d===h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f==l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l==f?1:0);return new T(h,s.typeInfo)}return new E(r===a?1:0,this.getTypeInfo("bool"));case"!=":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d!==h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f!==l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l!==f?1:0);return new T(h,s.typeInfo)}return new E(r!==a?1:0,this.getTypeInfo("bool"));case">=":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d>=h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f>=l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l>=f?1:0);return new T(h,s.typeInfo)}return new E(r>=a?1:0,this.getTypeInfo("bool"));case"<=":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d<=h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f<=l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l<=f?1:0);return new T(h,s.typeInfo)}return new E(r<=a?1:0,this.getTypeInfo("bool"));case"&&":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d&&h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f&&l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l&&f?1:0);return new T(h,s.typeInfo)}return new E(r&&a?1:0,this.getTypeInfo("bool"));case"||":if($(r)&&$(a)){const l=r,h=a;if(l.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const f=l.map((d,_)=>d||h[_]?1:0);return new T(f,i.typeInfo)}if($(r)){const l=a,h=r.map((f,d)=>f||l?1:0);return new T(h,i.typeInfo)}if($(a)){const l=r,h=a.map((f,d)=>l||f?1:0);return new T(h,s.typeInfo)}return new E(r||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,e){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const i=e.clone();i.currentFunctionName=t.name;const s=e.getFunction(t.name);if(!s)return t.isBuiltin?this._callBuiltinFunction(t,i):this.getTypeInfo(t.name)?this._evalCreate(t,e):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let r=0;r<s.node.args.length;++r){const a=s.node.args[r],l=this.evalExpression(t.args[r],i);i.createVariable(a.name,l,a)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(t,e){switch(t.name){case"all":return this.builtins.All(t,e);case"any":return this.builtins.Any(t,e);case"select":return this.builtins.Select(t,e);case"arrayLength":return this.builtins.ArrayLength(t,e);case"abs":return this.builtins.Abs(t,e);case"acos":return this.builtins.Acos(t,e);case"acosh":return this.builtins.Acosh(t,e);case"asin":return this.builtins.Asin(t,e);case"asinh":return this.builtins.Asinh(t,e);case"atan":return this.builtins.Atan(t,e);case"atanh":return this.builtins.Atanh(t,e);case"atan2":return this.builtins.Atan2(t,e);case"ceil":return this.builtins.Ceil(t,e);case"clamp":return this.builtins.Clamp(t,e);case"cos":return this.builtins.Cos(t,e);case"cosh":return this.builtins.Cosh(t,e);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,e);case"countOneBits":return this.builtins.CountOneBits(t,e);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,e);case"cross":return this.builtins.Cross(t,e);case"degrees":return this.builtins.Degrees(t,e);case"determinant":return this.builtins.Determinant(t,e);case"distance":return this.builtins.Distance(t,e);case"dot":return this.builtins.Dot(t,e);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,e);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,e);case"exp":return this.builtins.Exp(t,e);case"exp2":return this.builtins.Exp2(t,e);case"extractBits":return this.builtins.ExtractBits(t,e);case"faceForward":return this.builtins.FaceForward(t,e);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,e);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,e);case"floor":return this.builtins.Floor(t,e);case"fma":return this.builtins.Fma(t,e);case"fract":return this.builtins.Fract(t,e);case"frexp":return this.builtins.Frexp(t,e);case"insertBits":return this.builtins.InsertBits(t,e);case"inverseSqrt":return this.builtins.InverseSqrt(t,e);case"ldexp":return this.builtins.Ldexp(t,e);case"length":return this.builtins.Length(t,e);case"log":return this.builtins.Log(t,e);case"log2":return this.builtins.Log2(t,e);case"max":return this.builtins.Max(t,e);case"min":return this.builtins.Min(t,e);case"mix":return this.builtins.Mix(t,e);case"modf":return this.builtins.Modf(t,e);case"normalize":return this.builtins.Normalize(t,e);case"pow":return this.builtins.Pow(t,e);case"quantizeToF16":return this.builtins.QuantizeToF16(t,e);case"radians":return this.builtins.Radians(t,e);case"reflect":return this.builtins.Reflect(t,e);case"refract":return this.builtins.Refract(t,e);case"reverseBits":return this.builtins.ReverseBits(t,e);case"round":return this.builtins.Round(t,e);case"saturate":return this.builtins.Saturate(t,e);case"sign":return this.builtins.Sign(t,e);case"sin":return this.builtins.Sin(t,e);case"sinh":return this.builtins.Sinh(t,e);case"smoothStep":return this.builtins.SmoothStep(t,e);case"sqrt":return this.builtins.Sqrt(t,e);case"step":return this.builtins.Step(t,e);case"tan":return this.builtins.Tan(t,e);case"tanh":return this.builtins.Tanh(t,e);case"transpose":return this.builtins.Transpose(t,e);case"trunc":return this.builtins.Trunc(t,e);case"dpdx":return this.builtins.Dpdx(t,e);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,e);case"dpdxFine":return this.builtins.DpdxFine(t,e);case"dpdy":return this.builtins.Dpdy(t,e);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,e);case"dpdyFine":return this.builtins.DpdyFine(t,e);case"fwidth":return this.builtins.Fwidth(t,e);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,e);case"fwidthFine":return this.builtins.FwidthFine(t,e);case"textureDimensions":return this.builtins.TextureDimensions(t,e);case"textureGather":return this.builtins.TextureGather(t,e);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,e);case"textureLoad":return this.builtins.TextureLoad(t,e);case"textureNumLayers":return this.builtins.TextureNumLayers(t,e);case"textureNumLevels":return this.builtins.TextureNumLevels(t,e);case"textureNumSamples":return this.builtins.TextureNumSamples(t,e);case"textureSample":return this.builtins.TextureSample(t,e);case"textureSampleBias":return this.builtins.TextureSampleBias(t,e);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,e);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,e);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,e);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,e);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,e);case"textureStore":return this.builtins.TextureStore(t,e);case"atomicLoad":return this.builtins.AtomicLoad(t,e);case"atomicStore":return this.builtins.AtomicStore(t,e);case"atomicAdd":return this.builtins.AtomicAdd(t,e);case"atomicSub":return this.builtins.AtomicSub(t,e);case"atomicMax":return this.builtins.AtomicMax(t,e);case"atomicMin":return this.builtins.AtomicMin(t,e);case"atomicAnd":return this.builtins.AtomicAnd(t,e);case"atomicOr":return this.builtins.AtomicOr(t,e);case"atomicXor":return this.builtins.AtomicXor(t,e);case"atomicExchange":return this.builtins.AtomicExchange(t,e);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,e);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,e);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,e);case"pack4xI8":return this.builtins.Pack4xI8(t,e);case"pack4xU8":return this.builtins.Pack4xU8(t,e);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,e);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,e);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,e);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,e);case"pack2x16float":return this.builtins.Pack2x16float(t,e);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,e);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,e);case"unpack4xI8":return this.builtins.Unpack4xI8(t,e);case"unpack4xU8":return this.builtins.Unpack4xU8(t,e);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,e);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,e);case"unpack2x16float":return this.builtins.Unpack2x16float(t,e);case"storageBarrier":return this.builtins.StorageBarrier(t,e);case"textureBarrier":return this.builtins.TextureBarrier(t,e);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,e);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,e);case"subgroupAdd":return this.builtins.SubgroupAdd(t,e);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,e);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,e);case"subgroupAll":return this.builtins.SubgroupAll(t,e);case"subgroupAnd":return this.builtins.SubgroupAnd(t,e);case"subgroupAny":return this.builtins.SubgroupAny(t,e);case"subgroupBallot":return this.builtins.SubgroupBallot(t,e);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,e);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,e);case"subgroupElect":return this.builtins.SubgroupElect(t,e);case"subgroupMax":return this.builtins.SubgroupMax(t,e);case"subgroupMin":return this.builtins.SubgroupMin(t,e);case"subgroupMul":return this.builtins.SubgroupMul(t,e);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,e);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,e);case"subgroupOr":return this.builtins.SubgroupOr(t,e);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,e);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,e);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,e);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,e);case"subgroupXor":return this.builtins.SubgroupXor(t,e);case"quadBroadcast":return this.builtins.QuadBroadcast(t,e);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,e);case"quadSwapX":return this.builtins.QuadSwapX(t,e);case"quadSwapY":return this.builtins.QuadSwapY(t,e)}const i=e.getFunction(t.name);if(i){const s=e.clone();for(let r=0;r<i.node.args.length;++r){const a=i.node.args[r],l=this.evalExpression(t.args[r],s);s.setVariable(a.name,l,a)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(t,e){if(!t.args||t.args.length===0)return new E(0,this.getTypeInfo(t.type));const i=this.evalExpression(t.args[0],e);return i.typeInfo=this.getTypeInfo(t.type),i.getSubData(this,t.postfix,e).clone()}_callConstructorVec(t,e){const i=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=Io[s];if(r===void 0)return console.error(`Invalid vec constructor ${s}. Line ${t.line}`),null;const a=[];if(t instanceof Nt)if(t.isVector){const l=t.vectorValue;for(const h of l)a.push(h)}else a.push(t.scalarValue);else if(t.args)for(const l of t.args){const h=this.evalExpression(l,e);if(h instanceof T){const f=h.data;for(let d=0;d<f.length;++d){let _=f[d];a.push(_)}}else if(h instanceof E){let f=h.value;a.push(f)}}if(t.type instanceof I&&t.type.format===null&&(t.type.format=I.f32),a.length===0){const l=new Array(r).fill(0);return new T(l,i).getSubData(this,t.postfix,e)}if(a.length===1)for(;a.length<r;)a.push(a[0]);return a.length<r?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new T(a.length>r?a.slice(0,r):a,i).getSubData(this,t.postfix,e)}_callConstructorMatrix(t,e){const i=this.getTypeInfo(t.type),s=t.type.getTypeName(),r=Zt[s];if(r===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${t.line}`),null;const a=[];if(t instanceof Nt)if(t.isVector){const l=t.vectorValue;for(const h of l)a.push(h)}else a.push(t.scalarValue);else if(t.args)for(const l of t.args){const h=this.evalExpression(l,e);h instanceof T?a.push(...h.data):h instanceof E?a.push(h.value):h instanceof q&&a.push(...h.data)}if(i instanceof yn&&i.format===null&&(i.format=this.getTypeInfo("f32")),a.length===0){const l=new Array(r[2]).fill(0);return new q(l,i).getSubData(this,t.postfix,e)}return a.length!==r[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new q(a,i).getSubData(this,t.postfix,e)}}$t._breakObj=new le(new oe("BREAK",null),null),$t._continueObj=new le(new oe("CONTINUE",null),null),$t._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class $v{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class jv{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new $v,this._exec=new $t,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;e.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,r=i.countNode;if(r instanceof ee){const a=r.name,l=this._context.constants.get(a);if(l)try{const h=l.constEvaluate(this._exec);s.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of e)i.search(s=>{s instanceof fh||s instanceof Po?s.type=this._forwardType(s.type):s instanceof Oi?s.format=this._forwardType(s.format):s instanceof Le||s instanceof Mi||s instanceof Cs?s.type=this._forwardType(s.type):s instanceof Li?s.returnType=this._forwardType(s.returnType):s instanceof uh&&(s.type=this._forwardType(s.type))});return e}_forwardType(t){if(t instanceof hh){const e=this._getType(t.name);if(e)return e}else t instanceof Po?t.type=this._forwardType(t.type):t instanceof Oi&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const e=new Nv(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,e){return t.line=e??this._currentLine,t}_error(t,e){return{token:t,message:e,toString:()=>`${e}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==b.eof}_match(t){if(t instanceof P)return!!this._check(t)&&(this._advance(),!0);for(let e=0,i=t.length;e<i;++e){const s=t[e];if(this._check(s))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),`${e}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const i=e.type;let s=!1;for(const r of t){if(i===r)return!0;r===b.tokens.name&&(s=!0)}if(s){const r=b.tokens.name.rule.exec(e.lexeme);if(r&&r.index==0&&r[0]==e.lexeme)return!0}return!1}if(e.type===t)return!0;if(t===b.tokens.name){const i=b.tokens.name.rule.exec(e.lexeme);return i&&i.index==0&&i[0]==e.lexeme}return!1}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(b.tokens.semicolon)&&!this._isAtEnd(););if(this._match(b.keywords.alias)){const e=this._type_alias();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(b.keywords.diagnostic)){const e=this._diagnostic();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(b.keywords.requires)){const e=this._requires_directive();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(b.keywords.enable)){const e=this._enable_directive();return this._consume(b.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const t=this._attribute();if(this._check(b.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(b.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(b.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(b.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(b.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([e]),e}if(this._check(b.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}if(this._check(b.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),this._exec.reflection.updateAST([e]),e}return null}_function_decl(){if(!this._match(b.keywords.fn))return null;const t=this._currentLine,e=this._consume(b.tokens.ident,"Expected function name.").toString();this._consume(b.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(b.tokens.paren_right))do{if(this._check(b.tokens.paren_right))break;const l=this._attribute(),h=this._consume(b.tokens.name,"Expected argument name.").toString();this._consume(b.tokens.colon,"Expected ':' for argument type.");const f=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=f,i.push(this._updateNode(new uh(h,d,l))))}while(this._match(b.tokens.comma));this._consume(b.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(b.tokens.arrow)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}const r=this._compound_statement(),a=this._currentLine;return this._updateNode(new Li(e,i,s,r,t,a),t)}_compound_statement(){const t=[];for(this._consume(b.tokens.brace_left,"Expected '{' for block.");!this._check(b.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(b.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(b.tokens.semicolon)&&!this._isAtEnd(););if(this._check(b.tokens.attr)&&this._attribute(),this._check(b.keywords.if))return this._if_statement();if(this._check(b.keywords.switch))return this._switch_statement();if(this._check(b.keywords.loop))return this._loop_statement();if(this._check(b.keywords.for))return this._for_statement();if(this._check(b.keywords.while))return this._while_statement();if(this._check(b.keywords.continuing))return this._continuing_statement();if(this._check(b.keywords.static_assert))return this._static_assert_statement();if(this._check(b.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(b.keywords.return))t=this._return_statement();else if(this._check([b.keywords.var,b.keywords.let,b.keywords.const]))t=this._variable_statement();else if(this._match(b.keywords.discard))t=this._updateNode(new Mv);else if(this._match(b.keywords.break)){const e=this._updateNode(new If);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];e.loopId=i.id}t=e,this._check(b.keywords.if)&&(this._advance(),e.condition=this._optional_paren_expression())}else if(this._match(b.keywords.continue)){const e=this._updateNode(new Cf);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${e.line}`);{const i=this._currentLoop[this._currentLoop.length-1];e.loopId=i.id}t=e}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(b.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(b.keywords.static_assert))return null;const t=this._currentLine,e=this._optional_paren_expression();return this._updateNode(new Pv(e),t)}_while_statement(){if(!this._match(b.keywords.while))return null;const t=this._updateNode(new bf(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(b.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(b.keywords.continuing))return null;const e=this._currentLine,i=this._compound_statement();return this._updateNode(new ua(i,t),e)}_for_statement(){if(!this._match(b.keywords.for))return null;this._consume(b.tokens.paren_left,"Expected '('.");const t=this._updateNode(new wf(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(b.tokens.semicolon)?null:this._for_init(),this._consume(b.tokens.semicolon,"Expected ';'."),t.condition=this._check(b.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(b.tokens.semicolon,"Expected ';'."),t.increment=this._check(b.tokens.paren_right)?null:this._for_increment(),this._consume(b.tokens.paren_right,"Expected ')'."),this._check(b.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(b.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(b.tokens.equal)&&(e=this._short_circuit_or_expression()),this._updateNode(new Le(t.name,t.type,t.storage,t.access,e),t.line)}if(this._match(b.keywords.let)){const t=this._currentLine,e=this._consume(b.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(b.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(b.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Mi(e,i,null,null,s),t)}if(this._match(b.keywords.const)){const t=this._currentLine,e=this._consume(b.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(b.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(b.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof Nt&&(i=s.type),this._updateNode(new Cs(e,i,null,null,s),t)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(b.increment_operators))return this._current=t,null;const i=this._consume(b.increment_operators,"Expected increment operator");return this._updateNode(new Tf(i.type===b.tokens.plus_plus?zn.increment:zn.decrement,e))}_assignment_statement(){let t=null;const e=this._currentLine;if(this._check(b.tokens.brace_right))return null;let i=this._match(b.tokens.underscore);if(i||(t=this._unary_expression()),!i&&t==null)return null;const s=this._consume(b.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return this._updateNode(new xf(Ai.parse(s.lexeme),t,r),e)}_func_call_statement(){if(!this._check(b.tokens.ident))return null;const t=this._currentLine,e=this._current,i=this._consume(b.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=e,null):this._updateNode(new Ka(i.lexeme,s),t)}_loop_statement(){if(!this._match(b.keywords.loop))return null;this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new Af([],null));this._currentLoop.push(t);let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let i of e)t.body.push(i);else t.body.push(e);if(e instanceof ua){t.continuing=e;break}e=this._statement()}return this._currentLoop.pop(),this._consume(b.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(b.keywords.switch))return null;const t=this._updateNode(new Sf(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(b.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let e=!1;for(;this._check([b.keywords.default,b.keywords.case]);){if(this._match(b.keywords.case)){const i=this._case_selectors();for(const r of i)if(r instanceof Ms){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");e=!0;break}this._match(b.tokens.colon),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(b.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new Df(i,s)))}if(this._match(b.keywords.default)){if(e)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(b.tokens.colon),this._check(b.tokens.attr)&&this._attribute(),this._consume(b.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(b.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new Bf(i)))}}return t}_case_selectors(){const t=[];for(this._match(b.keywords.default)?t.push(this._updateNode(new Ms)):t.push(this._shift_expression());this._match(b.tokens.comma);)this._match(b.keywords.default)?t.push(this._updateNode(new Ms)):t.push(this._shift_expression());return t}_case_body(){if(this._match(b.keywords.fallthrough))return this._consume(b.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(b.keywords.if))return null;const t=this._currentLine,e=this._optional_paren_expression();this._check(b.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(b.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let r=null;return this._match(b.keywords.else)&&(this._check(b.tokens.attr)&&this._attribute(),r=this._compound_statement()),this._updateNode(new Ef(e,i,s,r),t)}_match_elseif(){return this._tokens[this._current].type===b.keywords.else&&this._tokens[this._current+1].type===b.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const e=this._optional_paren_expression(),i=this._compound_statement();return t.push(this._updateNode(new Ov(e,i))),this._match_elseif()&&(this._check(b.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(b.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new Rf(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(b.tokens.or_or);)t=this._updateNode(new pe(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(b.tokens.and_and);)t=this._updateNode(new pe(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(b.tokens.or);)t=this._updateNode(new pe(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(b.tokens.xor);)t=this._updateNode(new pe(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(b.tokens.and);)t=this._updateNode(new pe(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([b.tokens.equal_equal,b.tokens.not_equal])?this._updateNode(new pe(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([b.tokens.less_than,b.tokens.greater_than,b.tokens.less_than_equal,b.tokens.greater_than_equal]);)t=this._updateNode(new pe(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([b.tokens.shift_left,b.tokens.shift_right]);)t=this._updateNode(new pe(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([b.tokens.plus,b.tokens.minus]);)t=this._updateNode(new pe(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([b.tokens.star,b.tokens.forward_slash,b.tokens.modulo]);)t=this._updateNode(new pe(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([b.tokens.minus,b.tokens.bang,b.tokens.tilde,b.tokens.star,b.tokens.and])?this._updateNode(new Ot(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(b.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(b.tokens.bracket_right,"Expected ']'.");const e=this._updateNode(new Kn(t)),i=this._postfix_expression();return i&&(e.postfix=i),e}if(this._match(b.tokens.period)){const t=this._consume(b.tokens.name,"Expected member name."),e=this._postfix_expression(),i=this._updateNode(new vn(t.lexeme));return e&&(i.postfix=e),i}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const e=this._getStruct(t);if(e!==null)return e;switch(t){case"void":return U.void;case"bool":return U.bool;case"i32":return U.i32;case"u32":return U.u32;case"f32":return U.f32;case"f16":return U.f16;case"vec2f":return I.vec2f;case"vec3f":return I.vec3f;case"vec4f":return I.vec4f;case"vec2i":return I.vec2i;case"vec3i":return I.vec3i;case"vec4i":return I.vec4i;case"vec2u":return I.vec2u;case"vec3u":return I.vec3u;case"vec4u":return I.vec4u;case"vec2h":return I.vec2h;case"vec3h":return I.vec3h;case"vec4h":return I.vec4h;case"mat2x2f":return I.mat2x2f;case"mat2x3f":return I.mat2x3f;case"mat2x4f":return I.mat2x4f;case"mat3x2f":return I.mat3x2f;case"mat3x3f":return I.mat3x3f;case"mat3x4f":return I.mat3x4f;case"mat4x2f":return I.mat4x2f;case"mat4x3f":return I.mat4x3f;case"mat4x4f":return I.mat4x4f;case"mat2x2h":return I.mat2x2h;case"mat2x3h":return I.mat2x3h;case"mat2x4h":return I.mat2x4h;case"mat3x2h":return I.mat3x2h;case"mat3x3h":return I.mat3x3h;case"mat3x4h":return I.mat3x4h;case"mat4x2h":return I.mat4x2h;case"mat4x3h":return I.mat4x3h;case"mat4x4h":return I.mat4x4h;case"mat2x2i":return I.mat2x2i;case"mat2x3i":return I.mat2x3i;case"mat2x4i":return I.mat2x4i;case"mat3x2i":return I.mat3x2i;case"mat3x3i":return I.mat3x3i;case"mat3x4i":return I.mat3x4i;case"mat4x2i":return I.mat4x2i;case"mat4x3i":return I.mat4x3i;case"mat4x4i":return I.mat4x4i;case"mat2x2u":return I.mat2x2u;case"mat2x3u":return I.mat2x3u;case"mat2x4u":return I.mat2x4u;case"mat3x2u":return I.mat3x2u;case"mat3x3u":return I.mat3x3u;case"mat3x4u":return I.mat3x4u;case"mat4x2u":return I.mat4x2u;case"mat4x3u":return I.mat4x3u;case"mat4x4u":return I.mat4x4u}return null}_validateTypeRange(t,e){if(e.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(e.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(b.tokens.ident)){const i=this._previous().toString();if(this._check(b.tokens.paren_left)){const s=this._argument_expression_list(),r=this._getType(i);return r!==null?this._updateNode(new Se(r,s)):this._updateNode(new Qa(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new Mf(i,s.value))}return this._updateNode(new ee(i))}if(this._match(b.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?U.i32:i.endsWith("u")||i.endsWith("U")?U.u32:U.x32;const r=parseInt(i);return this._validateTypeRange(r,s),this._updateNode(new Nt(new E(r,this._exec.getTypeInfo(s)),s))}if(this._match(b.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,U.u32),this._updateNode(new Nt(new E(i,this._exec.getTypeInfo(U.u32)),U.u32))}if(this._match([b.tokens.decimal_float_literal,b.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const r=parseFloat(i);this._validateTypeRange(r,s?U.f16:U.f32);const a=s?U.f16:U.f32;return this._updateNode(new Nt(new E(r,this._exec.getTypeInfo(a)),a))}if(this._match([b.keywords.true,b.keywords.false])){let i=this._previous().toString()===b.keywords.true.rule;return this._updateNode(new Nt(new E(i?1:0,this._exec.getTypeInfo(U.bool)),U.bool))}if(this._check(b.tokens.paren_left))return this._paren_expression();if(this._match(b.keywords.bitcast)){this._consume(b.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(b.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new Of(i,s))}const t=this._type_decl(),e=this._argument_expression_list();return this._updateNode(new Se(t,e))}_argument_expression_list(){if(!this._match(b.tokens.paren_left))return null;const t=[];do{if(this._check(b.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(b.tokens.comma));return this._consume(b.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(b.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(b.tokens.paren_right),t}_paren_expression(){this._consume(b.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(b.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(b.keywords.struct))return null;const t=this._currentLine,e=this._consume(b.tokens.ident,"Expected name for struct.").toString();this._consume(b.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(b.tokens.brace_right);){const a=this._attribute(),l=this._consume(b.tokens.name,"Expected variable name.").toString();this._consume(b.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=h),this._check(b.tokens.brace_right)?this._match(b.tokens.comma):this._consume(b.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new fh(l,f,a)))}this._consume(b.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,r=this._updateNode(new Be(e,i,t,s),t);return this._context.structs.set(e,r),r}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(b.tokens.equal)){const e=this._const_expression();t.value=e}if(t.type!==null&&t.value instanceof Nt){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof Nt&&(t.type=t.value.type.name==="x32"?U.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(b.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(b.keywords.const))return null;const e=this._consume(b.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(b.tokens.colon)){const h=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=h)}let r=null;this._consume(b.tokens.equal,"const declarations require an assignment");const a=this._short_circuit_or_expression();try{let h=[U.f32],f=a.constEvaluate(this._exec,h);f instanceof E&&this._validateTypeRange(f.value,h[0]),h[0]instanceof I&&h[0].format===null&&f.typeInfo instanceof yn&&f.typeInfo.format!==null&&(f.typeInfo.format.name==="f16"?h[0].format=U.f16:f.typeInfo.format.name==="f32"?h[0].format=U.f32:f.typeInfo.format.name==="i32"?h[0].format=U.i32:f.typeInfo.format.name==="u32"?h[0].format=U.u32:f.typeInfo.format.name==="bool"?h[0].format=U.bool:console.error(`TODO: impelement template format type ${f.typeInfo.format.name}`)),r=this._updateNode(new Nt(f,h[0])),this._exec.context.setVariable(e.toString(),f)}catch{r=a}if(s!==null&&r instanceof Nt){if(r.type.name!=="x32"&&s.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${s.name}. Line:${this._currentLine}`);r.type=s,r.isScalar&&this._validateTypeRange(r.scalarValue,r.type)}else s===null&&r instanceof Nt&&(s=(t=r==null?void 0:r.type)!==null&&t!==void 0?t:U.f32,s===U.x32&&(s=U.i32));const l=this._updateNode(new Cs(e.toString(),s,"","",r),i);return this._context.constants.set(l.name,l),l}_global_let_decl(){if(!this._match(b.keywords.let))return null;const t=this._currentLine,e=this._consume(b.tokens.name,"Expected variable name");let i=null;if(this._match(b.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let s=null;if(this._match(b.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof Nt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof Nt&&(i=s.type.name==="x32"?U.i32:s.type);return s instanceof Nt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new Mi(e.toString(),i,"","",s),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(b.keywords.var))return null;const t=this._currentLine;let e="",i="";this._match(b.tokens.less_than)&&(e=this._consume(b.storage_class,"Expected storage_class.").toString(),this._match(b.tokens.comma)&&(i=this._consume(b.access_mode,"Expected access_mode.").toString()),this._consume(b.tokens.greater_than,"Expected '>'."));const s=this._consume(b.tokens.name,"Expected variable name");let r=null;if(this._match(b.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}return this._updateNode(new Le(s.toString(),r,e,i,null),t)}_override_decl(){if(!this._match(b.keywords.override))return null;const t=this._consume(b.tokens.name,"Expected variable name");let e=null;if(this._match(b.tokens.colon)){const i=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=i)}return this._updateNode(new qa(t.toString(),e,null))}_diagnostic(){this._consume(b.tokens.paren_left,"Expected '('");const t=this._consume(b.tokens.ident,"Expected severity control name.");this._consume(b.tokens.comma,"Expected ','");let e=this._consume(b.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(b.tokens.period)&&(e+=`.${this._consume(b.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(b.tokens.paren_right,"Expected ')'"),this._updateNode(new Pf(t.toString(),e))}_enable_directive(){const t=this._consume(b.tokens.ident,"identity expected.");return this._updateNode(new Iv(t.toString()))}_requires_directive(){const t=[this._consume(b.tokens.ident,"identity expected.").toString()];for(;this._match(b.tokens.comma);){const e=this._consume(b.tokens.ident,"identity expected.");t.push(e.toString())}return this._updateNode(new Cv(t))}_type_alias(){const t=this._consume(b.tokens.ident,"identity expected.");this._consume(b.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const i=this._updateNode(new Ja(t.toString(),e));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([b.tokens.ident,...b.texel_format,b.keywords.bool,b.keywords.f32,b.keywords.i32,b.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new hh(i));return this._forwardTypeCount++,s}return this._updateNode(new U(i))}let t=this._texture_sampler_types();if(t)return t;if(this._check(b.template_types)){let i=this._advance().toString(),s=null,r=null;return this._match(b.tokens.less_than)&&(s=this._type_decl(),r=null,this._match(b.tokens.comma)&&(r=this._consume(b.access_mode,"Expected access_mode for pointer").toString()),this._consume(b.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new I(i,s,r))}if(this._match(b.keywords.ptr)){let i=this._previous().toString();this._consume(b.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(b.storage_class,"Expected storage_class for pointer");this._consume(b.tokens.comma,"Expected ',' for pointer.");const r=this._type_decl();let a=null;return this._match(b.tokens.comma)&&(a=this._consume(b.access_mode,"Expected access_mode for pointer").toString()),this._consume(b.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Po(i,s.toString(),r,a))}const e=this._attribute();if(this._match(b.keywords.array)){let i=null,s=-1;const r=this._previous();let a=null;if(this._match(b.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(b.tokens.comma)){a=this._shift_expression();try{h=a.constEvaluate(this._exec).toString(),a=null}catch{h="1"}}this._consume(b.tokens.greater_than,"Expected '>' for array."),s=h?parseInt(h):0}const l=this._updateNode(new Oi(r.toString(),e,i,s));return a&&this._deferArrayCountEval.push({arrayType:l,countNode:a}),l}return null}_texture_sampler_types(){if(this._match(b.sampler_type))return this._updateNode(new Si(this._previous().toString(),null,null));if(this._match(b.depth_texture_type))return this._updateNode(new Si(this._previous().toString(),null,null));if(this._match(b.sampled_texture_type)||this._match(b.multisampled_texture_type)){const t=this._previous();this._consume(b.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(b.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Si(t.toString(),e,null))}if(this._match(b.storage_texture_type)){const t=this._previous();this._consume(b.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(b.texel_format,"Invalid texel format.").toString();this._consume(b.tokens.comma,"Expected ',' after texel format.");const i=this._consume(b.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(b.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Si(t.toString(),e,i))}return null}_attribute(){let t=[];for(;this._match(b.tokens.attr);){const e=this._consume(b.attribute_name,"Expected attribute name"),i=this._updateNode(new Ff(e.toString(),null));if(this._match(b.tokens.paren_left)){if(i.value=this._consume(b.literal_or_ident,"Expected attribute value").toString(),this._check(b.tokens.comma)){this._advance();do{const s=this._consume(b.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(b.tokens.comma))}this._consume(b.tokens.paren_right,"Expected ')'")}t.push(i)}return t.length==0?null:t}}class Xv extends Re{constructor(t){super(),t&&this.update(t)}update(t){const e=new jv().parse(t);this.updateAST(e)}}function Zv(n){var r;const t={attributes:[],bindings:[]};let e;try{e=Yv(n)}catch(a){return z.error(a.message)(),t}for(const a of e.uniforms){const l=[];for(const h of((r=a.type)==null?void 0:r.members)||[])l.push({name:h.name,type:_h(h.type)});t.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:l})}for(const a of e.textures)t.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of e.samplers)t.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const i=e.entry.vertex[0],s=(i==null?void 0:i.inputs.length)||0;for(let a=0;a<s;a++){const l=i.inputs[a];if(l.locationType==="location"){const h=_h(l.type);t.attributes.push({name:l.name,location:Number(l.location),type:h})}}return t}function _h(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function Yv(n){try{return new Xv(n)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw typeof t=="object"&&(t!=null&&t.message)&&(e+=`: ${t.message} `),typeof t=="object"&&(t!=null&&t.token)&&(e+=t.token.line||""),new Error(e,{cause:t})}}const qv={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...qv}};const ae=globalThis.mathgl.config;function Kv(n,{precision:t=ae.precision}={}){return n=Jv(n),`${parseFloat(n.toPrecision(t))}`}function Jn(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Je(n,t,e){return Gv(n,i=>Math.max(t,Math.min(e,i)))}function Gs(n,t,e){return Jn(n)?n.map((i,s)=>Gs(i,t[s],e)):e*t+(1-e)*n}function Ui(n,t,e){const i=ae.EPSILON;try{if(n===t)return!0;if(Jn(n)&&Jn(t)){if(n.length!==t.length)return!1;for(let s=0;s<n.length;++s)if(!Ui(n[s],t[s]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=ae.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{ae.EPSILON=i}}function Jv(n){return Math.round(n/ae.EPSILON)*ae.EPSILON}function Qv(n){return n.clone?n.clone():new Array(n.length)}function Gv(n,t,e){if(Jn(n)){const i=n;e=e||Qv(i);for(let s=0;s<e.length&&s<i.length;++s){const r=typeof n=="number"?n:n[s];e[s]=t(r,s,e)}return e}return t(n)}class Lf extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Jn(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ae)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+Kv(this[i],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Ui(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(i===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const r=t[s],a=typeof e=="number"?e:e[s];this[s]=r+i*(a-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=e[i];return this.check()}subtract(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=e[i];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(ae.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function tb(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function te(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Co(n,t,e=""){if(ae.debug&&!tb(n,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return n}function gh(n,t){if(!n)throw new Error(`math.gl assertion ${t}`)}class eb extends Lf{get x(){return this[0]}set x(t){this[0]=te(t)}get y(){return this[1]}set y(t){this[1]=te(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-t[i];e+=s*s}return te(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return te(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=e[i];return this.check()}divide(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return gh(t>=0&&t<this.ELEMENTS,"index is out of range"),te(this[t])}setComponent(t,e){return gh(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const Os=1e-6;let Qn=typeof Float32Array<"u"?Float32Array:Array;function nb(){const n=new Qn(2);return Qn!=Float32Array&&(n[0]=0,n[1]=0),n}function mh(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function ib(n,t){return n[0]=-t[0],n[1]=-t[1],n}function Uf(n,t,e,i){const s=t[0],r=t[1];return n[0]=s+i*(e[0]-s),n[1]=r+i*(e[1]-r),n}function sb(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[4]*s+e[12],n[1]=e[1]*i+e[5]*s+e[13],n}(function(){const n=nb();return function(t,e,i,s,r,a){let l,h;for(e||(e=2),i||(i=0),s?h=Math.min(s*e+i,t.length):h=t.length,l=i;l<h;l+=e)n[0]=t[l],n[1]=t[l+1],r(n,n,a),t[l]=n[0],t[l+1]=n[1];return t}})();function rb(n,t,e){const i=t[0],s=t[1],r=e[3]*i+e[7]*s||1;return n[0]=(e[0]*i+e[4]*s)/r,n[1]=(e[1]*i+e[5]*s)/r,n}function Vf(n,t,e){const i=t[0],s=t[1],r=t[2],a=e[3]*i+e[7]*s+e[11]*r||1;return n[0]=(e[0]*i+e[4]*s+e[8]*r)/a,n[1]=(e[1]*i+e[5]*s+e[9]*r)/a,n[2]=(e[2]*i+e[6]*s+e[10]*r)/a,n}function ob(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s,n[1]=e[1]*i+e[3]*s,n[2]=t[2],n}function ab(){const n=new Qn(3);return Qn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function cb(n,t,e){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function lb(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n}function hb(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ub(n,t,e){const i=t[0],s=t[1],r=t[2],a=e[0],l=e[1],h=e[2];return n[0]=s*h-r*l,n[1]=r*a-i*h,n[2]=i*l-s*a,n}function zf(n,t,e){const i=t[0],s=t[1],r=t[2];let a=e[3]*i+e[7]*s+e[11]*r+e[15];return a=a||1,n[0]=(e[0]*i+e[4]*s+e[8]*r+e[12])/a,n[1]=(e[1]*i+e[5]*s+e[9]*r+e[13])/a,n[2]=(e[2]*i+e[6]*s+e[10]*r+e[14])/a,n}function fb(n,t,e){const i=t[0],s=t[1],r=t[2];return n[0]=i*e[0]+s*e[3]+r*e[6],n[1]=i*e[1]+s*e[4]+r*e[7],n[2]=i*e[2]+s*e[5]+r*e[8],n}function db(n,t,e){const i=e[0],s=e[1],r=e[2],a=e[3],l=t[0],h=t[1],f=t[2];let d=s*f-r*h,_=r*l-i*f,m=i*h-s*l,w=s*m-r*_,A=r*d-i*m,S=i*_-s*d;const k=a*2;return d*=k,_*=k,m*=k,w*=2,A*=2,S*=2,n[0]=l+d+w,n[1]=h+_+A,n[2]=f+m+S,n}function pb(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function _b(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function gb(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function mb(n,t){const e=n[0],i=n[1],s=n[2],r=t[0],a=t[1],l=t[2],h=Math.sqrt((e*e+i*i+s*s)*(r*r+a*a+l*l)),f=h&&hb(n,t)/h;return Math.acos(Math.min(Math.max(f,-1),1))}const yb=cb;(function(){const n=ab();return function(t,e,i,s,r,a){let l,h;for(e||(e=3),i||(i=0),s?h=Math.min(s*e+i,t.length):h=t.length,l=i;l<h;l+=e)n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2],r(n,n,a),t[l]=n[0],t[l+1]=n[1],t[l+2]=n[2];return t}})();const Mo=[0,0,0];let Ts;class Pe extends eb{static get ZERO(){return Ts||(Ts=new Pe(0,0,0),Object.freeze(Ts)),Ts}constructor(t=0,e=0,i=0){super(-0,-0,-0),arguments.length===1&&Jn(t)?this.copy(t):(ae.debug&&(te(t),te(e),te(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ae.debug&&(te(t.x),te(t.y),te(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=te(t)}angle(t){return mb(this,t)}cross(t){return ub(this,this,t),this.check()}rotateX({radians:t,origin:e=Mo}){return pb(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Mo}){return _b(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Mo}){return gb(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return zf(this,this,t),this.check()}transformAsVector(t){return Vf(this,this,t),this.check()}transformByMatrix3(t){return fb(this,this,t),this.check()}transformByMatrix2(t){return ob(this,this,t),this.check()}transformByQuaternion(t){return db(this,this,t),this.check()}}class vb extends Lf{toString(){let t="[";if(ae.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=` ${this[i*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=te(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[i+s];return e}setColumn(t,e){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=e[s];return this}}function bb(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function wb(n,t){if(n===t){const e=t[1],i=t[2],s=t[3],r=t[6],a=t[7],l=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[6]=t[9],n[7]=t[13],n[8]=i,n[9]=r,n[11]=t[14],n[12]=s,n[13]=a,n[14]=l}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n}function da(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],a=t[4],l=t[5],h=t[6],f=t[7],d=t[8],_=t[9],m=t[10],w=t[11],A=t[12],S=t[13],k=t[14],B=t[15],F=e*l-i*a,M=e*h-s*a,D=e*f-r*a,H=i*h-s*l,W=i*f-r*l,at=s*f-r*h,Y=d*S-_*A,J=d*k-m*A,rt=d*B-w*A,X=_*k-m*S,ot=_*B-w*S,Bt=m*B-w*k;let tt=F*Bt-M*ot+D*X+H*rt-W*J+at*Y;return tt?(tt=1/tt,n[0]=(l*Bt-h*ot+f*X)*tt,n[1]=(s*ot-i*Bt-r*X)*tt,n[2]=(S*at-k*W+B*H)*tt,n[3]=(m*W-_*at-w*H)*tt,n[4]=(h*rt-a*Bt-f*J)*tt,n[5]=(e*Bt-s*rt+r*J)*tt,n[6]=(k*D-A*at-B*M)*tt,n[7]=(d*at-m*D+w*M)*tt,n[8]=(a*ot-l*rt+f*Y)*tt,n[9]=(i*rt-e*ot-r*Y)*tt,n[10]=(A*W-S*D+B*F)*tt,n[11]=(_*D-d*W-w*F)*tt,n[12]=(l*J-a*X-h*Y)*tt,n[13]=(e*X-i*J+s*Y)*tt,n[14]=(S*M-A*H-k*F)*tt,n[15]=(d*H-_*M+m*F)*tt,n):null}function Tb(n){const t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],a=n[5],l=n[6],h=n[7],f=n[8],d=n[9],_=n[10],m=n[11],w=n[12],A=n[13],S=n[14],k=n[15],B=t*a-e*r,F=t*l-i*r,M=e*l-i*a,D=f*A-d*w,H=f*S-_*w,W=d*S-_*A,at=t*W-e*H+i*D,Y=r*W-a*H+l*D,J=f*M-d*F+_*B,rt=w*M-A*F+S*B;return h*at-s*Y+k*J-m*rt}function pn(n,t,e){const i=t[0],s=t[1],r=t[2],a=t[3],l=t[4],h=t[5],f=t[6],d=t[7],_=t[8],m=t[9],w=t[10],A=t[11],S=t[12],k=t[13],B=t[14],F=t[15];let M=e[0],D=e[1],H=e[2],W=e[3];return n[0]=M*i+D*l+H*_+W*S,n[1]=M*s+D*h+H*m+W*k,n[2]=M*r+D*f+H*w+W*B,n[3]=M*a+D*d+H*A+W*F,M=e[4],D=e[5],H=e[6],W=e[7],n[4]=M*i+D*l+H*_+W*S,n[5]=M*s+D*h+H*m+W*k,n[6]=M*r+D*f+H*w+W*B,n[7]=M*a+D*d+H*A+W*F,M=e[8],D=e[9],H=e[10],W=e[11],n[8]=M*i+D*l+H*_+W*S,n[9]=M*s+D*h+H*m+W*k,n[10]=M*r+D*f+H*w+W*B,n[11]=M*a+D*d+H*A+W*F,M=e[12],D=e[13],H=e[14],W=e[15],n[12]=M*i+D*l+H*_+W*S,n[13]=M*s+D*h+H*m+W*k,n[14]=M*r+D*f+H*w+W*B,n[15]=M*a+D*d+H*A+W*F,n}function tr(n,t,e){const i=e[0],s=e[1],r=e[2];let a,l,h,f,d,_,m,w,A,S,k,B;return t===n?(n[12]=t[0]*i+t[4]*s+t[8]*r+t[12],n[13]=t[1]*i+t[5]*s+t[9]*r+t[13],n[14]=t[2]*i+t[6]*s+t[10]*r+t[14],n[15]=t[3]*i+t[7]*s+t[11]*r+t[15]):(a=t[0],l=t[1],h=t[2],f=t[3],d=t[4],_=t[5],m=t[6],w=t[7],A=t[8],S=t[9],k=t[10],B=t[11],n[0]=a,n[1]=l,n[2]=h,n[3]=f,n[4]=d,n[5]=_,n[6]=m,n[7]=w,n[8]=A,n[9]=S,n[10]=k,n[11]=B,n[12]=a*i+d*s+A*r+t[12],n[13]=l*i+_*s+S*r+t[13],n[14]=h*i+m*s+k*r+t[14],n[15]=f*i+w*s+B*r+t[15]),n}function nc(n,t,e){const i=e[0],s=e[1],r=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*s,n[5]=t[5]*s,n[6]=t[6]*s,n[7]=t[7]*s,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function xb(n,t,e,i){let s=i[0],r=i[1],a=i[2],l=Math.sqrt(s*s+r*r+a*a),h,f,d,_,m,w,A,S,k,B,F,M,D,H,W,at,Y,J,rt,X,ot,Bt,tt,ye;return l<Os?null:(l=1/l,s*=l,r*=l,a*=l,f=Math.sin(e),h=Math.cos(e),d=1-h,_=t[0],m=t[1],w=t[2],A=t[3],S=t[4],k=t[5],B=t[6],F=t[7],M=t[8],D=t[9],H=t[10],W=t[11],at=s*s*d+h,Y=r*s*d+a*f,J=a*s*d-r*f,rt=s*r*d-a*f,X=r*r*d+h,ot=a*r*d+s*f,Bt=s*a*d+r*f,tt=r*a*d-s*f,ye=a*a*d+h,n[0]=_*at+S*Y+M*J,n[1]=m*at+k*Y+D*J,n[2]=w*at+B*Y+H*J,n[3]=A*at+F*Y+W*J,n[4]=_*rt+S*X+M*ot,n[5]=m*rt+k*X+D*ot,n[6]=w*rt+B*X+H*ot,n[7]=A*rt+F*X+W*ot,n[8]=_*Bt+S*tt+M*ye,n[9]=m*Bt+k*tt+D*ye,n[10]=w*Bt+B*tt+H*ye,n[11]=A*Bt+F*tt+W*ye,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)}function Wf(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[4],a=t[5],l=t[6],h=t[7],f=t[8],d=t[9],_=t[10],m=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=r*s+f*i,n[5]=a*s+d*i,n[6]=l*s+_*i,n[7]=h*s+m*i,n[8]=f*s-r*i,n[9]=d*s-a*i,n[10]=_*s-l*i,n[11]=m*s-h*i,n}function Ab(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],a=t[1],l=t[2],h=t[3],f=t[8],d=t[9],_=t[10],m=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s-f*i,n[1]=a*s-d*i,n[2]=l*s-_*i,n[3]=h*s-m*i,n[8]=r*i+f*s,n[9]=a*i+d*s,n[10]=l*i+_*s,n[11]=h*i+m*s,n}function Hf(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],a=t[1],l=t[2],h=t[3],f=t[4],d=t[5],_=t[6],m=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s+f*i,n[1]=a*s+d*i,n[2]=l*s+_*i,n[3]=h*s+m*i,n[4]=f*s-r*i,n[5]=d*s-a*i,n[6]=_*s-l*i,n[7]=m*s-h*i,n}function Sb(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],a=e+e,l=i+i,h=s+s,f=e*a,d=i*a,_=i*l,m=s*a,w=s*l,A=s*h,S=r*a,k=r*l,B=r*h;return n[0]=1-_-A,n[1]=d+B,n[2]=m-k,n[3]=0,n[4]=d-B,n[5]=1-f-A,n[6]=w+S,n[7]=0,n[8]=m+k,n[9]=w-S,n[10]=1-f-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Eb(n,t,e,i,s,r,a){const l=1/(e-t),h=1/(s-i),f=1/(r-a);return n[0]=r*2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*h,n[6]=0,n[7]=0,n[8]=(e+t)*l,n[9]=(s+i)*h,n[10]=(a+r)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*r*2*f,n[15]=0,n}function Rb(n,t,e,i,s){const r=1/Math.tan(t/2);if(n[0]=r/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const a=1/(i-s);n[10]=(s+i)*a,n[14]=2*s*i*a}else n[10]=-1,n[14]=-2*i;return n}const Pb=Rb;function Ib(n,t,e,i,s,r,a){const l=1/(t-e),h=1/(i-s),f=1/(r-a);return n[0]=-2*l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(t+e)*l,n[13]=(s+i)*h,n[14]=(a+r)*f,n[15]=1,n}const Cb=Ib;function Mb(n,t,e,i){let s,r,a,l,h,f,d,_,m,w;const A=t[0],S=t[1],k=t[2],B=i[0],F=i[1],M=i[2],D=e[0],H=e[1],W=e[2];return Math.abs(A-D)<Os&&Math.abs(S-H)<Os&&Math.abs(k-W)<Os?bb(n):(_=A-D,m=S-H,w=k-W,s=1/Math.sqrt(_*_+m*m+w*w),_*=s,m*=s,w*=s,r=F*w-M*m,a=M*_-B*w,l=B*m-F*_,s=Math.sqrt(r*r+a*a+l*l),s?(s=1/s,r*=s,a*=s,l*=s):(r=0,a=0,l=0),h=m*l-w*a,f=w*r-_*l,d=_*a-m*r,s=Math.sqrt(h*h+f*f+d*d),s?(s=1/s,h*=s,f*=s,d*=s):(h=0,f=0,d=0),n[0]=r,n[1]=h,n[2]=_,n[3]=0,n[4]=a,n[5]=f,n[6]=m,n[7]=0,n[8]=l,n[9]=d,n[10]=w,n[11]=0,n[12]=-(r*A+a*S+l*k),n[13]=-(h*A+f*S+d*k),n[14]=-(_*A+m*S+w*k),n[15]=1,n)}function Ob(){const n=new Qn(4);return Qn!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function kb(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function Zi(n,t,e){const i=t[0],s=t[1],r=t[2],a=t[3];return n[0]=e[0]*i+e[4]*s+e[8]*r+e[12]*a,n[1]=e[1]*i+e[5]*s+e[9]*r+e[13]*a,n[2]=e[2]*i+e[6]*s+e[10]*r+e[14]*a,n[3]=e[3]*i+e[7]*s+e[11]*r+e[15]*a,n}(function(){const n=Ob();return function(t,e,i,s,r,a){let l,h;for(e||(e=4),i||(i=0),s?h=Math.min(s*e+i,t.length):h=t.length,l=i;l<h;l+=e)n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2],n[3]=t[l+3],r(n,n,a),t[l]=n[0],t[l+1]=n[1],t[l+2]=n[2],t[l+3]=n[3];return t}})();var pa;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(pa||(pa={}));const Nb=45*Math.PI/180,Db=1,Oo=.1,ko=500,Bb=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ie extends vb{static get IDENTITY(){return Lb()}static get ZERO(){return Fb()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return pa}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,s,r,a,l,h,f,d,_,m,w,A,S,k){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=r,this[5]=a,this[6]=l,this[7]=h,this[8]=f,this[9]=d,this[10]=_,this[11]=m,this[12]=w,this[13]=A,this[14]=S,this[15]=k,this.check()}setRowMajor(t,e,i,s,r,a,l,h,f,d,_,m,w,A,S,k){return this[0]=t,this[1]=r,this[2]=f,this[3]=w,this[4]=e,this[5]=a,this[6]=d,this[7]=A,this[8]=i,this[9]=l,this[10]=_,this[11]=S,this[12]=s,this[13]=h,this[14]=m,this[15]=k,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Bb)}fromObject(t){return this.check()}fromQuaternion(t){return Sb(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:s,top:r,near:a=Oo,far:l=ko}=t;return l===1/0?Ub(this,e,i,s,r,a):Eb(this,e,i,s,r,a,l),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:s=[0,1,0]}=t;return Mb(this,e,i,s),this.check()}ortho(t){const{left:e,right:i,bottom:s,top:r,near:a=Oo,far:l=ko}=t;return Cb(this,e,i,s,r,a,l),this.check()}orthographic(t){const{fovy:e=Nb,aspect:i=Db,focalDistance:s=1,near:r=Oo,far:a=ko}=t;yh(e);const l=e/2,h=s*Math.tan(l),f=h*i;return this.ortho({left:-f,right:f,bottom:-h,top:h,near:r,far:a})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:s=.1,far:r=500}=t;return yh(e),Pb(this,e,i,s,r),this.check()}determinant(){return Tb(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],a=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*r,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*r,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],a=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*a,t[3]=this[4]*s,t[4]=this[5]*r,t[5]=this[6]*a,t[6]=this[8]*s,t[7]=this[9]*r,t[8]=this[10]*a,t}transpose(){return wb(this,this),this.check()}invert(){return da(this,this),this.check()}multiplyLeft(t){return pn(this,t,this),this.check()}multiplyRight(t){return pn(this,this,t),this.check()}rotateX(t){return Wf(this,this,t),this.check()}rotateY(t){return Ab(this,this,t),this.check()}rotateZ(t){return Hf(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return xb(this,this,t,e),this.check()}scale(t){return nc(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return tr(this,this,t),this.check()}transform(t,e){return t.length===4?(e=Zi(e||[-0,-0,-0,-0],t,this),Co(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let s;switch(i){case 2:s=sb(e||[-0,-0],t,this);break;case 3:s=zf(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Co(s,t.length),s}transformAsVector(t,e){let i;switch(t.length){case 2:i=rb(e||[-0,-0],t,this);break;case 3:i=Vf(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Co(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let xs,As;function Fb(){return xs||(xs=new Ie([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(xs)),xs}function Lb(){return As||(As=new Ie,Object.freeze(As)),As}function yh(n){if(n>Math.PI*2)throw Error("expected radians")}function Ub(n,t,e,i,s,r){const a=2*r/(e-t),l=2*r/(s-i),h=(e+t)/(e-t),f=(s+i)/(s-i),d=-1,_=-1,m=-2*r;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=l,n[6]=0,n[7]=0,n[8]=h,n[9]=f,n[10]=d,n[11]=_,n[12]=0,n[13]=0,n[14]=m,n[15]=0,n}function $f(n,t=[],e=0){const i=Math.fround(n),s=n-i;return t[e]=i,t[e+1]=s,t}function Vb(n){return n-Math.fround(n)}function zb(n){const t=new Float32Array(32);for(let e=0;e<4;++e)for(let i=0;i<4;++i){const s=e*4+i;$f(n[i*4+e],t,s*2)}return t}const Wb=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Hb={name:"fp32",vs:Wb},$b=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,jb={ONE:1},Xb={name:"fp64arithmetic",vs:$b,defaultUniforms:jb,uniformTypes:{ONE:"f32"},fp64ify:$f,fp64LowPart:Vb,fp64ifyMatrix4:zb},Zb=[0,1,1,1],Yb=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,qb=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,vh={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Zb},vs:Yb,fs:qb,getUniforms:Kb};function Kb(n={},t){const e={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)e.isHighlightActive=!1;else{e.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);e.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),e.highlightColor=i}return n.isActive!==void 0&&(e.isActive=!!n.isActive,e.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(e.useFloatColors=!!n.useFloatColors),e}const bh=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Jb={name:"layer",vs:bh,fs:bh,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Qb=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,jf="#define SMOOTH_EDGE_RADIUS 0.5",Gb=`${jf}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,tw=`${jf}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Xf={name:"geometry",source:Qb,vs:Gb,fs:tw},ew=25;var kt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(kt||(kt={}));var Dt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Dt||(Dt={}));var G;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(G||(G={}));const nw="compute",iw="auto",_a="manipulation",ks="none",ga="pan-x",ma="pan-y";function sw(n){if(n.includes(ks))return ks;const t=n.includes(ga),e=n.includes(ma);return t&&e?ks:t||e?t?ga:ma:n.includes(_a)?_a:iw}class rw{constructor(t,e){this.actions="",this.manager=t,this.set(e)}set(t){t===nw&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const e of this.manager.recognizers)e.options.enable&&(t=t.concat(e.getTouchAction()));return sw(t.join(" "))}}function er(n){return n.trim().split(/\s+/g)}function No(n,t,e){if(n)for(const i of er(t))n.addEventListener(i,e,!1)}function Do(n,t,e){if(n)for(const i of er(t))n.removeEventListener(i,e,!1)}function wh(n){return(n.ownerDocument||n).defaultView}function ow(n,t){let e=n;for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function Zf(n){const t=n.length;if(t===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let e=0,i=0,s=0;for(;s<t;)e+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(e/t),y:Math.round(i/t)}}function Th(n){const t=[];let e=0;for(;e<n.pointers.length;)t[e]={clientX:Math.round(n.pointers[e].clientX),clientY:Math.round(n.pointers[e].clientY)},e++;return{timeStamp:Date.now(),pointers:t,center:Zf(t),deltaX:n.deltaX,deltaY:n.deltaY}}function Yf(n,t){const e=t.x-n.x,i=t.y-n.y;return Math.sqrt(e*e+i*i)}function xh(n,t){const e=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.sqrt(e*e+i*i)}function aw(n,t){const e=t.x-n.x,i=t.y-n.y;return Math.atan2(i,e)*180/Math.PI}function Ah(n,t){const e=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.atan2(i,e)*180/Math.PI}function qf(n,t){return n===t?Dt.None:Math.abs(n)>=Math.abs(t)?n<0?Dt.Left:Dt.Right:t<0?Dt.Up:Dt.Down}function cw(n,t){const e=t.center;let i=n.offsetDelta,s=n.prevDelta;const r=n.prevInput;return(t.eventType===kt.Start||(r==null?void 0:r.eventType)===kt.End)&&(s=n.prevDelta={x:(r==null?void 0:r.deltaX)||0,y:(r==null?void 0:r.deltaY)||0},i=n.offsetDelta={x:e.x,y:e.y}),{deltaX:s.x+(e.x-i.x),deltaY:s.y+(e.y-i.y)}}function Kf(n,t,e){return{x:t/n||0,y:e/n||0}}function lw(n,t){return xh(t[0],t[1])/xh(n[0],n[1])}function hw(n,t){return Ah(t[1],t[0])-Ah(n[1],n[0])}function uw(n,t){const e=n.lastInterval||t,i=t.timeStamp-e.timeStamp;let s,r,a,l;if(t.eventType!==kt.Cancel&&(i>ew||e.velocity===void 0)){const h=t.deltaX-e.deltaX,f=t.deltaY-e.deltaY,d=Kf(i,h,f);r=d.x,a=d.y,s=Math.abs(d.x)>Math.abs(d.y)?d.x:d.y,l=qf(h,f),n.lastInterval=t}else s=e.velocity,r=e.velocityX,a=e.velocityY,l=e.direction;t.velocity=s,t.velocityX=r,t.velocityY=a,t.direction=l}function fw(n,t){const{session:e}=n,{pointers:i}=t,{length:s}=i;e.firstInput||(e.firstInput=Th(t)),s>1&&!e.firstMultiple?e.firstMultiple=Th(t):s===1&&(e.firstMultiple=!1);const{firstInput:r,firstMultiple:a}=e,l=a?a.center:r.center,h=t.center=Zf(i);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=aw(l,h),t.distance=Yf(l,h);const{deltaX:f,deltaY:d}=cw(e,t);t.deltaX=f,t.deltaY=d,t.offsetDirection=qf(t.deltaX,t.deltaY);const _=Kf(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=_.x,t.overallVelocityY=_.y,t.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,t.scale=a?lw(a.pointers,i):1,t.rotation=a?hw(a.pointers,i):0,t.maxPointers=e.prevInput?t.pointers.length>e.prevInput.maxPointers?t.pointers.length:e.prevInput.maxPointers:t.pointers.length;let m=n.element;return ow(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m,uw(e,t),t}function dw(n,t,e){const i=e.pointers.length,s=e.changedPointers.length,r=t&kt.Start&&i-s===0,a=t&(kt.End|kt.Cancel)&&i-s===0;e.isFirst=!!r,e.isFinal=!!a,r&&(n.session={}),e.eventType=t;const l=fw(n,e);n.emit("hammer.input",l),n.recognize(l),n.session.prevInput=l}let pw=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,e){dw(this.manager,t,e)}init(){No(this.element,this.evEl,this.domHandler),No(this.target,this.evTarget,this.domHandler),No(wh(this.element),this.evWin,this.domHandler)}destroy(){Do(this.element,this.evEl,this.domHandler),Do(this.target,this.evTarget,this.domHandler),Do(wh(this.element),this.evWin,this.domHandler)}};const _w={pointerdown:kt.Start,pointermove:kt.Move,pointerup:kt.End,pointercancel:kt.Cancel,pointerout:kt.Cancel},gw="pointerdown",mw="pointermove pointerup pointercancel";class yw extends pw{constructor(t){super(t),this.evEl=gw,this.evWin=mw,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:e}=this;let i=!1;const s=_w[t.type],r=t.pointerType,a=r==="touch";let l=e.findIndex(h=>h.pointerId===t.pointerId);s&kt.Start&&(t.buttons||a)?l<0&&(e.push(t),l=e.length-1):s&(kt.End|kt.Cancel)&&(i=!0),!(l<0)&&(e[l]=t,this.callback(s,{pointers:e,changedPointers:[t],eventType:s,pointerType:r,srcEvent:t}),i&&e.splice(l,1))}}const vw=["","webkit","Moz","MS","ms","o"];function bw(n,t){const e=t[0].toUpperCase()+t.slice(1);for(const i of vw){const s=i?i+e:t;if(s in n)return s}}const ww=1,Sh=2,Eh={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Tw{constructor(t,e){this.options={...Eh,...e,cssProps:{...Eh.cssProps,...e.cssProps},inputTarget:e.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new yw(this),this.touchAction=new rw(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?Sh:ww}recognize(t){const{session:e}=this;if(e.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:r}=e;(!r||r&&r.state&G.Recognized)&&(r=e.curRecognizer=null);let a=0;for(;a<s.length;)i=s[a],e.stopped!==Sh&&(!r||i===r||i.canRecognizeWith(r))?i.recognize(t):i.reset(),!r&&i.state&(G.Began|G.Changed|G.Ended)&&(r=e.curRecognizer=i),a++}get(t){const{recognizers:e}=this;for(let i=0;i<e.length;i++)if(e[i].options.event===t)return e[i];return null}add(t){if(Array.isArray(t)){for(const i of t)this.add(i);return this}const e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(const i of t)this.remove(i);return this}const e=typeof t=="string"?this.get(t):t;if(e){const{recognizers:i}=this,s=i.indexOf(e);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(t,e){if(!t||!e)return;const{handlers:i}=this;for(const s of er(t))i[s]=i[s]||[],i[s].push(e)}off(t,e){if(!t)return;const{handlers:i}=this;for(const s of er(t))e?i[s]&&i[s].splice(i[s].indexOf(e),1):delete i[s]}emit(t,e){const i=this.handlers[t]&&this.handlers[t].slice();if(!i||!i.length)return;const s=e;s.type=t,s.preventDefault=function(){e.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](s),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){const{element:e}=this;if(e){for(const[i,s]of Object.entries(this.options.cssProps)){const r=bw(e.style,i);t?(this.oldCssProps[r]=e.style[r],e.style[r]=s):e.style[r]=this.oldCssProps[r]||""}t||(this.oldCssProps={})}}}let xw=1;function Aw(){return xw++}function Rh(n){return n&G.Cancelled?"cancel":n&G.Ended?"end":n&G.Changed?"move":n&G.Began?"start":""}class Jf{constructor(t){this.options=t,this.id=Aw(),this.state=G.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const s of t)this.recognizeWith(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{simultaneous:i}=this;return i[e.id]||(i[e.id]=e,e.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const i of t)this.dropRecognizeWith(i);return this}let e;return typeof t=="string"?e=this.manager.get(t):e=t,e&&delete this.simultaneous[e.id],this}requireFailure(t){if(Array.isArray(t)){for(const s of t)this.requireFailure(s);return this}let e;if(typeof t=="string"){if(e=this.manager.get(t),!e)throw new Error(`Cannot find recognizer ${t}`)}else e=t;const{requireFail:i}=this;return i.indexOf(e)===-1&&(i.push(e),e.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const i of t)this.dropRequireFailure(i);return this}let e;if(typeof t=="string"?e=this.manager.get(t):e=t,e){const i=this.requireFail.indexOf(e);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:e}=this;e<G.Ended&&this.manager.emit(this.options.event+Rh(e),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),e>=G.Ended&&this.manager.emit(this.options.event+Rh(e),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=G.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(G.Failed|G.Possible)))return!1;t++}return!0}recognize(t){const e={...t};if(!this.options.enable){this.reset(),this.state=G.Failed;return}this.state&(G.Recognized|G.Cancelled|G.Failed)&&(this.state=G.Possible),this.state=this.process(e),this.state&(G.Began|G.Changed|G.Ended|G.Cancelled)&&this.tryEmit(e)}getEventNames(){return[this.options.event]}reset(){}}class Qf extends Jf{attrTest(t){const e=this.options.pointers;return e===0||t.pointers.length===e}process(t){const{state:e}=this,{eventType:i}=t,s=e&(G.Began|G.Changed),r=this.attrTest(t);return s&&(i&kt.Cancel||!r)?e|G.Cancelled:s||r?i&kt.End?e|G.Ended:e&G.Began?e|G.Changed:G.Began:G.Failed}}class Ph extends Jf{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[_a]}process(t){const{options:e}=this,i=t.pointers.length===e.pointers,s=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&kt.Start&&this.count===0)return this.failTimeout();if(s&&r&&i){if(t.eventType!==kt.End)return this.failTimeout();const a=this.pTime?t.timeStamp-this.pTime<e.interval:!0,l=!this.pCenter||Yf(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!l||!a?this.count=1:this.count+=1,this._input=t,this.count%e.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=G.Recognized,this.tryEmit(this._input)},e.interval),G.Began):G.Recognized}return G.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=G.Failed},this.options.interval),G.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===G.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const Sw=["","start","move","end","cancel","up","down","left","right"];class Ih extends Qf{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Dt.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,e=[];return t&Dt.Horizontal&&e.push(ma),t&Dt.Vertical&&e.push(ga),e}getEventNames(){return Sw.map(t=>this.options.event+t)}directionTest(t){const{options:e}=this;let i=!0,{distance:s}=t,{direction:r}=t;const a=t.deltaX,l=t.deltaY;return r&e.direction||(e.direction&Dt.Horizontal?(r=a===0?Dt.None:a<0?Dt.Left:Dt.Right,i=a!==this.pX,s=Math.abs(t.deltaX)):(r=l===0?Dt.None:l<0?Dt.Up:Dt.Down,i=l!==this.pY,s=Math.abs(t.deltaY))),t.direction=r,i&&s>e.threshold&&!!(r&e.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&G.Began)||!(this.state&G.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const e=Dt[t.direction].toLowerCase();e&&(t.additionalEvent=this.options.event+e),super.emit(t)}}const Ew=["","start","move","end","cancel","in","out"];class Rw extends Qf{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[ks]}getEventNames(){return Ew.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&G.Began))}emit(t){if(t.scale!==1){const e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}super.emit(t)}}class Rr{constructor(t,e,i){this.element=t,this.callback=e,this.options=i}}const Pw=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Iw=Pw.indexOf("firefox")!==-1,Ch=4.000244140625,Cw=40,Mw=.25;class Ow extends Rr{constructor(t,e,i){super(t,e,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let r=s.deltaY;globalThis.WheelEvent&&(Iw&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=Cw)),r!==0&&r%Ch===0&&(r=Math.floor(r/Ch)),s.shiftKey&&r&&(r=r*Mw),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-r,srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,e){t==="wheel"&&(this.options.enable=e)}}const Mh=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class kw extends Rr{constructor(t,e,i){super(t,e,{enable:!0,...i}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Mh.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){Mh.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){switch(t){case"pointermove":this.enableMoveEvent=e;break;case"pointerover":this.enableOverEvent=e;break;case"pointerout":this.enableOutEvent=e;break;case"pointerenter":this.enableEnterEvent=e;break;case"pointerleave":this.enableLeaveEvent=e;break}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break}}_emit(t,e){this.callback({type:t,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const Oh=["keydown","keyup"];class Nw extends Rr{constructor(t,e,i){super(t,e,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const r=s.target||s.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",Oh.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){Oh.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,e){t==="keydown"&&(this.enableDownEvent=e),t==="keyup"&&(this.enableUpEvent=e)}}class Dw extends Rr{constructor(t,e,i){super(t,e,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,e){t==="contextmenu"&&(this.options.enable=e)}}const kh=1,ya=2,Nh=4,Bw={pointerdown:kh,pointermove:ya,pointerup:Nh,mousedown:kh,mousemove:ya,mouseup:Nh},Fw=0,Lw=1,Uw=2,Vw=1,zw=2,Ww=4;function Hw(n){const t=Bw[n.srcEvent.type];if(!t)return null;const{buttons:e,button:i}=n.srcEvent;let s=!1,r=!1,a=!1;return t===ya?(s=!!(e&Vw),r=!!(e&Ww),a=!!(e&zw)):(s=i===Fw,r=i===Lw,a=i===Uw),{leftButton:s,middleButton:r,rightButton:a}}function $w(n,t){const e=n.center;if(!e)return null;const i=t.getBoundingClientRect(),s=i.width/t.offsetWidth||1,r=i.height/t.offsetHeight||1,a={x:(e.x-i.left-t.clientLeft)/s,y:(e.y-i.top-t.clientTop)/r};return{center:e,offsetCenter:a}}const jw={srcElement:"root",priority:0};class Xw{constructor(t,e){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==s.rootElement;){if(this._emit(s,r),s.handled)return;r=r.parentNode}this._emit(s,"root")},this.eventManager=t,this.recognizerName=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,e,i,s=!1,r=!1){const{handlers:a,handlersByElement:l}=this,h={...jw,...i};let f=l.get(h.srcElement);f||(f=[],l.set(h.srcElement,f));const d={type:t,handler:e,srcElement:h.srcElement,priority:h.priority};s&&(d.once=!0),r&&(d.passive=!0),a.push(d),this._active=this._active||!d.passive;let _=f.length-1;for(;_>=0&&!(f[_].priority>=d.priority);)_--;f.splice(_+1,0,d)}remove(t,e){const{handlers:i,handlersByElement:s}=this;for(let r=i.length-1;r>=0;r--){const a=i[r];if(a.type===t&&a.handler===e){i.splice(r,1);const l=s.get(a.srcElement);l.splice(l.indexOf(a),1),l.length===0&&s.delete(a.srcElement)}}this._active=i.some(r=>!r.passive)}_emit(t,e){const i=this.handlersByElement.get(e);if(i){let s=!1;const r=()=>{t.handled=!0},a=()=>{t.handled=!0,s=!0},l=[];for(let h=0;h<i.length;h++){const{type:f,handler:d,once:_}=i[h];if(d({...t,type:f,stopPropagation:r,stopImmediatePropagation:a}),_&&l.push(i[h]),s)break}for(let h=0;h<l.length;h++){const{type:f,handler:d}=l[h];this.remove(f,d)}}}_normalizeEvent(t){const e=this.eventManager.getElement();return{...t,...Hw(t),...$w(t,e),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:e}}}function Zw(n){if("recognizer"in n)return n;let t;const e=Array.isArray(n)?[...n]:[n];if(typeof e[0]=="function"){const i=e.shift(),s=e.shift()||{};t=new i(s)}else t=e.shift();return{recognizer:t,recognizeWith:typeof e[0]=="string"?[e[0]]:e[0],requireFailure:typeof e[1]=="string"?[e[1]]:e[1]}}class Yw{constructor(t=null,e={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...e},this.events=new Map,this.element=t,!!t){this.manager=new Tw(t,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:r,requireFailure:a}=Zw(i);this.manager.add(s),r&&s.recognizeWith(r),a&&s.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Ow(t,this._onOtherEvent,{enable:!1}),this.moveInput=new kw(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Nw(t,this._onOtherEvent,{enable:!1,tabIndex:e.tabIndex}),this.contextmenuInput=new Dw(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,e,i){this._addEventHandler(t,e,i,!1)}once(t,e,i){this._addEventHandler(t,e,i,!0)}watch(t,e,i){this._addEventHandler(t,e,i,!1,!0)}off(t,e){this._removeEventHandler(t,e)}_toggleRecognizer(t,e){var r,a,l,h;const{manager:i}=this;if(!i)return;const s=i.get(t);s&&(s.set({enable:e}),i.touchAction.update()),(r=this.wheelInput)==null||r.enableEventType(t,e),(a=this.moveInput)==null||a.enableEventType(t,e),(l=this.keyInput)==null||l.enableEventType(t,e),(h=this.contextmenuInput)==null||h.enableEventType(t,e)}_addEventHandler(t,e,i,s,r){if(typeof t!="string"){i=e;for(const[f,d]of Object.entries(t))this._addEventHandler(f,d,i,s,r);return}const{manager:a,events:l}=this;if(!a)return;let h=l.get(t);if(!h){const f=this._getRecognizerName(t)||t;h=new Xw(this,f),l.set(t,h),a&&a.on(t,h.handleEvent)}h.add(t,e,i,s,r),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(t,e){if(typeof t!="string"){for(const[r,a]of Object.entries(t))this._removeEventHandler(r,a);return}const{events:i}=this,s=i.get(t);if(s&&(s.remove(t,e),s.isEmpty())){const{recognizerName:r}=s;let a=!1;for(const l of i.values())if(l.recognizerName===r&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(r,!1)}}_getRecognizerName(t){var e;return(e=this.manager.recognizers.find(i=>i.getEventNames().includes(t)))==null?void 0:e.options.event}}const ft={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ft,"IDENTITY",{get:()=>(vt.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const re={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Vi={common:0,meters:1,pixels:2},va={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Dh={multipan:[Ih,{threshold:10,direction:Dt.Vertical,pointers:2}],pinch:[Rw,{},null,["multipan"]],pan:[Ih,{threshold:1},["pinch"],["multipan"]],dblclick:[Ph,{event:"dblclick",taps:2}],click:[Ph,{event:"click"},null,["dblclick"]]};function qw(n,t){if(n===t)return!0;if(Array.isArray(n)){const e=n.length;if(!t||t.length!==e)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}return!1}function Yi(n){let t={},e;return i=>{for(const s in i)if(!qw(i[s],t[s])){e=n(i),t=i;break}return e}}const Bh=[0,0,0,0],Kw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Gf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Jw=[0,0,0],td=[0,0,0],Qw=Yi(eT);function ed(n,t,e=td){e.length<3&&(e=[e[0],e[1],0]);let i=e,s,r=!0;switch(t===ft.LNGLAT_OFFSETS||t===ft.METER_OFFSETS?s=e:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case re.WEB_MERCATOR:(t===ft.LNGLAT||t===ft.CARTESIAN)&&(s=[0,0,0],r=!1);break;case re.WEB_MERCATOR_AUTO_OFFSET:t===ft.LNGLAT?i=s:t===ft.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=e[0],i[1]-=e[1],i[2]-=e[2]);break;case re.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case re.GLOBE:r=!1,s=null;break;default:r=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:r}}function Gw(n,t,e){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:r,viewProjectionMatrix:a}=n,l=Bh,h=Bh,f=n.cameraPosition;const{geospatialOrigin:d,shaderCoordinateOrigin:_,offsetMode:m}=ed(n,t,e);return m&&(h=n.projectPosition(d||_),f=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],h[3]=1,l=Zi([],h,a),r=i||r,a=pn([],s,r),a=pn([],a,Kw)),{viewMatrix:r,viewProjectionMatrix:a,projectionCenter:l,originCommon:h,cameraPosCommon:f,shaderCoordinateOrigin:_,geospatialOrigin:d}}function tT({viewport:n,devicePixelRatio:t=1,modelMatrix:e=null,coordinateSystem:i=ft.DEFAULT,coordinateOrigin:s=td,autoWrapLongitude:r=!1}){i===ft.DEFAULT&&(i=n.isGeospatial?ft.LNGLAT:ft.CARTESIAN);const a=Qw({viewport:n,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:s});return a.wrapLongitude=r,a.modelMatrix=e||Gf,a}function eT({viewport:n,devicePixelRatio:t,coordinateSystem:e,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:r,originCommon:a,cameraPosCommon:l,shaderCoordinateOrigin:h,geospatialOrigin:f}=Gw(n,e,i),d=n.getDistanceScales(),_=[n.width*t,n.height*t],m=Zi([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,w={coordinateSystem:e,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:a.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:t,focalDistance:m,commonUnitsPerMeter:d.unitsPerMeter,commonUnitsPerWorldUnit:d.unitsPerMeter,commonUnitsPerWorldUnit2:Jw,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:r,modelMatrix:Gf,cameraPosition:l};if(f){const A=n.getDistanceScales(f);switch(e){case ft.METER_OFFSETS:w.commonUnitsPerWorldUnit=A.unitsPerMeter,w.commonUnitsPerWorldUnit2=A.unitsPerMeter2;break;case ft.LNGLAT:case ft.LNGLAT_OFFSETS:n._pseudoMeters||(w.commonUnitsPerMeter=A.unitsPerMeter),w.commonUnitsPerWorldUnit=A.unitsPerDegree,w.commonUnitsPerWorldUnit2=A.unitsPerDegree2;break;case ft.CARTESIAN:w.commonUnitsPerWorldUnit=[1,1,A.unitsPerMeter[2]],w.commonUnitsPerWorldUnit2=[0,0,A.unitsPerMeter2[2]];break}}return w}const nT=Object.keys(ft).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${ft[n]};`).join(""),iT=Object.keys(re).map(n=>`const PROJECTION_MODE_${n}: i32 = ${re[n]};`).join(""),sT=Object.keys(Vi).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Vi[n]};`).join(""),rT=`${nT}
${iT}
${sT}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,oT=`${rT}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,aT=Object.keys(ft).map(n=>`const int COORDINATE_SYSTEM_${n} = ${ft[n]};`).join(""),cT=Object.keys(re).map(n=>`const int PROJECTION_MODE_${n} = ${re[n]};`).join(""),lT=Object.keys(Vi).map(n=>`const int UNIT_${n.toUpperCase()} = ${Vi[n]};`).join(""),hT=`${aT}
${cT}
${lT}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,uT={};function fT(n=uT){return"viewport"in n?tT(n):{}}const ic={name:"project",dependencies:[Hb,Xf],source:oT,vs:hT,getUniforms:fT,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},dT=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,pT=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,_T={name:"project32",dependencies:[ic],source:dT,vs:pT};function gT(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Zn(n,t){const e=Zi([],t,n);return kb(e,e,1/e[3]),e}function Fh(n,t){const e=n%t;return e<0?t+e:e}function ba(n,t,e){return n<t?t:n>e?e:n}function mT(n){return Math.log(n)*Math.LOG2E}const sc=Math.log2||mT;function Ue(n,t){if(!n)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const ge=Math.PI,nd=ge/4,ce=ge/180,wa=180/ge,Gn=512,nr=4003e4,Lh=85.051129,yT=1.5;function vT(n){return sc(n)}function ir(n){const[t,e]=n;Ue(Number.isFinite(t)),Ue(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const i=t*ce,s=e*ce,r=Gn*(i+ge)/(2*ge),a=Gn*(ge+Math.log(Math.tan(nd+s*.5)))/(2*ge);return[r,a]}function ti(n){const[t,e]=n,i=t/Gn*(2*ge)-ge,s=2*(Math.atan(Math.exp(e/Gn*(2*ge)-ge))-nd);return[i*wa,s*wa]}function bT(n){const{latitude:t}=n;Ue(Number.isFinite(t));const e=Math.cos(t*ce);return vT(nr*e)-9}function Bo(n){const t=Math.cos(n*ce);return Gn/nr/t}function Ta(n){const{latitude:t,longitude:e,highPrecision:i=!1}=n;Ue(Number.isFinite(t)&&Number.isFinite(e));const s=Gn,r=Math.cos(t*ce),a=s/360,l=a/r,h=s/nr/r,f={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,l,h],degreesPerUnit:[1/a,1/l,1/h]};if(i){const d=ce*Math.tan(t*ce)/r,_=a*d/2,m=s/nr*d,w=m/l*h;f.unitsPerDegree2=[0,_,m],f.unitsPerMeter2=[w,0,w]}return f}function id(n,t){const[e,i,s]=n,[r,a,l]=t,{unitsPerMeter:h,unitsPerMeter2:f}=Ta({longitude:e,latitude:i,highPrecision:!0}),d=ir(n);d[0]+=r*(h[0]+f[0]*a),d[1]+=a*(h[1]+f[1]*a);const _=ti(d),m=(s||0)+(l||0);return Number.isFinite(s)||Number.isFinite(l)?[_[0],_[1],m]:_}function wT(n){const{height:t,pitch:e,bearing:i,altitude:s,scale:r,center:a}=n,l=gT();tr(l,l,[0,0,-s]),Wf(l,l,-e*ce),Hf(l,l,i*ce);const h=r/t;return nc(l,l,[h,h,h]),a&&tr(l,l,lb([],a)),l}function TT(n){const{width:t,height:e,altitude:i,pitch:s=0,offset:r,center:a,scale:l,nearZMultiplier:h=1,farZMultiplier:f=1}=n;let{fovy:d=sr(yT)}=n;i!==void 0&&(d=sr(i));const _=d*ce,m=s*ce,w=sd(d);let A=w;a&&(A+=a[2]*l/Math.cos(m)/e);const S=_*(.5+(r?r[1]:0)/e),k=Math.sin(S)*A/Math.sin(ba(Math.PI/2-m-S,.01,Math.PI-.01)),B=Math.sin(m)*k+A,F=A*10,M=Math.min(B*f,F);return{fov:_,aspect:t/e,focalDistance:w,near:h,far:M}}function sr(n){return 2*Math.atan(.5/n)*wa}function sd(n){return .5/Math.tan(.5*n*ce)}function rd(n,t){const[e,i,s=0]=n;return Ue(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(s)),Zn(t,[e,i,s,1])}function rc(n,t,e=0){const[i,s,r]=n;if(Ue(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(r))return Zn(t,[i,s,r,1]);const a=Zn(t,[i,s,0,1]),l=Zn(t,[i,s,1,1]),h=a[2],f=l[2],d=h===f?0:((e||0)-h)/(f-h);return Uf([],a,l,d)}function xT(n){const{width:t,height:e,bounds:i,minExtent:s=0,maxZoom:r=24,offset:a=[0,0]}=n,[[l,h],[f,d]]=i,_=AT(n.padding),m=ir([l,ba(d,-85.051129,Lh)]),w=ir([f,ba(h,-85.051129,Lh)]),A=[Math.max(Math.abs(w[0]-m[0]),s),Math.max(Math.abs(w[1]-m[1]),s)],S=[t-_.left-_.right-Math.abs(a[0])*2,e-_.top-_.bottom-Math.abs(a[1])*2];Ue(S[0]>0&&S[1]>0);const k=S[0]/A[0],B=S[1]/A[1],F=(_.right-_.left)/2/k,M=(_.top-_.bottom)/2/B,D=[(w[0]+m[0])/2+F,(w[1]+m[1])/2+M],H=ti(D),W=Math.min(r,sc(Math.abs(Math.min(k,B))));return Ue(Number.isFinite(W)),{longitude:H[0],latitude:H[1],zoom:W}}function AT(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Ue(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Uh=Math.PI/180;function ST(n,t=0){const{width:e,height:i,unproject:s}=n,r={targetZ:t},a=s([0,i],r),l=s([e,i],r);let h,f;const d=n.fovy?.5*n.fovy*Uh:Math.atan(.5/n.altitude),_=(90-n.pitch)*Uh;return d>_-.01?(h=Vh(n,0,t),f=Vh(n,e,t)):(h=s([0,0],r),f=s([e,0],r)),[a,l,f,h]}function Vh(n,t,e){const{pixelUnprojectionMatrix:i}=n,s=Zn(i,[t,0,1,1]),r=Zn(i,[t,n.height,1,1]),l=(e*n.distanceScales.unitsPerMeter[2]-s[2])/(r[2]-s[2]),h=Uf([],s,r,l),f=ti(h);return f.push(e),f}const zh=512;function ET(n){const{width:t,height:e,pitch:i=0}=n;let{longitude:s,latitude:r,zoom:a,bearing:l=0}=n;(s<-180||s>180)&&(s=Fh(s+180,360)-180),(l<-180||l>180)&&(l=Fh(l+180,360)-180);const h=sc(e/zh);if(a<=h)a=h,r=0;else{const f=e/2/Math.pow(2,a),d=ti([0,f])[1];if(r<d)r=d;else{const _=ti([0,zh-f])[1];r>_&&(r=_)}}return{width:t,height:e,longitude:s,latitude:r,zoom:a,pitch:i,bearing:l}}const od=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,RT=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,PT=`
${od}
${RT}
`,IT=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,CT=`
${od}
${IT}
`,MT=Yi(BT),OT=Yi(FT),kT=[0,0,0,1],NT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function DT(n,t){const[e,i,s]=n,r=rc([e,i,s],t);return Number.isFinite(s)?r:[r[0],r[1],0]}function BT({viewport:n,center:t}){return new Ie(n.viewProjectionMatrix).invert().transform(t)}function FT({viewport:n,shadowMatrices:t}){const e=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,r=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(a=>DT(a,i));for(const a of t){const l=a.clone().translate(new Pe(n.center).negate()),h=r.map(d=>l.transform(d)),f=new Ie().ortho({left:Math.min(...h.map(d=>d[0])),right:Math.max(...h.map(d=>d[0])),bottom:Math.min(...h.map(d=>d[1])),top:Math.max(...h.map(d=>d[1])),near:Math.min(...h.map(d=>-d[2])),far:Math.max(...h.map(d=>-d[2]))});e.push(f.multiplyRight(a))}return e}function LT(n){const{shadowEnabled:t=!0,project:e}=n;if(!t||!e||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=ic.getUniforms(e),s=MT({viewport:e.viewport,center:i.center}),r=[],a=OT({shadowMatrices:n.shadowMatrices,viewport:e.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const f=a[h],d=f.clone().translate(new Pe(e.viewport.center).negate());i.coordinateSystem===ft.LNGLAT&&i.projectionMode===re.WEB_MERCATOR?(a[h]=d,r[h]=s):(a[h]=f.clone().multiplyRight(NT),r[h]=d.transform(s))}const l={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||kT,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<a.length;h++)l[`viewProjectionMatrix${h}`]=a[h],l[`projectCenter${h}`]=r[h];for(let h=0;h<2;h++)l[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return l}const Wh={name:"shadow",dependencies:[ic],vs:PT,fs:CT,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:LT,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},UT={...vh,defaultUniforms:{...vh.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},VT=[Xf],zT=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],WT=[];function HT(n){const t=zs.getDefaultShaderAssembler();for(const i of VT)t.addDefaultModule(i);const e=n==="glsl"?zT:WT;for(const i of e)t.addShaderHook(i);return t}const $T=[255,255,255],jT=1;let XT=0;class ZT{constructor(t={}){this.type="ambient";const{color:e=$T}=t,{intensity:i=jT}=t;this.id=t.id||`ambient-${XT++}`,this.color=e,this.intensity=i}}const YT=[255,255,255],qT=1,KT=[0,0,-1];let JT=0;class Hh{constructor(t={}){this.type="directional";const{color:e=YT}=t,{intensity:i=qT}=t,{direction:s=KT}=t,{_shadow:r=!1}=t;this.id=t.id||`directional-${JT++}`,this.color=e,this.intensity=i,this.type="directional",this.direction=new Pe(s).normalize().toArray(),this.shadow=r}getProjectedLight(t){return this}}class QT{constructor(t,e={id:"pass"}){const{id:i}=e;this.id=i,this.device=t,this.props={...e}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class oc extends QT{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[e,i]=this.device.canvasContext.getDrawingBufferSize(),s=t.clearCanvas??!0,r=t.clearColor??(s?[0,0,0,0]:!1),a=s?1:!1,l=s?0:!1,h=t.colorMask??15,f={viewport:[0,0,e,i]};t.colorMask&&(f.colorMask=h),t.scissorRect&&(f.scissorRect=t.scissorRect);const d=this.device.beginRenderPass({framebuffer:t.target,parameters:f,clearColor:r,clearDepth:a,clearStencil:l});try{return this._drawLayers(d,t)}finally{d.end(),this.device.submit()}}_drawLayers(t,e){const{target:i,shaderModuleProps:s,viewports:r,views:a,onViewportActive:l,clearStack:h=!0}=e;e.pass=e.pass||"unknown",h&&(this._lastRenderIndex=-1);const f=[];for(const d of r){const _=a&&a[d.id];l==null||l(d);const m=this._getDrawLayerParams(d,e),w=d.subViewports||[d];for(const A of w){const S=this._drawLayersInViewport(t,{target:i,shaderModuleProps:s,viewport:A,view:_,pass:e.pass,layers:e.layers},m);f.push(S)}}return f}_getDrawLayerParams(t,{layers:e,pass:i,isPicking:s=!1,layerFilter:r,cullRect:a,effects:l,shaderModuleProps:h},f=!1){var A;const d=[],_=ad(this._lastRenderIndex+1),m={layer:e[0],viewport:t,isPicking:s,renderPass:i,cullRect:a},w={};for(let S=0;S<e.length;S++){const k=e[S],B=this._shouldDrawLayer(k,m,r,w),F={shouldDrawLayer:B};B&&!f&&(F.shouldDrawLayer=!0,F.layerRenderIndex=_(k,B),F.shaderModuleProps=this._getShaderModuleProps(k,l,i,h),F.layerParameters={...(A=k.context.deck)==null?void 0:A.props.parameters,...this.getLayerParameters(k,S,t)}),d[S]=F}return d}_drawLayersInViewport(t,{layers:e,shaderModuleProps:i,pass:s,target:r,viewport:a,view:l},h){const f=GT(this.device,{shaderModuleProps:i,target:r,viewport:a});if(l&&l.props.clear){const _=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.beginRenderPass({framebuffer:r,parameters:{viewport:f,scissorRect:f},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const d={totalCount:e.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:f});for(let _=0;_<e.length;_++){const m=e[_],w=h[_],{shouldDrawLayer:A}=w;if(A&&m.props.pickable&&d.pickableCount++,m.isComposite&&d.compositeCount++,m.isDrawable&&w.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:k,layerParameters:B}=w;d.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),k.project&&(k.project.viewport=a),m.context.renderPass=t;try{m._drawLayer({renderPass:t,shaderModuleProps:k,uniforms:{layerIndex:S},parameters:B})}catch(F){m.raiseError(F,`drawing ${m} to ${s}`)}}}return d}shouldDrawLayer(t){return!0}getShaderModuleProps(t,e,i){return null}getLayerParameters(t,e,i){return t.props.parameters}_shouldDrawLayer(t,e,i,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;e.layer=t;let a=t.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(e))return!1;e.layer=a,a=a.parent}if(i){const l=e.layer.id;if(l in s||(s[l]=i(e)),!s[l])return!1}return t.activateViewport(e.viewport),!0}_getShaderModuleProps(t,e,i,s){var h,f;const r=this.device.canvasContext.cssToDeviceRatio(),a=((h=t.internalState)==null?void 0:h.propsInTransition)||t.props,l={layer:a,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:r,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(e)for(const d of e)$h(l,(f=d.getShaderModuleProps)==null?void 0:f.call(d,t,l));return $h(l,this.getShaderModuleProps(t,e,l),s)}}function ad(n=0,t={}){const e={},i=(s,r)=>{const a=s.props._offset,l=s.id,h=s.parent&&s.parent.id;let f;if(h&&!(h in t)&&i(s.parent,!1),h in e){const d=e[h]=e[h]||ad(t[h],t);f=d(s,r),e[l]=d}else Number.isFinite(a)?(f=a+(t[h]||0),e[l]=null):f=n;return r&&f>=n&&(n=f+1),t[l]=f,f};return i}function GT(n,{shaderModuleProps:t,target:e,viewport:i}){var h;const s=((h=t==null?void 0:t.project)==null?void 0:h.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,r]=n.canvasContext.getDrawingBufferSize(),a=e?e.height:r,l=i;return[l.x*s,a-(l.y+l.height)*s,l.width*s,l.height*s,0,1]}function $h(n,...t){for(const e of t)if(e)for(const i in e)n[i]?Object.assign(n[i],e[i]):n[i]=e[i];return n}class tx extends oc{constructor(t,e){super(t,e);const i=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const e=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=t.viewports[0],r=s.width*i,a=s.height*i,l=[1,1,1,1];(r!==e.width||a!==e.height)&&e.resize({width:r,height:a}),super.render({...t,clearColor:l,target:e,pass:"shadow"})}getLayerParameters(t,e,i){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,e,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const ex={color:[255,255,255],intensity:1},jh=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],nx=[0,0,0,200/255];class cd{constructor(t={}){this.id="lighting-effect",this.shadowColor=nx,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:e,deck:i}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(e),i._addDefaultShaderModule(Wh),this.dummyShadowMap=e.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const e in t){const i=t[e];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:e,viewports:i,onViewportActive:s,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:t,layerFilter:e,viewports:i,onViewportActive:s,views:r,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,e){const i=this.shadow?{project:e.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:t})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:t}))},r=t.props.material;return{shadow:i,lighting:s,phongMaterial:r,gouraudMaterial:r}}cleanup(t){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(Wh))}_calculateMatrices(){const t=[];for(const e of this.directionalLights){const i=new Ie().lookAt({eye:new Pe(e.direction).negate()});t.push(i)}return t}_createShadowPasses(t){for(let e=0;e<this.directionalLights.length;e++){const i=new tx(t);this.shadowPasses[e]=i}}_applyDefaultLights(){const{ambientLight:t,pointLights:e,directionalLights:i}=this;!t&&e.length===0&&i.length===0&&(this.ambientLight=new ZT(ex),this.directionalLights.push(new Hh(jh[0]),new Hh(jh[1])))}}class ix{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,e,{size:i=1,type:s,padding:r=0,copy:a=!1,initialize:l=!1,maxCount:h}){const f=s||t&&t.constructor||Float32Array,d=e*i+r;if(ArrayBuffer.isView(t)){if(d<=t.length)return t;if(d*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new f(t.buffer,0,d)}let _=1/0;h&&(_=h*i+r);const m=this._allocate(f,d,l,_);return t&&a?m.set(t):l||m.fill(0,0,4),this._release(t),m}release(t){this._release(t)}_allocate(t,e,i,s){let r=Math.max(Math.ceil(e*this.opts.overAlloc),1);r>s&&(r=s);const a=this._pool,l=t.BYTES_PER_ELEMENT*r,h=a.findIndex(f=>f.byteLength>=l);if(h>=0){const f=new t(a.splice(h,1)[0],0,r);return i&&f.fill(0),f}return new t(r)}_release(t){if(!ArrayBuffer.isView(t))return;const e=this._pool,{buffer:i}=t,{byteLength:s}=i,r=e.findIndex(a=>a.byteLength>=s);r<0?e.push(i):(r>0||e.length<this.opts.poolSize)&&e.splice(r,0,i),e.length>this.opts.poolSize&&e.shift()}}const zi=new ix;function Ei(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sx(n){return[n[12],n[13],n[14]]}function rx(n){return{left:Ln(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Ln(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Ln(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Ln(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Ln(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Ln(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Xh=new Pe;function Ln(n,t,e,i){Xh.set(n,t,e);const s=Xh.len();return{distance:i/s,normal:new Pe(-n/s,-t/s,-e/s)}}function ox(n){return n-Math.fround(n)}let bi;function Fo(n,t){const{size:e=1,startIndex:i=0}=t,s=t.endIndex!==void 0?t.endIndex:n.length,r=(s-i)/e;bi=zi.allocate(bi,r,{type:Float32Array,size:e*2});let a=i,l=0;for(;a<s;){for(let h=0;h<e;h++){const f=n[a++];bi[l+h]=f,bi[l+h+e]=ox(f)}l+=e*2}return bi.subarray(0,r*e*2)}function ax(n){let t=null,e=!1;for(const i of n)i&&(t?(e||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],e=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}const cx=Math.PI/180,lx=Ei(),Zh=[0,0,0],hx={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function ux({width:n,height:t,orthographic:e,fovyRadians:i,focalDistance:s,padding:r,near:a,far:l}){const h=n/t,f=e?new Ie().orthographic({fovy:i,aspect:h,focalDistance:s,near:a,far:l}):new Ie().perspective({fovy:i,aspect:h,near:a,far:l});if(r){const{left:d=0,right:_=0,top:m=0,bottom:w=0}=r,A=Je((d+n-_)/2,0,n)-n/2,S=Je((m+t-w)/2,0,t)-t/2;f[8]-=A*2/n,f[9]+=S*2/t}return f}class qi{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||hx,this.focalDistance=t.focalDistance||1,this.position=t.position||Zh,this.modelMatrix=t.modelMatrix||null;const{longitude:e,latitude:i}=t;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(e),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?re.WEB_MERCATOR:re.WEB_MERCATOR_AUTO_OFFSET:re.IDENTITY}equals(t){return t instanceof qi?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&Ui(t.projectionMatrix,this.projectionMatrix)&&Ui(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:e=!0}={}){const i=this.projectPosition(t),s=rd(i,this.pixelProjectionMatrix),[r,a]=s,l=e?a:this.height-a;return t.length===2?[r,l]:[r,l,s[2]]}unproject(t,{topLeft:e=!0,targetZ:i}={}){const[s,r,a]=t,l=e?r:this.height-r,h=i&&i*this.distanceScales.unitsPerMeter[2],f=rc([s,l,a],this.pixelUnprojectionMatrix,h),[d,_,m]=this.unprojectPosition(f);return Number.isFinite(a)?[d,_,m]:Number.isFinite(i)?[d,_,i]:[d,_]}projectPosition(t){const[e,i]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[e,i,s]}unprojectPosition(t){const[e,i]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[e,i,s]}projectFlat(t){if(this.isGeospatial){const e=ir(t);return e[1]=Je(e[1],-318,830),e}return t}unprojectFlat(t){return this.isGeospatial?ti(t):t}getBounds(t={}){const e={targetZ:t.z||0},i=this.unproject([0,0],e),s=this.unproject([this.width,0],e),r=this.unproject([0,this.height],e),a=this.unproject([this.width,this.height],e);return[Math.min(i[0],s[0],r[0],a[0]),Math.min(i[1],s[1],r[1],a[1]),Math.max(i[0],s[0],r[0],a[0]),Math.max(i[1],s[1],r[1],a[1])]}getDistanceScales(t){return t&&this.isGeospatial?Ta({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:e,width:i=1,height:s=1}){return t<this.x+this.width&&this.x<t+i&&e<this.y+this.height&&this.y<e+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,rx(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,e){return null}_initProps(t){const e=t.longitude,i=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=bT({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||Ta({latitude:i,longitude:e}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:r,modelMatrix:a}=t;let l=Zh;if(r&&(l=a?new Ie(a).transformAsVector(r,[]):r),this.isGeospatial){const h=this.projectPosition([e,i,0]);this.center=new Pe(l).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(l)}_initMatrices(t){const{viewMatrix:e=lx,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:r,fovy:a=75,near:l=.1,far:h=1e3,padding:f=null,focalDistance:d=1}=t;this.viewMatrixUncentered=e,this.viewMatrix=new Ie().multiplyRight(e).translate(new Pe(this.center).negate()),this.projectionMatrix=i||ux({width:this.width,height:this.height,orthographic:s,fovyRadians:r||a*cx,focalDistance:d,padding:f,near:l,far:h});const _=Ei();pn(_,_,this.projectionMatrix),pn(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=da([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=sx(this.viewMatrixInverse);const m=Ei(),w=Ei();nc(m,m,[this.width/2,-this.height/2,1]),tr(m,m,[1,-1,0]),pn(w,m,this.viewProjectionMatrix),this.pixelProjectionMatrix=w,this.pixelUnprojectionMatrix=da(Ei(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||vt.warn("Pixel project matrix not invertible")()}}qi.displayName="Viewport";class ei extends qi{constructor(t={}){const{latitude:e=0,longitude:i=0,zoom:s=0,pitch:r=0,bearing:a=0,nearZMultiplier:l=.1,farZMultiplier:h=1.01,nearZ:f,farZ:d,orthographic:_=!1,projectionMatrix:m,repeat:w=!1,worldOffset:A=0,position:S,padding:k,legacyMeterSizes:B=!1}=t;let{width:F,height:M,altitude:D=1.5}=t;const H=Math.pow(2,s);F=F||1,M=M||1;let W,at=null;if(m)D=m[5]/2,W=sr(D);else{t.fovy?(W=t.fovy,D=sd(W)):W=sr(D);let J;if(k){const{top:rt=0,bottom:X=0}=k;J=[0,Je((rt+M-X)/2,0,M)-M/2]}at=TT({width:F,height:M,scale:H,center:S&&[0,0,S[2]*Bo(e)],offset:J,pitch:r,fovy:W,nearZMultiplier:l,farZMultiplier:h}),Number.isFinite(f)&&(at.near=f),Number.isFinite(d)&&(at.far=d)}let Y=wT({height:M,pitch:r,bearing:a,scale:H,altitude:D});A&&(Y=new Ie().translate([512*A,0,0]).multiplyLeft(Y)),super({...t,width:F,height:M,viewMatrix:Y,longitude:i,latitude:e,zoom:s,...at,fovy:W,focalDistance:D}),this.latitude=e,this.longitude=i,this.zoom=s,this.pitch=r,this.bearing=a,this.altitude=D,this.fovy=W,this.orthographic=_,this._subViewports=w?[]:null,this._pseudoMeters=B,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),e=Math.floor((t[0]+180)/360),i=Math.ceil((t[2]-180)/360);for(let s=e;s<=i;s++){const r=s?new ei({...this,worldOffset:s}):this;this._subViewports.push(r)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[e,i]=this.projectFlat(t),s=(t[2]||0)*Bo(t[1]);return[e,i,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[e,i]=this.unprojectFlat(t),s=(t[2]||0)/Bo(i);return[e,i,s]}addMetersToLngLat(t,e){return id(t,e)}panByPosition(t,e){const i=rc(e,this.pixelUnprojectionMatrix),s=this.projectFlat(t),r=mh([],s,ib([],i)),a=mh([],this.center,r),[l,h]=this.unprojectFlat(a);return{longitude:l,latitude:h}}getBounds(t={}){const e=ST(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}fitBounds(t,e={}){const{width:i,height:s}=this,{longitude:r,latitude:a,zoom:l}=xT({width:i,height:s,bounds:t,...e});return new ei({width:i,height:s,longitude:r,latitude:a,zoom:l})}}ei.displayName="WebMercatorViewport";const Yh=[0,0,0];function Lo(n,t,e=!1){const i=t.projectPosition(n);if(e&&t instanceof ei){const[s,r,a=0]=n,l=t.getDistanceScales([s,r]);i[2]=a*l.unitsPerMeter[2]}return i}function fx(n){const{viewport:t,modelMatrix:e,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:a}=n;return s===ft.DEFAULT&&(s=t.isGeospatial?ft.LNGLAT:ft.CARTESIAN),r===void 0&&(r=s),a===void 0&&(a=i),{viewport:t,coordinateSystem:s,coordinateOrigin:i,modelMatrix:e,fromCoordinateSystem:r,fromCoordinateOrigin:a}}function ld(n,{viewport:t,modelMatrix:e,coordinateSystem:i,coordinateOrigin:s,offsetMode:r}){let[a,l,h=0]=n;switch(e&&([a,l,h]=Zi([],[a,l,h,1],e)),i){case ft.LNGLAT:return Lo([a,l,h],t,r);case ft.LNGLAT_OFFSETS:return Lo([a+s[0],l+s[1],h+(s[2]||0)],t,r);case ft.METER_OFFSETS:return Lo(id(s,[a,l,h]),t,r);case ft.CARTESIAN:default:return t.isGeospatial?[a+s[0],l+s[1],h+s[2]]:t.projectPosition([a,l,h])}}function dx(n,t){const{viewport:e,coordinateSystem:i,coordinateOrigin:s,modelMatrix:r,fromCoordinateSystem:a,fromCoordinateOrigin:l}=fx(t),{autoOffset:h=!0}=t,{geospatialOrigin:f=Yh,shaderCoordinateOrigin:d=Yh,offsetMode:_=!1}=h?ed(e,i,s):{},m=ld(n,{viewport:e,modelMatrix:r,coordinateSystem:a,coordinateOrigin:l,offsetMode:_});if(_){const w=e.projectPosition(f||d);yb(m,m,w)}return m}let px=1,_x=1;class hd{constructor(){v(this,"time",0);v(this,"channels",new Map);v(this,"animations",new Map);v(this,"playing",!1);v(this,"lastEngineTime",-1)}addChannel(t){const{delay:e=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:r=1}=t,a=px++,l={time:0,delay:e,duration:i,rate:s,repeat:r};return this._setChannelTime(l,this.time),this.channels.set(a,l),a}removeChannel(t){this.channels.delete(t);for(const[e,i]of this.animations)i.channel===t&&this.detachAnimation(e)}isFinished(t){const e=this.channels.get(t);return e===void 0?!1:this.time>=e.delay+e.duration*e.repeat}getTime(t){if(t===void 0)return this.time;const e=this.channels.get(t);return e===void 0?-1:e.time}setTime(t){this.time=Math.max(0,t);const e=this.channels.values();for(const s of e)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:r,channel:a}=s;r.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,e){const i=_x++;return this.animations.set(i,{animation:t,channel:e}),t.setTime(this.getTime(e)),i}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,e){const i=e-t.delay,s=t.duration*t.repeat;i>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,i)%t.duration,t.time*=t.rate)}}function gx(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function mx(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let yx=0;const vx={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:ia.stats.get(`animation-loop-${yx++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class bx{constructor(t){v(this,"device",null);v(this,"canvas",null);v(this,"props");v(this,"animationProps",null);v(this,"timeline",null);v(this,"stats");v(this,"cpuTime");v(this,"gpuTime");v(this,"frameRate");v(this,"display");v(this,"needsRedraw","initialized");v(this,"_initialized",!1);v(this,"_running",!1);v(this,"_animationFrameId",null);v(this,"_nextFramePromise",null);v(this,"_resolveNextFrame",null);v(this,"_cpuStartTime",0);v(this,"_error",null);if(this.props={...vx,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:e=!0}=this.props;this.stats=t.stats||new Ar({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:e}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(t){var i,s;if(this.props.onError(t),this._error=Error(),((s=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=t.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const e=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var t;return(t=this.device)!=null&&t.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=gx(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(mx(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){var e;if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),(e=this.device)==null||e.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;const t=(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas;if(!this.device||!t)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:t,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:e,aspect:i}=this._getSizeAndAspect();(t!==this.animationProps.width||e!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=e,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var t;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((t=this.device.canvasContext)==null?void 0:t.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(e);const i=this.props.onAddHTML(e);i&&(e.innerHTML=i)}}_getSizeAndAspect(){var r,a,l,h;if(!this.device)return{width:1,height:1,aspect:1};const[t,e]=((a=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:a.getPixelSize())||[1,1];let i=1;const s=(h=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:h.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:t>0&&e>0&&(i=t/e),{width:t,height:e,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var t,e;this.props.autoResizeDrawingBuffer&&((e=(t=this.device)==null?void 0:t.canvasContext)==null||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const Uo={};function ac(n="id"){Uo[n]=Uo[n]||1;const t=Uo[n]++;return`${n}-${t}`}class qh{constructor(t){v(this,"id");v(this,"userData",{});v(this,"topology");v(this,"bufferLayout",[]);v(this,"vertexCount");v(this,"indices");v(this,"attributes");if(this.id=t.id||ac("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&bt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var t;(t=this.indices)==null||t.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function wx(n,t){if(t instanceof qh)return t;const e=Tx(n,t),{attributes:i,bufferLayout:s}=xx(n,t);return new qh({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:e,attributes:i})}function Tx(n,t){if(!t.indices)return;const e=t.indices.value;return n.createBuffer({usage:bt.INDEX,data:e})}function xx(n,t){const e=[],i={};for(const[r,a]of Object.entries(t.attributes)){let l=r;switch(r){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}if(a){i[l]=n.createBuffer({data:a.value,id:`${r}-buffer`});const{value:h,size:f,normalized:d}=a;e.push({name:l,format:yv(h,f,d)})}}const s=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:e,vertexCount:s}}const wr=class wr{constructor(t){v(this,"device");v(this,"destroyPolicy");v(this,"_hashCounter",0);v(this,"_hashes",{});v(this,"_renderPipelineCache",{});v(this,"_computePipelineCache",{});this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new wr(t),t._lumaData.defaultPipelineFactory}createRenderPipeline(t){const e={...qn.defaultProps,...t},i=this._hashRenderPipeline(e);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...e,id:e.id?`${e.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(t){const e={...Xs.defaultProps,...t},i=this._hashComputePipeline(e);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...e,id:e.id?`${e.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(t){const e=t.hash,i=t instanceof Xs?this._computePipelineCache:this._renderPipelineCache;i[e].useCount--,i[e].useCount===0&&this.destroyPolicy==="unused"&&(i[e].pipeline.destroy(),delete i[e])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const e=t.vs?this._getHash(t.vs.source):0,i=t.fs?this._getHash(t.fs.source):0,s="-",r=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${e}/${i}V${s}BL${r}`;default:const a=this._getHash(JSON.stringify(t.parameters));return`${e}/${i}V${s}T${t.topology}P${a}BL${r}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};v(wr,"defaultProps",{...qn.defaultProps});let xa=wr;const Tr=class Tr{constructor(t){v(this,"device");v(this,"destroyPolicy");v(this,"_cache",{});this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}static getDefaultShaderFactory(t){var e;return(e=t._lumaData).defaultShaderFactory||(e.defaultShaderFactory=new Tr(t)),t._lumaData.defaultShaderFactory}createShader(t){const e=this._hashShader(t);let i=this._cache[e];if(!i){const s=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[e]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(t){const e=this._hashShader(t),i=this._cache[e];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[e],i.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};v(Tr,"defaultProps",{...Hs.defaultProps});let Aa=Tr;function Ax(n,t){var s;const e={},i="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const r of n.attributes)if(r){const a=`${r.location} ${r.name}: ${r.type}`;e[`in ${a}`]={[i]:r.stepMode||"vertex"}}for(const r of n.varyings||[]){const a=`${r.location} ${r.name}`;e[`out ${a}`]={[i]:JSON.stringify(r)}}return e}let Lt=null,cn=null;function Sx(n,{id:t,minimap:e,opaque:i,top:s="0",left:r="0",rgbaScale:a=1}){Lt||(Lt=document.createElement("canvas"),Lt.id=t,Lt.title=t,Lt.style.zIndex="100",Lt.style.position="absolute",Lt.style.top=s,Lt.style.left=r,Lt.style.border="blue 5px solid",Lt.style.transform="scaleY(-1)",document.body.appendChild(Lt),cn=Lt.getContext("2d")),(Lt.width!==n.width||Lt.height!==n.height)&&(Lt.width=n.width/2,Lt.height=n.height/2,Lt.style.width="400px",Lt.style.height="400px");const l=n.device.readPixelsToArrayWebGL(n),h=cn==null?void 0:cn.createImageData(n.width,n.height);if(h){for(let d=0;d<l.length;d+=4)h.data[0+d+0]=l[d+0]*a,h.data[0+d+1]=l[d+1]*a,h.data[0+d+2]=l[d+2]*a,h.data[0+d+3]=i?255:l[d+3]*a;cn==null||cn.putImageData(h,0,0)}}function Sa(n,t,e){if(n===t)return!0;if(!e||!n||!t)return!1;if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Sa(n[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof n=="object"&&typeof t=="object"){const i=Object.keys(n),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!Sa(n[r],t[r],e-1))return!1;return!0}return!1}function Ex(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Rx(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function ud(n){return Ex(n)||Rx(n)}function Px(n){return ud(n)||typeof n=="number"||typeof n=="boolean"}function fd(n){const t={bindings:{},uniforms:{}};return Object.keys(n).forEach(e=>{const i=n[e];Px(i)?t.uniforms[e]=i:t.bindings[e]=i}),t}class Ix{constructor(t,e){v(this,"options",{disableWarnings:!1});v(this,"modules");v(this,"moduleUniforms");v(this,"moduleBindings");Object.assign(this.options,e);const i=Xa(Object.values(t).filter(s=>s.dependencies));for(const s of i)t[s.name]=s;z.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[s,r]of Object.entries(t))this._addModule(r),r.name&&s!==r.name&&!this.options.disableWarnings&&z.warn(`Module name: ${s} vs ${r.name}`)()}destroy(){}setProps(t){var e;for(const i of Object.keys(t)){const s=i,r=t[s]||{},a=this.modules[s];if(!a){this.options.disableWarnings||z.warn(`Module ${i} not found`)();continue}const l=this.moduleUniforms[s],h=this.moduleBindings[s],f=((e=a.getUniforms)==null?void 0:e.call(a,r,l))||r,{uniforms:d,bindings:_}=fd(f);this.moduleUniforms[s]={...l,...d},this.moduleBindings[s]={...h,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const e of Object.values(this.moduleBindings))Object.assign(t,e);return t}getDebugTable(){var e;const t={};for(const[i,s]of Object.entries(this.moduleUniforms))for(const[r,a]of Object.entries(s))t[`${i}.${r}`]={type:(e=this.modules[i].uniformTypes)==null?void 0:e[r],value:String(a)};return t}_addModule(t){const e=t.name;this.moduleUniforms[e]=t.defaultUniforms||{},this.moduleBindings[e]={}}}let Cx="";async function Mx(n,t){const e=new Image;return e.crossOrigin="anonymous",e.src=n.startsWith("http")?n:Cx+n,await e.decode(),t?await createImageBitmap(e,t):await createImageBitmap(e)}class Vo{constructor(t,e){v(this,"device");v(this,"id");v(this,"texture");v(this,"sampler");v(this,"view");v(this,"ready");v(this,"isReady",!1);v(this,"destroyed",!1);v(this,"resolveReady",()=>{});v(this,"rejectReady",()=>{});this.device=t,this.id=e.id||ac("async-texture"),typeof(e==null?void 0:e.data)=="string"&&e.dimension==="2d"&&(e={...e,data:Mx(e.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(e)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(t){let e,i;const s=t.data,r=await dd(s).then(e,i);if(this.destroyed)return;const a={...t,data:r};this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const e=this.texture;this.texture=e.clone(t),e.destroy()}return!0}}async function dd(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(dd));if(n&&typeof n=="object"&&n.constructor===Object){const t=n,e=await Promise.all(Object.values(t)),i=Object.keys(t),s={};for(let r=0;r<i.length;r++)s[i[r]]=e[r];return s}return n}const ln=2,Ox=1e4,xr=class xr{constructor(t,e){v(this,"device");v(this,"id");v(this,"source");v(this,"vs");v(this,"fs");v(this,"pipelineFactory");v(this,"shaderFactory");v(this,"userData",{});v(this,"parameters");v(this,"topology");v(this,"bufferLayout");v(this,"isInstanced");v(this,"instanceCount",0);v(this,"vertexCount");v(this,"indexBuffer",null);v(this,"bufferAttributes",{});v(this,"constantAttributes",{});v(this,"bindings",{});v(this,"uniforms",{});v(this,"vertexArray");v(this,"transformFeedback",null);v(this,"pipeline");v(this,"shaderInputs");v(this,"_uniformStore");v(this,"_attributeInfos",{});v(this,"_gpuGeometry",null);v(this,"_getModuleUniforms");v(this,"props");v(this,"_pipelineNeedsUpdate","newly created");v(this,"_needsRedraw","initializing");v(this,"_destroyed",!1);v(this,"_lastDrawTimestamp",-1);v(this,"_lastLogTime",0);v(this,"_logOpen",!1);v(this,"_drawCount",0);var h,f,d,_;this.props={...xr.defaultProps,...e},e=this.props,this.id=e.id||ac("model"),this.device=t,Object.assign(this.userData,e.userData);const i=Object.fromEntries(((h=this.props.modules)==null?void 0:h.map(m=>[m.name,m]))||[]),s=e.shaderInputs||new Ix(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const r=Nx(t),a=(((f=this.props.modules)==null?void 0:f.length)>0?this.props.modules:(d=this.shaderInputs)==null?void 0:d.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:m,getUniforms:w}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:r,...this.props,modules:a});this.source=m,this._getModuleUniforms=w,(_=this.props).shaderLayout||(_.shaderLayout=Zv(this.source))}else{const{vs:m,fs:w,getUniforms:A}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:r,...this.props,modules:a});this.vs=m,this.fs=w,this._getModuleUniforms=A}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,e.geometry&&this.setGeometry(e.geometry),this.pipelineFactory=e.pipelineFactory||xa.getDefaultPipelineFactory(this.device),this.shaderFactory=e.shaderFactory||Aa.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in e&&(this.isInstanced=e.isInstanced),e.instanceCount&&this.setInstanceCount(e.instanceCount),e.vertexCount&&this.setVertexCount(e.vertexCount),e.indexBuffer&&this.setIndexBuffer(e.indexBuffer),e.attributes&&this.setAttributes(e.attributes),e.constantAttributes&&this.setConstantAttributes(e.constantAttributes),e.bindings&&this.setBindings(e.bindings),e.uniforms&&this.setUniformsWebGL(e.uniforms),e.moduleSettings&&this.updateModuleSettingsWebGL(e.moduleSettings),e.transformFeedback&&(this.transformFeedback=e.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var t;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(t=this._gpuGeometry)==null||t.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||(this._needsRedraw=t)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const e=this._areBindingsLoading();if(e)return z.info(ln,`>>> DRAWING ABORTED ${this.id}: ${e} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let i;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Ea(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,a=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(t){var i;(i=this._gpuGeometry)==null||i.destroy();const e=t&&wx(this.device,t);if(e){this.setTopology(e.topology||"triangle-list");const s=new Eo(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(e.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(e)}this._gpuGeometry=e}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const e=new Eo(this.bufferLayout);this.bufferLayout=this._gpuGeometry?e.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){Sa(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new mv(this.shaderInputs.modules);for(const[e,i]of Object.entries(this.shaderInputs.modules))if(kx(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,e){const i=(e==null?void 0:e.disableWarnings)??this.props.disableWarnings;t.indices&&z.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const s=new Eo(this.bufferLayout);for(const[r,a]of Object.entries(t)){const l=s.getBufferLayout(r);if(!l){i||z.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const h=s.getAttributeNamesForBuffer(l);let f=!1;for(const d of h){const _=this._attributeInfos[d];_&&(this.vertexArray.setBuffer(_.location,a),f=!0)}!f&&!i&&z.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,e){for(const[i,s]of Object.entries(t)){const r=this._attributeInfos[i];r?this.vertexArray.setConstantWebGL(r.location,s):((e==null?void 0:e.disableWarnings)??this.props.disableWarnings)||z.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){this.setUniformsWebGL(t)}setUniformsWebGL(t){Ea(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(t){const{bindings:e,uniforms:i}=fd(this._getModuleUniforms(t));Object.assign(this.bindings,e),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof Vo&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[e,i]of Object.entries(this.bindings))i instanceof Vo?i.isReady&&(t[e]=i.texture):t[e]=i;return t}_getBindingsUpdateTimestamp(){let t=0;for(const e of Object.values(this.bindings))e instanceof Ws?t=Math.max(t,e.texture.updateTimestamp):e instanceof bt||e instanceof St?t=Math.max(t,e.updateTimestamp):e instanceof Vo?t=e.texture?Math.max(t,e.texture.updateTimestamp):1/0:e instanceof $s||(t=Math.max(t,e.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const e={...t.attributes};for(const[i]of Object.entries(e))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete e[i];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(e,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=t),this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,e=null;this.pipeline&&(z.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,e=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=df(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),e&&this.shaderFactory.release(e)}return this.pipeline}_logDrawCallStart(){const t=z.level>3?0:Ox;z.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,z.group(ln,`>>> DRAWING MODEL ${this.id}`,{collapsed:z.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=Ax(this.pipeline.shaderLayout,this.id);z.table(ln,t)();const e=this.shaderInputs.getDebugTable();for(const[s,r]of Object.entries(this.uniforms))e[s]={value:r};z.table(ln,e)();const i=this._getAttributeDebugTable();z.table(ln,this._attributeInfos)(),z.table(ln,i)(),z.groupEnd(ln)(),this._logOpen=!1}}_logFramebuffer(t){const e=this.device.props.debugFramebuffers;if(this._drawCount++,!e)return;const i=t.props.framebuffer;i&&Sx(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[e,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];t[i.location]={name:e,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:e}=this.vertexArray,i=e.indexType==="uint32"?new Uint32Array(e.debugData):new Uint16Array(e.debugData);t.indices={name:"indices",type:e.indexType,values:i.toString()}}return t}_getBufferOrConstantValues(t,e){const i=gf(e);return(t instanceof bt?new i(t.debugData):t).toString()}};v(xr,"defaultProps",{...qn.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:zs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Wi=xr;function kx(n){return!!(n.uniformTypes&&!Ea(n.uniformTypes))}function Nx(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function Ea(n){for(const t in n)return!1;return!0}const Fi=class Fi{constructor(t,e=Fi.defaultProps){v(this,"device");v(this,"model");v(this,"transformFeedback");if(!Fi.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Wi(this.device,{id:e.id||"buffer-transform-model",fs:e.fs||by(),topology:e.topology||"point-list",varyings:e.outputs||e.varyings,...e}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:e.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(t){var e;return((e=t==null?void 0:t.info)==null?void 0:e.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t!=null&&t.inputBuffers&&this.model.setAttributes(t.inputBuffers),t!=null&&t.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const e=this.device.beginRenderPass(t);this.model.draw(e),e.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const e=this.getBuffer(t);if(!e)throw new Error("BufferTransform#getBuffer");if(e instanceof bt)return e.readAsync();const{buffer:i,byteOffset:s=0,byteLength:r=i.byteLength}=e;return i.readAsync(s,r)}};v(Fi,"defaultProps",{...Wi.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Hi=Fi;const Dx={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class pd extends oc{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:r,pickingFBO:a,deviceRect:{x:l,y:h,width:f,height:d},cullRect:_,effects:m,pass:w="picking",pickZ:A,shaderModuleProps:S}){this.pickZ=A;const k=this._resetColorEncoder(A),B=[l,h,f,d],F=super.render({target:a,layers:t,layerFilter:e,views:i,viewports:s,onViewportActive:r,cullRect:_,effects:m==null?void 0:m.filter(D=>D.useInPicking),pass:w,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:B});return this._colorEncoderState=null,{decodePickingColor:k&&Fx.bind(null,k),stats:F}}shouldDrawLayer(t){const{pickable:e,operation:i}=t.props;return e&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(t,e,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,e,i){const s={...t.props.parameters},{pickable:r,operation:a}=t.props;return!this._colorEncoderState||a.includes("terrain")?s.blend=!1:r&&a.includes("draw")&&(Object.assign(s,Dx),s.blend=!0,s.blendColor=Bx(this._colorEncoderState,t,i)),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Bx(n,t,e){const{byLayer:i,byAlpha:s}=n;let r,a=i.get(t);return a?(a.viewports.push(e),r=a.a):(r=i.size+1,r<=255?(a={a:r,layer:t,viewports:[e]},i.set(t,a),s[r]=a):(vt.warn("Too many pickable layers, only picking the first 255")(),r=0)),[0,0,0,r/255]}function Fx(n,t){const e=n.byAlpha[t[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(t)}}const Vn={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},rr=Symbol.for("component"),_n=Symbol.for("propTypes"),zo=Symbol.for("deprecatedProps"),Yn=Symbol.for("asyncPropDefaults"),bn=Symbol.for("asyncPropOriginal"),Qe=Symbol.for("asyncPropResolved");function _d(n,t=()=>!0){return Array.isArray(n)?gd(n,t,[]):t(n)?[n]:[]}function gd(n,t,e){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?gd(s,t,e):t(s)&&e.push(s)}return e}function Lx({target:n,source:t,start:e=0,count:i=1}){const s=t.length,r=i*s;let a=0;for(let l=e;a<s;a++)n[l++]=t[a];for(;a<r;)a<r-a?(n.copyWithin(e+a,e,e+a),a*=2):(n.copyWithin(e+a,e,e+r-a),a=r);return n}class Ux{constructor(t,e,i){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=i,this.setData(e)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,e){if(t===this._data&&!e)return;this._data=t;const i=++this._loadCount;let s=t;typeof t=="string"&&(s=Ko(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=r)}).catch(r=>{this._loadCount===i&&(this.isLoaded=!0,this._error=r||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const r of this._subscribers)r.onChange(this.getData())}}class Vx{constructor(t){var e;this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:(e=t.device)==null?void 0:e.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:e,forceUpdate:i=!1,persistent:s=!0}){let r=this._resources[t];r?r.setData(e,i):(r=new Ux(t,e,this._context),this._resources[t]=r),r.persistent=s}remove(t){const e=this._resources[t];e&&(e.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const e=this._consumers[t];if(e){for(const i in e){const s=e[i],r=this._resources[s.resourceId];r&&r.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:e,consumerId:i,requestId:s="default"}){const{_resources:r,protocol:a}=this;t.startsWith(a)&&(t=t.replace(a,""),r[t]||this.add({resourceId:t,data:null,persistent:!1}));const l=r[t];if(this._track(i,s,l,e),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,e,i,s){const r=this._consumers,a=r[t]=r[t]||{};let l=a[e];const h=l&&l.resourceId&&this._resources[l.resourceId];h&&(h.unsubscribe(l),this.prune()),i&&(l?(l.onChange=s,l.resourceId=i.id):l={onChange:s,resourceId:i.id},a[e]=l,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const e=this._resources[t];!e.persistent&&!e.inUse()&&(e.delete(),delete this._resources[t])}}}const zx="layerManager.setLayers",Wx="layerManager.activateViewport";class Hx{constructor(t,e){var l;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=h=>{Yt(Wx,this,h),h&&(this.context.viewport=h)};const{deck:i,stats:s,viewport:r,timeline:a}=e||{};this.layers=[],this.resourceManager=new Vx({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t==null?void 0:t.gl,deck:i,shaderAssembler:HT(((l=t==null?void 0:t.info)==null?void 0:l.shadingLanguage)||"glsl"),defaultShaderModules:[Jb],renderPass:void 0,stats:s||new Ar({id:"deck.gl"}),viewport:r||new qi({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new hd,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(t);e=e||s}return e}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(e=>t.find(i=>e.id.indexOf(i)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,e){Yt(zx,this,e,t),this._lastRenderedLayers=t;const i=_d(t,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:e}=this.context;e.find(i=>i.name===t.name)||(e.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:e}=this.context,i=e.findIndex(s=>s.name===t.name);i>=0&&(e.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(t,e,i){i.raiseError(e,`${t} of ${i}`)}_updateLayers(t,e){const i={};for(const a of t)i[a.id]?vt.warn(`Multiple old layers with same id ${a.id}`)():i[a.id]=a;if(this._defaultShaderModulesChanged){for(const a of t)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(e,i,s),this._finalizeOldLayers(i);let r=!1;for(const a of s)if(a.hasUniformTransition()){r=`Uniform transition in ${a}`;break}this._needsUpdate=r,this.layers=s}_updateSublayersRecursively(t,e,i){for(const s of t){s.context=this.context;const r=e[s.id];r===null&&vt.warn(`Multiple new layers with same id ${s.id}`)(),e[s.id]=null;let a=null;try{this._debug&&r!==s&&s.validateProps(),r?(this._transferLayerState(r,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),a=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}a&&this._updateSublayersRecursively(a,e,i)}}_finalizeOldLayers(t){for(const e in t){const i=t[e];i&&this._finalizeLayer(i)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Vn.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}_transferLayerState(t,e){e._transferState(t),e.lifecycle=Vn.MATCHED,e!==t&&(t.lifecycle=Vn.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(e){this._handleError("update",e,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=Vn.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Vn.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}function me(n,t,e){if(n===t)return!0;if(!e||!n||!t)return!1;if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!me(n[i],t[i],e-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof n=="object"&&typeof t=="object"){const i=Object.keys(n),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(!t.hasOwnProperty(r)||!me(n[r],t[r],e-1))return!1;return!0}return!1}class $x{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const e=this.controllers[t];e&&e.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const e=this.controllers[t];e&&e.updateTransition()}}getViewports(t){return t?this._viewports.filter(e=>e.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(e=>{t[e.id]=e}),t}getView(t){return this.views.find(e=>e.id===t)}getViewState(t){const e=typeof t=="string"?this.getView(t):t,i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}getViewport(t){return this._viewportMap[t]}unproject(t,e){const i=this.getViewports(),s={x:t[0],y:t[1]};for(let r=i.length-1;r>=0;--r){const a=i[r];if(a.containsPixel(s)){const l=t.slice();return l[0]-=a.x,l[1]-=a.y,a.unproject(l,e)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,e){(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}_setViews(t){t=_d(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!me(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):vt.warn("missing `viewState` or `initialViewState`")()}_createController(t,e){const i=e.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>{var a;return(a=this.getView(t.id))==null?void 0:a.makeViewport({viewState:r,width:this.width,height:this.height})}})}_updateController(t,e,i,s){const r=t.controller;if(r&&i){const a={...e,...r,id:t.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==r.type)&&(s=this._createController(t,a)),s&&s.setProps(a),s}return null}_rebuildViewports(){const{views:t}=this,e=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=t.length;s--;){const r=t[s],a=this.getViewState(r),l=r.makeViewport({viewState:a,width:this.width,height:this.height});let h=e[r.id];const f=!!r.controller;f&&!h&&(i=!0),(i||!f)&&h&&(h.finalize(),h=null),this.controllers[r.id]=this._updateController(r,a,l,h),l&&this._viewports.unshift(l)}for(const s in e){const r=e[s];r&&!this.controllers[s]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,e){return t.length!==e.length?!0:t.some((i,s)=>!t[s].equals(e[s]))}}const jx=/([0-9]+\.?[0-9]*)(%|px)/;function He(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const t=jx.exec(n);if(t&&t.length>=3){const e=t[2]==="%",i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error(`Could not parse position string ${n}`)}}function $e(n,t){return n.relative?Math.round(n.position*t):n.position}class Xx{constructor(t){const{id:e,x:i=0,y:s=0,width:r="100%",height:a="100%",padding:l=null}=t;this.id=e||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=He(i),this._y=He(s),this._width=He(r),this._height=He(a),this._padding=l&&{left:He(l.left||0),right:He(l.right||0),top:He(l.top||0),bottom:He(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&me(this.props,t.props,2)}makeViewport({width:t,height:e,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:t,height:e});if(!s.height||!s.width)return null;const r=this.getViewportType(i);return new r({...i,...this.props,...s})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:(t==null?void 0:t.id)||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const e={...t};for(const i in this.props.viewState)i!=="id"&&(e[i]=this.props.viewState[i]);return e}return t}getDimensions({width:t,height:e}){const i={x:$e(this._x,t),y:$e(this._y,e),width:$e(this._width,t),height:$e(this._height,e)};return this._padding&&(i.padding={left:$e(this._padding.left,t),top:$e(this._padding.top,e),right:$e(this._padding.right,t),bottom:$e(this._padding.bottom,e)}),i}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class Pr{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){var e,i;this.cancel(),this.settings=t,this._inProgress=!0,(i=(e=this.settings).onStart)==null||i.call(e,this)}end(){var t,e;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)==null||e.call(t,this))}cancel(){var t,e;this._inProgress&&((e=(t=this.settings).onInterrupt)==null||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var t,e;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)==null||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Kh=()=>{},Ra={BREAK:1,SNAP_TO_END:2,IGNORE:3},Zx=n=>n,Yx=Ra.BREAK;class qx{constructor(t){this._onTransitionUpdate=e=>{const{time:i,settings:{interpolator:s,startProps:r,endProps:a,duration:l,easing:h}}=e,f=h(i/l),d=s.interpolateProps(r,a,f);this.propsInTransition=this.getControllerState({...this.props,...d}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Pr(t.timeline),this.onViewStateChange=t.onViewStateChange||Kh,this.onStateChange=t.onStateChange||Kh}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let e=!1;const i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){let s=i;if(this.transition.inProgress){const{interruption:r,endProps:a}=this.transition.settings;s={...i,...r===Ra.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(s,t),e=!0}else this.transition.cancel();return e}updateTransition(){this.transition.update()}_isTransitionEnabled(t){const{transitionDuration:e,transitionInterpolator:i}=t;return(e>0||e==="auto")&&!!i}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,e){return this.transition.inProgress?this.transition.settings.interruption===Ra.IGNORE||this._isUpdateDueToCurrentTransition(e):this._isTransitionEnabled(e)?e.transitionInterpolator.arePropsEqual(t,e):!0}_triggerTransition(t,e){const i=this.getControllerState(t),s=this.getControllerState(e).shortestPathFrom(i),r=e.transitionInterpolator,a=r.getDuration?r.getDuration(t,e):e.transitionDuration;if(a===0)return;const l=r.initializeProps(t,s);this.propsInTransition={};const h={duration:a,easing:e.transitionEasing||Zx,interpolator:r,interruption:e.transitionInterruption||Yx,startProps:l.start,endProps:l.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return e=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t==null||t(e)}}}function jt(n,t){if(!n)throw new Error(t||"deck.gl: assertion failed.")}class Kx{constructor(t){const{compare:e,extract:i,required:s}=t;this._propsToCompare=e,this._propsToExtract=i||e,this._requiredProps=s}arePropsEqual(t,e){for(const i of this._propsToCompare)if(!(i in t)||!(i in e)||!Ui(t[i],e[i]))return!1;return!0}initializeProps(t,e){const i={},s={};for(const r of this._propsToExtract)(r in t||r in e)&&(i[r]=t[r],s[r]=e[r]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(t,e){return e.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(e=>{const i=t[e];jt(Number.isFinite(i)||Array.isArray(i),`${e} is required for transition`)})}}const Jx=["longitude","latitude","zoom","bearing","pitch"],Qx=["longitude","latitude","zoom"];class md extends Kx{constructor(t={}){const e=Array.isArray(t)?t:t.transitionProps,i=Array.isArray(t)?{}:t;i.transitionProps=Array.isArray(e)?{compare:e,required:e}:e||{compare:Jx,required:Qx},super(i.transitionProps),this.opts=i}initializeProps(t,e){const i=super.initializeProps(t,e),{makeViewport:s,around:r}=this.opts;if(s&&r){const a=s(t),l=s(e),h=a.unproject(r);i.start.around=r,Object.assign(i.end,{around:l.project(h),aroundPosition:h,width:e.width,height:e.height})}return i}interpolateProps(t,e,i){const s={};for(const r of this._propsToExtract)s[r]=Gs(t[r]||0,e[r]||0,i);if(e.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...e,...s});Object.assign(s,r.panByPosition(e.aroundPosition,Gs(t.around,e.around,i)))}return s}}const je={transitionDuration:0},Gx=300,Ss=n=>1-(1-n)*(1-n),Un={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},hn={};class t0{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new qx({...t,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){var t;for(const e in this._events)this._events[e]&&((t=this.eventManager)==null||t.off(e,this.handleEvent));this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const e=this._eventStartBlocked;switch(t.type){case"panstart":return e?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return e?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return e?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:e,y:i}=this.props,{offsetCenter:s}=t;return[s.x-e,s.y-i]}isPointInBounds(t,e){const{width:i,height:s}=this.props;if(e&&e.handled)return!1;const r=t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=s;return r&&e&&e.stopPropagation(),r}isFunctionKeyPressed(t){const{srcEvent:e}=t;return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const e=setTimeout(()=>{this._eventStartBlocked===e&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=e}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:e}=t;this.inertia=Number.isFinite(e)?e:e===!0?Gx:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:r=!0,doubleClickZoom:a=!0,touchZoom:l=!0,touchRotate:h=!1,keyboard:f=!0}=t,d=!!this.onViewStateChange;this.toggleEvents(Un.WHEEL,d&&i),this.toggleEvents(Un.PAN,d),this.toggleEvents(Un.PINCH,d&&(l||h)),this.toggleEvents(Un.MULTI_PAN,d&&h),this.toggleEvents(Un.DOUBLE_CLICK,d&&a),this.toggleEvents(Un.KEYBOARD,d&&f),this.scrollZoom=i,this.dragPan=s,this.dragRotate=r,this.doubleClickZoom=a,this.touchZoom=l,this.touchRotate=h,this.keyboard=f}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,e){this.eventManager&&t.forEach(i=>{this._events[i]!==e&&(this._events[i]=e,e?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(t,e=null,i={}){const s={...t.getViewportProps(),...e},r=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(i),r){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;let i=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:e});return this._panMove=i,this.updateViewport(s,je,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const e=this.getCenter(t),i=this.controllerState.pan({pos:e});return this.updateViewport(i,je,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:e}=this;if(this.dragPan&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],r=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Ss},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const e=this.getCenter(t),i=this.controllerState.rotate({pos:e});return this.updateViewport(i,je,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:e}=this;if(this.dragRotate&&e&&t.velocity){const i=this.getCenter(t),s=[i[0]+t.velocityX*e/2,i[1]+t.velocityY*e/2],r=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Ss},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;t.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:r}=t;let a=2/(1+Math.exp(-Math.abs(r*i)));r<0&&a!==0&&(a=1/a);const l=this.controllerState.zoom({pos:e,scale:a});return this.updateViewport(l,{...this._getTransitionProps({around:e}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.rotateStart({pos:e});return this.updateViewport(i,je,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const e=this.getCenter(t);e[0]-=t.deltaX;const i=this.controllerState.rotate({pos:e});return this.updateViewport(i,je,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this;if(this.touchRotate&&e&&t.velocityY){const i=this.getCenter(t),s=[i[0],i[1]+=t.velocityY*e/2],r=this.controllerState.rotate({pos:s});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:e,transitionEasing:Ss},{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return hn._startPinchRotation=t.rotation,hn._lastPinchEvent=t,this.updateViewport(i,je,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let e=this.controllerState;if(this.touchZoom){const{scale:i}=t,s=this.getCenter(t);e=e.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=t;e=e.rotate({deltaAngleX:hn._startPinchRotation-i})}return this.updateViewport(e,je,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),hn._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:e}=this,{_lastPinchEvent:i}=hn;if(this.touchZoom&&e&&i&&t.scale!==i.scale){const s=this.getCenter(t);let r=this.controllerState.rotateEnd();const a=Math.log2(t.scale),l=(a-Math.log2(i.scale))/(t.deltaTime-i.deltaTime),h=Math.pow(2,a+l*e/2);r=r.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:s}),transitionDuration:e,transitionEasing:Ss},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return hn._startPinchRotation=null,hn._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;const i=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const e=this.isFunctionKeyPressed(t),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:r,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let h;const f={};switch(t.srcEvent.code){case"Minus":h=e?l.zoomOut(i).zoomOut(i):l.zoomOut(i),f.isZooming=!0;break;case"Equal":h=e?l.zoomIn(i).zoomIn(i):l.zoomIn(i),f.isZooming=!0;break;case"ArrowLeft":e?(h=l.rotateLeft(r),f.isRotating=!0):(h=l.moveLeft(s),f.isPanning=!0);break;case"ArrowRight":e?(h=l.rotateRight(r),f.isRotating=!0):(h=l.moveRight(s),f.isPanning=!0);break;case"ArrowUp":e?(h=l.rotateUp(a),f.isRotating=!0):(h=l.moveUp(s),f.isPanning=!0);break;case"ArrowDown":e?(h=l.rotateDown(a),f.isRotating=!0):(h=l.moveDown(s),f.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),f),!0}_getTransitionProps(t){const{transition:e}=this;return!e||!e.transitionInterpolator?je:t?{...e,transitionInterpolator:new md({...t,...e.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:e}}class e0{constructor(t,e){this._viewportProps=this.applyConstraints(t),this._state=e}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Jh=5,n0=1.2;class i0 extends e0{constructor(t){const{width:e,height:i,latitude:s,longitude:r,zoom:a,bearing:l=0,pitch:h=0,altitude:f=1.5,position:d=[0,0,0],maxZoom:_=20,minZoom:m=0,maxPitch:w=60,minPitch:A=0,startPanLngLat:S,startZoomLngLat:k,startRotatePos:B,startBearing:F,startPitch:M,startZoom:D,normalize:H=!0}=t;jt(Number.isFinite(r)),jt(Number.isFinite(s)),jt(Number.isFinite(a)),super({width:e,height:i,latitude:s,longitude:r,zoom:a,bearing:l,pitch:h,altitude:f,maxZoom:_,minZoom:m,maxPitch:w,minPitch:A,normalize:H,position:d},{startPanLngLat:S,startZoomLngLat:k,startRotatePos:B,startBearing:F,startPitch:M,startZoom:D}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:e}){const i=this.getState().startPanLngLat||this._unproject(e);if(!i)return this;const r=this.makeViewport(this.getViewportProps()).panByPosition(i,t);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:e=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:r,startPitch:a}=this.getState();if(!s||r===void 0||a===void 0)return this;let l;return t?l=this._getNewRotation(t,s,a,r):l={bearing:r+e,pitch:a+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:e,scale:i}){let{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(e)||this._unproject(t)),!r)return this;const{maxZoom:a,minZoom:l}=this.getViewportProps();let h=s+Math.log2(i);h=Je(h,l,a);const f=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...f.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){const e=t.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:r}=i;return Math.abs(s-e.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(r-e.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(t){const{maxZoom:e,minZoom:i,zoom:s}=t;t.zoom=Je(s,i,e);const{maxPitch:r,minPitch:a,pitch:l}=t;t.pitch=Je(l,a,r);const{normalize:h=!0}=t;return h&&Object.assign(t,ET(t)),t}_zoomFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.zoom({pos:[e/2,i/2],scale:t})}_panFromCenter(t){const{width:e,height:i}=this.getViewportProps();return this.pan({startPos:[e/2,i/2],pos:[e/2+t[0],i/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){const e=this.makeViewport(this.getViewportProps());return t&&e.unproject(t)}_getNewRotation(t,e,i,s){const r=t[0]-e[0],a=t[1]-e[1],l=t[1],h=e[1],{width:f,height:d}=this.getViewportProps(),_=r/f;let m=0;a>0?Math.abs(d-h)>Jh&&(m=a/(h-d)*n0):a<0&&h>Jh&&(m=1-l/h),m=Je(m,-1,1);const{minPitch:w,maxPitch:A}=this.getViewportProps(),S=s+180*_;let k=i;return m>0?k=i+m*(A-i):m<0&&(k=i-m*(w-i)),{pitch:k,bearing:S}}}class s0 extends t0{constructor(){super(...arguments),this.ControllerState=i0,this.transition={transitionDuration:300,transitionInterpolator:new md({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];const e=this.props;super.setProps(t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}}class Ir extends Xx{constructor(t={}){super(t)}getViewportType(){return ei}get ControllerType(){return s0}}Ir.displayName="MapView";const r0=new cd;function o0(n,t){const e=n.order??1/0,i=t.order??1/0;return e-i}class a0{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const e=this._defaultEffects;if(!e.find(i=>i.id===t.id)){const i=e.findIndex(s=>o0(s,t)>0);i<0?e.push(t):e.splice(i,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(me(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}getEffects(){return this._resolvedEffects}_setEffects(t){const e={};for(const s of this.effects)e[s.id]=s;const i=[];for(const s of t){const r=e[s.id];let a=s;r&&r!==s?r.setProps?(r.setProps(s.props),a=r):r.cleanup(this._context):r||s.setup(this._context),i.push(a),delete e[s.id]}for(const s in e)e[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),t.some(s=>s instanceof cd)||this._resolvedEffects.push(r0),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class c0 extends oc{shouldDrawLayer(t){const{operation:e}=t.props;return e.includes("draw")||e.includes("terrain")}}const l0="deckRenderer.renderLayers";class h0{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new c0(t),this.pickLayersPass=new pd(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const r=e.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,Yt(l0,this,r,t)}needsRedraw(t={clearRedrawFlags:!1}){const e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}finalize(){const{renderBuffers:t}=this;for(const e of t)e.delete();t.length=0}_preRender(t,e){this.lastPostProcessEffect=null,e.preRenderStats=e.preRenderStats||{};for(const i of t)e.preRenderStats[i.id]=i.preRender(e),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,e=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of t)i.resize(e)}_postRender(t,e){const{renderBuffers:i}=this,s={...e,inputBuffer:i[0],swapBuffer:i[1]};for(const r of t)if(r.postRender){s.target=r.id===this.lastPostProcessEffect?e.target:void 0;const a=r.postRender(s);s.inputBuffer=a,s.swapBuffer=a===i[0]?i[1]:i[0]}}}const u0={pickedColor:null,pickedObjectIndex:-1};function f0({pickedColors:n,decodePickingColor:t,deviceX:e,deviceY:i,deviceRadius:s,deviceRect:r}){const{x:a,y:l,width:h,height:f}=r;let d=s*s,_=-1,m=0;for(let w=0;w<f;w++){const A=w+l-i,S=A*A;if(S>d)m+=4*h;else for(let k=0;k<h;k++){if(n[m+3]-1>=0){const F=k+a-e,M=F*F+S;M<=d&&(d=M,_=m)}m+=4}}if(_>=0){const w=n.slice(_,_+4),A=t(w);if(A){const S=Math.floor(_/4/h),k=_/4-S*h;return{...A,pickedColor:w,pickedX:a+k,pickedY:l+S}}vt.error("Picked non-existent layer. Is picking buffer corrupt?")()}return u0}function d0({pickedColors:n,decodePickingColor:t}){const e=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const r=n.slice(i,i+4),a=r.join(",");if(!e.has(a)){const l=t(r);l?e.set(a,{...l,color:r}):vt.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(e.values())}function yd({pickInfo:n,viewports:t,pixelRatio:e,x:i,y:s,z:r}){let a=t[0];t.length>1&&(a=_0((n==null?void 0:n.pickedViewports)||t,{x:i,y:s}));let l;if(a){const h=[i-a.x,s-a.y];r!==void 0&&(h[2]=r),l=a.unproject(h)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:l,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:e}}function p0(n){const{pickInfo:t,lastPickedInfo:e,mode:i,layers:s}=n,{pickedColor:r,pickedLayer:a,pickedObjectIndex:l}=t,h=a?[a]:[];if(i==="hover"){const _=e.index,m=e.layerId,w=a?a.props.id:null;if(w!==m||l!==_){if(w!==m){const A=s.find(S=>S.props.id===m);A&&h.unshift(A)}e.layerId=w,e.index=l,e.info=null}}const f=yd(n),d=new Map;return d.set(null,f),h.forEach(_=>{let m={...f};_===a&&(m.color=r,m.index=l,m.picked=!0),m=vd({layer:_,info:m,mode:i});const w=m.layer;_===a&&i==="hover"&&(e.info=m),d.set(w.id,m),i==="hover"&&w.updateAutoHighlight(m)}),d}function vd({layer:n,info:t,mode:e}){for(;n&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=n,t=n.getPickingInfo({info:t,mode:e,sourceLayer:i}),n=n.parent}return t}function _0(n,t){for(let e=n.length-1;e>=0;e--){const i=n[e];if(i.containsPixel(t))return i}return n[0]}class g0{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new pd(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:e,layers:i,viewports:s},r=this.lastPickedInfo.info){const a=r&&r.layer&&r.layer.id,l=r&&r.viewport&&r.viewport.id,h=a?i.find(m=>m.id===a):null,f=l&&s.find(m=>m.id===l)||s[0],d=f&&f.unproject([t-f.x,e-f.y]);return{...r,...{x:t,y:e,viewport:f,coordinate:d,layer:h}}}_resizeBuffer(){var e,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:t}=this.device.getDefaultCanvasContext();(e=this.pickingFBO)==null||e.resize({width:t.width,height:t.height}),(i=this.depthFBO)==null||i.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const e=t.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return e.length?e:null}_pickClosestObject({layers:t,views:e,viewports:i,x:s,y:r,radius:a=0,depth:l=1,mode:h="query",unproject3D:f,onViewportActive:d,effects:_}){const m=this.device.canvasContext.cssToDeviceRatio(),w=this._getPickable(t);if(!w||i.length===0)return{result:[],emptyInfo:yd({viewports:i,x:s,y:r,pixelRatio:m})};this._resizeBuffer();const A=this.device.canvasContext.cssToDevicePixels([s,r],!0),S=[A.x+Math.floor(A.width/2),A.y+Math.floor(A.height/2)],k=Math.round(a*m),{width:B,height:F}=this.pickingFBO,M=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:k,deviceWidth:B,deviceHeight:F}),D={x:s-a,y:r-a,width:a*2+1,height:a*2+1};let H;const W=[],at=new Set;for(let Y=0;Y<l;Y++){let J;if(M){const X=this._drawAndSample({layers:w,views:e,viewports:i,onViewportActive:d,deviceRect:M,cullRect:D,effects:_,pass:`picking:${h}`});J=f0({...X,deviceX:S[0],deviceY:S[1],deviceRadius:k,deviceRect:M})}else J={pickedColor:null,pickedObjectIndex:-1};let rt;if(J.pickedLayer&&f&&this.depthFBO){const{pickedColors:X}=this._drawAndSample({layers:[J.pickedLayer],views:e,viewports:i,onViewportActive:d,deviceRect:{x:J.pickedX,y:J.pickedY,width:1,height:1},cullRect:D,effects:_,pass:`picking:${h}:z`},!0);X[3]&&(rt=X[0])}J.pickedLayer&&Y+1<l&&(at.add(J.pickedLayer),J.pickedLayer.disablePickingIndex(J.pickedObjectIndex)),H=p0({pickInfo:J,lastPickedInfo:this.lastPickedInfo,mode:h,layers:w,viewports:i,x:s,y:r,z:rt,pixelRatio:m});for(const X of H.values())X.layer&&W.push(X);if(!J.pickedColor)break}for(const Y of at)Y.restorePickingColors();return{result:W,emptyInfo:H.get(null)}}_pickVisibleObjects({layers:t,views:e,viewports:i,x:s,y:r,width:a=1,height:l=1,mode:h="query",maxObjects:f=null,onViewportActive:d,effects:_}){const m=this._getPickable(t);if(!m||i.length===0)return[];this._resizeBuffer();const w=this.device.canvasContext.cssToDeviceRatio(),A=this.device.canvasContext.cssToDevicePixels([s,r],!0),S=A.x,k=A.y+A.height,B=this.device.canvasContext.cssToDevicePixels([s+a,r+l],!0),F=B.x+B.width,M=B.y,D={x:S,y:M,width:F-S,height:k-M},H=this._drawAndSample({layers:m,views:e,viewports:i,onViewportActive:d,deviceRect:D,cullRect:{x:s,y:r,width:a,height:l},effects:_,pass:`picking:${h}`}),W=d0(H),at=new Map,Y=[],J=Number.isFinite(f);for(let rt=0;rt<W.length&&!(J&&Y.length>=f);rt++){const X=W[rt];let ot={color:X.pickedColor,layer:null,index:X.pickedObjectIndex,picked:!0,x:s,y:r,pixelRatio:w};ot=vd({layer:X.pickedLayer,info:ot,mode:h});const Bt=ot.layer.id;at.has(Bt)||at.set(Bt,new Set);const tt=at.get(Bt),ye=ot.object??ot.index;tt.has(ye)||(tt.add(ye),Y.push(ot))}return Y}_drawAndSample({layers:t,views:e,viewports:i,onViewportActive:s,deviceRect:r,cullRect:a,effects:l,pass:h},f=!1){const d=f?this.depthFBO:this.pickingFBO,_={layers:t,layerFilter:this.layerFilter,views:e,viewports:i,onViewportActive:s,pickingFBO:d,deviceRect:r,cullRect:a,effects:l,pass:h,pickZ:f,preRenderStats:{},isPicking:!0};for(const F of l)F.useInPicking&&(_.preRenderStats[F.id]=F.preRender(_));const{decodePickingColor:m}=this.pickLayersPass.render(_),{x:w,y:A,width:S,height:k}=r,B=new(f?Float32Array:Uint8Array)(S*k*4);return this.device.readPixelsToArrayWebGL(d,{sourceX:w,sourceY:A,sourceWidth:S,sourceHeight:k,target:B}),{pickedColors:B,decodePickingColor:m}}_getPickingRect({deviceX:t,deviceY:e,deviceRadius:i,deviceWidth:s,deviceHeight:r}){const a=Math.max(0,t-i),l=Math.max(0,e-i),h=Math.min(s,t+i+1)-a,f=Math.min(r,e+i+1)-l;return h<=0||f<=0?null:{x:a,y:l,width:h,height:f}}}const m0={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},y0="top-left",Qh="__root";class v0{constructor({deck:t,parentElement:e}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=e}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!me(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(e=>e.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const e={};for(const i of this.resolvedWidgets)e[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)e[i.id]=null,this.resolvedWidgets.push(i);for(let i of t){const s=e[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),e[i.id]=null,this.resolvedWidgets.push(i)}for(const i in e){const s=e[i];s&&this._remove(s)}this.widgets=t}_add(t){const{viewId:e=null,placement:i=y0}=t,s=t.onAdd({deck:this.deck,viewId:e});s&&this._getContainer(e,i).append(s),t._element=s}_remove(t){var e;(e=t.onRemove)==null||e.call(t),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,e){var a;const i=t||Qh;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(a=this.parentElement)==null||a.append(s),this.containers[i]=s);let r=s.querySelector(`.${e}`);return r||(r=document.createElement("div"),r.className=e,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,m0[e]),s.append(r)),r}_updateContainers(){const t=this.deck.width,e=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,r=i===Qh||s,a=this.containers[i];r?(a.style.display="block",a.style.left=`${s?s.x:0}px`,a.style.top=`${s?s.y:0}px`,a.style.width=`${s?s.width:t}px`,a.style.height=`${s?s.height:e}px`):a.style.display="none"}}onRedraw({viewports:t,layers:e}){var s,r;const i=t.reduce((a,l)=>(a[l.id]=l,a),{});for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const h=i[l];h&&(a.onViewportChange&&a.onViewportChange(h),(s=a.onRedraw)==null||s.call(a,{viewports:[h],layers:e}))}else{if(a.onViewportChange)for(const h of t)a.onViewportChange(h);(r=a.onRedraw)==null||r.call(a,{viewports:t,layers:e})}}this.lastViewports=i,this._updateContainers()}onHover(t,e){var i,s;for(const r of this.getWidgets()){const{viewId:a}=r;(!a||a===((i=t.viewport)==null?void 0:i.id))&&((s=r.onHover)==null||s.call(r,t,e))}}onEvent(t,e){var s,r;const i=va[e.type];if(i)for(const a of this.getWidgets()){const{viewId:l}=a;(!l||l===((s=t.viewport)==null?void 0:s.id))&&((r=a[i])==null||r.call(a,t,e))}}}const b0={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class w0{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const e=document.createElement("div");return e.className="deck-tooltip",Object.assign(e.style,b0),this.deck=t,this.element=e,e}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){var e;this.isVisible&&t.id===((e=this.lastViewport)==null?void 0:e.id)&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:e}=this,i=e&&e.props.getTooltip;if(!i)return;const s=i(t);this.lastViewport=t.viewport,this.setTooltip(s,t.x,t.y)}setTooltip(t,e,i){const s=this.element;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${e}px, ${i}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}}var Wn;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Wn||(Wn={}));const cc={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Mt=(n,t,e)=>t?n.enable(e):n.disable(e),Gh=(n,t,e)=>n.hint(e,t),Gt=(n,t,e)=>n.pixelStorei(e,t),tu=(n,t,e)=>{const i=e===36006?36009:36008;return n.bindFramebuffer(i,t)},wi=(n,t,e)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[e];n.bindBuffer(s,t)};function Wo(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const T0={3042:Mt,32773:(n,t)=>n.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,t)=>n.clearColor(...t),3107:(n,t)=>n.colorMask(...t),2884:Mt,2885:(n,t)=>n.cullFace(t),2929:Mt,2931:(n,t)=>n.clearDepth(t),2932:(n,t)=>n.depthFunc(t),2928:(n,t)=>n.depthRange(...t),2930:(n,t)=>n.depthMask(t),3024:Mt,35723:Gh,35725:(n,t)=>n.useProgram(t),36007:(n,t)=>n.bindRenderbuffer(36161,t),36389:(n,t)=>{var e;return(e=n.bindTransformFeedback)==null?void 0:e.call(n,36386,t)},34229:(n,t)=>n.bindVertexArray(t),36006:tu,36010:tu,34964:wi,36662:wi,36663:wi,35053:wi,35055:wi,2886:(n,t)=>n.frontFace(t),33170:Gh,2849:(n,t)=>n.lineWidth(t),32823:Mt,32824:"polygonOffset",10752:"polygonOffset",35977:Mt,32926:Mt,32928:Mt,32938:"sampleCoverage",32939:"sampleCoverage",3089:Mt,3088:(n,t)=>n.scissor(...t),2960:Mt,2961:(n,t)=>n.clearStencil(t),2968:(n,t)=>n.stencilMaskSeparate(1028,t),36005:(n,t)=>n.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,t)=>n.viewport(...t),34383:Mt,10754:Mt,12288:Mt,12289:Mt,12290:Mt,12291:Mt,12292:Mt,12293:Mt,12294:Mt,12295:Mt,3333:Gt,3317:Gt,37440:Gt,37441:Gt,37443:Gt,3330:Gt,3332:Gt,3331:Gt,3314:Gt,32878:Gt,3316:Gt,3315:Gt,32877:Gt,framebuffer:(n,t)=>{const e=t&&"handle"in t?t.handle:t;return n.bindFramebuffer(36160,e)},blend:(n,t)=>t?n.enable(3042):n.disable(3042),blendColor:(n,t)=>n.blendColor(...t),blendEquation:(n,t)=>{const e=typeof t=="number"?[t,t]:t;n.blendEquationSeparate(...e)},blendFunc:(n,t)=>{const e=(t==null?void 0:t.length)===2?[...t,...t]:t;n.blendFuncSeparate(...e)},clearColor:(n,t)=>n.clearColor(...t),clearDepth:(n,t)=>n.clearDepth(t),clearStencil:(n,t)=>n.clearStencil(t),colorMask:(n,t)=>n.colorMask(...t),cull:(n,t)=>t?n.enable(2884):n.disable(2884),cullFace:(n,t)=>n.cullFace(t),depthTest:(n,t)=>t?n.enable(2929):n.disable(2929),depthFunc:(n,t)=>n.depthFunc(t),depthMask:(n,t)=>n.depthMask(t),depthRange:(n,t)=>n.depthRange(...t),dither:(n,t)=>t?n.enable(3024):n.disable(3024),derivativeHint:(n,t)=>{n.hint(35723,t)},frontFace:(n,t)=>n.frontFace(t),mipmapHint:(n,t)=>n.hint(33170,t),lineWidth:(n,t)=>n.lineWidth(t),polygonOffsetFill:(n,t)=>t?n.enable(32823):n.disable(32823),polygonOffset:(n,t)=>n.polygonOffset(...t),sampleCoverage:(n,t)=>n.sampleCoverage(t[0],t[1]||!1),scissorTest:(n,t)=>t?n.enable(3089):n.disable(3089),scissor:(n,t)=>n.scissor(...t),stencilTest:(n,t)=>t?n.enable(2960):n.disable(2960),stencilMask:(n,t)=>{t=Wo(t)?t:[t,t];const[e,i]=t;n.stencilMaskSeparate(1028,e),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,t)=>{t=Wo(t)&&t.length===3?[...t,...t]:t;const[e,i,s,r,a,l]=t;n.stencilFuncSeparate(1028,e,i,s),n.stencilFuncSeparate(1029,r,a,l)},stencilOp:(n,t)=>{t=Wo(t)&&t.length===3?[...t,...t]:t;const[e,i,s,r,a,l]=t;n.stencilOpSeparate(1028,e,i,s),n.stencilOpSeparate(1029,r,a,l)},viewport:(n,t)=>n.viewport(...t)};function At(n,t,e){return t[n]!==void 0?t[n]:e[n]}const x0={blendEquation:(n,t,e)=>n.blendEquationSeparate(At(32777,t,e),At(34877,t,e)),blendFunc:(n,t,e)=>n.blendFuncSeparate(At(32969,t,e),At(32968,t,e),At(32971,t,e),At(32970,t,e)),polygonOffset:(n,t,e)=>n.polygonOffset(At(32824,t,e),At(10752,t,e)),sampleCoverage:(n,t,e)=>n.sampleCoverage(At(32938,t,e),At(32939,t,e)),stencilFuncFront:(n,t,e)=>n.stencilFuncSeparate(1028,At(2962,t,e),At(2967,t,e),At(2963,t,e)),stencilFuncBack:(n,t,e)=>n.stencilFuncSeparate(1029,At(34816,t,e),At(36003,t,e),At(36004,t,e)),stencilOpFront:(n,t,e)=>n.stencilOpSeparate(1028,At(2964,t,e),At(2965,t,e),At(2966,t,e)),stencilOpBack:(n,t,e)=>n.stencilOpSeparate(1029,At(34817,t,e),At(34818,t,e),At(34819,t,e))},eu={enable:(n,t)=>n({[t]:!0}),disable:(n,t)=>n({[t]:!1}),pixelStorei:(n,t,e)=>n({[t]:e}),hint:(n,t,e)=>n({[t]:e}),useProgram:(n,t)=>n({35725:t}),bindRenderbuffer:(n,t,e)=>n({36007:e}),bindTransformFeedback:(n,t,e)=>n({36389:e}),bindVertexArray:(n,t)=>n({34229:t}),bindFramebuffer:(n,t,e)=>{switch(t){case 36160:return n({36006:e,36010:e});case 36009:return n({36006:e});case 36008:return n({36010:e});default:return null}},bindBuffer:(n,t,e)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?n({[i]:e}):{valueChanged:!0}},blendColor:(n,t,e,i,s)=>n({32773:new Float32Array([t,e,i,s])}),blendEquation:(n,t)=>n({32777:t,34877:t}),blendEquationSeparate:(n,t,e)=>n({32777:t,34877:e}),blendFunc:(n,t,e)=>n({32969:t,32968:e,32971:t,32970:e}),blendFuncSeparate:(n,t,e,i,s)=>n({32969:t,32968:e,32971:i,32970:s}),clearColor:(n,t,e,i,s)=>n({3106:new Float32Array([t,e,i,s])}),clearDepth:(n,t)=>n({2931:t}),clearStencil:(n,t)=>n({2961:t}),colorMask:(n,t,e,i,s)=>n({3107:[t,e,i,s]}),cullFace:(n,t)=>n({2885:t}),depthFunc:(n,t)=>n({2932:t}),depthRange:(n,t,e)=>n({2928:new Float32Array([t,e])}),depthMask:(n,t)=>n({2930:t}),frontFace:(n,t)=>n({2886:t}),lineWidth:(n,t)=>n({2849:t}),polygonOffset:(n,t,e)=>n({32824:t,10752:e}),sampleCoverage:(n,t,e)=>n({32938:t,32939:e}),scissor:(n,t,e,i,s)=>n({3088:new Int32Array([t,e,i,s])}),stencilMask:(n,t)=>n({2968:t,36005:t}),stencilMaskSeparate:(n,t,e)=>n({[t===1028?2968:36005]:e}),stencilFunc:(n,t,e,i)=>n({2962:t,2967:e,2963:i,34816:t,36003:e,36004:i}),stencilFuncSeparate:(n,t,e,i,s)=>n({[t===1028?2962:34816]:e,[t===1028?2967:36003]:i,[t===1028?2963:36004]:s}),stencilOp:(n,t,e,i)=>n({2964:t,2965:e,2966:i,34817:t,34818:e,34819:i}),stencilOpSeparate:(n,t,e,i,s)=>n({[t===1028?2964:34817]:e,[t===1028?2965:34818]:i,[t===1028?2966:34819]:s}),viewport:(n,t,e,i,s)=>n({2978:[t,e,i,s]})},Ae=(n,t)=>n.isEnabled(t),nu={3042:Ae,2884:Ae,2929:Ae,3024:Ae,32823:Ae,32926:Ae,32928:Ae,3089:Ae,2960:Ae,35977:Ae},A0=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ii(n,t){if(E0(t))return;const e={};for(const s in t){const r=Number(s),a=T0[s];a&&(typeof a=="string"?e[a]=!0:a(n,t[s],r))}const i=n.state&&n.state.cache;if(i)for(const s in e){const r=x0[s];r(n,t,i)}}function bd(n,t=cc){if(typeof t=="number"){const s=t,r=nu[s];return r?r(n,s):n.getParameter(s)}const e=Array.isArray(t)?t:Object.keys(t),i={};for(const s of e){const r=nu[s];i[s]=r?r(n,Number(s)):n.getParameter(Number(s))}return i}function S0(n){ii(n,cc)}function E0(n){for(const t in n)return!1;return!0}function R0(n,t){if(n===t)return!0;const e=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(t)||ArrayBuffer.isView(t);if(e&&i&&n.length===t.length){for(let s=0;s<n.length;++s)if(n[s]!==t[s])return!1;return!0}return!1}class gn{constructor(t,e){v(this,"gl");v(this,"program",null);v(this,"stateStack",[]);v(this,"enable",!0);v(this,"cache",null);v(this,"log");v(this,"initialized",!1);this.gl=t,this.log=(e==null?void 0:e.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(t){return t.state}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];ii(this.gl,t),this.stateStack.pop()}trackState(t,e){if(this.cache=e.copyState?bd(t):Object.assign({},cc),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,I0(t);for(const i in eu){const s=eu[i];P0(t,i,s)}iu(t,"getParameter"),iu(t,"isEnabled")}_updateCache(t){let e=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in t){const a=t[r],l=this.cache[r];R0(a,l)||(e=!0,i=l,s&&!(r in s)&&(s[r]=l),this.cache[r]=a)}return{valueChanged:e,oldValue:i}}}function iu(n,t){const e=n[t].bind(n);n[t]=function(s){if(s===void 0||A0.has(s))return e(s);const r=gn.get(n);return s in r.cache||(r.cache[s]=e(s)),r.enable?r.cache[s]:e(s)},Object.defineProperty(n[t],"name",{value:`${t}-from-cache`,configurable:!1})}function P0(n,t,e){if(!n[t])return;const i=n[t].bind(n);n[t]=function(...r){const a=gn.get(n),{valueChanged:l,oldValue:h}=e(a._updateCache,...r);return l&&i(...r),h},Object.defineProperty(n[t],"name",{value:`${t}-to-cache`,configurable:!1})}function I0(n){const t=n.useProgram.bind(n);n.useProgram=function(i){const s=gn.get(n);s.program!==i&&(t(i),s.program=i)}}function C0(n,t,e){let i="";const s={preserveDrawingBuffer:!0,...e};let r=null;if(r||(r=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!r&&!e.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,r=n.getContext("webgl2",s),r.luma||(r.luma={}),r.luma.softwareRenderer=!0),r||(r=n.getContext("webgl",{}),r&&(r=null,i||(i="Your browser only supports WebGL1"))),!r)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:a,onContextRestored:l}=t;return n.addEventListener("webglcontextlost",h=>a(h),!1),n.addEventListener("webglcontextrestored",h=>l(h),!1),r.luma||(r.luma={}),r}function ni(n,t,e){return e[t]===void 0&&(e[t]=n.getExtension(t)||null),e[t]}function M0(n,t){const e=n.getParameter(7936),i=n.getParameter(7937);ni(n,"WEBGL_debug_renderer_info",t);const s=t.WEBGL_debug_renderer_info,r=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),a=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),l=r||e,h=a||i,f=n.getParameter(7938),d=wd(l,h),_=O0(l,h),m=k0(l,h);return{type:"webgl",gpu:d,gpuType:m,gpuBackend:_,vendor:l,renderer:h,version:f,shadingLanguage:"glsl",shadingLanguageVersion:300}}function wd(n,t){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(n)||/Apple/i.exec(t)?"apple":/AMD/i.exec(n)||/AMD/i.exec(t)||/ATI/i.exec(n)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(t)?"software":"unknown"}function O0(n,t){return/Metal/i.exec(n)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(t)?"opengl":"unknown"}function k0(n,t){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(t))return"cpu";switch(wd(n,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Td(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Ri="WEBGL_compressed_texture_s3tc",Pi="WEBGL_compressed_texture_s3tc_srgb",Hn="EXT_texture_compression_rgtc",$n="EXT_texture_compression_bptc",N0="WEBGL_compressed_texture_etc",D0="WEBGL_compressed_texture_astc",B0="WEBGL_compressed_texture_etc1",F0="WEBGL_compressed_texture_pvrtc",L0="WEBGL_compressed_texture_atc",su="EXT_texture_norm16",ru="EXT_render_snorm",U0="EXT_color_buffer_float",lc={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ru],"norm16-renderable-webgl":[su],"snorm16-renderable-webgl":[su,ru],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ri,Pi,Hn,$n],"texture-compression-bc5-webgl":[Hn],"texture-compression-bc7-webgl":[$n],"texture-compression-etc2":[N0],"texture-compression-astc":[D0],"texture-compression-etc1-webgl":[B0],"texture-compression-pvrtc-webgl":[F0],"texture-compression-atc-webgl":[L0]};function V0(n){return n in lc}function z0(n,t,e){return(lc[t]||[]).every(s=>ni(n,s,e))}const hc={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:U0,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ri},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Pi},"bc1-rgba-unorm":{gl:33777,x:Ri},"bc1-rgba-unorm-srgb":{gl:35916,x:Pi},"bc2-rgba-unorm":{gl:33778,x:Ri},"bc2-rgba-unorm-srgb":{gl:35918,x:Pi},"bc3-rgba-unorm":{gl:33779,x:Ri},"bc3-rgba-unorm-srgb":{gl:35919,x:Pi},"bc4-r-unorm":{gl:36283,x:Hn},"bc4-r-snorm":{gl:36284,x:Hn},"bc5-rg-unorm":{gl:36285,x:Hn},"bc5-rg-snorm":{gl:36286,x:Hn},"bc6h-rgb-ufloat":{gl:36495,x:$n},"bc6h-rgb-float":{gl:36494,x:$n},"bc7-rgba-unorm":{gl:36492,x:$n},"bc7-rgba-unorm-srgb":{gl:36493,x:$n},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function W0(n,t,e){let i=t.create;const s=hc[t.format];return(s==null?void 0:s.gl)===void 0&&(i=!1),s!=null&&s.x&&(i=i&&!!ni(n,s.x,e)),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}function xd(n){var s;const t=hc[n],e=j0(n),i=Za(n);return{internalFormat:e,format:(t==null?void 0:t.dataFormat)||$0(i.channels,i.integer,i.normalized,e),type:i.dataType?Td(i.dataType):((s=t==null?void 0:t.types)==null?void 0:s[0])||5121,compressed:i.compressed||!1}}function H0(n){switch(Za(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function $0(n,t,e,i){if(i===6408||i===6407)return i;switch(n){case"r":return t&&!e?36244:6403;case"rg":return t&&!e?33320:33319;case"rgb":return t&&!e?36248:6407;case"rgba":return t&&!e?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function j0(n){const t=hc[n],e=t==null?void 0:t.gl;if(e===void 0)throw new Error(`Unsupported texture format ${n}`);return e}const ou={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class X0 extends By{constructor(e,i,s){super([],s);v(this,"gl");v(this,"extensions");v(this,"testedFeatures",new Set);this.gl=e,this.extensions=i,ni(e,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const e=this.getFeatures();for(const i of e)this.has(i)&&(yield i);return[]}has(e){var i;return(i=this.disabledFeatures)!=null&&i[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),V0(e)&&z0(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of e)this.has(i)}getFeatures(){return[...Object.keys(ou),...Object.keys(lc)]}getWebGLFeature(e){const i=ou[e];return typeof i=="string"?!!ni(this.gl,i,this.extensions):!!i}}class Z0 extends Dy{constructor(e){super();v(this,"gl");v(this,"limits",{});this.gl=e}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class ki extends js{constructor(e,i){super(e,i);v(this,"device");v(this,"gl");v(this,"handle");v(this,"colorAttachments",[]);v(this,"depthStencilAttachment",null);const s=i.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const s=this.colorAttachments[i];if(s){const r=36064+i;this._attachTextureView(r,s)}}if(this.depthStencilAttachment){const i=H0(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${q0(i)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,i){const{gl:s}=this.device,{texture:r}=i,a=i.props.baseMipLevel,l=i.props.baseArrayLayer;switch(s.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,e,r.handle,a,l);break;case 34067:const h=Y0(l);s.framebufferTexture2D(36160,e,h,r.handle,a);break;case 3553:s.framebufferTexture2D(36160,e,3553,r.handle,a);break;default:throw new Error("Illegal texture type")}s.bindTexture(r.glTarget,null)}}function Y0(n){return n<34069?n+34069:n}function q0(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class K0 extends sa{constructor(e,i){super(i);v(this,"device");v(this,"format","rgba8unorm");v(this,"depthStencilFormat","depth24plus");v(this,"presentationSize");v(this,"_framebuffer",null);this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new ki(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(e==null?void 0:e.useDevicePixels);this.setDevicePixelRatio(i,e);return}}commit(){}}async function Ad(n,t){const e=document.getElementsByTagName("head")[0];if(!e)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,r)=>{i.onload=s,i.onerror=a=>r(new Error(`Unable to load script '${n}': ${a}`)),e.appendChild(i)})}const J0=1;let mt=null,au=!1;const uc={debugSpectorJS:z.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function Q0(n){if(!globalThis.SPECTOR)try{await Ad(n.debugSpectorJSUrl||uc.debugSpectorJSUrl)}catch(t){z.warn(String(t))}}function G0(n){var t;if(n={...uc,...n},!n.debugSpectorJS)return null;if(!mt&&globalThis.SPECTOR&&!((t=globalThis.luma)!=null&&t.spector)){z.probe(J0,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;mt=new e,globalThis.luma&&(globalThis.luma.spector=mt)}if(!mt)return null;if(au||(au=!0,mt.spyCanvases(),mt==null||mt.onCaptureStarted.add(e=>z.info("Spector capture started:",e)()),mt==null||mt.onCapture.add(e=>{z.info("Spector capture complete:",e)(),mt==null||mt.getResultUI(),mt==null||mt.resultView.display(),mt==null||mt.resultView.addCapture(e)})),n.gl){const e=n.gl,i=e.device;mt==null||mt.startCapture(n.gl,500),e.device=i,new Promise(s=>setTimeout(s,2e3)).then(s=>{z.info("Spector capture stopped after 2 seconds")(),mt==null||mt.stopCapture()})}return mt}const t3="https://unpkg.com/webgl-debug@2.0.1/index.js";function Sd(n){return n.luma=n.luma||{},n.luma}async function e3(){wn()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Ad(t3))}function n3(n,t={}){return t.debugWebGL||t.traceWebGL?s3(n,t):i3(n)}function i3(n){const t=Sd(n);return t.realContext?t.realContext:n}function s3(n,t){if(!globalThis.WebGLDebugUtils)return z.warn("webgl-debug not loaded")(),n;const e=Sd(n);if(e.debugContext)return e.debugContext;globalThis.WebGLDebugUtils.init({...Wn,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,r3.bind(null,t),o3.bind(null,t));for(const a in Wn)!(a in i)&&typeof Wn[a]=="number"&&(i[a]=Wn[a]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const r=Object.create(s);return e.realContext=n,e.debugContext=r,r.debug=!0,r}function cu(n,t){t=Array.from(t).map(i=>i===void 0?"undefined":i);let e=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,t);return e=`${e.slice(0,100)}${e.length>100?"...":""}`,`gl.${n}(${e})`}function r3(n,t,e,i){i=Array.from(i).map(l=>l===void 0?"undefined":l);const s=globalThis.WebGLDebugUtils.glEnumToString(t),r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,i),a=`${s} in gl.${e}(${r})`;z.error(a)();debugger}function o3(n,t,e){let i="";z.level>=1&&(i=cu(t,e),n.traceWebGL&&z.log(1,i)());for(const s of e)if(s===void 0){i=i||cu(t,e);debugger}}const Ho={};function a3(n="id"){Ho[n]=Ho[n]||1;const t=Ho[n]++;return`${n}-${t}`}class Ni extends bt{constructor(e,i={}){super(e,i);v(this,"device");v(this,"gl");v(this,"handle");v(this,"glTarget");v(this,"glUsage");v(this,"glIndexType",5123);v(this,"byteLength");v(this,"bytesUsed");this.device=e,this.gl=this.device.gl;const s=typeof i=="object"?i.handle:void 0;this.handle=s||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=c3(this.props.usage),this.glUsage=l3(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(e,i=0,s=e.byteLength+i){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,s,this.glUsage),this.gl.bufferSubData(r,i,e),this.gl.bindBuffer(r,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(e,i,s),this.trackAllocatedMemory(s)}_initWithByteLength(e){let i=e;e===0&&(i=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,i,e.byteLength)}async readAsync(e=0,i){return this.readSyncWebGL(e,i)}readSyncWebGL(e=0,i){i=i??this.byteLength-e;const s=new Uint8Array(i),r=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,s,r,i),this.gl.bindBuffer(36662,null),this._setDebugData(s,e,i),s}}function c3(n){return n&bt.INDEX?34963:n&bt.VERTEX?34962:n&bt.UNIFORM?35345:34962}function l3(n){return n&bt.INDEX||n&bt.VERTEX?35044:n&bt.UNIFORM?35048:35044}function h3(n){const t=n.split(/\r?\n/),e=[];for(const i of t){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,m]=s;e.push({message:m.trim(),type:lu(_),lineNum:0,linePos:0});continue}const[r,a,l,...h]=s;let f=parseInt(l,10);isNaN(f)&&(f=0);let d=parseInt(a,10);isNaN(d)&&(d=0),e.push({message:h.join(":").trim(),type:lu(r),lineNum:f,linePos:d})}return e}function lu(n){const t=["warning","error","info"],e=n.toLowerCase();return t.includes(e)?e:"info"}class u3 extends Hs{constructor(e,i){super(e,i);v(this,"device");v(this,"handle");switch(this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?h3(e):[]}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(i==null?void 0:i.getTranslatedShaderSource(this.handle))||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,e),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}z.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),z.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async r=>await new Promise(a=>setTimeout(a,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function f3(n,t,e,i){if(g3(t))return i(n);const s=n;s.pushState();try{return d3(n,t),ii(s.gl,e),i(n)}finally{s.popState()}}function d3(n,t){const e=n,{gl:i}=e;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(t.frontFace&&i.frontFace(mn("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),t.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&n.features.has("provoking-vertex-webgl")){const r=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=mn("provokingVertex",t.provokingVertex,{first:36429,last:36430});r==null||r.provokingVertexWEBGL(a)}if((t.polygonMode||t.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=mn("polygonMode",t.polygonMode,{fill:6914,line:6913});r==null||r.polygonModeWEBGL(1028,a),r==null||r.polygonModeWEBGL(1029,a)}t.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),t.depthWriteEnabled!==void 0&&i.depthMask(_3("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Pa("depthCompare",t.depthCompare))),t.stencilWriteMask){const s=t.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(t.stencilReadMask&&z.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const s=t.stencilReadMask||4294967295,r=Pa("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,r,0,s),i.stencilFuncSeparate(1029,r,0,s)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const s=$o("stencilPassOperation",t.stencilPassOperation),r=$o("stencilFailOperation",t.stencilFailOperation),a=$o("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,r,a,s),i.stencilOpSeparate(1029,r,a,s)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const s=hu("blendColorOperation",t.blendColorOperation||"add"),r=hu("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(s,r);const a=Es("blendColorSrcFactor",t.blendColorSrcFactor||"one"),l=Es("blendColorDstFactor",t.blendColorDstFactor||"zero"),h=Es("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),f=Es("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(a,l,h,f)}}function Pa(n,t){return mn(n,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function $o(n,t){return mn(n,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function hu(n,t){return mn(n,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Es(n,t){return mn(n,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function p3(n,t){return`Illegal parameter ${t} for ${n}`}function mn(n,t,e){if(!(t in e))throw new Error(p3(n,t));return e[t]}function _3(n,t){return t}function g3(n){let t=!0;for(const e in n){t=!1;break}return t}function Ed(n){const t={};return n.addressModeU&&(t[10242]=jo(n.addressModeU)),n.addressModeV&&(t[10243]=jo(n.addressModeV)),n.addressModeW&&(t[32882]=jo(n.addressModeW)),n.magFilter&&(t[10240]=Ia(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(t[10241]=m3(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(t[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(t[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(t[34892]=34894),n.compare&&(t[34893]=Pa("compare",n.compare)),n.maxAnisotropy&&(t[34046]=n.maxAnisotropy),t}function jo(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ia(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function m3(n,t="none"){if(!t)return Ia(n);switch(t){case"none":return Ia(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Ca extends $s{constructor(e,i){super(e,i);v(this,"device");v(this,"handle");v(this,"parameters");this.device=e,this.parameters=Ed(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[i,s]of Object.entries(e)){const r=Number(i);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,s);break;default:this.device.gl.samplerParameteri(this.handle,r,s);break}}}}class jn extends Ws{constructor(e,i){super(e,{...St.defaultProps,...i});v(this,"device");v(this,"gl");v(this,"handle");v(this,"texture");this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const y3="Failed to deduce GL constant from typed array";function v3(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(y3)}}function b3(n,t){const{clamped:e=!0}=t||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Rd(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function w3(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function or(n,t,e){if(T3(t))return e(n);const{nocatch:i=!0}=t,s=gn.get(n);s.push(),ii(n,t);let r;if(i)r=e(n),s.pop();else try{r=e(n)}finally{s.pop()}return r}function T3(n){for(const t in n)return!1;return!0}function x3(n,t,e){const{dimension:i,width:s,height:r,depth:a=0}=e,{glInternalFormat:l}=e,h=e.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(h,t,l,s,r,a);break;default:n.texStorage2D(h,t,l,s,r)}}function uu(n,t,e,i){const{width:s,height:r}=i,{dimension:a,depth:l=0,mipLevel:h=0}=i,{x:f=0,y:d=0,z:_=0}=i,{glFormat:m,glType:w}=i,A=Pd(i.glTarget,a,l),S=i.flipY?{37440:!0}:{};or(n,S,()=>{switch(a){case"2d-array":case"3d":n.bindTexture(A,t),n.texSubImage3D(A,h,f,d,_,s,r,l,m,w,e),n.bindTexture(A,null);break;case"2d":case"cube":n.bindTexture(A,t),n.texSubImage2D(A,h,f,d,s,r,m,w,e),n.bindTexture(A,null);break;default:throw new Error(a)}})}function fu(n,t,e){const{dimension:i,width:s,height:r,depth:a=0,mipLevel:l=0,byteOffset:h=0}=e,{x:f=0,y:d=0,z:_=0}=e,{glFormat:m,glType:w,compressed:A}=e,S=Pd(e.glTarget,i,a);switch(i){case"2d-array":case"3d":A?n.compressedTexSubImage3D(S,l,f,d,_,s,r,a,m,t,h):n.texSubImage3D(S,l,f,d,_,s,r,a,m,w,t,h);break;case"2d":case"cube":A?n.compressedTexSubImage2D(S,l,f,d,s,r,m,t,h):n.texSubImage2D(S,l,f,d,s,r,m,w,t,h);break;default:throw new Error(i)}}function A3(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function Pd(n,t,e){return t==="cube"?34069+e:n}function S3(n,t){var B;const{sourceX:e=0,sourceY:i=0,sourceAttachment:s=0}=t||{};let{target:r=null,sourceWidth:a,sourceHeight:l,sourceDepth:h,sourceFormat:f,sourceType:d}=t||{};const{framebuffer:_,deleteFramebuffer:m}=Id(n),{gl:w,handle:A}=_;a||(a=_.width),l||(l=_.height);const S=(B=_.colorAttachments[s])==null?void 0:B.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${s}`);h=(S==null?void 0:S.depth)||1,f||(f=(S==null?void 0:S.glFormat)||6408),d||(d=(S==null?void 0:S.glType)||5121),r=P3(r,d,f,a,l),d=d||v3(r);const k=w.bindFramebuffer(36160,A);return w.readBuffer(36064+s),w.readPixels(e,i,a,l,f,d,r),w.readBuffer(36064),w.bindFramebuffer(36160,k||null),m&&_.destroy(),r}function E3(n,t){const{target:e,sourceX:i=0,sourceY:s=0,sourceFormat:r=6408,targetByteOffset:a=0}=t||{};let{sourceWidth:l,sourceHeight:h,sourceType:f}=t||{};const{framebuffer:d,deleteFramebuffer:_}=Id(n);l=l||d.width,h=h||d.height;const m=d;f=f||5121;let w=e;if(!w){const S=Rd(r),k=w3(f),B=a+l*h*S*k;w=m.device.createBuffer({byteLength:B})}const A=n.device.createCommandEncoder();return A.copyTextureToBuffer({sourceTexture:n,width:l,height:h,origin:[i,s],destinationBuffer:w,byteOffset:a}),A.destroy(),_&&d.destroy(),w}function Id(n){return n instanceof js?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:R3(n),deleteFramebuffer:!0}}function R3(n,t){const{device:e,width:i,height:s,id:r}=n;return e.createFramebuffer({...t,id:`framebuffer-for-${r}`,width:i,height:s,colorAttachments:[n]})}function P3(n,t,e,i,s,r){if(n)return n;t||(t=5121);const a=b3(t,{clamped:!1}),l=Rd(e);return new a(i*s*l)}class Di extends St{constructor(e,i){super(e,i);v(this,"device");v(this,"gl");v(this,"handle");v(this,"sampler");v(this,"view");v(this,"mipmaps");v(this,"compressed");v(this,"glTarget");v(this,"glFormat");v(this,"glType");v(this,"glInternalFormat");v(this,"textureUnit",0);const s={...this.props};s.data=i.data,this.device=e,this.gl=this.device.gl,this.glTarget=A3(this.props.dimension);const r=xd(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:i,height:s}=e;if(!i||!s){const r=St.getTextureDataSize(e.data);i=(r==null?void 0:r.width)||1,s=(r==null?void 0:r.height)||1}if(this.width=i,this.height=s,this.depth=e.depth,this.setSampler(e.sampler),this.view=new jn(this.device,{...this.props,texture:this}),this.bind(),x3(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new jn(this.device,{...e,texture:this})}setSampler(e={}){let i;e instanceof Ca?(this.sampler=e,i=e.props):(this.sampler=new Ca(this.device,e),i=e);const s=Ed(i);this._setSamplerParameters(s)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(z.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(e!=null&&e.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){z.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const i=St.getExternalImageSize(e.image),s={...St.defaultCopyExternalImageOptions,...i,...e},{image:r,depth:a,mipLevel:l,x:h,y:f,z:d,flipY:_}=s;let{width:m,height:w}=s;const{dimension:A,glTarget:S,glFormat:k,glInternalFormat:B,glType:F}=this;if(m=Math.min(m,this.width-h),w=Math.min(w,this.height-f),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return uu(this.device.gl,this.handle,r,{dimension:A,mipLevel:l,x:h,y:f,z:d,width:m,height:w,depth:a,glFormat:k,glType:F,glTarget:S,flipY:_}),{width:s.width,height:s.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,i=0){this.bind();const s=St.normalizeTextureData(e,this);s.length>1&&this.props.mipmaps!==!1&&z.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<s.length;r++){const a=s[r];this._setMipLevel(i,r,a)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),fu(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of St.CubeFaces)this.setTextureCubeFaceData(e[s],s)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,i,s=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&z.warn(`${this.id} has mipmap and multiple LODs.`)();const r=St.CubeFaces.indexOf(i);this.setTexture2DData(e,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:i,width:s,height:r,pixels:a,data:l,format:h=6408,type:f=5121}=e,{gl:d}=this,_=a||l;this.bind(),_ instanceof Promise?_.then(m=>this.setImageDataForFace(Object.assign({},e,{face:i,data:m,pixels:m}))):this.width||this.height?d.texImage2D(i,0,h,s,r,0,h,f,_):d.texImage2D(i,0,h,h,f,_)}_getImageDataMap(e){for(let i=0;i<St.CubeFaces.length;++i){const s=St.CubeFaces[i];e[s]&&(e[34069+i]=e[s],delete e[s])}return e}_setSamplerParameters(e){z.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,s]of Object.entries(e)){const r=Number(i),a=s;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,a);break;case 10241:this.gl.texParameteri(this.glTarget,r,a);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,a);break;default:this.gl.texParameteri(this.glTarget,r,a);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,i,s,r=this.glTarget){if(St.isExternalImage(s)){uu(this.device.gl,this.handle,s,{...this,depth:e,mipLevel:i,glTarget:r,flipY:this.props.flipY});return}if(St.isTextureLevelData(s)){fu(this.device.gl,s.data,{...this,depth:e,mipLevel:i,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:i}=this;return e!==void 0&&(this.textureUnit=e,i.activeTexture(33984+e)),i.bindTexture(this.glTarget,null),e}}const I3=[1,2,4,8];class C3 extends ra{constructor(e,i){var a;super(e,i);v(this,"device");v(this,"glParameters");this.device=e;let s;if(!((a=i==null?void 0:i.parameters)!=null&&a.viewport))if(i!=null&&i.framebuffer){const{width:l,height:h}=i.framebuffer;s=[0,0,l,h]}else{const[l,h]=e.getCanvasContext().getDrawingBufferSize();s=[0,0,l,h]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const r=this.props.framebuffer;if(r!=null&&r.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((h,f)=>36064+f);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(i.viewport=e.viewport.slice(0,4),i.depthRange=[e.viewport[4],e.viewport[5]]):i.viewport=e.viewport),e.scissorRect&&(i.scissorTest=!0,i.scissor=e.scissorRect),e.blendConstant&&(i.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(i.colorMask=I3.map(s=>!!(s&e.colorMask))),this.glParameters=i,ii(this.device.gl,i)}beginOcclusionQuery(e){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e==null||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((s,r)=>{s&&this.clearColorBuffer(r,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,e.clearStencil=this.props.clearStencil),i!==0&&or(this.device.gl,e,()=>{this.device.gl.clear(i)})}clearColorBuffer(e=0,i=[0,0,0,0]){or(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function M3(n){return O3.includes(n)}const O3=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Cd={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Md(n){const t=Cd[n];if(!t)throw new Error("uniform");const[e,i,,s]=t;return{format:s,components:i,glType:e}}function k3(n){const t=Cd[n];if(!t)throw new Error("attribute");const[,e,,i,s]=t;return{attributeType:i,vertexFormat:s,components:e}}function N3(n,t){const e={attributes:[],bindings:[]};e.attributes=D3(n,t);const i=L3(n,t);for(const l of i){const h=l.uniforms.map(f=>({name:f.name,format:f.format,byteOffset:f.byteOffset,byteStride:f.byteStride,arrayLength:f.arrayLength}));e.bindings.push({type:"uniform",name:l.name,group:0,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:h})}const s=F3(n,t);let r=0;for(const l of s)if(M3(l.type)){const{viewDimension:h,sampleType:f}=V3(l.type);e.bindings.push({type:"texture",name:l.name,group:0,location:r,viewDimension:h,sampleType:f}),l.textureUnit=r,r+=1}s.length&&(e.uniforms=s);const a=B3(n,t);return a!=null&&a.length&&(e.varyings=a),e}function D3(n,t){const e=[],i=n.getProgramParameter(t,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(t,s);if(!r)throw new Error("activeInfo");const{name:a,type:l}=r,h=n.getAttribLocation(t,a);if(h>=0){const{attributeType:f}=k3(l),d=/instance/i.test(a)?"instance":"vertex";e.push({name:a,location:h,stepMode:d,type:f})}}return e.sort((s,r)=>s.location-r.location),e}function B3(n,t){const e=[],i=n.getProgramParameter(t,35971);for(let s=0;s<i;s++){const r=n.getTransformFeedbackVarying(t,s);if(!r)throw new Error("activeInfo");const{name:a,type:l,size:h}=r,{glType:f,components:d}=Md(l),_={location:s,name:a,type:f,size:h*d};e.push(_)}return e.sort((s,r)=>s.location-r.location),e}function F3(n,t){const e=[],i=n.getProgramParameter(t,35718);for(let s=0;s<i;s++){const r=n.getActiveUniform(t,s);if(!r)throw new Error("activeInfo");const{name:a,size:l,type:h}=r,{name:f,isArray:d}=z3(a);let _=n.getUniformLocation(t,f);const m={location:_,name:f,size:l,type:h,isArray:d};if(e.push(m),m.size>1)for(let w=0;w<m.size;w++){const A=`${f}[${w}]`;_=n.getUniformLocation(t,A);const S={...m,name:A,location:_};e.push(S)}}return e}function L3(n,t){const e=(r,a)=>n.getActiveUniformBlockParameter(t,r,a),i=[],s=n.getProgramParameter(t,35382);for(let r=0;r<s;r++){const a={name:n.getActiveUniformBlockName(t,r)||"",location:e(r,35391),byteLength:e(r,35392),vertex:e(r,35396),fragment:e(r,35398),uniformCount:e(r,35394),uniforms:[]},l=e(r,35395)||[],h=n.getActiveUniforms(t,l,35383),f=n.getActiveUniforms(t,l,35384),d=n.getActiveUniforms(t,l,35387),_=n.getActiveUniforms(t,l,35388);for(let m=0;m<a.uniformCount;++m){const w=n.getActiveUniform(t,l[m]);if(!w)throw new Error("activeInfo");a.uniforms.push({name:w.name,format:Md(h[m]).format,type:h[m],arrayLength:f[m],byteOffset:d[m],byteStride:_[m]})}i.push(a)}return i.sort((r,a)=>r.location-a.location),i}const U3={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function V3(n){const t=U3[n];if(!t)throw new Error("sampler");const[e,i]=t;return{viewDimension:e,sampleType:i}}function z3(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:e[1],length:e[2]?1:0,isArray:!!e[2]}}function W3(n,t,e,i){const s=n;let r=i;r===!0&&(r=1),r===!1&&(r=0);const a=typeof r=="number"?[r]:r;switch(e){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(t,i);case 5126:return n.uniform1fv(t,a);case 35664:return n.uniform2fv(t,a);case 35665:return n.uniform3fv(t,a);case 35666:return n.uniform4fv(t,a);case 5124:return n.uniform1iv(t,a);case 35667:return n.uniform2iv(t,a);case 35668:return n.uniform3iv(t,a);case 35669:return n.uniform4iv(t,a);case 35670:return n.uniform1iv(t,a);case 35671:return n.uniform2iv(t,a);case 35672:return n.uniform3iv(t,a);case 35673:return n.uniform4iv(t,a);case 5125:return s.uniform1uiv(t,a,1);case 36294:return s.uniform2uiv(t,a,2);case 36295:return s.uniform3uiv(t,a,3);case 36296:return s.uniform4uiv(t,a,4);case 35674:return n.uniformMatrix2fv(t,!1,a);case 35675:return n.uniformMatrix3fv(t,!1,a);case 35676:return n.uniformMatrix4fv(t,!1,a);case 35685:return s.uniformMatrix2x3fv(t,!1,a);case 35686:return s.uniformMatrix2x4fv(t,!1,a);case 35687:return s.uniformMatrix3x2fv(t,!1,a);case 35688:return s.uniformMatrix3x4fv(t,!1,a);case 35689:return s.uniformMatrix4x2fv(t,!1,a);case 35690:return s.uniformMatrix4x3fv(t,!1,a)}throw new Error("Illegal uniform")}function H3(n){return ud(n)!==null||typeof n=="number"||typeof n=="boolean"}function $3(n){const t={bindings:{},uniforms:{}};return Object.keys(n).forEach(e=>{const i=n[e];H3(i)?t.uniforms[e]=i:t.bindings[e]=i}),t}function j3(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function X3(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const du=4;class Z3 extends qn{constructor(e,i){super(e,i);v(this,"device");v(this,"handle");v(this,"vs");v(this,"fs");v(this,"introspectedLayout");v(this,"uniforms",{});v(this,"bindings",{});v(this,"varyings",null);v(this,"_uniformCount",0);v(this,"_uniformSetters",{});this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:s,bufferMode:r=35981}=i;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,r)),this._linkShaders(),z.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=N3(this.device.gl,this.handle),z.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Y3(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,i){for(const[s,r]of Object.entries(e)){const a=this.shaderLayout.bindings.find(l=>l.name===s)||this.shaderLayout.bindings.find(l=>l.name===`${s}Uniforms`);if(!a){const l=this.shaderLayout.bindings.map(h=>`"${h.name}"`).join(", ");i!=null&&i.disableWarnings||z.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${l}`,r)();continue}switch(r||z.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(r instanceof Ni)&&!(r.buffer instanceof Ni))throw new Error("buffer value");break;case"texture":if(!(r instanceof jn||r instanceof Di||r instanceof ki))throw new Error("texture value");break;case"sampler":z.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(a.type)}this.bindings[s]=r}}draw(e){var k;const{renderPass:i,parameters:s=this.props.parameters,topology:r=this.props.topology,vertexArray:a,vertexCount:l,instanceCount:h,isInstanced:f=!1,firstVertex:d=0,transformFeedback:_}=e,m=j3(r),w=!!a.indexBuffer,A=(k=a.indexBuffer)==null?void 0:k.glIndexType;if(this.linkStatus!=="success")return z.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return z.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=i;return f3(this.device,s,S.glParameters,()=>{w&&f?this.device.gl.drawElementsInstanced(m,l||0,A,d,h||0):w?this.device.gl.drawElements(m,l||0,A,d):f?this.device.gl.drawArraysInstanced(m,d,l||0,h||0):this.device.gl.drawArrays(m,d,l||0),_&&_.end()}),a.unbindAfterRender(i),!0}setUniformsWebGL(e){const{bindings:i}=$3(e);Object.keys(i).forEach(s=>{z.warn(`Unsupported value "${JSON.stringify(i[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),z.time(du,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),z.timeEnd(du,`linkProgram for ${this.id}`)(),z.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}z.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),z.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(e){var i;switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${s}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async r=>await new Promise(a=>setTimeout(a,r));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(z.warn(`Binding ${i.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let i=0,s=0;for(const r of this.shaderLayout.bindings){const a=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:l}=r,h=e.getUniformBlockIndex(this.handle,l);if(h===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,s,h),a instanceof Ni?e.bindBufferBase(35345,s,a.handle):e.bindBufferRange(35345,s,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),s+=1;break;case"texture":if(!(a instanceof jn||a instanceof Di||a instanceof ki))throw new Error("texture");let f;if(a instanceof jn)f=a.texture;else if(a instanceof Di)f=a;else if(a instanceof ki&&a.colorAttachments[0]instanceof jn)z.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),f=a.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+i),e.bindTexture(f.glTarget,f.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:i,location:s,type:r,textureUnit:a}=e,l=this.uniforms[i]??a;l!==void 0&&W3(this.device.gl,s,r,l)}}}function Y3(n,t){const e={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of(t==null?void 0:t.attributes)||[]){const s=e.attributes.find(r=>r.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):z.warn(`shader layout attribute ${i.name} not present in shader`)}return e}class q3 extends aa{constructor(e){super(e,{});v(this,"device");v(this,"commands",[]);this.device=e}submitCommands(e=this.commands){for(const i of e)switch(i.name){case"copy-buffer-to-buffer":K3(this.device,i.options);break;case"copy-buffer-to-texture":J3(this.device,i.options);break;case"copy-texture-to-buffer":Q3(this.device,i.options);break;case"copy-texture-to-texture":G3(this.device,i.options);break;default:throw new Error(i.name)}}}function K3(n,t){const e=t.sourceBuffer,i=t.destinationBuffer;n.gl.bindBuffer(36662,e.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function J3(n,t){throw new Error("Not implemented")}function Q3(n,t){const{sourceTexture:e,mipLevel:i=0,aspect:s="all",width:r=t.sourceTexture.width,height:a=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:h=[0,0],destinationBuffer:f,byteOffset:d=0,bytesPerRow:_,rowsPerImage:m}=t;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||l!==0||_||m)throw new Error("not implemented");const{framebuffer:w,destroyFramebuffer:A}=Od(e);let S;try{const k=f,B=r||w.width,F=a||w.height,M=xd(w.colorAttachments[0].texture.props.format),D=M.format,H=M.type;n.gl.bindBuffer(35051,k.handle),S=n.gl.bindFramebuffer(36160,w.handle),n.gl.readPixels(h[0],h[1],B,F,D,H,d)}finally{n.gl.bindBuffer(35051,null),S!==void 0&&n.gl.bindFramebuffer(36160,S),A&&w.destroy()}}function G3(n,t){const{sourceTexture:e,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:r=[0,0],destinationTexture:a}=t;let{width:l=t.destinationTexture.width,height:h=t.destinationTexture.height}=t;const{framebuffer:f,destroyFramebuffer:d}=Od(e),[_,m]=s,[w,A,S]=r,k=n.gl.bindFramebuffer(36160,f.handle);let B=null,F;if(a instanceof Di)B=a,l=Number.isFinite(l)?l:B.width,h=Number.isFinite(h)?h:B.height,B.bind(0),F=B.glTarget;else throw new Error("invalid destination");switch(F){case 3553:case 34067:n.gl.copyTexSubImage2D(F,i,w,A,_,m,l,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D(F,i,w,A,S,_,m,l,h);break}B&&B.unbind(),n.gl.bindFramebuffer(36160,k),d&&f.destroy()}function Od(n){if(n instanceof St){const{width:t,height:e,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:e,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class tA extends oa{constructor(e,i){super(e,i);v(this,"device");v(this,"commandBuffer");this.device=e,this.commandBuffer=new q3(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,i,s){}}function eA(n){const{target:t,source:e,start:i=0,count:s=1}=n,r=e.length,a=s*r;let l=0;for(let h=i;l<r;l++)t[h++]=e[l];for(;l<a;)l<a-l?(t.copyWithin(i+l,i,i+l),l*=2):(t.copyWithin(i+l,i,i+a-l),l=a);return n.target}class fc extends ca{constructor(e,i){super(e,i);v(this,"device");v(this,"handle");v(this,"buffer",null);v(this,"bufferValue",null);this.device=e,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return S_()==="Chrome"}destroy(){var e;super.destroy(),this.buffer&&((e=this.buffer)==null||e.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const i=e;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(e,i){const s=i;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:a,stride:l,offset:h,normalized:f,integer:d,divisor:_}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),d?this.device.gl.vertexAttribIPointer(e,r,a,l,h):this.device.gl.vertexAttribPointer(e,r,a,f,l,h),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,_||0),this.attributes[e]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,i){this._enable(e,!1),this.attributes[e]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const i=this.attributes[e];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(e,i)}}_getAccessor(e){const i=this.attributeInfos[e];if(!i)throw new Error(`Unknown attribute location ${e}`);const s=Td(i.bufferDataType);return{size:i.bufferComponents,type:s,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(e,i=!0){const r=fc.isConstantAttributeZeroSupported(this.device)||e!==0;(i||r)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,i){const s=nA(i),r=s.byteLength*e,a=s.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),l=l||!iA(s,this.bufferValue),l){const h=uv(i.constructor,a);eA({target:h,source:s,start:0,count:a}),this.buffer.write(h),this.bufferValue=i}return this.buffer}}function nA(n){return Array.isArray(n)?new Float32Array(n):n}function iA(n,t){if(!n||!t||n.length!==t.length||n.constructor!==t.constructor)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0}class sA extends la{constructor(e,i){super(e,i);v(this,"device");v(this,"gl");v(this,"handle");v(this,"layout");v(this,"buffers",{});v(this,"unusedBuffers",{});v(this,"bindOnUse",!0);v(this,"_bound",!1);this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(X3(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in e)this.setBuffer(i,e[i])})}setBuffer(e,i){const s=this._getVaryingIndex(e),{buffer:r,byteLength:a,byteOffset:l}=this._getBufferRange(i);if(s<0){this.unusedBuffers[e]=r,z.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[s]={buffer:r,byteLength:a,byteOffset:l},this.bindOnUse||this._bindBuffer(s,r,l,a)}getBuffer(e){if(pu(e))return this.buffers[e]||null;const i=this._getVaryingIndex(e);return i>=0?this.buffers[i]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let i;return this._bound?i=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Ni)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:i,byteOffset:s=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:i,byteOffset:s,byteLength:r}}_getVaryingIndex(e){if(pu(e))return Number(e);for(const i of this.layout.varyings)if(e===i.name)return i.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:i,byteLength:s,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),i,r,s)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,i,s=0,r){const a=i&&i.handle;!a||r===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,s,r)}}function pu(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class rA extends ha{constructor(e,i){super(e,i);v(this,"device");v(this,"handle");v(this,"target",null);v(this,"_queryPending",!1);v(this,"_pollingPromise",null);if(this.device=e,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e!=null&&e.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((s,r)=>{const a=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):i++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}class Xn extends Ge{constructor(e){var _,m;super({...e,id:e.id||a3("webgl-device")});v(this,"type","webgl");v(this,"handle");v(this,"features");v(this,"limits");v(this,"info");v(this,"canvasContext");v(this,"lost");v(this,"_resolveContextLost");v(this,"gl");v(this,"debug",!1);v(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});v(this,"_extensions",{});v(this,"_polyfilled",!1);v(this,"spectorJS");v(this,"renderPass",null);v(this,"_constants");const i=Ge._getCanvasContextProps(e);if(!i)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(m=(_=i.canvas)==null?void 0:_.gl)==null?void 0:m.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new K0(this,i),this.lost=new Promise(w=>{this._resolveContextLost=w});const r={...e.webgl};i.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),e.powerPreference!==void 0&&(r.powerPreference=e.powerPreference);const l=this.props._handle||C0(this.canvasContext.canvas,{onContextLost:w=>{var A;return(A=this._resolveContextLost)==null?void 0:A.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:w=>console.log("WebGL context restored")},r);if(!l)throw new Error("WebGL context creation failed");if(s=l.device,s){if(e._reuseDevices)return z.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=l,this.gl=l,this.spectorJS=G0({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=M0(this.gl,this._extensions),this.limits=new Z0(this.gl),this.features=new X0(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new gn(this.gl,{log:(...w)=>z.log(1,...w)()}).trackState(this.gl,{copyState:!1});const f=e.debugWebGL||e.debug,d=e.debugWebGL;f&&(this.gl=n3(this.gl,{debugWebGL:f,traceWebGL:d}),z.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(z.level=Math.max(z.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const i=this._normalizeBufferProps(e);return new Ni(this,i)}createTexture(e){return new Di(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Ca(this,e)}createShader(e){return new u3(this,e)}createFramebuffer(e){return new ki(this,e)}createVertexArray(e){return new fc(this,e)}createTransformFeedback(e){return new sA(this,e)}createQuerySet(e){return new rA(this,e)}createRenderPipeline(e){return new Z3(this,e)}beginRenderPass(e){return new C3(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(e={}){return new tA(this,e)}submit(){var e;(e=this.renderPass)==null||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,i){return S3(e,i)}readPixelsToBufferWebGL(e,i){return E3(e,i)}setParametersWebGL(e){ii(this.gl,e)}getParametersWebGL(e){return bd(this.gl,e)}withParametersWebGL(e,i){return or(this.gl,e,i)}resetWebGL(){z.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),S0(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return W0(this.gl,e,this._extensions)}loseDevice(){var r;let e=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(e=!0,s.loseContext()),(r=this._resolveContextLost)==null||r.call(this,{reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){gn.get(this.gl).push()}popState(){gn.get(this.gl).pop()}setSpectorMetadata(e,i){e.__SPECTOR_Metadata=i}getGLKey(e,i){const s=Number(e);for(const r in this.gl)if(this.gl[r]===s)return`GL.${r}`;return i!=null&&i.emptyIfUnknown?"":String(e)}getGLKeys(e){const i={emptyIfUnknown:!0};return Object.entries(e).reduce((s,[r,a])=>(s[`${r}:${this.getGLKey(r,i)}`]=`${a}:${this.getGLKey(a,i)}`,s),{})}setConstantAttributeWebGL(e,i){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const r=this._constants[e];switch(r&&lA(r,i)&&z.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=i,i.constructor){case Float32Array:oA(this,e,i);break;case Int32Array:aA(this,e,i);break;case Uint32Array:cA(this,e,i);break;default:throw new Error("constant")}}getExtension(e){return ni(this.gl,e,this._extensions),this._extensions}}function oA(n,t,e){switch(e.length){case 1:n.gl.vertexAttrib1fv(t,e);break;case 2:n.gl.vertexAttrib2fv(t,e);break;case 3:n.gl.vertexAttrib3fv(t,e);break;case 4:n.gl.vertexAttrib4fv(t,e);break}}function aA(n,t,e){n.gl.vertexAttribI4iv(t,e)}function cA(n,t,e){n.gl.vertexAttribI4uiv(t,e)}function lA(n,t){if(!n||!t||n.length!==t.length||n.constructor!==t.constructor)return!1;for(let e=0;e<n.length;++e)if(n[e]!==t[e])return!1;return!0}const hA={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},uA=n=>({drawBuffersWEBGL(t){return n.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),fA=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(t){return n.deleteVertexArray(t)},isVertexArrayOES(t){return n.isVertexArray(t)},bindVertexArrayOES(t){return n.bindVertexArray(t)}}),dA=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return n.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return n.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return n.vertexAttribDivisor(...t)}});function pA(n=!0){const t=HTMLCanvasElement.prototype;if(!n&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,i){if(e==="webgl"||e==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&_A(s),s}return this.originalGetContext(e,i)}}function _A(n){n.getExtension("EXT_color_buffer_float");const t={...hA,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:uA(n),OES_vertex_array_object:fA(n),ANGLE_instanced_arrays:dA(n)},e=n.getExtension;n.getExtension=function(s){const r=e.call(n,s);return r||(s in t?t[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=i.apply(n)||[];return s==null?void 0:s.concat(Object.keys(t))}}const Rs=1;class gA extends zy{constructor(){super();v(this,"type","webgl");Ge.defaultProps={...Ge.defaultProps,...uc},Xn.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){pA(e)}async attach(e){if(e instanceof Xn)return e;if((e==null?void 0:e.device)instanceof Ge)return e.device;if(!mA(e))throw new Error("Invalid WebGL2RenderingContext");return new Xn({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){z.groupCollapsed(Rs,"WebGLDevice created")();const i=[];(e.debugWebGL||e.debug)&&i.push(e3()),e.debugSpectorJS&&i.push(Q0(e));const s=await Promise.allSettled(i);for(const l of s)l.status==="rejected"&&z.error(`Failed to initialize debug libraries ${l.reason}`)();const r=new Xn(e),a=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return z.probe(Rs,a)(),z.table(Rs,r.info)(),z.groupEnd(Rs)(),r}}function mA(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const _u=new gA;function Xe(){}const yA=({isDragging:n})=>n?"grabbing":"grab",kd={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Xe,onWebGLInitialized:Xe,onResize:Xe,onViewStateChange:Xe,onInteractionStateChange:Xe,onBeforeRender:Xe,onAfterRender:Xe,onLoad:Xe,onError:n=>vt.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:yA,getTooltip:null,debug:!1,drawPickingColors:!1};class Cr{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Ar({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const r=i.offsetCenter;if(!r)return;s.x=r.x,s.y=r.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=va[i.type],r=i.offsetCenter;if(!s||!r||!this.layerManager)return;const a=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:a,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:h}=l,f=h&&(h[s]||h.props[s]),d=this.props[s];let _=!1;f&&(_=f.call(h,l,i)),_||(d==null||d(l,i),this.widgetManager.onEvent(l,i))},this._onPointerDown=i=>{var a;if(((a=this.device)==null?void 0:a.type)==="webgpu")return;const s=i.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...kd,...t},t=this.props,t.viewState&&t.initialViewState&&vt.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let e=this.device;!e&&t.gl&&(t.gl instanceof WebGLRenderingContext&&vt.error("WebGL1 context not supported.")(),e=_u.attach(t.gl)),e||(e=ia.createDevice({type:"best-available",_reuseDevices:!0,adapters:[_u],...t.deviceProps,createCanvasContext:{canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(e,t),this.setProps(t),t._typedArrayManagerProps&&zi.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){var t,e,i,s,r,a,l,h,f,d;(t=this.animationLoop)==null||t.stop(),(e=this.animationLoop)==null||e.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(r=this.effectManager)==null||r.finalize(),this.effectManager=null,(a=this.deckRenderer)==null||a.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(f=this.widgetManager)==null||f.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((d=this.canvas.parentElement)==null||d.removeChild(this.canvas),this.canvas=null)}setProps(t){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&vt.removed("onLayerHover","onHover")(),"onLayerClick"in t&&vt.removed("onLayerClick","onClick")(),t.initialViewState&&!me(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e),this.widgetManager.setProps(e)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||i||s||r||a,e}redraw(t){if(!this.layerManager)return;let e=this.needsRedraw({clearRedrawFlags:!0});e=t||e,e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}get isInitialized(){return this.viewManager!==null}getViews(){return jt(this.viewManager),this.viewManager.views}getViewports(t){return jt(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,e=!1){for(const i in t)this.layerManager.resourceManager.add({resourceId:i,data:t[i],forceUpdate:e})}_removeResources(t){for(const e of t)this.layerManager.resourceManager.remove(e)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){var e;(e=this.layerManager)==null||e.removeDefaultShaderModule(t)}_pick(t,e,i){jt(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(e).timeStart();const r=this.deckPicker[t]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(e).timeEnd(),r}_createCanvas(t){let e=t.canvas;return typeof e=="string"&&(e=document.getElementById(e),jt(e)),e||(e=document.createElement("canvas"),e.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}_setCanvasSize(t){var s;if(!this.canvas)return;const{width:e,height:i}=t;if(e||e===0){const r=Number.isFinite(e)?`${e}px`:e;this.canvas.style.width=r}if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((s=t.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){var s,r;const{canvas:t}=this;if(!t)return;const e=t.clientWidth??t.width,i=t.clientHeight??t.height;(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,(s=this.viewManager)==null||s.setProps({width:e,height:i}),(r=this.layerManager)==null||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:e,height:i}))}_createAnimationLoop(t,e){const{gl:i,onError:s,useDevicePixels:r}=e;return new bx({device:t,useDevicePixels:r,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,e=Array.isArray(t)?t:t?[t]:[new Ir({id:"default-view"})];return e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){var e,i,s,r;if(((e=this.device)==null?void 0:e.type)==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:a,emptyInfo:l}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=a.length>0;let h=l,f=!1;for(const d of a)h=d,f=((i=d.layer)==null?void 0:i.onHover(d,t.event))||f;f||((r=(s=this.props).onHover)==null||r.call(s,h,t.event),this.widgetManager.onHover(h,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){var s,r;if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const e=new hd;e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new Yw(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Dh).map(a=>{var w;const[l,h,f,d]=Dh[a],_=(w=this.props.eventRecognizerOptions)==null?void 0:w[a],m={...h,..._,event:a};return{recognizer:new l(m),recognizeWith:f,requestFailure:d}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in va)this.eventManager.on(a,this._onEvent);this.viewManager=new $x({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new Hx(this.device,{deck:this,stats:this.stats,viewport:i,timeline:e}),this.effectManager=new a0({deck:this,device:this.device}),this.deckRenderer=new h0(this.device),this.deckPicker=new g0(this.device),this.widgetManager=new v0({deck:this,parentElement:(r=this.canvas)==null?void 0:r.parentElement}),this.widgetManager.addDefault(new w0),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,e){var a;const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...e};(a=this.deckRenderer)==null||a.renderLayers(r),r.pass==="screen"&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){var t;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),vt.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((t=this.device)==null?void 0:t.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:e},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:e}=this;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();const i=ia.stats.get("Memory Usage");t.bufferMemory=i.get("Buffer Memory").count,t.textureMemory=i.get("Texture Memory").count,t.renderbufferMemory=i.get("Renderbuffer Memory").count,t.gpuMemory=i.get("GPU Memory").count}}Cr.defaultProps=kd;Cr.VERSION=Xm;function vA(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return gf(n)}}const bA=_f;function Ps(n,t,e){const i=e==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:n,format:t.size>1?`${i}x${t.size}`:t.type,byteOffset:t.offset||0}}function fn(n){return n.stride||n.size*n.bytesPerElement}function wA(n,t){return n.type===t.type&&n.size===t.size&&fn(n)===fn(t)&&(n.offset||0)===(t.offset||0)}function Ma(n,t){t.offset&&vt.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const e=fn(n),i=t.vertexOffset!==void 0?t.vertexOffset:n.vertexOffset||0,s=t.elementOffset||0,r=i*e+s*n.bytesPerElement+(n.offset||0);return{...t,offset:r,stride:e}}function TA(n,t){const e=Ma(n,t);return{high:e,low:{...e,offset:e.offset+n.size*4}}}class xA{constructor(t,e,i){this._buffer=null,this.device=t,this.id=e.id||"",this.size=e.size||1;const s=e.logicalType||e.type,r=s==="float64";let{defaultValue:a}=e;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let l;r?l="float32":!s&&e.isIndexed?l="uint32":l=s||"float32";let h=vA(s||l);this.doublePrecision=r,r&&e.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...e,defaultType:h,defaultValue:a,logicalType:s,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*fn(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),zi.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,e=null){const i={};if(this.state.constant){const s=this.value;if(e){const r=Ma(this.getAccessor(),e),a=r.offset/s.BYTES_PER_ELEMENT,l=r.size||this.size;i[t]=s.subarray(a,a+l)}else i[t]=s}else i[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${t}64Low`]=i[t]:i[`${t}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(t=this.id,e=null){const i=this.getAccessor(),s=[],r={name:this.id,byteStride:fn(i),attributes:s};if(this.doublePrecision){const a=TA(i,e||{});s.push(Ps(t,{...i,...a.high},this.device.type),Ps(`${t}64Low`,{...i,...a.low},this.device.type))}else if(e){const a=Ma(i,e);s.push(Ps(t,{...i,...a},this.device.type))}else s.push(Ps(t,i,this.device.type));return r}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const e=Array.from(this.value);t=[e,e]}else{const{value:e,numInstances:i,size:s}=this,r=i*s;if(e&&r&&e.length>=r){const a=new Array(s).fill(1/0),l=new Array(s).fill(-1/0);for(let h=0;h<r;)for(let f=0;f<s;f++){const d=e[h++];d<a[f]&&(a[f]=d),d>l[f]&&(l[f]=d)}t=[a,l]}}return this.state.bounds=t,t}setData(t){const{state:e}=this;let i;ArrayBuffer.isView(t)?i={value:t}:t instanceof bt?i={buffer:t}:i=t;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const a=bA(i.value);s.type=s.normalized?a.replace("int","norm"):a}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=fn(s)}if(e.bounds=null,i.constant){let r=i.value;if(r=this._normalizeValue(r,[],0),this.settings.normalized&&(r=this.normalizeConstant(r)),!(!e.constant||!this._areValuesEqual(r,this.value)))return!1;e.externalBuffer=null,e.constant=!0,this.value=ArrayBuffer.isView(r)?r:new Float32Array(r)}else if(i.buffer){const r=i.buffer;e.externalBuffer=r,e.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let r=i.value;e.externalBuffer=null,e.constant=!1,this.value=r;let{buffer:a}=this;const l=fn(s),h=(s.vertexOffset||0)*l;if(this.doublePrecision&&r instanceof Float64Array&&(r=Fo(r,s)),this.settings.isIndexed){const d=this.settings.defaultType;r.constructor!==d&&(r=new d(r))}const f=r.byteLength+h+l*2;(!a||a.byteLength<f)&&(a=this._createBuffer(f)),a.write(r,h)}return this.setAccessor(s),!0}updateSubBuffer(t={}){this.state.bounds=null;const e=this.value,{startOffset:i=0,endOffset:s}=t;this.buffer.write(this.doublePrecision&&e instanceof Float64Array?Fo(e,{size:this.size,startIndex:i,endIndex:s}):e.subarray(i,s),i*e.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,e=!1){const{state:i}=this,s=i.allocatedValue,r=zi.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:e});this.value=r;const{byteOffset:a}=this;let{buffer:l}=this;return(!l||l.byteLength<r.byteLength+a)&&(l=this._createBuffer(r.byteLength+a),e&&s&&l.write(s instanceof Float64Array?Fo(s,this):s,a)),i.allocatedValue=r,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:e}=t;if(!ArrayBuffer.isView(e))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=e.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${e.constructor.name}`);!(e instanceof i)&&this.settings.normalized&&!("normalized"in t)&&vt.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(t).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(e=>e/255);case"unorm16":return new Float32Array(t).map(e=>e/65535);default:return t}}_normalizeValue(t,e,i){const{defaultValue:s,size:r}=this.settings;if(Number.isFinite(t))return e[i]=t,e;if(!t){let a=r;for(;--a>=0;)e[i+a]=s[a];return e}switch(r){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let a=r;for(;--a>=0;)e[i+a]=Number.isFinite(t[a])?t[a]:s[a]}return e}_areValuesEqual(t,e){if(!t||!e)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(t[s]!==e[s])return!1;return!0}_createBuffer(t){var s;this._buffer&&this._buffer.destroy();const{isIndexed:e,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(e?bt.INDEX:bt.VERTEX)|bt.COPY_DST,indexType:e?i:void 0,byteLength:t}),this._buffer}}const gu=[],mu=[];function AA(n,t=0,e=1/0){let i=gu;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(mu.length=n.length,i=mu):i=gu,(t>0||Number.isFinite(e))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,e),s.index=t-1),{iterable:i,objectInfo:s}}function Nd(n){return n&&n[Symbol.asyncIterator]}function SA(n,t){const{size:e,stride:i,offset:s,startIndices:r,nested:a}=t,l=n.BYTES_PER_ELEMENT,h=i?i/l:e,f=s?s/l:0,d=Math.floor((n.length-f)/h);return(_,{index:m,target:w})=>{if(!r){const B=m*h+f;for(let F=0;F<e;F++)w[F]=n[B+F];return w}const A=r[m],S=r[m+1]||d;let k;if(a){k=new Array(S-A);for(let B=A;B<S;B++){const F=B*h+f;w=new Array(e);for(let M=0;M<e;M++)w[M]=n[F+M];k[B-A]=w}}else if(h===e)k=n.subarray(A*e+f,S*e+f);else{k=new n.constructor((S-A)*e);let B=0;for(let F=A;F<S;F++){const M=F*h+f;for(let D=0;D<e;D++)k[B++]=n[M+D]}}return k}}const EA=[],Ns=[[0,1/0]];function RA(n,t){if(n===Ns||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return n;const e=[],i=n.length;let s=0;for(let r=0;r<i;r++){const a=n[r];a[1]<t[0]?(e.push(a),s=r+1):a[0]>t[1]?e.push(a):t=[Math.min(a[0],t[0]),Math.max(a[1],t[1])]}return e.splice(s,0,t),e}const PA={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function Dd(n,t){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const e=n.type||"interpolation";return{...PA[e],...t,...n,type:e}}class Bd extends xA{constructor(t,e){super(t,e,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ns}),this.constant=!1,this.settings.update=e.update||(e.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const e=this.state.needsRedraw;return this.state.needsRedraw=e&&!t,e}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var e;(e=this.state).layoutChanged||(e.layoutChanged=!wA(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:e}=this.settings,i=this.settings.transition,s=Array.isArray(e)?t[e.find(r=>t[r])]:t[e];return Dd(s,i)}setNeedsUpdate(t=this.id,e){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){const{startRow:i=0,endRow:s=1/0}=e;this.state.updateRanges=RA(this.state.updateRanges,[i,s])}else this.state.updateRanges=Ns}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=EA}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:e,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(t,e.updateRanges!==Ns),!0):!1}updateBuffer({numInstances:t,data:e,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:a,noAlloc:l}}=this;let h=!0;if(a){for(const[f,d]of r)a.call(s,this,{data:e,startRow:f,endRow:d,props:i,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[f,d]of r){const _=Number.isFinite(f)?this.getVertexOffset(f):0,m=Number.isFinite(d)?this.getVertexOffset(d):l||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:_,endOffset:m})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(t){return this.device.type==="webgpu"||t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:e}=this;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(e.lastExternalBuffer=null,!1)}setBinaryValue(t,e=null){const{state:i,settings:s}=this;if(!t)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===t)return this.clearNeedsUpdate(),!0;if(i.binaryValue=t,this.setNeedsRedraw(),s.transform||e!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const a=t;jt(ArrayBuffer.isView(a.value),`invalid ${s.accessor}`);const l=!!a.size&&a.size!==this.size;return i.binaryAccessor=SA(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:e,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:e}=this;return(e?t<e.length?e[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,e=super.getValue();if(!t)return e;for(const i in t)Object.assign(e,super.getValue(i,t[i]));return e}getBufferLayout(t){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=t?t.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!e)return i;for(const r in e){const a=super._getBufferLayout(r,e[r]);i.attributes.push(...a.attributes)}return i}_autoUpdater(t,{data:e,startRow:i,endRow:s,props:r,numInstances:a}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:l,state:h,value:f,size:d,startIndices:_}=t,{accessor:m,transform:w}=l;let A=h.binaryAccessor||(typeof m=="function"?m:r[m]);typeof A!="function"&&(A=()=>A),jt(typeof A=="function",`accessor "${m}" is not a function`);let S=t.getVertexOffset(i);const{iterable:k,objectInfo:B}=AA(e,i,s);for(const F of k){B.index++;let M=A(F,B);if(w&&(M=w.call(this,M)),_){const D=(B.index<_.length-1?_[B.index+1]:a)-_[B.index];if(M&&Array.isArray(M[0])){let H=S;for(const W of M)t._normalizeValue(W,f,H),H+=d}else M&&M.length>d?f.set(M,S):(t._normalizeValue(M,B.target,0),Lx({target:f,source:B.target,start:S,count:D}));S+=D*d}else t._normalizeValue(M,f,S),S+=d}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,e=Math.min(4,this.size);if(t&&t.length>=e){let i=!0;switch(e){case 4:i=i&&Number.isFinite(t[3]);case 3:i=i&&Number.isFinite(t[2]);case 2:i=i&&Number.isFinite(t[1]);case 1:i=i&&Number.isFinite(t[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Xo(n){const{source:t,target:e,start:i=0,size:s,getData:r}=n,a=n.end||e.length,l=t.length,h=a-i;if(l>h){e.set(t.subarray(0,h),i);return}if(e.set(t,i),!r)return;let f=l;for(;f<h;){const d=r(f,t);for(let _=0;_<s;_++)e[i+f]=d[_]||0,f++}}function IA({source:n,target:t,size:e,getData:i,sourceStartIndices:s,targetStartIndices:r}){if(!s||!r)return Xo({source:n,target:t,size:e,getData:i}),t;let a=0,l=0;const h=i&&((d,_)=>i(d+l,_)),f=Math.min(s.length,r.length);for(let d=1;d<f;d++){const _=s[d]*e,m=r[d]*e;Xo({source:n.subarray(a,_),target:t,start:l,end:m,size:e,getData:h}),a=_,l=m}return l<t.length&&Xo({source:[],target:t,start:l,size:e,getData:h}),t}function CA(n){const{device:t,settings:e,value:i}=n,s=new Bd(t,e);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:e.normalized}),s}function Fd(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function Ld(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Ud(n){n.push(n.shift())}function MA(n,t){const{doublePrecision:e,settings:i,value:s,size:r}=n,a=e&&s instanceof Float64Array?2:1;let l=0;const{shaderAttributes:h}=n.settings;if(h)for(const f of Object.values(h))l=Math.max(l,f.vertexOffset??0);return(i.noAlloc?s.length:(t+l)*r)*a}function Vd({device:n,source:t,target:e}){return(!e||e.byteLength<t.byteLength)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:t.byteLength,usage:t.usage})),e}function zd({device:n,buffer:t,attribute:e,fromLength:i,toLength:s,fromStartIndices:r,getData:a=l=>l}){const l=e.doublePrecision&&e.value instanceof Float64Array?2:1,h=e.size*l,f=e.byteOffset,d=e.settings.bytesPerElement<4?f/e.settings.bytesPerElement*4:f,_=e.startIndices,m=r&&_,w=e.isConstant;if(!m&&t&&i>=s)return t;const A=e.value instanceof Float64Array?Float32Array:e.value.constructor,S=w?e.value:new A(e.getBuffer().readSyncWebGL(f,s*A.BYTES_PER_ELEMENT).buffer);if(e.settings.normalized&&!w){const M=a;a=(D,H)=>e.normalizeConstant(M(D,H))}const k=w?(M,D)=>a(S,D):(M,D)=>a(S.subarray(M+f,M+f+h),D),B=t?new Float32Array(t.readSyncWebGL(d,i*4).buffer):new Float32Array(0),F=new Float32Array(s);return IA({source:B,target:F,sourceStartIndices:r,targetStartIndices:_,size:h,getData:k}),(!t||t.byteLength<F.byteLength+d)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:F.byteLength+d,usage:35050})),t.write(F,d),t}class Wd{constructor({device:t,attribute:e,timeline:i}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Pr(i),this.attribute=e,this.attributeInTransition=CA(e),this.currentStartIndices=e.startIndices}get inProgress(){return this.transition.inProgress}start(t,e,i=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=MA(this.attribute,e),this.transition.start({...t,duration:i})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class OA extends Wd{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="interpolation",this.transform=BA(t,e)}start(t,e){const i=this.currentLength,s=this.currentStartIndices;if(super.start(t,e,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:r,attribute:a}=this;Ud(r),r[0]=zd({device:this.device,buffer:r[0],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:t.enter}),r[1]=Vd({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:l}=this,h=l.model;let f=Math.floor(this.currentLength/a.size);Hd(a)&&(f/=2),h.setVertexCount(f),a.isConstant?(h.setAttributes({aFrom:r[0]}),h.setConstantAttributes({aTo:a.value})):h.setAttributes({aFrom:r[0],aTo:a.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:t,easing:e}=this.settings,{time:i}=this.transition;let s=i/t;e&&(s=e(s));const{model:r}=this.transform,a={time:s};r.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const kA=`uniform interpolationUniforms {
  float time;
} interpolation;
`,yu={name:"interpolation",vs:kA,uniformTypes:{time:"f32"}},NA=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,DA=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Hd(n){return n.doublePrecision&&n.value instanceof Float64Array}function BA(n,t){const e=t.size,i=Fd(e),s=Ld(e),r=t.getBufferLayout();return Hd(t)?new Hi(n,{vs:DA,bufferLayout:[{name:"aFrom",byteStride:8*e,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*e}]},{name:"aTo",byteStride:8*e,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*e}]}],modules:[Xb,yu],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:e},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Hi(n,{vs:NA,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:r.attributes[0].format}],modules:[yu],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class FA extends Wd{constructor({device:t,attribute:e,timeline:i}){super({device:t,attribute:e,timeline:i}),this.type="spring",this.texture=HA(t),this.framebuffer=$A(t,this.texture),this.transform=WA(t,e)}start(t,e){const i=this.currentLength,s=this.currentStartIndices;super.start(t,e);const{buffers:r,attribute:a}=this;for(let h=0;h<2;h++)r[h]=zd({device:this.device,buffer:r[h],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:t.enter});r[2]=Vd({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?l.setConstantAttributes({aTo:a.value}):l.setAttributes({aTo:a.getBuffer()})}onUpdate(){const{buffers:t,transform:e,framebuffer:i,transition:s}=this,r=this.settings;e.model.setAttributes({aPrev:t[0],aCur:t[1]}),e.transformFeedback.setBuffers({vNext:t[2]});const a={stiffness:r.stiffness,damping:r.damping};e.model.shaderInputs.setProps({spring:a}),e.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Ud(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const LA=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,UA={name:"spring",vs:LA,uniformTypes:{damping:"f32",stiffness:"f32"}},VA=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,zA=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function WA(n,t){const e=Fd(t.size),i=Ld(t.size);return new Hi(n,{vs:VA,fs:zA,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[UA],defines:{ATTRIBUTE_TYPE:e},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function HA(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function $A(n,t){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const jA={interpolation:OA,spring:FA};class XA{constructor(t,{id:e,timeline:i}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=e,this.device=t,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:e,numInstances:i}){this.numInstances=i||1;for(const s in t){const r=t[s],a=r.getTransitionSetting(e);a&&this._updateAttribute(s,r,a)}for(const s in this.transitions){const r=t[s];(!r||!r.getTransitionSetting(e))&&this._removeTransition(s)}}hasAttribute(t){const e=this.transitions[t];return e&&e.inProgress}getAttributes(){const t={};for(const e in this.transitions){const i=this.transitions[e];i.inProgress&&(t[e]=i.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,e,i){const s=this.transitions[t];let r=!s||s.type!==i.type;if(r){s&&this._removeTransition(t);const a=jA[i.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,device:this.device}):(vt.error(`unsupported transition type '${i.type}'`)(),r=!1)}(r||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(i,this.numInstances))}}const vu="attributeManager.invalidate",ZA="attributeManager.updateStart",YA="attributeManager.updateEnd",qA="attribute.updateStart",KA="attribute.allocate",JA="attribute.updateEnd";class QA{constructor(t,{id:e="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=Yi(ax),this.id=e,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new XA(t,{id:`${e}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const e of t)this.attributes[e]!==void 0&&(this.attributes[e].delete(),delete this.attributes[e])}invalidate(t,e){const i=this._invalidateTrigger(t,e);Yt(vu,this,t,i)}invalidateAll(t){for(const e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Yt(vu,this,"all")}update({data:t,numInstances:e,startIndices:i=null,transitions:s,props:r={},buffers:a={},context:l={}}){let h=!1;Yt(ZA,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const f in this.attributes){const d=this.attributes[f],_=d.settings.accessor;d.startIndices=i,d.numInstances=e,r[f]&&vt.removed(`props.${f}`,`data.attributes.${f}`)(),d.setExternalBuffer(a[f])||d.setBinaryValue(typeof _=="string"?a[_]:void 0,t.startIndices)||typeof _=="string"&&!a[_]&&d.setConstantValue(r[_])||d.needsUpdate()&&(h=!0,this._updateAttribute({attribute:d,numInstances:e,data:t,props:r,context:l})),this.needsRedraw=this.needsRedraw||d.needsRedraw()}h&&Yt(YA,this,e),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:e,transitions:s})}updateTransition(){const{attributeTransitionManager:t}=this,e=t.run();return this.needsRedraw=this.needsRedraw||e,e}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const e=t.map(i=>{var s;return(s=this.attributes[i])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(e)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:e,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const r in e){const a=e[r];a.needsRedraw(t)&&!i.hasAttribute(r)&&(s[r]=a)}return s}getBufferLayouts(t){return Object.values(this.getAttributes()).map(e=>e.getBufferLayout(t))}_add(t,e){for(const i in t){const s=t[i],r={...s,id:i,size:s.isIndexed&&1||s.size||1,...e};this.attributes[i]=new Bd(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const e in this.attributes)this.attributes[e].getUpdateTriggers().forEach(s=>{t[s]||(t[s]=[]),t[s].push(e)});this.updateTriggers=t}_invalidateTrigger(t,e){const{attributes:i,updateTriggers:s}=this,r=s[t];return r&&r.forEach(a=>{const l=i[a];l&&l.setNeedsUpdate(l.id,e)}),r}_updateAttribute(t){const{attribute:e,numInstances:i}=t;if(Yt(qA,e),e.constant){e.setConstantValue(e.value);return}e.allocate(i)&&Yt(KA,e,i),e.updateBuffer(t)&&(this.needsRedraw=!0,Yt(JA,e,i))}}class GA extends Pr{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:e,toValue:i,duration:s,easing:r}}=this,a=r(t/s);this._value=Gs(e,i,a)}}const bu=1e-5;function wu(n,t,e,i,s){const r=t-n,l=(e-t)*s,h=-r*i;return l+h+r+t}function t2(n,t,e,i,s){if(Array.isArray(e)){const r=[];for(let a=0;a<e.length;a++)r[a]=wu(n[a],t[a],e[a],i,s);return r}return wu(n,t,e,i,s)}function Tu(n,t){if(Array.isArray(n)){let e=0;for(let i=0;i<n.length;i++){const s=n[i]-t[i];e+=s*s}return Math.sqrt(e)}return Math.abs(n-t)}class e2 extends Pr{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:e,damping:i,stiffness:s}=this.settings,{_prevValue:r=t,_currValue:a=t}=this;let l=t2(r,a,e,i,s);const h=Tu(l,e),f=Tu(l,a);h<bu&&f<bu&&(l=e,this.end()),this._prevValue=a,this._currValue=l}}const n2={interpolation:GA,spring:e2};class i2{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,e,i,s){const{transitions:r}=this;if(r.has(t)){const h=r.get(t),{value:f=h.settings.fromValue}=h;e=f,this.remove(t)}if(s=Dd(s),!s)return;const a=n2[s.type];if(!a){vt.error(`unsupported transition type '${s.type}'`)();return}const l=new a(this.timeline);l.start({...s,fromValue:e,toValue:i}),r.set(t,l)}remove(t){const{transitions:e}=this;e.has(t)&&(e.get(t).cancel(),e.delete(t))}update(){const t={};for(const[e,i]of this.transitions)i.update(),t[e]=i.value,i.inProgress||this.remove(e);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function s2(n){const t=n[_n];for(const e in t){const i=t[e],{validate:s}=i;if(s&&!s(n[e],i))throw new Error(`Invalid prop ${e}: ${n[e]}`)}}function r2(n,t){const e=$d({newProps:n,oldProps:t,propTypes:n[_n],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=a2(n,t);let s=!1;return i||(s=c2(n,t)),{dataChanged:i,propsChanged:e,updateTriggersChanged:s,extensionsChanged:l2(n,t),transitionsChanged:o2(n,t)}}function o2(n,t){if(!n.transitions)return!1;const e={},i=n[_n];let s=!1;for(const r in n.transitions){const a=i[r],l=a&&a.type;(l==="number"||l==="color"||l==="array")&&Oa(n[r],t[r],a)&&(e[r]=!0,s=!0)}return s?e:!1}function $d({newProps:n,oldProps:t,ignoreProps:e={},propTypes:i={},triggerName:s="props"}){if(t===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(const r of Object.keys(n))if(!(r in e)){if(!(r in t))return`${s}.${r} added`;const a=Oa(n[r],t[r],i[r]);if(a)return`${s}.${r} ${a}`}for(const r of Object.keys(t))if(!(r in e)){if(!(r in n))return`${s}.${r} dropped`;if(!Object.hasOwnProperty.call(n,r)){const a=Oa(n[r],t[r],i[r]);if(a)return`${s}.${r} ${a}`}}return!1}function Oa(n,t,e){let i=e&&e.equal;return i&&!i(n,t,e)||!i&&(i=n&&t&&n.equals,i&&!i.call(n,t))?"changed deeply":!i&&t!==n?"changed shallowly":null}function a2(n,t){if(t===null)return"oldProps is null, initial diff";let e=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,t.data)||(e="Data comparator detected a change"):n.data!==t.data&&(e="A new data container was supplied"),e&&s&&(e=s(n.data,t.data)||e),e}function c2(n,t){if(t===null)return{all:!0};if("all"in n.updateTriggers&&xu(n,t,"all"))return{all:!0};const e={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&xu(n,t,s)&&(e[s]=!0,i=!0);return i?e:!1}function l2(n,t){if(t===null)return!0;const e=t.extensions,{extensions:i}=n;if(i===e)return!1;if(!e||!i||i.length!==e.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(e[s]))return!0;return!1}function xu(n,t,e){let i=n.updateTriggers[e];i=i??{};let s=t.updateTriggers[e];return s=s??{},$d({oldProps:s,newProps:i,triggerName:e})}const h2="count(): argument not an object",u2="count(): argument not a container";function f2(n){if(!p2(n))throw new Error(h2);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(d2(n))return Object.keys(n).length;throw new Error(u2)}function d2(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function p2(n){return n!==null&&typeof n=="object"}function Au(n,t){if(!t)return n;const e={...n,...t};if("defines"in t&&(e.defines={...n.defines,...t.defines}),"modules"in t&&(e.modules=(n.modules||[]).concat(t.modules),t.modules.some(i=>i.name==="project64"))){const i=e.modules.findIndex(s=>s.name==="project32");i>=0&&e.modules.splice(i,1)}if("inject"in t)if(!n.inject)e.inject=t.inject;else{const i={...n.inject};for(const s in t.inject)i[s]=(i[s]||"")+t.inject[s];e.inject=i}return e}const _2={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ka={};function g2(n,t,e,i){if(e instanceof St)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let s=null;e.compressed&&(s={minFilter:"linear",mipmapFilter:e.data.length>1?"nearest":"linear"});const r=t.createTexture({...e,sampler:{..._2,...s,...i},mipmaps:!0});return ka[r.id]=n,r}function m2(n,t){!t||!(t instanceof St)||ka[t.id]===n&&(t.delete(),delete ka[t.id])}const y2={boolean:{validate(n,t){return!0},equal(n,t,e){return!!n==!!t}},number:{validate(n,t){return Number.isFinite(n)&&(!("max"in t)||n<=t.max)&&(!("min"in t)||n>=t.min)}},color:{validate(n,t){return t.optional&&!n||Na(n)&&(n.length===3||n.length===4)},equal(n,t,e){return me(n,t,1)}},accessor:{validate(n,t){const e=ar(n);return e==="function"||e===ar(t.value)},equal(n,t,e){return typeof t=="function"?!0:me(n,t,1)}},array:{validate(n,t){return t.optional&&!n||Na(n)},equal(n,t,e){const{compare:i}=e,s=Number.isInteger(i)?i:i?1:0;return i?me(n,t,s):n===t}},object:{equal(n,t,e){if(e.ignore)return!0;const{compare:i}=e,s=Number.isInteger(i)?i:i?1:0;return i?me(n,t,s):n===t}},function:{validate(n,t){return t.optional&&!n||typeof n=="function"},equal(n,t,e){return!e.compare&&e.ignore!==!1||n===t}},data:{transform:(n,t,e)=>{if(!n)return n;const{dataTransform:i}=e.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,t,e)=>{const i=e.context;return!i||!i.device?null:g2(e.id,i.device,n,{...t.parameters,...e.props.textureParameters})},release:(n,t,e)=>{m2(e.id,n)}}};function v2(n){const t={},e={},i={};for(const[s,r]of Object.entries(n)){const a=r==null?void 0:r.deprecatedFor;if(a)i[s]=Array.isArray(a)?a:[a];else{const l=b2(s,r);t[s]=l,e[s]=l.value}}return{propTypes:t,defaultProps:e,deprecatedProps:i}}function b2(n,t){switch(ar(t)){case"object":return Ti(n,t);case"array":return Ti(n,{type:"array",value:t,compare:!1});case"boolean":return Ti(n,{type:"boolean",value:t});case"number":return Ti(n,{type:"number",value:t});case"function":return Ti(n,{type:"function",value:t,compare:!0});default:return{name:n,type:"unknown",value:t}}}function Ti(n,t){return"type"in t?{name:n,...y2[t.type],...t}:"value"in t?{name:n,type:ar(t.value),...t}:{name:n,type:"object",value:t}}function Na(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function ar(n){return Na(n)?"array":n===null?"null":typeof n}function w2(n,t){let e;for(let r=t.length-1;r>=0;r--){const a=t[r];"extensions"in a&&(e=a.extensions)}const i=Da(n.constructor,e),s=Object.create(i);s[rr]=n,s[bn]={},s[Qe]={};for(let r=0;r<t.length;++r){const a=t[r];for(const l in a)s[l]=a[l]}return Object.freeze(s),s}const T2="_mergedDefaultProps";function Da(n,t){if(!(n instanceof Mr.constructor))return{};let e=T2;if(t)for(const s of t){const r=s.constructor;r&&(e+=`:${r.extensionName||r.name}`)}const i=jd(n,e);return i||(n[e]=x2(n,t||[]))}function x2(n,t){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Da(i),r=jd(n,"defaultProps")||{},a=v2(r),l=Object.assign(Object.create(null),s,a.defaultProps),h=Object.assign(Object.create(null),s==null?void 0:s[_n],a.propTypes),f=Object.assign(Object.create(null),s==null?void 0:s[zo],a.deprecatedProps);for(const d of t){const _=Da(d.constructor);_&&(Object.assign(l,_),Object.assign(h,_[_n]),Object.assign(f,_[zo]))}return A2(l,n),E2(l,h),S2(l,f),l[_n]=h,l[zo]=f,t.length===0&&!dc(n,"_propTypes")&&(n._propTypes=h),l}function A2(n,t){const e=P2(t);Object.defineProperties(n,{id:{writable:!0,value:e}})}function S2(n,t){for(const e in t)Object.defineProperty(n,e,{enumerable:!1,set(i){const s=`${this.id}: ${e}`;for(const r of t[e])dc(this,r)||(this[r]=i);vt.deprecated(s,t[e].join("/"))()}})}function E2(n,t){const e={},i={};for(const s in t){const r=t[s],{name:a,value:l}=r;r.async&&(e[a]=l,i[a]=R2(a))}n[Yn]=e,n[bn]={},Object.defineProperties(n,i)}function R2(n){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||Nd(t)?this[bn][n]=t:this[Qe][n]=t},get(){if(this[Qe]){if(n in this[Qe])return this[Qe][n]||this[Yn][n];if(n in this[bn]){const t=this[rr]&&this[rr].internalState;if(t&&t.hasAsyncProp(n))return t.getAsyncProp(n)||this[Yn][n]}}return this[Yn][n]}}}function dc(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function jd(n,t){return dc(n,t)&&n[t]}function P2(n){const t=n.componentName;return t||vt.warn(`${n.name}.componentName not specified`)(),t||n.name}let I2=0;class Mr{constructor(...t){this.props=w2(this,t),this.id=this.props.id,this.count=I2++}clone(t){const{props:e}=this,i={};for(const s in e[Yn])s in e[Qe]?i[s]=e[Qe][s]:s in e[bn]&&(i[s]=e[bn][s]);return new this.constructor({...e,...i,...t})}}Mr.componentName="Component";Mr.defaultProps={};const C2=Object.freeze({});class M2{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||C2}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const e=this.asyncProps[t];return e&&e.resolvedValue}isAsyncPropLoading(t){if(t){const e=this.asyncProps[t];return!!(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(t,e){this._watchPromise(t,Promise.resolve(e))}setAsyncProps(t){this.component=t[rr]||this.component;const e=t[Qe]||{},i=t[bn]||t,s=t[Yn]||{};for(const r in e){const a=e[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,a),e[r]=this.getAsyncProp(r)}for(const r in i){const a=i[r];this._createAsyncPropData(r,s[r]),this._updateAsyncProp(r,a)}}_fetch(t,e){return null}_onResolve(t,e){}_onError(t,e){}_updateAsyncProp(t,e){if(this._didAsyncInputValueChange(t,e)){if(typeof e=="string"&&(e=this._fetch(t,e)),e instanceof Promise){this._watchPromise(t,e);return}if(Nd(e)){this._resolveAsyncIterable(t,e);return}this._setPropValue(t,e)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,e){const i=this.asyncProps[t];return e===i.resolvedValue||e===i.lastValue?!1:(i.lastValue=e,!0)}_setPropValue(t,e){this._freezeAsyncOldProps();const i=this.asyncProps[t];i&&(e=this._postProcessValue(i,e),i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(t,e,i){const s=this.asyncProps[t];s&&i>=s.resolvedLoadCount&&e!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=e,s.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}_watchPromise(t,e){const i=this.asyncProps[t];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;e.then(r=>{this.component&&(r=this._postProcessValue(i,r),this._setAsyncPropValue(t,r,s),this._onResolve(t,r))}).catch(r=>{this._onError(t,r)})}}async _resolveAsyncIterable(t,e){if(t!=="data"){this._setPropValue(t,e);return}const i=this.asyncProps[t];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let r=[],a=0;for await(const l of e){if(!this.component)return;const{dataTransform:h}=this.component.props;h?r=h(l,r):r=r.concat(l),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:a,endRow:r.length}]}),a=r.length,this._setAsyncPropValue(t,r,s)}this._onResolve(t,r)}_postProcessValue(t,e){const i=t.type;return i&&this.component&&(i.release&&i.release(t.resolvedValue,i,this.component),i.transform)?i.transform(e,i,this.component):e}_createAsyncPropData(t,e){if(!this.asyncProps[t]){const s=this.component&&this.component.props[_n];this.asyncProps[t]={type:s&&s[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}class O2 extends M2{constructor({attributeManager:t,layer:e}){super(e),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,e){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(e,{propName:t,layer:i}):super._fetch(t,e)}_onResolve(t,e){const i=this.layer;if(i){const s=i.props.onDataLoad;t==="data"&&s&&s(e,{propName:t,layer:i})}}_onError(t,e){const i=this.layer;i&&i.raiseError(e,`loading ${t} of ${this.layer}`)}}const k2="layer.changeFlag",N2="layer.initialize",D2="layer.update",B2="layer.finalize",F2="layer.matched",Su=2**24-1,L2=Object.freeze([]),U2=Yi(({oldViewport:n,viewport:t})=>n.equals(t));let de=new Uint8ClampedArray(0);const V2={data:{type:"data",value:L2,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:t,layer:e,loaders:i,loadOptions:s,signal:r})=>{const{resourceManager:a}=e.context;s=s||e.getLoadOptions(),i=i||e.props.loaders,r&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:r}});let l=a.contains(n);return!l&&!s&&(a.add({resourceId:n,data:Ko(n,i),persistent:!1}),l=!0),l?a.subscribe({resourceId:n,onChange:h=>{var f;return(f=e.internalState)==null?void 0:f.reloadAsyncProp(t,h)},consumerId:e.id,requestId:t}):Ko(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ft.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class pc extends Mr{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Vn.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){jt(this.internalState);const e=this.internalState.viewport||this.context.viewport,i=ld(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,r,a]=rd(i,e.pixelProjectionMatrix);return t.length===2?[s,r]:[s,r,a]}unproject(t){return jt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,e){jt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return dx(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...e})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const e of this.getModels())e.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===ft.DEFAULT||t===ft.LNGLAT||t===ft.CARTESIAN}onHover(t,e){return this.props.onHover&&this.props.onHover(t,e)||!1}onClick(t,e){return this.props.onClick&&this.props.onClick(t,e)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,e=[]){return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}decodePickingColor(t){jt(t instanceof Uint8Array);const[e,i,s]=t;return e+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:f2(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["positions","instancePositions"])}getShaders(t){t=Au(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const e of this.props.extensions)t=Au(t,e.getShaders.call(this,e));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const e=this.getAttributeManager(),{dataChanged:i}=t.changeFlags;if(i&&e)if(Array.isArray(i))for(const s of i)e.invalidateAll(s);else e.invalidateAll();if(e){const{props:s}=t,r=this.internalState.hasPickingBuffer,a=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(r!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:l,instancePickingColors:h}=e.attributes,f=l||h;f&&(a&&f.constant&&(f.constant=!1,e.invalidate(f.id)),!f.value&&!a&&(f.constant=!0,f.value=[0,0,0]))}}}finalizeState(t){for(const i of this.getModels())i.destroy();const e=this.getAttributeManager();e&&e.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const e of this.getModels())e.draw(t.renderPass)}getPickingInfo({info:t,mode:e,sourceLayer:i}){const{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(t,e){var i,s,r,a;e&&(t=new Error(`${e}: ${t.message}`,{cause:t})),(s=(i=this.props).onError)!=null&&s.call(i,t)||(a=(r=this.context)==null?void 0:r.onError)==null||a.call(r,t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var t;return((t=this.internalState)==null?void 0:t.uniformTransitions.active)||!1}activateViewport(t){if(!this.internalState)return;const e=this.internalState.viewport;this.internalState.viewport=t,(!e||!U2({oldViewport:e,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const e=this.getAttributeManager();e&&(t==="all"?e.invalidateAll():e.invalidate(t))}updateAttributes(t){let e=!1;for(const i in t)t[i].layoutChanged()&&(e=!0);for(const i of this.getModels())this._setModelAttributes(i,t,e)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const e=this.props,i=this.getNumInstances(),s=this.getStartIndices();t.update({data:e.data,numInstances:i,startIndices:s,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this});const r=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const e=t.update(),i=Object.create(this.props);for(const s in e)Object.defineProperty(i,s,{value:e[s]});return i}return this.props}calculateInstancePickingColors(t,{numInstances:e}){if(t.constant)return;const i=Math.floor(de.length/4);if(this.internalState.usesPickingColorCache=!0,i<e){e>Su&&vt.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),de=zi.allocate(de,e,{size:4,copy:!0,maxCount:Math.max(e,Su)});const s=Math.floor(de.length/4),r=[0,0,0];for(let a=i;a<s;a++)this.encodePickingColor(a,r),de[a*4+0]=r[0],de[a*4+1]=r[1],de[a*4+2]=r[2],de[a*4+3]=0}t.value=de.subarray(0,e*4)}_setModelAttributes(t,e,i=!1){var l;if(!Object.keys(e).length)return;if(i){const h=this.getAttributeManager();t.setBufferLayout(h.getBufferLayouts(t)),e=h.getAttributes()}const s=((l=t.userData)==null?void 0:l.excludeAttributes)||{},r={},a={};for(const h in e){if(s[h])continue;const f=e[h].getValue();for(const d in f){const _=f[d];_ instanceof bt?e[h].settings.isIndexed?t.setIndexBuffer(_):r[d]=_:_&&(a[d]=_)}}t.setAttributes(r),t.setConstantAttributes(a)}disablePickingIndex(t){const e=this.props.data;if(!("attributes"in e)){this._disablePickingIndex(t);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,r=i||s,a=r&&e.attributes&&e.attributes[r.id];if(a&&a.value){const l=a.value,h=this.encodePickingColor(t);for(let f=0;f<e.length;f++){const d=r.getVertexOffset(f);l[d]===h[0]&&l[d+1]===h[1]&&l[d+2]===h[2]&&this._disablePickingIndex(f)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,s=e||i;if(!s)return;const r=s.getVertexOffset(t),a=s.getVertexOffset(t+1);s.buffer.write(new Uint8Array(a-r),r)}restorePickingColors(){const{pickingColors:t,instancePickingColors:e}=this.getAttributeManager().attributes,i=t||e;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==de.buffer&&(i.value=de.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){jt(!this.internalState),jt(Number.isFinite(this.props.coordinateSystem)),Yt(N2,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new O2({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(vt.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new i2(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Yt(F2,this,this===t);const{state:e,internalState:i}=t;this!==t&&(this.internalState=i,this.state=e,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(Yt(D2,this,t),!t)return;const e=this.props,i=this.context,s=this.internalState,r=i.viewport,a=this._updateUniformTransition();s.propsInTransition=a,i.viewport=s.viewport||r,this.props=a;try{const l=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const d of this.props.extensions)d.updateState.call(this,l,d);this.setNeedsRedraw(),this._updateAttributes();const f=this.getModels()[0]!==h[0];this._postUpdate(l,f)}finally{i.viewport=r,this.props=e,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Yt(B2,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:e=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const r=this.props,a=this.context;this.props=this.internalState.propsInTransition||r;try{e&&this.setShaderModuleProps(e);const{getPolygonOffset:l}=this.props,h=l&&l(i)||[0,0];a.device instanceof Xn&&a.device.setParametersWebGL({polygonOffset:h});for(const f of this.getModels())f.device.type==="webgpu"?f.setParameters({...f.parameters,...s}):f.setParameters(s);if(a.device instanceof Xn)a.device.withParametersWebGL(s,()=>{const f={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:s,context:a};for(const d of this.props.extensions)d.draw.call(this,f,d);this.draw(f)});else{const f={renderPass:t,shaderModuleProps:e,uniforms:i,parameters:s,context:a};for(const d of this.props.extensions)d.draw.call(this,f,d);this.draw(f)}}finally{this.props=r}}getChangeFlags(){var t;return(t=this.internalState)==null?void 0:t.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:e}=this.internalState;for(const s in t)if(t[s]){let r=!1;switch(s){case"dataChanged":const a=t[s],l=e[s];a&&Array.isArray(l)&&(e.dataChanged=Array.isArray(a)?l.concat(a):a,r=!0);default:e[s]||(e[s]=t[s],r=!0)}r&&Yt(k2,this,s,t)}const i=!!(e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged);e.propsOrDataChanged=i,e.somethingChanged=i||e.viewportChanged||e.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,e){var s;const i=r2(t,e);if(i.updateTriggersChanged)for(const r in i.updateTriggersChanged)i.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(i.transitionsChanged)for(const r in i.transitionsChanged)this.internalState.uniformTransitions.add(r,e[r],t[r],(s=t.transitions)==null?void 0:s[r]);return this.setChangeFlags(i)}validateProps(){s2(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const e={highlightedObjectColor:t.picked?t.color:null},{highlightColor:i}=this.props;t.picked&&typeof i=="function"&&(e.highlightColor=i(t)),this.setShaderModuleProps({picking:e}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new QA(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,e){const{props:i,oldProps:s}=t,r=this.state.model;r!=null&&r.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:l,highlightColor:h}=i;if(e||s.autoHighlight!==a||s.highlightedObjectIndex!==l||s.highlightColor!==h){const f={};Array.isArray(h)&&(f.highlightColor=h),(e||s.autoHighlight!==a||l!==s.highlightedObjectIndex)&&(f.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:f})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let e=!1;e=e||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(t):!1;if(e=e||s,e)for(const r of this.props.extensions)r.onNeedsRedraw.call(this,r);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,e}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}pc.defaultProps=V2;pc.layerName="Layer";const Eu=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,z2={name:"arc",vs:Eu,fs:Eu,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},W2=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,H2=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cr=[0,0,0,255],$2={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getSourceColor:{type:"accessor",value:cr},getTargetColor:{type:"accessor",value:cr},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class _c extends pc{getBounds(){var t;return(t=this.getAttributeManager())==null?void 0:t.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:W2,fs:H2,modules:[_T,UT,z2]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:cr},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:cr},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){var e;super.updateState(t),t.changeFlags.extensionsChanged&&((e=this.state.model)==null||e.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:e,widthScale:i,widthMinPixels:s,widthMaxPixels:r,greatCircle:a,wrapLongitude:l,numSegments:h}=this.props,f={numSegments:h,widthUnits:Vi[e],widthScale:i,widthMinPixels:s,widthMaxPixels:r,greatCircle:a,useShortestPath:l},d=this.state.model;d.shaderInputs.setProps({arc:f}),d.setVertexCount(h*2),d.draw(this.context.renderPass)}_getModel(){return new Wi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}_c.layerName="ArcLayer";_c.defaultProps=$2;async function j2(){const t=`https://query.wikidata.org/sparql?format=json&query=${encodeURIComponent(`
    SELECT ?country ?countryLabel ?iso3166_3 ?coord WHERE {
      ?country wdt:P31 wd:Q3624078;  # Sovereign state
               wdt:P298 ?iso3166_3;   # ISO 3166-1 alpha-3 code
               wdt:P625 ?coord.       # Coordinates

      SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
    }`)}`;try{return await(await fetch(t,{headers:{Accept:"application/json"}})).json()}catch(e){return console.error("Error fetching data:",e),null}}const X2=n=>({type:"FeatureCollection",features:n.results.bindings.map(e=>{const i=e.coord.value.match(/Point\(([^ ]+) ([^ ]+)\)/);if(!i)return null;const[s,r,a]=i.map(Number);return{type:"Feature",properties:{name:e.countryLabel.value,iso3166_3:e.iso3166_3.value},geometry:{type:"Point",coordinates:[r,a]}}}).filter(e=>e!==null)});function Xd(n=8){return[...["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","CPV","KHM","CMR","CAN","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","SWZ","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MKD","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]].sort(()=>.5-Math.random()).slice(0,n)}const Z2=Xd();console.log("Random ISO3 codes:",Z2);function Y2(n,t,e,i){n.eachLayer(r=>{r._isDeckLayer&&n.removeLayer(r)});const s=new Cr({parent:n.getPanes().overlayPane,views:[new Ir({repeat:!0})],layers:[new _c({id:"arcs",data:t,dataTransform:r=>{const a=r.features.find(h=>h.properties.iso3166_3===i),l=a?a.geometry.coordinates:null;return r.features.filter(h=>e.includes(h.properties.iso3166_3)).map(h=>({...h,sourcePosition:l,targetPosition:h.geometry.coordinates}))},getSourcePosition:r=>r.sourcePosition,getTargetPosition:r=>r.targetPosition,getSourceColor:[0,128,200],getTargetColor:[200,0,80],getWidth:1})],controller:!1});n.addLayer(s)}const Zd={fillColor:"#cbc9e2",color:"#9e9ac8",weight:1,fillOpacity:.6},q2={fillColor:"#9e9ac8",color:"#9e9ac8",weight:1,fillOpacity:.8},K2={fillColor:"#54278f",weight:1};let Or=Fa.map("map").setView([2.5,20],3);const J2="pk.eyJ1IjoibXdpc2NnIiwiYSI6ImNtN2VtbGEzNzBnaTgyam9vZXl3YzM2Ym4ifQ.YJe4CFT-CEYhl0D98Wk8aw";Fa.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/light-v11/tiles/{z}/{x}/{y}?access_token=${J2}`,{attribution:'© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',tileSize:512,zoomOffset:-1}).addTo(Or);const Q2=new Cr({parent:Or.getPanes().overlayPane,views:[new Ir({repeat:!0})],controller:!1,layers:[]});Q2._isDeckLayer=!0;let Ba=null;j2().then(n=>{Ba=X2(n),console.log("Fetched centroids once:",Ba)}).catch(n=>console.error("Error fetching centroids:",n));fetch("/GEOG778-vite/WorldPoly.geojson").then(n=>n.json()).then(n=>{Fa.geoJson(n,{style:Zd,onEachFeature:G2}).addTo(Or)}).catch(n=>console.error("Error loading GeoJSON:",n));function G2(n,t){t.on({mouseover:function(e){e.target.setStyle(q2)},mouseout:function(e){e.target.setStyle(Zd)},click:function(e){const s=e.target.feature.properties.adm0_a3_us;console.log("Selected Country ISO3:",s),e.target.setStyle(K2);const r=Xd();console.log("Random ISO3 codes:",r),Y2(Or,Ba,r,s)}})}
