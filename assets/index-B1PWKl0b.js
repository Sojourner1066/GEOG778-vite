var Jf=Object.defineProperty;var Qf=(t,e,i)=>e in t?Jf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var m=(t,e,i)=>Qf(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();function Gf(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Si={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var tu=Si.exports,Ta;function eu(){return Ta||(Ta=1,function(t,e){(function(i,r){r(e)})(tu,function(i){var r="1.9.4";function s(n){var o,c,h,d;for(c=1,h=arguments.length;c<h;c++){d=arguments[c];for(o in d)n[o]=d[o]}return n}var a=Object.create||function(){function n(){}return function(o){return n.prototype=o,new n}}();function l(n,o){var c=Array.prototype.slice;if(n.bind)return n.bind.apply(n,c.call(arguments,1));var h=c.call(arguments,2);return function(){return n.apply(o,h.length?h.concat(c.call(arguments)):arguments)}}var f=0;function u(n){return"_leaflet_id"in n||(n._leaflet_id=++f),n._leaflet_id}function p(n,o,c){var h,d,_,y;return y=function(){h=!1,d&&(_.apply(c,d),d=!1)},_=function(){h?d=arguments:(n.apply(c,arguments),setTimeout(y,o),h=!0)},_}function g(n,o,c){var h=o[1],d=o[0],_=h-d;return n===h&&c?n:((n-d)%_+_)%_+d}function T(){return!1}function v(n,o){if(o===!1)return n;var c=Math.pow(10,o===void 0?6:o);return Math.round(n*c)/c}function E(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function b(n){return E(n).split(/\s+/)}function S(n,o){Object.prototype.hasOwnProperty.call(n,"options")||(n.options=n.options?a(n.options):{});for(var c in o)n.options[c]=o[c];return n.options}function w(n,o,c){var h=[];for(var d in n)h.push(encodeURIComponent(c?d.toUpperCase():d)+"="+encodeURIComponent(n[d]));return(!o||o.indexOf("?")===-1?"?":"&")+h.join("&")}var I=/\{ *([\w_ -]+) *\}/g;function C(n,o){return n.replace(I,function(c,h){var d=o[h];if(d===void 0)throw new Error("No value provided for variable "+c);return typeof d=="function"&&(d=d(o)),d})}var M=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};function O(n,o){for(var c=0;c<n.length;c++)if(n[c]===o)return c;return-1}var B="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function D(n){return window["webkit"+n]||window["moz"+n]||window["ms"+n]}var tt=0;function z(n){var o=+new Date,c=Math.max(0,16-(o-tt));return tt=o+c,window.setTimeout(n,c)}var W=window.requestAnimationFrame||D("RequestAnimationFrame")||z,Q=window.cancelAnimationFrame||D("CancelAnimationFrame")||D("CancelRequestAnimationFrame")||function(n){window.clearTimeout(n)};function U(n,o,c){if(c&&W===z)n.call(o);else return W.call(window,l(n,o))}function K(n){n&&Q.call(window,n)}var Tt={__proto__:null,extend:s,create:a,bind:l,get lastId(){return f},stamp:u,throttle:p,wrapNum:g,falseFn:T,formatNum:v,trim:E,splitWords:b,setOptions:S,getParamString:w,template:C,isArray:M,indexOf:O,emptyImageUrl:B,requestFn:W,cancelFn:Q,requestAnimFrame:U,cancelAnimFrame:K};function j(){}j.extend=function(n){var o=function(){S(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},c=o.__super__=this.prototype,h=a(c);h.constructor=o,o.prototype=h;for(var d in this)Object.prototype.hasOwnProperty.call(this,d)&&d!=="prototype"&&d!=="__super__"&&(o[d]=this[d]);return n.statics&&s(o,n.statics),n.includes&&(Wt(n.includes),s.apply(null,[h].concat(n.includes))),s(h,n),delete h.statics,delete h.includes,h.options&&(h.options=c.options?a(c.options):{},s(h.options,n.options)),h._initHooks=[],h.callInitHooks=function(){if(!this._initHooksCalled){c.callInitHooks&&c.callInitHooks.call(this),this._initHooksCalled=!0;for(var _=0,y=h._initHooks.length;_<y;_++)h._initHooks[_].call(this)}},o},j.include=function(n){var o=this.prototype.options;return s(this.prototype,n),n.options&&(this.prototype.options=o,this.mergeOptions(n.options)),this},j.mergeOptions=function(n){return s(this.prototype.options,n),this},j.addInitHook=function(n){var o=Array.prototype.slice.call(arguments,1),c=typeof n=="function"?n:function(){this[n].apply(this,o)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c),this};function Wt(n){if(!(typeof L>"u"||!L||!L.Mixin)){n=M(n)?n:[n];for(var o=0;o<n.length;o++)n[o]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Ct={on:function(n,o,c){if(typeof n=="object")for(var h in n)this._on(h,n[h],o);else{n=b(n);for(var d=0,_=n.length;d<_;d++)this._on(n[d],o,c)}return this},off:function(n,o,c){if(!arguments.length)delete this._events;else if(typeof n=="object")for(var h in n)this._off(h,n[h],o);else{n=b(n);for(var d=arguments.length===1,_=0,y=n.length;_<y;_++)d?this._off(n[_]):this._off(n[_],o,c)}return this},_on:function(n,o,c,h){if(typeof o!="function"){console.warn("wrong listener type: "+typeof o);return}if(this._listens(n,o,c)===!1){c===this&&(c=void 0);var d={fn:o,ctx:c};h&&(d.once=!0),this._events=this._events||{},this._events[n]=this._events[n]||[],this._events[n].push(d)}},_off:function(n,o,c){var h,d,_;if(this._events&&(h=this._events[n],!!h)){if(arguments.length===1){if(this._firingCount)for(d=0,_=h.length;d<_;d++)h[d].fn=T;delete this._events[n];return}if(typeof o!="function"){console.warn("wrong listener type: "+typeof o);return}var y=this._listens(n,o,c);if(y!==!1){var A=h[y];this._firingCount&&(A.fn=T,this._events[n]=h=h.slice()),h.splice(y,1)}}},fire:function(n,o,c){if(!this.listens(n,c))return this;var h=s({},o,{type:n,target:this,sourceTarget:o&&o.sourceTarget||this});if(this._events){var d=this._events[n];if(d){this._firingCount=this._firingCount+1||1;for(var _=0,y=d.length;_<y;_++){var A=d[_],R=A.fn;A.once&&this.off(n,R,A.ctx),R.call(A.ctx||this,h)}this._firingCount--}}return c&&this._propagateEvent(h),this},listens:function(n,o,c,h){typeof n!="string"&&console.warn('"string" type argument expected');var d=o;typeof o!="function"&&(h=!!o,d=void 0,c=void 0);var _=this._events&&this._events[n];if(_&&_.length&&this._listens(n,d,c)!==!1)return!0;if(h){for(var y in this._eventParents)if(this._eventParents[y].listens(n,o,c,h))return!0}return!1},_listens:function(n,o,c){if(!this._events)return!1;var h=this._events[n]||[];if(!o)return!!h.length;c===this&&(c=void 0);for(var d=0,_=h.length;d<_;d++)if(h[d].fn===o&&h[d].ctx===c)return d;return!1},once:function(n,o,c){if(typeof n=="object")for(var h in n)this._on(h,n[h],o,!0);else{n=b(n);for(var d=0,_=n.length;d<_;d++)this._on(n[d],o,c,!0)}return this},addEventParent:function(n){return this._eventParents=this._eventParents||{},this._eventParents[u(n)]=n,this},removeEventParent:function(n){return this._eventParents&&delete this._eventParents[u(n)],this},_propagateEvent:function(n){for(var o in this._eventParents)this._eventParents[o].fire(n.type,s({layer:n.target,propagatedFrom:n.target},n),!0)}};Ct.addEventListener=Ct.on,Ct.removeEventListener=Ct.clearAllEventListeners=Ct.off,Ct.addOneTimeEventListener=Ct.once,Ct.fireEvent=Ct.fire,Ct.hasEventListeners=Ct.listens;var si=j.extend(Ct);function X(n,o,c){this.x=c?Math.round(n):n,this.y=c?Math.round(o):o}var oo=Math.trunc||function(n){return n>0?Math.floor(n):Math.ceil(n)};X.prototype={clone:function(){return new X(this.x,this.y)},add:function(n){return this.clone()._add(V(n))},_add:function(n){return this.x+=n.x,this.y+=n.y,this},subtract:function(n){return this.clone()._subtract(V(n))},_subtract:function(n){return this.x-=n.x,this.y-=n.y,this},divideBy:function(n){return this.clone()._divideBy(n)},_divideBy:function(n){return this.x/=n,this.y/=n,this},multiplyBy:function(n){return this.clone()._multiplyBy(n)},_multiplyBy:function(n){return this.x*=n,this.y*=n,this},scaleBy:function(n){return new X(this.x*n.x,this.y*n.y)},unscaleBy:function(n){return new X(this.x/n.x,this.y/n.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=oo(this.x),this.y=oo(this.y),this},distanceTo:function(n){n=V(n);var o=n.x-this.x,c=n.y-this.y;return Math.sqrt(o*o+c*c)},equals:function(n){return n=V(n),n.x===this.x&&n.y===this.y},contains:function(n){return n=V(n),Math.abs(n.x)<=Math.abs(this.x)&&Math.abs(n.y)<=Math.abs(this.y)},toString:function(){return"Point("+v(this.x)+", "+v(this.y)+")"}};function V(n,o,c){return n instanceof X?n:M(n)?new X(n[0],n[1]):n==null?n:typeof n=="object"&&"x"in n&&"y"in n?new X(n.x,n.y):new X(n,o,c)}function ot(n,o){if(n)for(var c=o?[n,o]:n,h=0,d=c.length;h<d;h++)this.extend(c[h])}ot.prototype={extend:function(n){var o,c;if(!n)return this;if(n instanceof X||typeof n[0]=="number"||"x"in n)o=c=V(n);else if(n=wt(n),o=n.min,c=n.max,!o||!c)return this;return!this.min&&!this.max?(this.min=o.clone(),this.max=c.clone()):(this.min.x=Math.min(o.x,this.min.x),this.max.x=Math.max(c.x,this.max.x),this.min.y=Math.min(o.y,this.min.y),this.max.y=Math.max(c.y,this.max.y)),this},getCenter:function(n){return V((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,n)},getBottomLeft:function(){return V(this.min.x,this.max.y)},getTopRight:function(){return V(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(n){var o,c;return typeof n[0]=="number"||n instanceof X?n=V(n):n=wt(n),n instanceof ot?(o=n.min,c=n.max):o=c=n,o.x>=this.min.x&&c.x<=this.max.x&&o.y>=this.min.y&&c.y<=this.max.y},intersects:function(n){n=wt(n);var o=this.min,c=this.max,h=n.min,d=n.max,_=d.x>=o.x&&h.x<=c.x,y=d.y>=o.y&&h.y<=c.y;return _&&y},overlaps:function(n){n=wt(n);var o=this.min,c=this.max,h=n.min,d=n.max,_=d.x>o.x&&h.x<c.x,y=d.y>o.y&&h.y<c.y;return _&&y},isValid:function(){return!!(this.min&&this.max)},pad:function(n){var o=this.min,c=this.max,h=Math.abs(o.x-c.x)*n,d=Math.abs(o.y-c.y)*n;return wt(V(o.x-h,o.y-d),V(c.x+h,c.y+d))},equals:function(n){return n?(n=wt(n),this.min.equals(n.getTopLeft())&&this.max.equals(n.getBottomRight())):!1}};function wt(n,o){return!n||n instanceof ot?n:new ot(n,o)}function Pt(n,o){if(n)for(var c=o?[n,o]:n,h=0,d=c.length;h<d;h++)this.extend(c[h])}Pt.prototype={extend:function(n){var o=this._southWest,c=this._northEast,h,d;if(n instanceof et)h=n,d=n;else if(n instanceof Pt){if(h=n._southWest,d=n._northEast,!h||!d)return this}else return n?this.extend(q(n)||ht(n)):this;return!o&&!c?(this._southWest=new et(h.lat,h.lng),this._northEast=new et(d.lat,d.lng)):(o.lat=Math.min(h.lat,o.lat),o.lng=Math.min(h.lng,o.lng),c.lat=Math.max(d.lat,c.lat),c.lng=Math.max(d.lng,c.lng)),this},pad:function(n){var o=this._southWest,c=this._northEast,h=Math.abs(o.lat-c.lat)*n,d=Math.abs(o.lng-c.lng)*n;return new Pt(new et(o.lat-h,o.lng-d),new et(c.lat+h,c.lng+d))},getCenter:function(){return new et((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new et(this.getNorth(),this.getWest())},getSouthEast:function(){return new et(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(n){typeof n[0]=="number"||n instanceof et||"lat"in n?n=q(n):n=ht(n);var o=this._southWest,c=this._northEast,h,d;return n instanceof Pt?(h=n.getSouthWest(),d=n.getNorthEast()):h=d=n,h.lat>=o.lat&&d.lat<=c.lat&&h.lng>=o.lng&&d.lng<=c.lng},intersects:function(n){n=ht(n);var o=this._southWest,c=this._northEast,h=n.getSouthWest(),d=n.getNorthEast(),_=d.lat>=o.lat&&h.lat<=c.lat,y=d.lng>=o.lng&&h.lng<=c.lng;return _&&y},overlaps:function(n){n=ht(n);var o=this._southWest,c=this._northEast,h=n.getSouthWest(),d=n.getNorthEast(),_=d.lat>o.lat&&h.lat<c.lat,y=d.lng>o.lng&&h.lng<c.lng;return _&&y},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(n,o){return n?(n=ht(n),this._southWest.equals(n.getSouthWest(),o)&&this._northEast.equals(n.getNorthEast(),o)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ht(n,o){return n instanceof Pt?n:new Pt(n,o)}function et(n,o,c){if(isNaN(n)||isNaN(o))throw new Error("Invalid LatLng object: ("+n+", "+o+")");this.lat=+n,this.lng=+o,c!==void 0&&(this.alt=+c)}et.prototype={equals:function(n,o){if(!n)return!1;n=q(n);var c=Math.max(Math.abs(this.lat-n.lat),Math.abs(this.lng-n.lng));return c<=(o===void 0?1e-9:o)},toString:function(n){return"LatLng("+v(this.lat,n)+", "+v(this.lng,n)+")"},distanceTo:function(n){return se.distance(this,q(n))},wrap:function(){return se.wrapLatLng(this)},toBounds:function(n){var o=180*n/40075017,c=o/Math.cos(Math.PI/180*this.lat);return ht([this.lat-o,this.lng-c],[this.lat+o,this.lng+c])},clone:function(){return new et(this.lat,this.lng,this.alt)}};function q(n,o,c){return n instanceof et?n:M(n)&&typeof n[0]!="object"?n.length===3?new et(n[0],n[1],n[2]):n.length===2?new et(n[0],n[1]):null:n==null?n:typeof n=="object"&&"lat"in n?new et(n.lat,"lng"in n?n.lng:n.lon,n.alt):o===void 0?null:new et(n,o,c)}var Gt={latLngToPoint:function(n,o){var c=this.projection.project(n),h=this.scale(o);return this.transformation._transform(c,h)},pointToLatLng:function(n,o){var c=this.scale(o),h=this.transformation.untransform(n,c);return this.projection.unproject(h)},project:function(n){return this.projection.project(n)},unproject:function(n){return this.projection.unproject(n)},scale:function(n){return 256*Math.pow(2,n)},zoom:function(n){return Math.log(n/256)/Math.LN2},getProjectedBounds:function(n){if(this.infinite)return null;var o=this.projection.bounds,c=this.scale(n),h=this.transformation.transform(o.min,c),d=this.transformation.transform(o.max,c);return new ot(h,d)},infinite:!1,wrapLatLng:function(n){var o=this.wrapLng?g(n.lng,this.wrapLng,!0):n.lng,c=this.wrapLat?g(n.lat,this.wrapLat,!0):n.lat,h=n.alt;return new et(c,o,h)},wrapLatLngBounds:function(n){var o=n.getCenter(),c=this.wrapLatLng(o),h=o.lat-c.lat,d=o.lng-c.lng;if(h===0&&d===0)return n;var _=n.getSouthWest(),y=n.getNorthEast(),A=new et(_.lat-h,_.lng-d),R=new et(y.lat-h,y.lng-d);return new Pt(A,R)}},se=s({},Gt,{wrapLng:[-180,180],R:6371e3,distance:function(n,o){var c=Math.PI/180,h=n.lat*c,d=o.lat*c,_=Math.sin((o.lat-n.lat)*c/2),y=Math.sin((o.lng-n.lng)*c/2),A=_*_+Math.cos(h)*Math.cos(d)*y*y,R=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A));return this.R*R}}),ao=6378137,qn={R:ao,MAX_LATITUDE:85.0511287798,project:function(n){var o=Math.PI/180,c=this.MAX_LATITUDE,h=Math.max(Math.min(c,n.lat),-c),d=Math.sin(h*o);return new X(this.R*n.lng*o,this.R*Math.log((1+d)/(1-d))/2)},unproject:function(n){var o=180/Math.PI;return new et((2*Math.atan(Math.exp(n.y/this.R))-Math.PI/2)*o,n.x*o/this.R)},bounds:function(){var n=ao*Math.PI;return new ot([-n,-n],[n,n])}()};function Jn(n,o,c,h){if(M(n)){this._a=n[0],this._b=n[1],this._c=n[2],this._d=n[3];return}this._a=n,this._b=o,this._c=c,this._d=h}Jn.prototype={transform:function(n,o){return this._transform(n.clone(),o)},_transform:function(n,o){return o=o||1,n.x=o*(this._a*n.x+this._b),n.y=o*(this._c*n.y+this._d),n},untransform:function(n,o){return o=o||1,new X((n.x/o-this._b)/this._a,(n.y/o-this._d)/this._c)}};function oi(n,o,c,h){return new Jn(n,o,c,h)}var Qn=s({},se,{code:"EPSG:3857",projection:qn,transformation:function(){var n=.5/(Math.PI*qn.R);return oi(n,.5,-n,.5)}()}),wh=s({},Qn,{code:"EPSG:900913"});function co(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function lo(n,o){var c="",h,d,_,y,A,R;for(h=0,_=n.length;h<_;h++){for(A=n[h],d=0,y=A.length;d<y;d++)R=A[d],c+=(d?"L":"M")+R.x+" "+R.y;c+=o?F.svg?"z":"x":""}return c||"M0 0"}var Gn=document.documentElement.style,ki="ActiveXObject"in window,Ph=ki&&!document.addEventListener,ho="msLaunchUri"in navigator&&!("documentMode"in document),tr=Ht("webkit"),fo=Ht("android"),uo=Ht("android 2")||Ht("android 3"),Mh=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ch=fo&&Ht("Google")&&Mh<537&&!("AudioNode"in window),er=!!window.opera,_o=!ho&&Ht("chrome"),po=Ht("gecko")&&!tr&&!er&&!ki,Ih=!_o&&Ht("safari"),go=Ht("phantom"),mo="OTransition"in Gn,Oh=navigator.platform.indexOf("Win")===0,To=ki&&"transition"in Gn,ir="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!uo,vo="MozPerspective"in Gn,xh=!window.L_DISABLE_3D&&(To||ir||vo)&&!mo&&!go,ai=typeof orientation<"u"||Ht("mobile"),Nh=ai&&tr,Dh=ai&&ir,yo=!window.PointerEvent&&window.MSPointerEvent,Eo=!!(window.PointerEvent||yo),Ao="ontouchstart"in window||!!window.TouchEvent,Bh=!window.L_NO_TOUCH&&(Ao||Eo),Fh=ai&&er,Uh=ai&&po,Lh=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,kh=function(){var n=!1;try{var o=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("testPassiveEventSupport",T,o),window.removeEventListener("testPassiveEventSupport",T,o)}catch{}return n}(),zh=function(){return!!document.createElement("canvas").getContext}(),nr=!!(document.createElementNS&&co("svg").createSVGRect),Vh=!!nr&&function(){var n=document.createElement("div");return n.innerHTML="<svg/>",(n.firstChild&&n.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Wh=!nr&&function(){try{var n=document.createElement("div");n.innerHTML='<v:shape adj="1"/>';var o=n.firstChild;return o.style.behavior="url(#default#VML)",o&&typeof o.adj=="object"}catch{return!1}}(),Hh=navigator.platform.indexOf("Mac")===0,jh=navigator.platform.indexOf("Linux")===0;function Ht(n){return navigator.userAgent.toLowerCase().indexOf(n)>=0}var F={ie:ki,ielt9:Ph,edge:ho,webkit:tr,android:fo,android23:uo,androidStock:Ch,opera:er,chrome:_o,gecko:po,safari:Ih,phantom:go,opera12:mo,win:Oh,ie3d:To,webkit3d:ir,gecko3d:vo,any3d:xh,mobile:ai,mobileWebkit:Nh,mobileWebkit3d:Dh,msPointer:yo,pointer:Eo,touch:Bh,touchNative:Ao,mobileOpera:Fh,mobileGecko:Uh,retina:Lh,passiveEvents:kh,canvas:zh,svg:nr,vml:Wh,inlineSvg:Vh,mac:Hh,linux:jh},So=F.msPointer?"MSPointerDown":"pointerdown",Ro=F.msPointer?"MSPointerMove":"pointermove",bo=F.msPointer?"MSPointerUp":"pointerup",wo=F.msPointer?"MSPointerCancel":"pointercancel",rr={touchstart:So,touchmove:Ro,touchend:bo,touchcancel:wo},Po={touchstart:qh,touchmove:zi,touchend:zi,touchcancel:zi},Ne={},Mo=!1;function Xh(n,o,c){return o==="touchstart"&&Kh(),Po[o]?(c=Po[o].bind(this,c),n.addEventListener(rr[o],c,!1),c):(console.warn("wrong event specified:",o),T)}function Zh(n,o,c){if(!rr[o]){console.warn("wrong event specified:",o);return}n.removeEventListener(rr[o],c,!1)}function $h(n){Ne[n.pointerId]=n}function Yh(n){Ne[n.pointerId]&&(Ne[n.pointerId]=n)}function Co(n){delete Ne[n.pointerId]}function Kh(){Mo||(document.addEventListener(So,$h,!0),document.addEventListener(Ro,Yh,!0),document.addEventListener(bo,Co,!0),document.addEventListener(wo,Co,!0),Mo=!0)}function zi(n,o){if(o.pointerType!==(o.MSPOINTER_TYPE_MOUSE||"mouse")){o.touches=[];for(var c in Ne)o.touches.push(Ne[c]);o.changedTouches=[o],n(o)}}function qh(n,o){o.MSPOINTER_TYPE_TOUCH&&o.pointerType===o.MSPOINTER_TYPE_TOUCH&&yt(o),zi(n,o)}function Jh(n){var o={},c,h;for(h in n)c=n[h],o[h]=c&&c.bind?c.bind(n):c;return n=o,o.type="dblclick",o.detail=2,o.isTrusted=!1,o._simulated=!0,o}var Qh=200;function Gh(n,o){n.addEventListener("dblclick",o);var c=0,h;function d(_){if(_.detail!==1){h=_.detail;return}if(!(_.pointerType==="mouse"||_.sourceCapabilities&&!_.sourceCapabilities.firesTouchEvents)){var y=Do(_);if(!(y.some(function(R){return R instanceof HTMLLabelElement&&R.attributes.for})&&!y.some(function(R){return R instanceof HTMLInputElement||R instanceof HTMLSelectElement}))){var A=Date.now();A-c<=Qh?(h++,h===2&&o(Jh(_))):h=1,c=A}}}return n.addEventListener("click",d),{dblclick:o,simDblclick:d}}function tf(n,o){n.removeEventListener("dblclick",o.dblclick),n.removeEventListener("click",o.simDblclick)}var sr=Hi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ci=Hi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Io=ci==="webkitTransition"||ci==="OTransition"?ci+"End":"transitionend";function Oo(n){return typeof n=="string"?document.getElementById(n):n}function li(n,o){var c=n.style[o]||n.currentStyle&&n.currentStyle[o];if((!c||c==="auto")&&document.defaultView){var h=document.defaultView.getComputedStyle(n,null);c=h?h[o]:null}return c==="auto"?null:c}function G(n,o,c){var h=document.createElement(n);return h.className=o||"",c&&c.appendChild(h),h}function at(n){var o=n.parentNode;o&&o.removeChild(n)}function Vi(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function De(n){var o=n.parentNode;o&&o.lastChild!==n&&o.appendChild(n)}function Be(n){var o=n.parentNode;o&&o.firstChild!==n&&o.insertBefore(n,o.firstChild)}function or(n,o){if(n.classList!==void 0)return n.classList.contains(o);var c=Wi(n);return c.length>0&&new RegExp("(^|\\s)"+o+"(\\s|$)").test(c)}function $(n,o){if(n.classList!==void 0)for(var c=b(o),h=0,d=c.length;h<d;h++)n.classList.add(c[h]);else if(!or(n,o)){var _=Wi(n);ar(n,(_?_+" ":"")+o)}}function lt(n,o){n.classList!==void 0?n.classList.remove(o):ar(n,E((" "+Wi(n)+" ").replace(" "+o+" "," ")))}function ar(n,o){n.className.baseVal===void 0?n.className=o:n.className.baseVal=o}function Wi(n){return n.correspondingElement&&(n=n.correspondingElement),n.className.baseVal===void 0?n.className:n.className.baseVal}function xt(n,o){"opacity"in n.style?n.style.opacity=o:"filter"in n.style&&ef(n,o)}function ef(n,o){var c=!1,h="DXImageTransform.Microsoft.Alpha";try{c=n.filters.item(h)}catch{if(o===1)return}o=Math.round(o*100),c?(c.Enabled=o!==100,c.Opacity=o):n.style.filter+=" progid:"+h+"(opacity="+o+")"}function Hi(n){for(var o=document.documentElement.style,c=0;c<n.length;c++)if(n[c]in o)return n[c];return!1}function Te(n,o,c){var h=o||new X(0,0);n.style[sr]=(F.ie3d?"translate("+h.x+"px,"+h.y+"px)":"translate3d("+h.x+"px,"+h.y+"px,0)")+(c?" scale("+c+")":"")}function ft(n,o){n._leaflet_pos=o,F.any3d?Te(n,o):(n.style.left=o.x+"px",n.style.top=o.y+"px")}function ve(n){return n._leaflet_pos||new X(0,0)}var hi,fi,cr;if("onselectstart"in document)hi=function(){Z(window,"selectstart",yt)},fi=function(){rt(window,"selectstart",yt)};else{var ui=Hi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);hi=function(){if(ui){var n=document.documentElement.style;cr=n[ui],n[ui]="none"}},fi=function(){ui&&(document.documentElement.style[ui]=cr,cr=void 0)}}function lr(){Z(window,"dragstart",yt)}function hr(){rt(window,"dragstart",yt)}var ji,fr;function ur(n){for(;n.tabIndex===-1;)n=n.parentNode;n.style&&(Xi(),ji=n,fr=n.style.outlineStyle,n.style.outlineStyle="none",Z(window,"keydown",Xi))}function Xi(){ji&&(ji.style.outlineStyle=fr,ji=void 0,fr=void 0,rt(window,"keydown",Xi))}function xo(n){do n=n.parentNode;while((!n.offsetWidth||!n.offsetHeight)&&n!==document.body);return n}function dr(n){var o=n.getBoundingClientRect();return{x:o.width/n.offsetWidth||1,y:o.height/n.offsetHeight||1,boundingClientRect:o}}var nf={__proto__:null,TRANSFORM:sr,TRANSITION:ci,TRANSITION_END:Io,get:Oo,getStyle:li,create:G,remove:at,empty:Vi,toFront:De,toBack:Be,hasClass:or,addClass:$,removeClass:lt,setClass:ar,getClass:Wi,setOpacity:xt,testProp:Hi,setTransform:Te,setPosition:ft,getPosition:ve,get disableTextSelection(){return hi},get enableTextSelection(){return fi},disableImageDrag:lr,enableImageDrag:hr,preventOutline:ur,restoreOutline:Xi,getSizedParentNode:xo,getScale:dr};function Z(n,o,c,h){if(o&&typeof o=="object")for(var d in o)pr(n,d,o[d],c);else{o=b(o);for(var _=0,y=o.length;_<y;_++)pr(n,o[_],c,h)}return this}var jt="_leaflet_events";function rt(n,o,c,h){if(arguments.length===1)No(n),delete n[jt];else if(o&&typeof o=="object")for(var d in o)gr(n,d,o[d],c);else if(o=b(o),arguments.length===2)No(n,function(A){return O(o,A)!==-1});else for(var _=0,y=o.length;_<y;_++)gr(n,o[_],c,h);return this}function No(n,o){for(var c in n[jt]){var h=c.split(/\d/)[0];(!o||o(h))&&gr(n,h,null,null,c)}}var _r={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function pr(n,o,c,h){var d=o+u(c)+(h?"_"+u(h):"");if(n[jt]&&n[jt][d])return this;var _=function(A){return c.call(h||n,A||window.event)},y=_;!F.touchNative&&F.pointer&&o.indexOf("touch")===0?_=Xh(n,o,_):F.touch&&o==="dblclick"?_=Gh(n,_):"addEventListener"in n?o==="touchstart"||o==="touchmove"||o==="wheel"||o==="mousewheel"?n.addEventListener(_r[o]||o,_,F.passiveEvents?{passive:!1}:!1):o==="mouseenter"||o==="mouseleave"?(_=function(A){A=A||window.event,Tr(n,A)&&y(A)},n.addEventListener(_r[o],_,!1)):n.addEventListener(o,y,!1):n.attachEvent("on"+o,_),n[jt]=n[jt]||{},n[jt][d]=_}function gr(n,o,c,h,d){d=d||o+u(c)+(h?"_"+u(h):"");var _=n[jt]&&n[jt][d];if(!_)return this;!F.touchNative&&F.pointer&&o.indexOf("touch")===0?Zh(n,o,_):F.touch&&o==="dblclick"?tf(n,_):"removeEventListener"in n?n.removeEventListener(_r[o]||o,_,!1):n.detachEvent("on"+o,_),n[jt][d]=null}function ye(n){return n.stopPropagation?n.stopPropagation():n.originalEvent?n.originalEvent._stopped=!0:n.cancelBubble=!0,this}function mr(n){return pr(n,"wheel",ye),this}function di(n){return Z(n,"mousedown touchstart dblclick contextmenu",ye),n._leaflet_disable_click=!0,this}function yt(n){return n.preventDefault?n.preventDefault():n.returnValue=!1,this}function Ee(n){return yt(n),ye(n),this}function Do(n){if(n.composedPath)return n.composedPath();for(var o=[],c=n.target;c;)o.push(c),c=c.parentNode;return o}function Bo(n,o){if(!o)return new X(n.clientX,n.clientY);var c=dr(o),h=c.boundingClientRect;return new X((n.clientX-h.left)/c.x-o.clientLeft,(n.clientY-h.top)/c.y-o.clientTop)}var rf=F.linux&&F.chrome?window.devicePixelRatio:F.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Fo(n){return F.edge?n.wheelDeltaY/2:n.deltaY&&n.deltaMode===0?-n.deltaY/rf:n.deltaY&&n.deltaMode===1?-n.deltaY*20:n.deltaY&&n.deltaMode===2?-n.deltaY*60:n.deltaX||n.deltaZ?0:n.wheelDelta?(n.wheelDeltaY||n.wheelDelta)/2:n.detail&&Math.abs(n.detail)<32765?-n.detail*20:n.detail?n.detail/-32765*60:0}function Tr(n,o){var c=o.relatedTarget;if(!c)return!0;try{for(;c&&c!==n;)c=c.parentNode}catch{return!1}return c!==n}var sf={__proto__:null,on:Z,off:rt,stopPropagation:ye,disableScrollPropagation:mr,disableClickPropagation:di,preventDefault:yt,stop:Ee,getPropagationPath:Do,getMousePosition:Bo,getWheelDelta:Fo,isExternalTarget:Tr,addListener:Z,removeListener:rt},Uo=si.extend({run:function(n,o,c,h){this.stop(),this._el=n,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(h||.5,.2),this._startPos=ve(n),this._offset=o.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=U(this._animate,this),this._step()},_step:function(n){var o=+new Date-this._startTime,c=this._duration*1e3;o<c?this._runFrame(this._easeOut(o/c),n):(this._runFrame(1),this._complete())},_runFrame:function(n,o){var c=this._startPos.add(this._offset.multiplyBy(n));o&&c._round(),ft(this._el,c),this.fire("step")},_complete:function(){K(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(n){return 1-Math.pow(1-n,this._easeOutPower)}}),J=si.extend({options:{crs:Qn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(n,o){o=S(this,o),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(n),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),o.maxBounds&&this.setMaxBounds(o.maxBounds),o.zoom!==void 0&&(this._zoom=this._limitZoom(o.zoom)),o.center&&o.zoom!==void 0&&this.setView(q(o.center),o.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ci&&F.any3d&&!F.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Z(this._proxy,Io,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(n,o,c){if(o=o===void 0?this._zoom:this._limitZoom(o),n=this._limitCenter(q(n),o,this.options.maxBounds),c=c||{},this._stop(),this._loaded&&!c.reset&&c!==!0){c.animate!==void 0&&(c.zoom=s({animate:c.animate},c.zoom),c.pan=s({animate:c.animate,duration:c.duration},c.pan));var h=this._zoom!==o?this._tryAnimatedZoom&&this._tryAnimatedZoom(n,o,c.zoom):this._tryAnimatedPan(n,c.pan);if(h)return clearTimeout(this._sizeTimer),this}return this._resetView(n,o,c.pan&&c.pan.noMoveStart),this},setZoom:function(n,o){return this._loaded?this.setView(this.getCenter(),n,{zoom:o}):(this._zoom=n,this)},zoomIn:function(n,o){return n=n||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+n,o)},zoomOut:function(n,o){return n=n||(F.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-n,o)},setZoomAround:function(n,o,c){var h=this.getZoomScale(o),d=this.getSize().divideBy(2),_=n instanceof X?n:this.latLngToContainerPoint(n),y=_.subtract(d).multiplyBy(1-1/h),A=this.containerPointToLatLng(d.add(y));return this.setView(A,o,{zoom:c})},_getBoundsCenterZoom:function(n,o){o=o||{},n=n.getBounds?n.getBounds():ht(n);var c=V(o.paddingTopLeft||o.padding||[0,0]),h=V(o.paddingBottomRight||o.padding||[0,0]),d=this.getBoundsZoom(n,!1,c.add(h));if(d=typeof o.maxZoom=="number"?Math.min(o.maxZoom,d):d,d===1/0)return{center:n.getCenter(),zoom:d};var _=h.subtract(c).divideBy(2),y=this.project(n.getSouthWest(),d),A=this.project(n.getNorthEast(),d),R=this.unproject(y.add(A).divideBy(2).add(_),d);return{center:R,zoom:d}},fitBounds:function(n,o){if(n=ht(n),!n.isValid())throw new Error("Bounds are not valid.");var c=this._getBoundsCenterZoom(n,o);return this.setView(c.center,c.zoom,o)},fitWorld:function(n){return this.fitBounds([[-90,-180],[90,180]],n)},panTo:function(n,o){return this.setView(n,this._zoom,{pan:o})},panBy:function(n,o){if(n=V(n).round(),o=o||{},!n.x&&!n.y)return this.fire("moveend");if(o.animate!==!0&&!this.getSize().contains(n))return this._resetView(this.unproject(this.project(this.getCenter()).add(n)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Uo,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),o.noMoveStart||this.fire("movestart"),o.animate!==!1){$(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(n).round();this._panAnim.run(this._mapPane,c,o.duration||.25,o.easeLinearity)}else this._rawPanBy(n),this.fire("move").fire("moveend");return this},flyTo:function(n,o,c){if(c=c||{},c.animate===!1||!F.any3d)return this.setView(n,o,c);this._stop();var h=this.project(this.getCenter()),d=this.project(n),_=this.getSize(),y=this._zoom;n=q(n),o=o===void 0?y:o;var A=Math.max(_.x,_.y),R=A*this.getZoomScale(y,o),P=d.distanceTo(h)||1,x=1.42,k=x*x;function Y(ut){var rn=ut?-1:1,$f=ut?R:A,Yf=R*R-A*A+rn*k*k*P*P,Kf=2*$f*k*P,Cr=Yf/Kf,ma=Math.sqrt(Cr*Cr+1)-Cr,qf=ma<1e-9?-18:Math.log(ma);return qf}function bt(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function vt(ut){return(Math.exp(ut)+Math.exp(-ut))/2}function Dt(ut){return bt(ut)/vt(ut)}var Mt=Y(0);function Ve(ut){return A*(vt(Mt)/vt(Mt+x*ut))}function Hf(ut){return A*(vt(Mt)*Dt(Mt+x*ut)-bt(Mt))/k}function jf(ut){return 1-Math.pow(1-ut,1.5)}var Xf=Date.now(),pa=(Y(1)-Mt)/x,Zf=c.duration?1e3*c.duration:1e3*pa*.8;function ga(){var ut=(Date.now()-Xf)/Zf,rn=jf(ut)*pa;ut<=1?(this._flyToFrame=U(ga,this),this._move(this.unproject(h.add(d.subtract(h).multiplyBy(Hf(rn)/P)),y),this.getScaleZoom(A/Ve(rn),y),{flyTo:!0})):this._move(n,o)._moveEnd(!0)}return this._moveStart(!0,c.noMoveStart),ga.call(this),this},flyToBounds:function(n,o){var c=this._getBoundsCenterZoom(n,o);return this.flyTo(c.center,c.zoom,o)},setMaxBounds:function(n){return n=ht(n),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),n.isValid()?(this.options.maxBounds=n,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(n){var o=this.options.minZoom;return this.options.minZoom=n,this._loaded&&o!==n&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(n):this},setMaxZoom:function(n){var o=this.options.maxZoom;return this.options.maxZoom=n,this._loaded&&o!==n&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(n):this},panInsideBounds:function(n,o){this._enforcingBounds=!0;var c=this.getCenter(),h=this._limitCenter(c,this._zoom,ht(n));return c.equals(h)||this.panTo(h,o),this._enforcingBounds=!1,this},panInside:function(n,o){o=o||{};var c=V(o.paddingTopLeft||o.padding||[0,0]),h=V(o.paddingBottomRight||o.padding||[0,0]),d=this.project(this.getCenter()),_=this.project(n),y=this.getPixelBounds(),A=wt([y.min.add(c),y.max.subtract(h)]),R=A.getSize();if(!A.contains(_)){this._enforcingBounds=!0;var P=_.subtract(A.getCenter()),x=A.extend(_).getSize().subtract(R);d.x+=P.x<0?-x.x:x.x,d.y+=P.y<0?-x.y:x.y,this.panTo(this.unproject(d),o),this._enforcingBounds=!1}return this},invalidateSize:function(n){if(!this._loaded)return this;n=s({animate:!1,pan:!0},n===!0?{animate:!0}:n);var o=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var c=this.getSize(),h=o.divideBy(2).round(),d=c.divideBy(2).round(),_=h.subtract(d);return!_.x&&!_.y?this:(n.animate&&n.pan?this.panBy(_):(n.pan&&this._rawPanBy(_),this.fire("move"),n.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:o,newSize:c}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(n){if(n=this._locateOptions=s({timeout:1e4,watch:!1},n),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var o=l(this._handleGeolocationResponse,this),c=l(this._handleGeolocationError,this);return n.watch?this._locationWatchId=navigator.geolocation.watchPosition(o,c,n):navigator.geolocation.getCurrentPosition(o,c,n),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(n){if(this._container._leaflet_id){var o=n.code,c=n.message||(o===1?"permission denied":o===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:o,message:"Geolocation error: "+c+"."})}},_handleGeolocationResponse:function(n){if(this._container._leaflet_id){var o=n.coords.latitude,c=n.coords.longitude,h=new et(o,c),d=h.toBounds(n.coords.accuracy*2),_=this._locateOptions;if(_.setView){var y=this.getBoundsZoom(d);this.setView(h,_.maxZoom?Math.min(y,_.maxZoom):y)}var A={latlng:h,bounds:d,timestamp:n.timestamp};for(var R in n.coords)typeof n.coords[R]=="number"&&(A[R]=n.coords[R]);this.fire("locationfound",A)}},addHandler:function(n,o){if(!o)return this;var c=this[n]=new o(this);return this._handlers.push(c),this.options[n]&&c.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),at(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(K(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var n;for(n in this._layers)this._layers[n].remove();for(n in this._panes)at(this._panes[n]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(n,o){var c="leaflet-pane"+(n?" leaflet-"+n.replace("Pane","")+"-pane":""),h=G("div",c,o||this._mapPane);return n&&(this._panes[n]=h),h},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var n=this.getPixelBounds(),o=this.unproject(n.getBottomLeft()),c=this.unproject(n.getTopRight());return new Pt(o,c)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(n,o,c){n=ht(n),c=V(c||[0,0]);var h=this.getZoom()||0,d=this.getMinZoom(),_=this.getMaxZoom(),y=n.getNorthWest(),A=n.getSouthEast(),R=this.getSize().subtract(c),P=wt(this.project(A,h),this.project(y,h)).getSize(),x=F.any3d?this.options.zoomSnap:1,k=R.x/P.x,Y=R.y/P.y,bt=o?Math.max(k,Y):Math.min(k,Y);return h=this.getScaleZoom(bt,h),x&&(h=Math.round(h/(x/100))*(x/100),h=o?Math.ceil(h/x)*x:Math.floor(h/x)*x),Math.max(d,Math.min(_,h))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new X(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(n,o){var c=this._getTopLeftPoint(n,o);return new ot(c,c.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(n){return this.options.crs.getProjectedBounds(n===void 0?this.getZoom():n)},getPane:function(n){return typeof n=="string"?this._panes[n]:n},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(n,o){var c=this.options.crs;return o=o===void 0?this._zoom:o,c.scale(n)/c.scale(o)},getScaleZoom:function(n,o){var c=this.options.crs;o=o===void 0?this._zoom:o;var h=c.zoom(n*c.scale(o));return isNaN(h)?1/0:h},project:function(n,o){return o=o===void 0?this._zoom:o,this.options.crs.latLngToPoint(q(n),o)},unproject:function(n,o){return o=o===void 0?this._zoom:o,this.options.crs.pointToLatLng(V(n),o)},layerPointToLatLng:function(n){var o=V(n).add(this.getPixelOrigin());return this.unproject(o)},latLngToLayerPoint:function(n){var o=this.project(q(n))._round();return o._subtract(this.getPixelOrigin())},wrapLatLng:function(n){return this.options.crs.wrapLatLng(q(n))},wrapLatLngBounds:function(n){return this.options.crs.wrapLatLngBounds(ht(n))},distance:function(n,o){return this.options.crs.distance(q(n),q(o))},containerPointToLayerPoint:function(n){return V(n).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(n){return V(n).add(this._getMapPanePos())},containerPointToLatLng:function(n){var o=this.containerPointToLayerPoint(V(n));return this.layerPointToLatLng(o)},latLngToContainerPoint:function(n){return this.layerPointToContainerPoint(this.latLngToLayerPoint(q(n)))},mouseEventToContainerPoint:function(n){return Bo(n,this._container)},mouseEventToLayerPoint:function(n){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(n))},mouseEventToLatLng:function(n){return this.layerPointToLatLng(this.mouseEventToLayerPoint(n))},_initContainer:function(n){var o=this._container=Oo(n);if(o){if(o._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Z(o,"scroll",this._onScroll,this),this._containerId=u(o)},_initLayout:function(){var n=this._container;this._fadeAnimated=this.options.fadeAnimation&&F.any3d,$(n,"leaflet-container"+(F.touch?" leaflet-touch":"")+(F.retina?" leaflet-retina":"")+(F.ielt9?" leaflet-oldie":"")+(F.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var o=li(n,"position");o!=="absolute"&&o!=="relative"&&o!=="fixed"&&o!=="sticky"&&(n.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var n=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ft(this._mapPane,new X(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||($(n.markerPane,"leaflet-zoom-hide"),$(n.shadowPane,"leaflet-zoom-hide"))},_resetView:function(n,o,c){ft(this._mapPane,new X(0,0));var h=!this._loaded;this._loaded=!0,o=this._limitZoom(o),this.fire("viewprereset");var d=this._zoom!==o;this._moveStart(d,c)._move(n,o)._moveEnd(d),this.fire("viewreset"),h&&this.fire("load")},_moveStart:function(n,o){return n&&this.fire("zoomstart"),o||this.fire("movestart"),this},_move:function(n,o,c,h){o===void 0&&(o=this._zoom);var d=this._zoom!==o;return this._zoom=o,this._lastCenter=n,this._pixelOrigin=this._getNewPixelOrigin(n),h?c&&c.pinch&&this.fire("zoom",c):((d||c&&c.pinch)&&this.fire("zoom",c),this.fire("move",c)),this},_moveEnd:function(n){return n&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return K(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(n){ft(this._mapPane,this._getMapPanePos().subtract(n))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(n){this._targets={},this._targets[u(this._container)]=this;var o=n?rt:Z;o(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&o(window,"resize",this._onResize,this),F.any3d&&this.options.transform3DLimit&&(n?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){K(this._resizeRequest),this._resizeRequest=U(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var n=this._getMapPanePos();Math.max(Math.abs(n.x),Math.abs(n.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(n,o){for(var c=[],h,d=o==="mouseout"||o==="mouseover",_=n.target||n.srcElement,y=!1;_;){if(h=this._targets[u(_)],h&&(o==="click"||o==="preclick")&&this._draggableMoved(h)){y=!0;break}if(h&&h.listens(o,!0)&&(d&&!Tr(_,n)||(c.push(h),d))||_===this._container)break;_=_.parentNode}return!c.length&&!y&&!d&&this.listens(o,!0)&&(c=[this]),c},_isClickDisabled:function(n){for(;n&&n!==this._container;){if(n._leaflet_disable_click)return!0;n=n.parentNode}},_handleDOMEvent:function(n){var o=n.target||n.srcElement;if(!(!this._loaded||o._leaflet_disable_events||n.type==="click"&&this._isClickDisabled(o))){var c=n.type;c==="mousedown"&&ur(o),this._fireDOMEvent(n,c)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(n,o,c){if(n.type==="click"){var h=s({},n);h.type="preclick",this._fireDOMEvent(h,h.type,c)}var d=this._findEventTargets(n,o);if(c){for(var _=[],y=0;y<c.length;y++)c[y].listens(o,!0)&&_.push(c[y]);d=_.concat(d)}if(d.length){o==="contextmenu"&&yt(n);var A=d[0],R={originalEvent:n};if(n.type!=="keypress"&&n.type!=="keydown"&&n.type!=="keyup"){var P=A.getLatLng&&(!A._radius||A._radius<=10);R.containerPoint=P?this.latLngToContainerPoint(A.getLatLng()):this.mouseEventToContainerPoint(n),R.layerPoint=this.containerPointToLayerPoint(R.containerPoint),R.latlng=P?A.getLatLng():this.layerPointToLatLng(R.layerPoint)}for(y=0;y<d.length;y++)if(d[y].fire(o,R,!0),R.originalEvent._stopped||d[y].options.bubblingMouseEvents===!1&&O(this._mouseEvents,o)!==-1)return}},_draggableMoved:function(n){return n=n.dragging&&n.dragging.enabled()?n:this,n.dragging&&n.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var n=0,o=this._handlers.length;n<o;n++)this._handlers[n].disable()},whenReady:function(n,o){return this._loaded?n.call(o||this,{target:this}):this.on("load",n,o),this},_getMapPanePos:function(){return ve(this._mapPane)||new X(0,0)},_moved:function(){var n=this._getMapPanePos();return n&&!n.equals([0,0])},_getTopLeftPoint:function(n,o){var c=n&&o!==void 0?this._getNewPixelOrigin(n,o):this.getPixelOrigin();return c.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(n,o){var c=this.getSize()._divideBy(2);return this.project(n,o)._subtract(c)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(n,o,c){var h=this._getNewPixelOrigin(c,o);return this.project(n,o)._subtract(h)},_latLngBoundsToNewLayerBounds:function(n,o,c){var h=this._getNewPixelOrigin(c,o);return wt([this.project(n.getSouthWest(),o)._subtract(h),this.project(n.getNorthWest(),o)._subtract(h),this.project(n.getSouthEast(),o)._subtract(h),this.project(n.getNorthEast(),o)._subtract(h)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(n){return this.latLngToLayerPoint(n).subtract(this._getCenterLayerPoint())},_limitCenter:function(n,o,c){if(!c)return n;var h=this.project(n,o),d=this.getSize().divideBy(2),_=new ot(h.subtract(d),h.add(d)),y=this._getBoundsOffset(_,c,o);return Math.abs(y.x)<=1&&Math.abs(y.y)<=1?n:this.unproject(h.add(y),o)},_limitOffset:function(n,o){if(!o)return n;var c=this.getPixelBounds(),h=new ot(c.min.add(n),c.max.add(n));return n.add(this._getBoundsOffset(h,o))},_getBoundsOffset:function(n,o,c){var h=wt(this.project(o.getNorthEast(),c),this.project(o.getSouthWest(),c)),d=h.min.subtract(n.min),_=h.max.subtract(n.max),y=this._rebound(d.x,-_.x),A=this._rebound(d.y,-_.y);return new X(y,A)},_rebound:function(n,o){return n+o>0?Math.round(n-o)/2:Math.max(0,Math.ceil(n))-Math.max(0,Math.floor(o))},_limitZoom:function(n){var o=this.getMinZoom(),c=this.getMaxZoom(),h=F.any3d?this.options.zoomSnap:1;return h&&(n=Math.round(n/h)*h),Math.max(o,Math.min(c,n))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){lt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(n,o){var c=this._getCenterOffset(n)._trunc();return(o&&o.animate)!==!0&&!this.getSize().contains(c)?!1:(this.panBy(c,o),!0)},_createAnimProxy:function(){var n=this._proxy=G("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(n),this.on("zoomanim",function(o){var c=sr,h=this._proxy.style[c];Te(this._proxy,this.project(o.center,o.zoom),this.getZoomScale(o.zoom,1)),h===this._proxy.style[c]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){at(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var n=this.getCenter(),o=this.getZoom();Te(this._proxy,this.project(n,o),this.getZoomScale(o,1))},_catchTransitionEnd:function(n){this._animatingZoom&&n.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(n,o,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(o-this._zoom)>this.options.zoomAnimationThreshold)return!1;var h=this.getZoomScale(o),d=this._getCenterOffset(n)._divideBy(1-1/h);return c.animate!==!0&&!this.getSize().contains(d)?!1:(U(function(){this._moveStart(!0,c.noMoveStart||!1)._animateZoom(n,o,!0)},this),!0)},_animateZoom:function(n,o,c,h){this._mapPane&&(c&&(this._animatingZoom=!0,this._animateToCenter=n,this._animateToZoom=o,$(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:n,zoom:o,noUpdate:h}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&lt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function of(n,o){return new J(n,o)}var Lt=j.extend({options:{position:"topright"},initialize:function(n){S(this,n)},getPosition:function(){return this.options.position},setPosition:function(n){var o=this._map;return o&&o.removeControl(this),this.options.position=n,o&&o.addControl(this),this},getContainer:function(){return this._container},addTo:function(n){this.remove(),this._map=n;var o=this._container=this.onAdd(n),c=this.getPosition(),h=n._controlCorners[c];return $(o,"leaflet-control"),c.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(at(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(n){this._map&&n&&n.screenX>0&&n.screenY>0&&this._map.getContainer().focus()}}),_i=function(n){return new Lt(n)};J.include({addControl:function(n){return n.addTo(this),this},removeControl:function(n){return n.remove(),this},_initControlPos:function(){var n=this._controlCorners={},o="leaflet-",c=this._controlContainer=G("div",o+"control-container",this._container);function h(d,_){var y=o+d+" "+o+_;n[d+_]=G("div",y,c)}h("top","left"),h("top","right"),h("bottom","left"),h("bottom","right")},_clearControlPos:function(){for(var n in this._controlCorners)at(this._controlCorners[n]);at(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Lo=Lt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(n,o,c,h){return c<h?-1:h<c?1:0}},initialize:function(n,o,c){S(this,c),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var h in n)this._addLayer(n[h],h);for(h in o)this._addLayer(o[h],h,!0)},onAdd:function(n){this._initLayout(),this._update(),this._map=n,n.on("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(n){return Lt.prototype.addTo.call(this,n),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var n=0;n<this._layers.length;n++)this._layers[n].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(n,o){return this._addLayer(n,o),this._map?this._update():this},addOverlay:function(n,o){return this._addLayer(n,o,!0),this._map?this._update():this},removeLayer:function(n){n.off("add remove",this._onLayerChange,this);var o=this._getLayer(u(n));return o&&this._layers.splice(this._layers.indexOf(o),1),this._map?this._update():this},expand:function(){$(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var n=this._map.getSize().y-(this._container.offsetTop+50);return n<this._section.clientHeight?($(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=n+"px"):lt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return lt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var n="leaflet-control-layers",o=this._container=G("div",n),c=this.options.collapsed;o.setAttribute("aria-haspopup",!0),di(o),mr(o);var h=this._section=G("section",n+"-list");c&&(this._map.on("click",this.collapse,this),Z(o,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var d=this._layersLink=G("a",n+"-toggle",o);d.href="#",d.title="Layers",d.setAttribute("role","button"),Z(d,{keydown:function(_){_.keyCode===13&&this._expandSafely()},click:function(_){yt(_),this._expandSafely()}},this),c||this.expand(),this._baseLayersList=G("div",n+"-base",h),this._separator=G("div",n+"-separator",h),this._overlaysList=G("div",n+"-overlays",h),o.appendChild(h)},_getLayer:function(n){for(var o=0;o<this._layers.length;o++)if(this._layers[o]&&u(this._layers[o].layer)===n)return this._layers[o]},_addLayer:function(n,o,c){this._map&&n.on("add remove",this._onLayerChange,this),this._layers.push({layer:n,name:o,overlay:c}),this.options.sortLayers&&this._layers.sort(l(function(h,d){return this.options.sortFunction(h.layer,d.layer,h.name,d.name)},this)),this.options.autoZIndex&&n.setZIndex&&(this._lastZIndex++,n.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Vi(this._baseLayersList),Vi(this._overlaysList),this._layerControlInputs=[];var n,o,c,h,d=0;for(c=0;c<this._layers.length;c++)h=this._layers[c],this._addItem(h),o=o||h.overlay,n=n||!h.overlay,d+=h.overlay?0:1;return this.options.hideSingleBase&&(n=n&&d>1,this._baseLayersList.style.display=n?"":"none"),this._separator.style.display=o&&n?"":"none",this},_onLayerChange:function(n){this._handlingClick||this._update();var o=this._getLayer(u(n.target)),c=o.overlay?n.type==="add"?"overlayadd":"overlayremove":n.type==="add"?"baselayerchange":null;c&&this._map.fire(c,o)},_createRadioElement:function(n,o){var c='<input type="radio" class="leaflet-control-layers-selector" name="'+n+'"'+(o?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=c,h.firstChild},_addItem:function(n){var o=document.createElement("label"),c=this._map.hasLayer(n.layer),h;n.overlay?(h=document.createElement("input"),h.type="checkbox",h.className="leaflet-control-layers-selector",h.defaultChecked=c):h=this._createRadioElement("leaflet-base-layers_"+u(this),c),this._layerControlInputs.push(h),h.layerId=u(n.layer),Z(h,"click",this._onInputClick,this);var d=document.createElement("span");d.innerHTML=" "+n.name;var _=document.createElement("span");o.appendChild(_),_.appendChild(h),_.appendChild(d);var y=n.overlay?this._overlaysList:this._baseLayersList;return y.appendChild(o),this._checkDisabledLayers(),o},_onInputClick:function(){if(!this._preventClick){var n=this._layerControlInputs,o,c,h=[],d=[];this._handlingClick=!0;for(var _=n.length-1;_>=0;_--)o=n[_],c=this._getLayer(o.layerId).layer,o.checked?h.push(c):o.checked||d.push(c);for(_=0;_<d.length;_++)this._map.hasLayer(d[_])&&this._map.removeLayer(d[_]);for(_=0;_<h.length;_++)this._map.hasLayer(h[_])||this._map.addLayer(h[_]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var n=this._layerControlInputs,o,c,h=this._map.getZoom(),d=n.length-1;d>=0;d--)o=n[d],c=this._getLayer(o.layerId).layer,o.disabled=c.options.minZoom!==void 0&&h<c.options.minZoom||c.options.maxZoom!==void 0&&h>c.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var n=this._section;this._preventClick=!0,Z(n,"click",yt),this.expand();var o=this;setTimeout(function(){rt(n,"click",yt),o._preventClick=!1})}}),af=function(n,o,c){return new Lo(n,o,c)},vr=Lt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(n){var o="leaflet-control-zoom",c=G("div",o+" leaflet-bar"),h=this.options;return this._zoomInButton=this._createButton(h.zoomInText,h.zoomInTitle,o+"-in",c,this._zoomIn),this._zoomOutButton=this._createButton(h.zoomOutText,h.zoomOutTitle,o+"-out",c,this._zoomOut),this._updateDisabled(),n.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(n){n.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(n){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(n.shiftKey?3:1))},_zoomOut:function(n){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(n.shiftKey?3:1))},_createButton:function(n,o,c,h,d){var _=G("a",c,h);return _.innerHTML=n,_.href="#",_.title=o,_.setAttribute("role","button"),_.setAttribute("aria-label",o),di(_),Z(_,"click",Ee),Z(_,"click",d,this),Z(_,"click",this._refocusOnMap,this),_},_updateDisabled:function(){var n=this._map,o="leaflet-disabled";lt(this._zoomInButton,o),lt(this._zoomOutButton,o),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||n._zoom===n.getMinZoom())&&($(this._zoomOutButton,o),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||n._zoom===n.getMaxZoom())&&($(this._zoomInButton,o),this._zoomInButton.setAttribute("aria-disabled","true"))}});J.mergeOptions({zoomControl:!0}),J.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new vr,this.addControl(this.zoomControl))});var cf=function(n){return new vr(n)},ko=Lt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(n){var o="leaflet-control-scale",c=G("div",o),h=this.options;return this._addScales(h,o+"-line",c),n.on(h.updateWhenIdle?"moveend":"move",this._update,this),n.whenReady(this._update,this),c},onRemove:function(n){n.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(n,o,c){n.metric&&(this._mScale=G("div",o,c)),n.imperial&&(this._iScale=G("div",o,c))},_update:function(){var n=this._map,o=n.getSize().y/2,c=n.distance(n.containerPointToLatLng([0,o]),n.containerPointToLatLng([this.options.maxWidth,o]));this._updateScales(c)},_updateScales:function(n){this.options.metric&&n&&this._updateMetric(n),this.options.imperial&&n&&this._updateImperial(n)},_updateMetric:function(n){var o=this._getRoundNum(n),c=o<1e3?o+" m":o/1e3+" km";this._updateScale(this._mScale,c,o/n)},_updateImperial:function(n){var o=n*3.2808399,c,h,d;o>5280?(c=o/5280,h=this._getRoundNum(c),this._updateScale(this._iScale,h+" mi",h/c)):(d=this._getRoundNum(o),this._updateScale(this._iScale,d+" ft",d/o))},_updateScale:function(n,o,c){n.style.width=Math.round(this.options.maxWidth*c)+"px",n.innerHTML=o},_getRoundNum:function(n){var o=Math.pow(10,(Math.floor(n)+"").length-1),c=n/o;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,o*c}}),lf=function(n){return new ko(n)},hf='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',yr=Lt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(F.inlineSvg?hf+" ":"")+"Leaflet</a>"},initialize:function(n){S(this,n),this._attributions={}},onAdd:function(n){n.attributionControl=this,this._container=G("div","leaflet-control-attribution"),di(this._container);for(var o in n._layers)n._layers[o].getAttribution&&this.addAttribution(n._layers[o].getAttribution());return this._update(),n.on("layeradd",this._addAttribution,this),this._container},onRemove:function(n){n.off("layeradd",this._addAttribution,this)},_addAttribution:function(n){n.layer.getAttribution&&(this.addAttribution(n.layer.getAttribution()),n.layer.once("remove",function(){this.removeAttribution(n.layer.getAttribution())},this))},setPrefix:function(n){return this.options.prefix=n,this._update(),this},addAttribution:function(n){return n?(this._attributions[n]||(this._attributions[n]=0),this._attributions[n]++,this._update(),this):this},removeAttribution:function(n){return n?(this._attributions[n]&&(this._attributions[n]--,this._update()),this):this},_update:function(){if(this._map){var n=[];for(var o in this._attributions)this._attributions[o]&&n.push(o);var c=[];this.options.prefix&&c.push(this.options.prefix),n.length&&c.push(n.join(", ")),this._container.innerHTML=c.join(' <span aria-hidden="true">|</span> ')}}});J.mergeOptions({attributionControl:!0}),J.addInitHook(function(){this.options.attributionControl&&new yr().addTo(this)});var ff=function(n){return new yr(n)};Lt.Layers=Lo,Lt.Zoom=vr,Lt.Scale=ko,Lt.Attribution=yr,_i.layers=af,_i.zoom=cf,_i.scale=lf,_i.attribution=ff;var Xt=j.extend({initialize:function(n){this._map=n},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xt.addTo=function(n,o){return n.addHandler(o,this),this};var uf={Events:Ct},zo=F.touch?"touchstart mousedown":"mousedown",oe=si.extend({options:{clickTolerance:3},initialize:function(n,o,c,h){S(this,h),this._element=n,this._dragStartTarget=o||n,this._preventOutline=c},enable:function(){this._enabled||(Z(this._dragStartTarget,zo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(oe._dragging===this&&this.finishDrag(!0),rt(this._dragStartTarget,zo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(n){if(this._enabled&&(this._moved=!1,!or(this._element,"leaflet-zoom-anim"))){if(n.touches&&n.touches.length!==1){oe._dragging===this&&this.finishDrag();return}if(!(oe._dragging||n.shiftKey||n.which!==1&&n.button!==1&&!n.touches)&&(oe._dragging=this,this._preventOutline&&ur(this._element),lr(),hi(),!this._moving)){this.fire("down");var o=n.touches?n.touches[0]:n,c=xo(this._element);this._startPoint=new X(o.clientX,o.clientY),this._startPos=ve(this._element),this._parentScale=dr(c);var h=n.type==="mousedown";Z(document,h?"mousemove":"touchmove",this._onMove,this),Z(document,h?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(n){if(this._enabled){if(n.touches&&n.touches.length>1){this._moved=!0;return}var o=n.touches&&n.touches.length===1?n.touches[0]:n,c=new X(o.clientX,o.clientY)._subtract(this._startPoint);!c.x&&!c.y||Math.abs(c.x)+Math.abs(c.y)<this.options.clickTolerance||(c.x/=this._parentScale.x,c.y/=this._parentScale.y,yt(n),this._moved||(this.fire("dragstart"),this._moved=!0,$(document.body,"leaflet-dragging"),this._lastTarget=n.target||n.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),$(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(c),this._moving=!0,this._lastEvent=n,this._updatePosition())}},_updatePosition:function(){var n={originalEvent:this._lastEvent};this.fire("predrag",n),ft(this._element,this._newPos),this.fire("drag",n)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(n){lt(document.body,"leaflet-dragging"),this._lastTarget&&(lt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),rt(document,"mousemove touchmove",this._onMove,this),rt(document,"mouseup touchend touchcancel",this._onUp,this),hr(),fi();var o=this._moved&&this._moving;this._moving=!1,oe._dragging=!1,o&&this.fire("dragend",{noInertia:n,distance:this._newPos.distanceTo(this._startPos)})}});function Vo(n,o,c){var h,d=[1,4,2,8],_,y,A,R,P,x,k,Y;for(_=0,x=n.length;_<x;_++)n[_]._code=Ae(n[_],o);for(A=0;A<4;A++){for(k=d[A],h=[],_=0,x=n.length,y=x-1;_<x;y=_++)R=n[_],P=n[y],R._code&k?P._code&k||(Y=Zi(P,R,k,o,c),Y._code=Ae(Y,o),h.push(Y)):(P._code&k&&(Y=Zi(P,R,k,o,c),Y._code=Ae(Y,o),h.push(Y)),h.push(R));n=h}return n}function Wo(n,o){var c,h,d,_,y,A,R,P,x;if(!n||n.length===0)throw new Error("latlngs not passed");Nt(n)||(console.warn("latlngs are not flat! Only the first ring will be used"),n=n[0]);var k=q([0,0]),Y=ht(n),bt=Y.getNorthWest().distanceTo(Y.getSouthWest())*Y.getNorthEast().distanceTo(Y.getNorthWest());bt<1700&&(k=Er(n));var vt=n.length,Dt=[];for(c=0;c<vt;c++){var Mt=q(n[c]);Dt.push(o.project(q([Mt.lat-k.lat,Mt.lng-k.lng])))}for(A=R=P=0,c=0,h=vt-1;c<vt;h=c++)d=Dt[c],_=Dt[h],y=d.y*_.x-_.y*d.x,R+=(d.x+_.x)*y,P+=(d.y+_.y)*y,A+=y*3;A===0?x=Dt[0]:x=[R/A,P/A];var Ve=o.unproject(V(x));return q([Ve.lat+k.lat,Ve.lng+k.lng])}function Er(n){for(var o=0,c=0,h=0,d=0;d<n.length;d++){var _=q(n[d]);o+=_.lat,c+=_.lng,h++}return q([o/h,c/h])}var df={__proto__:null,clipPolygon:Vo,polygonCenter:Wo,centroid:Er};function Ho(n,o){if(!o||!n.length)return n.slice();var c=o*o;return n=gf(n,c),n=pf(n,c),n}function jo(n,o,c){return Math.sqrt(pi(n,o,c,!0))}function _f(n,o,c){return pi(n,o,c)}function pf(n,o){var c=n.length,h=typeof Uint8Array<"u"?Uint8Array:Array,d=new h(c);d[0]=d[c-1]=1,Ar(n,d,o,0,c-1);var _,y=[];for(_=0;_<c;_++)d[_]&&y.push(n[_]);return y}function Ar(n,o,c,h,d){var _=0,y,A,R;for(A=h+1;A<=d-1;A++)R=pi(n[A],n[h],n[d],!0),R>_&&(y=A,_=R);_>c&&(o[y]=1,Ar(n,o,c,h,y),Ar(n,o,c,y,d))}function gf(n,o){for(var c=[n[0]],h=1,d=0,_=n.length;h<_;h++)mf(n[h],n[d])>o&&(c.push(n[h]),d=h);return d<_-1&&c.push(n[_-1]),c}var Xo;function Zo(n,o,c,h,d){var _=h?Xo:Ae(n,c),y=Ae(o,c),A,R,P;for(Xo=y;;){if(!(_|y))return[n,o];if(_&y)return!1;A=_||y,R=Zi(n,o,A,c,d),P=Ae(R,c),A===_?(n=R,_=P):(o=R,y=P)}}function Zi(n,o,c,h,d){var _=o.x-n.x,y=o.y-n.y,A=h.min,R=h.max,P,x;return c&8?(P=n.x+_*(R.y-n.y)/y,x=R.y):c&4?(P=n.x+_*(A.y-n.y)/y,x=A.y):c&2?(P=R.x,x=n.y+y*(R.x-n.x)/_):c&1&&(P=A.x,x=n.y+y*(A.x-n.x)/_),new X(P,x,d)}function Ae(n,o){var c=0;return n.x<o.min.x?c|=1:n.x>o.max.x&&(c|=2),n.y<o.min.y?c|=4:n.y>o.max.y&&(c|=8),c}function mf(n,o){var c=o.x-n.x,h=o.y-n.y;return c*c+h*h}function pi(n,o,c,h){var d=o.x,_=o.y,y=c.x-d,A=c.y-_,R=y*y+A*A,P;return R>0&&(P=((n.x-d)*y+(n.y-_)*A)/R,P>1?(d=c.x,_=c.y):P>0&&(d+=y*P,_+=A*P)),y=n.x-d,A=n.y-_,h?y*y+A*A:new X(d,_)}function Nt(n){return!M(n[0])||typeof n[0][0]!="object"&&typeof n[0][0]<"u"}function $o(n){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Nt(n)}function Yo(n,o){var c,h,d,_,y,A,R,P;if(!n||n.length===0)throw new Error("latlngs not passed");Nt(n)||(console.warn("latlngs are not flat! Only the first ring will be used"),n=n[0]);var x=q([0,0]),k=ht(n),Y=k.getNorthWest().distanceTo(k.getSouthWest())*k.getNorthEast().distanceTo(k.getNorthWest());Y<1700&&(x=Er(n));var bt=n.length,vt=[];for(c=0;c<bt;c++){var Dt=q(n[c]);vt.push(o.project(q([Dt.lat-x.lat,Dt.lng-x.lng])))}for(c=0,h=0;c<bt-1;c++)h+=vt[c].distanceTo(vt[c+1])/2;if(h===0)P=vt[0];else for(c=0,_=0;c<bt-1;c++)if(y=vt[c],A=vt[c+1],d=y.distanceTo(A),_+=d,_>h){R=(_-h)/d,P=[A.x-R*(A.x-y.x),A.y-R*(A.y-y.y)];break}var Mt=o.unproject(V(P));return q([Mt.lat+x.lat,Mt.lng+x.lng])}var Tf={__proto__:null,simplify:Ho,pointToSegmentDistance:jo,closestPointOnSegment:_f,clipSegment:Zo,_getEdgeIntersection:Zi,_getBitCode:Ae,_sqClosestPointOnSegment:pi,isFlat:Nt,_flat:$o,polylineCenter:Yo},Sr={project:function(n){return new X(n.lng,n.lat)},unproject:function(n){return new et(n.y,n.x)},bounds:new ot([-180,-90],[180,90])},Rr={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ot([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(n){var o=Math.PI/180,c=this.R,h=n.lat*o,d=this.R_MINOR/c,_=Math.sqrt(1-d*d),y=_*Math.sin(h),A=Math.tan(Math.PI/4-h/2)/Math.pow((1-y)/(1+y),_/2);return h=-c*Math.log(Math.max(A,1e-10)),new X(n.lng*o*c,h)},unproject:function(n){for(var o=180/Math.PI,c=this.R,h=this.R_MINOR/c,d=Math.sqrt(1-h*h),_=Math.exp(-n.y/c),y=Math.PI/2-2*Math.atan(_),A=0,R=.1,P;A<15&&Math.abs(R)>1e-7;A++)P=d*Math.sin(y),P=Math.pow((1-P)/(1+P),d/2),R=Math.PI/2-2*Math.atan(_*P)-y,y+=R;return new et(y*o,n.x*o/c)}},vf={__proto__:null,LonLat:Sr,Mercator:Rr,SphericalMercator:qn},yf=s({},se,{code:"EPSG:3395",projection:Rr,transformation:function(){var n=.5/(Math.PI*Rr.R);return oi(n,.5,-n,.5)}()}),Ko=s({},se,{code:"EPSG:4326",projection:Sr,transformation:oi(1/180,1,-1/180,.5)}),Ef=s({},Gt,{projection:Sr,transformation:oi(1,0,-1,0),scale:function(n){return Math.pow(2,n)},zoom:function(n){return Math.log(n)/Math.LN2},distance:function(n,o){var c=o.lng-n.lng,h=o.lat-n.lat;return Math.sqrt(c*c+h*h)},infinite:!0});Gt.Earth=se,Gt.EPSG3395=yf,Gt.EPSG3857=Qn,Gt.EPSG900913=wh,Gt.EPSG4326=Ko,Gt.Simple=Ef;var kt=si.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(n){return n.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(n){return n&&n.removeLayer(this),this},getPane:function(n){return this._map.getPane(n?this.options[n]||n:this.options.pane)},addInteractiveTarget:function(n){return this._map._targets[u(n)]=this,this},removeInteractiveTarget:function(n){return delete this._map._targets[u(n)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(n){var o=n.target;if(o.hasLayer(this)){if(this._map=o,this._zoomAnimated=o._zoomAnimated,this.getEvents){var c=this.getEvents();o.on(c,this),this.once("remove",function(){o.off(c,this)},this)}this.onAdd(o),this.fire("add"),o.fire("layeradd",{layer:this})}}});J.include({addLayer:function(n){if(!n._layerAdd)throw new Error("The provided object is not a Layer.");var o=u(n);return this._layers[o]?this:(this._layers[o]=n,n._mapToAdd=this,n.beforeAdd&&n.beforeAdd(this),this.whenReady(n._layerAdd,n),this)},removeLayer:function(n){var o=u(n);return this._layers[o]?(this._loaded&&n.onRemove(this),delete this._layers[o],this._loaded&&(this.fire("layerremove",{layer:n}),n.fire("remove")),n._map=n._mapToAdd=null,this):this},hasLayer:function(n){return u(n)in this._layers},eachLayer:function(n,o){for(var c in this._layers)n.call(o,this._layers[c]);return this},_addLayers:function(n){n=n?M(n)?n:[n]:[];for(var o=0,c=n.length;o<c;o++)this.addLayer(n[o])},_addZoomLimit:function(n){(!isNaN(n.options.maxZoom)||!isNaN(n.options.minZoom))&&(this._zoomBoundLayers[u(n)]=n,this._updateZoomLevels())},_removeZoomLimit:function(n){var o=u(n);this._zoomBoundLayers[o]&&(delete this._zoomBoundLayers[o],this._updateZoomLevels())},_updateZoomLevels:function(){var n=1/0,o=-1/0,c=this._getZoomSpan();for(var h in this._zoomBoundLayers){var d=this._zoomBoundLayers[h].options;n=d.minZoom===void 0?n:Math.min(n,d.minZoom),o=d.maxZoom===void 0?o:Math.max(o,d.maxZoom)}this._layersMaxZoom=o===-1/0?void 0:o,this._layersMinZoom=n===1/0?void 0:n,c!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Fe=kt.extend({initialize:function(n,o){S(this,o),this._layers={};var c,h;if(n)for(c=0,h=n.length;c<h;c++)this.addLayer(n[c])},addLayer:function(n){var o=this.getLayerId(n);return this._layers[o]=n,this._map&&this._map.addLayer(n),this},removeLayer:function(n){var o=n in this._layers?n:this.getLayerId(n);return this._map&&this._layers[o]&&this._map.removeLayer(this._layers[o]),delete this._layers[o],this},hasLayer:function(n){var o=typeof n=="number"?n:this.getLayerId(n);return o in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(n){var o=Array.prototype.slice.call(arguments,1),c,h;for(c in this._layers)h=this._layers[c],h[n]&&h[n].apply(h,o);return this},onAdd:function(n){this.eachLayer(n.addLayer,n)},onRemove:function(n){this.eachLayer(n.removeLayer,n)},eachLayer:function(n,o){for(var c in this._layers)n.call(o,this._layers[c]);return this},getLayer:function(n){return this._layers[n]},getLayers:function(){var n=[];return this.eachLayer(n.push,n),n},setZIndex:function(n){return this.invoke("setZIndex",n)},getLayerId:function(n){return u(n)}}),Af=function(n,o){return new Fe(n,o)},te=Fe.extend({addLayer:function(n){return this.hasLayer(n)?this:(n.addEventParent(this),Fe.prototype.addLayer.call(this,n),this.fire("layeradd",{layer:n}))},removeLayer:function(n){return this.hasLayer(n)?(n in this._layers&&(n=this._layers[n]),n.removeEventParent(this),Fe.prototype.removeLayer.call(this,n),this.fire("layerremove",{layer:n})):this},setStyle:function(n){return this.invoke("setStyle",n)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var n=new Pt;for(var o in this._layers){var c=this._layers[o];n.extend(c.getBounds?c.getBounds():c.getLatLng())}return n}}),Sf=function(n,o){return new te(n,o)},Ue=j.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(n){S(this,n)},createIcon:function(n){return this._createIcon("icon",n)},createShadow:function(n){return this._createIcon("shadow",n)},_createIcon:function(n,o){var c=this._getIconUrl(n);if(!c){if(n==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var h=this._createImg(c,o&&o.tagName==="IMG"?o:null);return this._setIconStyles(h,n),(this.options.crossOrigin||this.options.crossOrigin==="")&&(h.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),h},_setIconStyles:function(n,o){var c=this.options,h=c[o+"Size"];typeof h=="number"&&(h=[h,h]);var d=V(h),_=V(o==="shadow"&&c.shadowAnchor||c.iconAnchor||d&&d.divideBy(2,!0));n.className="leaflet-marker-"+o+" "+(c.className||""),_&&(n.style.marginLeft=-_.x+"px",n.style.marginTop=-_.y+"px"),d&&(n.style.width=d.x+"px",n.style.height=d.y+"px")},_createImg:function(n,o){return o=o||document.createElement("img"),o.src=n,o},_getIconUrl:function(n){return F.retina&&this.options[n+"RetinaUrl"]||this.options[n+"Url"]}});function Rf(n){return new Ue(n)}var gi=Ue.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(n){return typeof gi.imagePath!="string"&&(gi.imagePath=this._detectIconPath()),(this.options.imagePath||gi.imagePath)+Ue.prototype._getIconUrl.call(this,n)},_stripUrl:function(n){var o=function(c,h,d){var _=h.exec(c);return _&&_[d]};return n=o(n,/^url\((['"])?(.+)\1\)$/,2),n&&o(n,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var n=G("div","leaflet-default-icon-path",document.body),o=li(n,"background-image")||li(n,"backgroundImage");if(document.body.removeChild(n),o=this._stripUrl(o),o)return o;var c=document.querySelector('link[href$="leaflet.css"]');return c?c.href.substring(0,c.href.length-11-1):""}}),qo=Xt.extend({initialize:function(n){this._marker=n},addHooks:function(){var n=this._marker._icon;this._draggable||(this._draggable=new oe(n,n,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),$(n,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&lt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(n){var o=this._marker,c=o._map,h=this._marker.options.autoPanSpeed,d=this._marker.options.autoPanPadding,_=ve(o._icon),y=c.getPixelBounds(),A=c.getPixelOrigin(),R=wt(y.min._subtract(A).add(d),y.max._subtract(A).subtract(d));if(!R.contains(_)){var P=V((Math.max(R.max.x,_.x)-R.max.x)/(y.max.x-R.max.x)-(Math.min(R.min.x,_.x)-R.min.x)/(y.min.x-R.min.x),(Math.max(R.max.y,_.y)-R.max.y)/(y.max.y-R.max.y)-(Math.min(R.min.y,_.y)-R.min.y)/(y.min.y-R.min.y)).multiplyBy(h);c.panBy(P,{animate:!1}),this._draggable._newPos._add(P),this._draggable._startPos._add(P),ft(o._icon,this._draggable._newPos),this._onDrag(n),this._panRequest=U(this._adjustPan.bind(this,n))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(n){this._marker.options.autoPan&&(K(this._panRequest),this._panRequest=U(this._adjustPan.bind(this,n)))},_onDrag:function(n){var o=this._marker,c=o._shadow,h=ve(o._icon),d=o._map.layerPointToLatLng(h);c&&ft(c,h),o._latlng=d,n.latlng=d,n.oldLatLng=this._oldLatLng,o.fire("move",n).fire("drag",n)},_onDragEnd:function(n){K(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",n)}}),$i=kt.extend({options:{icon:new gi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(n,o){S(this,o),this._latlng=q(n)},onAdd:function(n){this._zoomAnimated=this._zoomAnimated&&n.options.markerZoomAnimation,this._zoomAnimated&&n.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(n){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&n.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(n){var o=this._latlng;return this._latlng=q(n),this.update(),this.fire("move",{oldLatLng:o,latlng:this._latlng})},setZIndexOffset:function(n){return this.options.zIndexOffset=n,this.update()},getIcon:function(){return this.options.icon},setIcon:function(n){return this.options.icon=n,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var n=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(n)}return this},_initIcon:function(){var n=this.options,o="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),c=n.icon.createIcon(this._icon),h=!1;c!==this._icon&&(this._icon&&this._removeIcon(),h=!0,n.title&&(c.title=n.title),c.tagName==="IMG"&&(c.alt=n.alt||"")),$(c,o),n.keyboard&&(c.tabIndex="0",c.setAttribute("role","button")),this._icon=c,n.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Z(c,"focus",this._panOnFocus,this);var d=n.icon.createShadow(this._shadow),_=!1;d!==this._shadow&&(this._removeShadow(),_=!0),d&&($(d,o),d.alt=""),this._shadow=d,n.opacity<1&&this._updateOpacity(),h&&this.getPane().appendChild(this._icon),this._initInteraction(),d&&_&&this.getPane(n.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&rt(this._icon,"focus",this._panOnFocus,this),at(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&at(this._shadow),this._shadow=null},_setPos:function(n){this._icon&&ft(this._icon,n),this._shadow&&ft(this._shadow,n),this._zIndex=n.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(n){this._icon&&(this._icon.style.zIndex=this._zIndex+n)},_animateZoom:function(n){var o=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center).round();this._setPos(o)},_initInteraction:function(){if(this.options.interactive&&($(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),qo)){var n=this.options.draggable;this.dragging&&(n=this.dragging.enabled(),this.dragging.disable()),this.dragging=new qo(this),n&&this.dragging.enable()}},setOpacity:function(n){return this.options.opacity=n,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var n=this.options.opacity;this._icon&&xt(this._icon,n),this._shadow&&xt(this._shadow,n)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var n=this._map;if(n){var o=this.options.icon.options,c=o.iconSize?V(o.iconSize):V(0,0),h=o.iconAnchor?V(o.iconAnchor):V(0,0);n.panInside(this._latlng,{paddingTopLeft:h,paddingBottomRight:c.subtract(h)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function bf(n,o){return new $i(n,o)}var ae=kt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(n){this._renderer=n.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(n){return S(this,n),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&n&&Object.prototype.hasOwnProperty.call(n,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Yi=ae.extend({options:{fill:!0,radius:10},initialize:function(n,o){S(this,o),this._latlng=q(n),this._radius=this.options.radius},setLatLng:function(n){var o=this._latlng;return this._latlng=q(n),this.redraw(),this.fire("move",{oldLatLng:o,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(n){return this.options.radius=this._radius=n,this.redraw()},getRadius:function(){return this._radius},setStyle:function(n){var o=n&&n.radius||this._radius;return ae.prototype.setStyle.call(this,n),this.setRadius(o),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var n=this._radius,o=this._radiusY||n,c=this._clickTolerance(),h=[n+c,o+c];this._pxBounds=new ot(this._point.subtract(h),this._point.add(h))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(n){return n.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function wf(n,o){return new Yi(n,o)}var br=Yi.extend({initialize:function(n,o,c){if(typeof o=="number"&&(o=s({},c,{radius:o})),S(this,o),this._latlng=q(n),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(n){return this._mRadius=n,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var n=[this._radius,this._radiusY||this._radius];return new Pt(this._map.layerPointToLatLng(this._point.subtract(n)),this._map.layerPointToLatLng(this._point.add(n)))},setStyle:ae.prototype.setStyle,_project:function(){var n=this._latlng.lng,o=this._latlng.lat,c=this._map,h=c.options.crs;if(h.distance===se.distance){var d=Math.PI/180,_=this._mRadius/se.R/d,y=c.project([o+_,n]),A=c.project([o-_,n]),R=y.add(A).divideBy(2),P=c.unproject(R).lat,x=Math.acos((Math.cos(_*d)-Math.sin(o*d)*Math.sin(P*d))/(Math.cos(o*d)*Math.cos(P*d)))/d;(isNaN(x)||x===0)&&(x=_/Math.cos(Math.PI/180*o)),this._point=R.subtract(c.getPixelOrigin()),this._radius=isNaN(x)?0:R.x-c.project([P,n-x]).x,this._radiusY=R.y-y.y}else{var k=h.unproject(h.project(this._latlng).subtract([this._mRadius,0]));this._point=c.latLngToLayerPoint(this._latlng),this._radius=this._point.x-c.latLngToLayerPoint(k).x}this._updateBounds()}});function Pf(n,o,c){return new br(n,o,c)}var ee=ae.extend({options:{smoothFactor:1,noClip:!1},initialize:function(n,o){S(this,o),this._setLatLngs(n)},getLatLngs:function(){return this._latlngs},setLatLngs:function(n){return this._setLatLngs(n),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(n){for(var o=1/0,c=null,h=pi,d,_,y=0,A=this._parts.length;y<A;y++)for(var R=this._parts[y],P=1,x=R.length;P<x;P++){d=R[P-1],_=R[P];var k=h(n,d,_,!0);k<o&&(o=k,c=h(n,d,_))}return c&&(c.distance=Math.sqrt(o)),c},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Yo(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(n,o){return o=o||this._defaultShape(),n=q(n),o.push(n),this._bounds.extend(n),this.redraw()},_setLatLngs:function(n){this._bounds=new Pt,this._latlngs=this._convertLatLngs(n)},_defaultShape:function(){return Nt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(n){for(var o=[],c=Nt(n),h=0,d=n.length;h<d;h++)c?(o[h]=q(n[h]),this._bounds.extend(o[h])):o[h]=this._convertLatLngs(n[h]);return o},_project:function(){var n=new ot;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,n),this._bounds.isValid()&&n.isValid()&&(this._rawPxBounds=n,this._updateBounds())},_updateBounds:function(){var n=this._clickTolerance(),o=new X(n,n);this._rawPxBounds&&(this._pxBounds=new ot([this._rawPxBounds.min.subtract(o),this._rawPxBounds.max.add(o)]))},_projectLatlngs:function(n,o,c){var h=n[0]instanceof et,d=n.length,_,y;if(h){for(y=[],_=0;_<d;_++)y[_]=this._map.latLngToLayerPoint(n[_]),c.extend(y[_]);o.push(y)}else for(_=0;_<d;_++)this._projectLatlngs(n[_],o,c)},_clipPoints:function(){var n=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(n))){if(this.options.noClip){this._parts=this._rings;return}var o=this._parts,c,h,d,_,y,A,R;for(c=0,d=0,_=this._rings.length;c<_;c++)for(R=this._rings[c],h=0,y=R.length;h<y-1;h++)A=Zo(R[h],R[h+1],n,h,!0),A&&(o[d]=o[d]||[],o[d].push(A[0]),(A[1]!==R[h+1]||h===y-2)&&(o[d].push(A[1]),d++))}},_simplifyPoints:function(){for(var n=this._parts,o=this.options.smoothFactor,c=0,h=n.length;c<h;c++)n[c]=Ho(n[c],o)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(n,o){var c,h,d,_,y,A,R=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(n))return!1;for(c=0,_=this._parts.length;c<_;c++)for(A=this._parts[c],h=0,y=A.length,d=y-1;h<y;d=h++)if(!(!o&&h===0)&&jo(n,A[d],A[h])<=R)return!0;return!1}});function Mf(n,o){return new ee(n,o)}ee._flat=$o;var Le=ee.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Wo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(n){var o=ee.prototype._convertLatLngs.call(this,n),c=o.length;return c>=2&&o[0]instanceof et&&o[0].equals(o[c-1])&&o.pop(),o},_setLatLngs:function(n){ee.prototype._setLatLngs.call(this,n),Nt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Nt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var n=this._renderer._bounds,o=this.options.weight,c=new X(o,o);if(n=new ot(n.min.subtract(c),n.max.add(c)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(n))){if(this.options.noClip){this._parts=this._rings;return}for(var h=0,d=this._rings.length,_;h<d;h++)_=Vo(this._rings[h],n,!0),_.length&&this._parts.push(_)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(n){var o=!1,c,h,d,_,y,A,R,P;if(!this._pxBounds||!this._pxBounds.contains(n))return!1;for(_=0,R=this._parts.length;_<R;_++)for(c=this._parts[_],y=0,P=c.length,A=P-1;y<P;A=y++)h=c[y],d=c[A],h.y>n.y!=d.y>n.y&&n.x<(d.x-h.x)*(n.y-h.y)/(d.y-h.y)+h.x&&(o=!o);return o||ee.prototype._containsPoint.call(this,n,!0)}});function Cf(n,o){return new Le(n,o)}var ie=te.extend({initialize:function(n,o){S(this,o),this._layers={},n&&this.addData(n)},addData:function(n){var o=M(n)?n:n.features,c,h,d;if(o){for(c=0,h=o.length;c<h;c++)d=o[c],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(d);return this}var _=this.options;if(_.filter&&!_.filter(n))return this;var y=Ki(n,_);return y?(y.feature=Qi(n),y.defaultOptions=y.options,this.resetStyle(y),_.onEachFeature&&_.onEachFeature(n,y),this.addLayer(y)):this},resetStyle:function(n){return n===void 0?this.eachLayer(this.resetStyle,this):(n.options=s({},n.defaultOptions),this._setLayerStyle(n,this.options.style),this)},setStyle:function(n){return this.eachLayer(function(o){this._setLayerStyle(o,n)},this)},_setLayerStyle:function(n,o){n.setStyle&&(typeof o=="function"&&(o=o(n.feature)),n.setStyle(o))}});function Ki(n,o){var c=n.type==="Feature"?n.geometry:n,h=c?c.coordinates:null,d=[],_=o&&o.pointToLayer,y=o&&o.coordsToLatLng||wr,A,R,P,x;if(!h&&!c)return null;switch(c.type){case"Point":return A=y(h),Jo(_,n,A,o);case"MultiPoint":for(P=0,x=h.length;P<x;P++)A=y(h[P]),d.push(Jo(_,n,A,o));return new te(d);case"LineString":case"MultiLineString":return R=qi(h,c.type==="LineString"?0:1,y),new ee(R,o);case"Polygon":case"MultiPolygon":return R=qi(h,c.type==="Polygon"?1:2,y),new Le(R,o);case"GeometryCollection":for(P=0,x=c.geometries.length;P<x;P++){var k=Ki({geometry:c.geometries[P],type:"Feature",properties:n.properties},o);k&&d.push(k)}return new te(d);case"FeatureCollection":for(P=0,x=c.features.length;P<x;P++){var Y=Ki(c.features[P],o);Y&&d.push(Y)}return new te(d);default:throw new Error("Invalid GeoJSON object.")}}function Jo(n,o,c,h){return n?n(o,c):new $i(c,h&&h.markersInheritOptions&&h)}function wr(n){return new et(n[1],n[0],n[2])}function qi(n,o,c){for(var h=[],d=0,_=n.length,y;d<_;d++)y=o?qi(n[d],o-1,c):(c||wr)(n[d]),h.push(y);return h}function Pr(n,o){return n=q(n),n.alt!==void 0?[v(n.lng,o),v(n.lat,o),v(n.alt,o)]:[v(n.lng,o),v(n.lat,o)]}function Ji(n,o,c,h){for(var d=[],_=0,y=n.length;_<y;_++)d.push(o?Ji(n[_],Nt(n[_])?0:o-1,c,h):Pr(n[_],h));return!o&&c&&d.length>0&&d.push(d[0].slice()),d}function ke(n,o){return n.feature?s({},n.feature,{geometry:o}):Qi(o)}function Qi(n){return n.type==="Feature"||n.type==="FeatureCollection"?n:{type:"Feature",properties:{},geometry:n}}var Mr={toGeoJSON:function(n){return ke(this,{type:"Point",coordinates:Pr(this.getLatLng(),n)})}};$i.include(Mr),br.include(Mr),Yi.include(Mr),ee.include({toGeoJSON:function(n){var o=!Nt(this._latlngs),c=Ji(this._latlngs,o?1:0,!1,n);return ke(this,{type:(o?"Multi":"")+"LineString",coordinates:c})}}),Le.include({toGeoJSON:function(n){var o=!Nt(this._latlngs),c=o&&!Nt(this._latlngs[0]),h=Ji(this._latlngs,c?2:o?1:0,!0,n);return o||(h=[h]),ke(this,{type:(c?"Multi":"")+"Polygon",coordinates:h})}}),Fe.include({toMultiPoint:function(n){var o=[];return this.eachLayer(function(c){o.push(c.toGeoJSON(n).geometry.coordinates)}),ke(this,{type:"MultiPoint",coordinates:o})},toGeoJSON:function(n){var o=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(o==="MultiPoint")return this.toMultiPoint(n);var c=o==="GeometryCollection",h=[];return this.eachLayer(function(d){if(d.toGeoJSON){var _=d.toGeoJSON(n);if(c)h.push(_.geometry);else{var y=Qi(_);y.type==="FeatureCollection"?h.push.apply(h,y.features):h.push(y)}}}),c?ke(this,{geometries:h,type:"GeometryCollection"}):{type:"FeatureCollection",features:h}}});function Qo(n,o){return new ie(n,o)}var If=Qo,Gi=kt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(n,o,c){this._url=n,this._bounds=ht(o),S(this,c)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&($(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){at(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(n){return this.options.opacity=n,this._image&&this._updateOpacity(),this},setStyle:function(n){return n.opacity&&this.setOpacity(n.opacity),this},bringToFront:function(){return this._map&&De(this._image),this},bringToBack:function(){return this._map&&Be(this._image),this},setUrl:function(n){return this._url=n,this._image&&(this._image.src=n),this},setBounds:function(n){return this._bounds=ht(n),this._map&&this._reset(),this},getEvents:function(){var n={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},setZIndex:function(n){return this.options.zIndex=n,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var n=this._url.tagName==="IMG",o=this._image=n?this._url:G("img");if($(o,"leaflet-image-layer"),this._zoomAnimated&&$(o,"leaflet-zoom-animated"),this.options.className&&$(o,this.options.className),o.onselectstart=T,o.onmousemove=T,o.onload=l(this.fire,this,"load"),o.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(o.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),n){this._url=o.src;return}o.src=this._url,o.alt=this.options.alt},_animateZoom:function(n){var o=this._map.getZoomScale(n.zoom),c=this._map._latLngBoundsToNewLayerBounds(this._bounds,n.zoom,n.center).min;Te(this._image,c,o)},_reset:function(){var n=this._image,o=new ot(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),c=o.getSize();ft(n,o.min),n.style.width=c.x+"px",n.style.height=c.y+"px"},_updateOpacity:function(){xt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var n=this.options.errorOverlayUrl;n&&this._url!==n&&(this._url=n,this._image.src=n)},getCenter:function(){return this._bounds.getCenter()}}),Of=function(n,o,c){return new Gi(n,o,c)},Go=Gi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var n=this._url.tagName==="VIDEO",o=this._image=n?this._url:G("video");if($(o,"leaflet-image-layer"),this._zoomAnimated&&$(o,"leaflet-zoom-animated"),this.options.className&&$(o,this.options.className),o.onselectstart=T,o.onmousemove=T,o.onloadeddata=l(this.fire,this,"load"),n){for(var c=o.getElementsByTagName("source"),h=[],d=0;d<c.length;d++)h.push(c[d].src);this._url=c.length>0?h:[o.src];return}M(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(o.style,"objectFit")&&(o.style.objectFit="fill"),o.autoplay=!!this.options.autoplay,o.loop=!!this.options.loop,o.muted=!!this.options.muted,o.playsInline=!!this.options.playsInline;for(var _=0;_<this._url.length;_++){var y=G("source");y.src=this._url[_],o.appendChild(y)}}});function xf(n,o,c){return new Go(n,o,c)}var ta=Gi.extend({_initImage:function(){var n=this._image=this._url;$(n,"leaflet-image-layer"),this._zoomAnimated&&$(n,"leaflet-zoom-animated"),this.options.className&&$(n,this.options.className),n.onselectstart=T,n.onmousemove=T}});function Nf(n,o,c){return new ta(n,o,c)}var Zt=kt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(n,o){n&&(n instanceof et||M(n))?(this._latlng=q(n),S(this,o)):(S(this,n),this._source=o),this.options.content&&(this._content=this.options.content)},openOn:function(n){return n=arguments.length?n:this._source._map,n.hasLayer(this)||n.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(n){return this._map?this.close():(arguments.length?this._source=n:n=this._source,this._prepareOpen(),this.openOn(n._map)),this},onAdd:function(n){this._zoomAnimated=n._zoomAnimated,this._container||this._initLayout(),n._fadeAnimated&&xt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),n._fadeAnimated&&xt(this._container,1),this.bringToFront(),this.options.interactive&&($(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(n){n._fadeAnimated?(xt(this._container,0),this._removeTimeout=setTimeout(l(at,void 0,this._container),200)):at(this._container),this.options.interactive&&(lt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(n){return this._latlng=q(n),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(n){return this._content=n,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var n={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&De(this._container),this},bringToBack:function(){return this._map&&Be(this._container),this},_prepareOpen:function(n){var o=this._source;if(!o._map)return!1;if(o instanceof te){o=null;var c=this._source._layers;for(var h in c)if(c[h]._map){o=c[h];break}if(!o)return!1;this._source=o}if(!n)if(o.getCenter)n=o.getCenter();else if(o.getLatLng)n=o.getLatLng();else if(o.getBounds)n=o.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(n),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var n=this._contentNode,o=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof o=="string")n.innerHTML=o;else{for(;n.hasChildNodes();)n.removeChild(n.firstChild);n.appendChild(o)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var n=this._map.latLngToLayerPoint(this._latlng),o=V(this.options.offset),c=this._getAnchor();this._zoomAnimated?ft(this._container,n.add(c)):o=o.add(n).add(c);var h=this._containerBottom=-o.y,d=this._containerLeft=-Math.round(this._containerWidth/2)+o.x;this._container.style.bottom=h+"px",this._container.style.left=d+"px"}},_getAnchor:function(){return[0,0]}});J.include({_initOverlay:function(n,o,c,h){var d=o;return d instanceof n||(d=new n(h).setContent(o)),c&&d.setLatLng(c),d}}),kt.include({_initOverlay:function(n,o,c,h){var d=c;return d instanceof n?(S(d,h),d._source=this):(d=o&&!h?o:new n(h,this),d.setContent(c)),d}});var tn=Zt.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(n){return n=arguments.length?n:this._source._map,!n.hasLayer(this)&&n._popup&&n._popup.options.autoClose&&n.removeLayer(n._popup),n._popup=this,Zt.prototype.openOn.call(this,n)},onAdd:function(n){Zt.prototype.onAdd.call(this,n),n.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ae||this._source.on("preclick",ye))},onRemove:function(n){Zt.prototype.onRemove.call(this,n),n.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ae||this._source.off("preclick",ye))},getEvents:function(){var n=Zt.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(n.preclick=this.close),this.options.keepInView&&(n.moveend=this._adjustPan),n},_initLayout:function(){var n="leaflet-popup",o=this._container=G("div",n+" "+(this.options.className||"")+" leaflet-zoom-animated"),c=this._wrapper=G("div",n+"-content-wrapper",o);if(this._contentNode=G("div",n+"-content",c),di(o),mr(this._contentNode),Z(o,"contextmenu",ye),this._tipContainer=G("div",n+"-tip-container",o),this._tip=G("div",n+"-tip",this._tipContainer),this.options.closeButton){var h=this._closeButton=G("a",n+"-close-button",o);h.setAttribute("role","button"),h.setAttribute("aria-label","Close popup"),h.href="#close",h.innerHTML='<span aria-hidden="true">&#215;</span>',Z(h,"click",function(d){yt(d),this.close()},this)}},_updateLayout:function(){var n=this._contentNode,o=n.style;o.width="",o.whiteSpace="nowrap";var c=n.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),o.width=c+1+"px",o.whiteSpace="",o.height="";var h=n.offsetHeight,d=this.options.maxHeight,_="leaflet-popup-scrolled";d&&h>d?(o.height=d+"px",$(n,_)):lt(n,_),this._containerWidth=this._container.offsetWidth},_animateZoom:function(n){var o=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center),c=this._getAnchor();ft(this._container,o.add(c))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var n=this._map,o=parseInt(li(this._container,"marginBottom"),10)||0,c=this._container.offsetHeight+o,h=this._containerWidth,d=new X(this._containerLeft,-c-this._containerBottom);d._add(ve(this._container));var _=n.layerPointToContainerPoint(d),y=V(this.options.autoPanPadding),A=V(this.options.autoPanPaddingTopLeft||y),R=V(this.options.autoPanPaddingBottomRight||y),P=n.getSize(),x=0,k=0;_.x+h+R.x>P.x&&(x=_.x+h-P.x+R.x),_.x-x-A.x<0&&(x=_.x-A.x),_.y+c+R.y>P.y&&(k=_.y+c-P.y+R.y),_.y-k-A.y<0&&(k=_.y-A.y),(x||k)&&(this.options.keepInView&&(this._autopanning=!0),n.fire("autopanstart").panBy([x,k]))}},_getAnchor:function(){return V(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Df=function(n,o){return new tn(n,o)};J.mergeOptions({closePopupOnClick:!0}),J.include({openPopup:function(n,o,c){return this._initOverlay(tn,n,o,c).openOn(this),this},closePopup:function(n){return n=arguments.length?n:this._popup,n&&n.close(),this}}),kt.include({bindPopup:function(n,o){return this._popup=this._initOverlay(tn,this._popup,n,o),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(n){return this._popup&&(this instanceof te||(this._popup._source=this),this._popup._prepareOpen(n||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(n){return this._popup&&this._popup.setContent(n),this},getPopup:function(){return this._popup},_openPopup:function(n){if(!(!this._popup||!this._map)){Ee(n);var o=n.layer||n.target;if(this._popup._source===o&&!(o instanceof ae)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(n.latlng);return}this._popup._source=o,this.openPopup(n.latlng)}},_movePopup:function(n){this._popup.setLatLng(n.latlng)},_onKeyPress:function(n){n.originalEvent.keyCode===13&&this._openPopup(n)}});var en=Zt.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(n){Zt.prototype.onAdd.call(this,n),this.setOpacity(this.options.opacity),n.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(n){Zt.prototype.onRemove.call(this,n),n.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var n=Zt.prototype.getEvents.call(this);return this.options.permanent||(n.preclick=this.close),n},_initLayout:function(){var n="leaflet-tooltip",o=n+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=G("div",o),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(n){var o,c,h=this._map,d=this._container,_=h.latLngToContainerPoint(h.getCenter()),y=h.layerPointToContainerPoint(n),A=this.options.direction,R=d.offsetWidth,P=d.offsetHeight,x=V(this.options.offset),k=this._getAnchor();A==="top"?(o=R/2,c=P):A==="bottom"?(o=R/2,c=0):A==="center"?(o=R/2,c=P/2):A==="right"?(o=0,c=P/2):A==="left"?(o=R,c=P/2):y.x<_.x?(A="right",o=0,c=P/2):(A="left",o=R+(x.x+k.x)*2,c=P/2),n=n.subtract(V(o,c,!0)).add(x).add(k),lt(d,"leaflet-tooltip-right"),lt(d,"leaflet-tooltip-left"),lt(d,"leaflet-tooltip-top"),lt(d,"leaflet-tooltip-bottom"),$(d,"leaflet-tooltip-"+A),ft(d,n)},_updatePosition:function(){var n=this._map.latLngToLayerPoint(this._latlng);this._setPosition(n)},setOpacity:function(n){this.options.opacity=n,this._container&&xt(this._container,n)},_animateZoom:function(n){var o=this._map._latLngToNewLayerPoint(this._latlng,n.zoom,n.center);this._setPosition(o)},_getAnchor:function(){return V(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Bf=function(n,o){return new en(n,o)};J.include({openTooltip:function(n,o,c){return this._initOverlay(en,n,o,c).openOn(this),this},closeTooltip:function(n){return n.close(),this}}),kt.include({bindTooltip:function(n,o){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(en,this._tooltip,n,o),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(n){if(!(!n&&this._tooltipHandlersAdded)){var o=n?"off":"on",c={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?c.add=this._openTooltip:(c.mouseover=this._openTooltip,c.mouseout=this.closeTooltip,c.click=this._openTooltip,this._map?this._addFocusListeners():c.add=this._addFocusListeners),this._tooltip.options.sticky&&(c.mousemove=this._moveTooltip),this[o](c),this._tooltipHandlersAdded=!n}},openTooltip:function(n){return this._tooltip&&(this instanceof te||(this._tooltip._source=this),this._tooltip._prepareOpen(n)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(n){return this._tooltip&&this._tooltip.setContent(n),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(n){var o=typeof n.getElement=="function"&&n.getElement();o&&(Z(o,"focus",function(){this._tooltip._source=n,this.openTooltip()},this),Z(o,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(n){var o=typeof n.getElement=="function"&&n.getElement();o&&o.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(n){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var o=this;this._map.once("moveend",function(){o._openOnceFlag=!1,o._openTooltip(n)});return}this._tooltip._source=n.layer||n.target,this.openTooltip(this._tooltip.options.sticky?n.latlng:void 0)}},_moveTooltip:function(n){var o=n.latlng,c,h;this._tooltip.options.sticky&&n.originalEvent&&(c=this._map.mouseEventToContainerPoint(n.originalEvent),h=this._map.containerPointToLayerPoint(c),o=this._map.layerPointToLatLng(h)),this._tooltip.setLatLng(o)}});var ea=Ue.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(n){var o=n&&n.tagName==="DIV"?n:document.createElement("div"),c=this.options;if(c.html instanceof Element?(Vi(o),o.appendChild(c.html)):o.innerHTML=c.html!==!1?c.html:"",c.bgPos){var h=V(c.bgPos);o.style.backgroundPosition=-h.x+"px "+-h.y+"px"}return this._setIconStyles(o,"icon"),o},createShadow:function(){return null}});function Ff(n){return new ea(n)}Ue.Default=gi;var mi=kt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:F.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(n){S(this,n)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(n){n._addZoomLimit(this)},onRemove:function(n){this._removeAllTiles(),at(this._container),n._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(De(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Be(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(n){return this.options.opacity=n,this._updateOpacity(),this},setZIndex:function(n){return this.options.zIndex=n,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var n=this._clampZoom(this._map.getZoom());n!==this._tileZoom&&(this._tileZoom=n,this._updateLevels()),this._update()}return this},getEvents:function(){var n={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p(this._onMoveEnd,this.options.updateInterval,this)),n.move=this._onMove),this._zoomAnimated&&(n.zoomanim=this._animateZoom),n},createTile:function(){return document.createElement("div")},getTileSize:function(){var n=this.options.tileSize;return n instanceof X?n:new X(n,n)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(n){for(var o=this.getPane().children,c=-n(-1/0,1/0),h=0,d=o.length,_;h<d;h++)_=o[h].style.zIndex,o[h]!==this._container&&_&&(c=n(c,+_));isFinite(c)&&(this.options.zIndex=c+n(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!F.ielt9){xt(this._container,this.options.opacity);var n=+new Date,o=!1,c=!1;for(var h in this._tiles){var d=this._tiles[h];if(!(!d.current||!d.loaded)){var _=Math.min(1,(n-d.loaded)/200);xt(d.el,_),_<1?o=!0:(d.active?c=!0:this._onOpaqueTile(d),d.active=!0)}}c&&!this._noPrune&&this._pruneTiles(),o&&(K(this._fadeFrame),this._fadeFrame=U(this._updateOpacity,this))}},_onOpaqueTile:T,_initContainer:function(){this._container||(this._container=G("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var n=this._tileZoom,o=this.options.maxZoom;if(n!==void 0){for(var c in this._levels)c=Number(c),this._levels[c].el.children.length||c===n?(this._levels[c].el.style.zIndex=o-Math.abs(n-c),this._onUpdateLevel(c)):(at(this._levels[c].el),this._removeTilesAtZoom(c),this._onRemoveLevel(c),delete this._levels[c]);var h=this._levels[n],d=this._map;return h||(h=this._levels[n]={},h.el=G("div","leaflet-tile-container leaflet-zoom-animated",this._container),h.el.style.zIndex=o,h.origin=d.project(d.unproject(d.getPixelOrigin()),n).round(),h.zoom=n,this._setZoomTransform(h,d.getCenter(),d.getZoom()),T(h.el.offsetWidth),this._onCreateLevel(h)),this._level=h,h}},_onUpdateLevel:T,_onRemoveLevel:T,_onCreateLevel:T,_pruneTiles:function(){if(this._map){var n,o,c=this._map.getZoom();if(c>this.options.maxZoom||c<this.options.minZoom){this._removeAllTiles();return}for(n in this._tiles)o=this._tiles[n],o.retain=o.current;for(n in this._tiles)if(o=this._tiles[n],o.current&&!o.active){var h=o.coords;this._retainParent(h.x,h.y,h.z,h.z-5)||this._retainChildren(h.x,h.y,h.z,h.z+2)}for(n in this._tiles)this._tiles[n].retain||this._removeTile(n)}},_removeTilesAtZoom:function(n){for(var o in this._tiles)this._tiles[o].coords.z===n&&this._removeTile(o)},_removeAllTiles:function(){for(var n in this._tiles)this._removeTile(n)},_invalidateAll:function(){for(var n in this._levels)at(this._levels[n].el),this._onRemoveLevel(Number(n)),delete this._levels[n];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(n,o,c,h){var d=Math.floor(n/2),_=Math.floor(o/2),y=c-1,A=new X(+d,+_);A.z=+y;var R=this._tileCoordsToKey(A),P=this._tiles[R];return P&&P.active?(P.retain=!0,!0):(P&&P.loaded&&(P.retain=!0),y>h?this._retainParent(d,_,y,h):!1)},_retainChildren:function(n,o,c,h){for(var d=2*n;d<2*n+2;d++)for(var _=2*o;_<2*o+2;_++){var y=new X(d,_);y.z=c+1;var A=this._tileCoordsToKey(y),R=this._tiles[A];if(R&&R.active){R.retain=!0;continue}else R&&R.loaded&&(R.retain=!0);c+1<h&&this._retainChildren(d,_,c+1,h)}},_resetView:function(n){var o=n&&(n.pinch||n.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),o,o)},_animateZoom:function(n){this._setView(n.center,n.zoom,!0,n.noUpdate)},_clampZoom:function(n){var o=this.options;return o.minNativeZoom!==void 0&&n<o.minNativeZoom?o.minNativeZoom:o.maxNativeZoom!==void 0&&o.maxNativeZoom<n?o.maxNativeZoom:n},_setView:function(n,o,c,h){var d=Math.round(o);this.options.maxZoom!==void 0&&d>this.options.maxZoom||this.options.minZoom!==void 0&&d<this.options.minZoom?d=void 0:d=this._clampZoom(d);var _=this.options.updateWhenZooming&&d!==this._tileZoom;(!h||_)&&(this._tileZoom=d,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),d!==void 0&&this._update(n),c||this._pruneTiles(),this._noPrune=!!c),this._setZoomTransforms(n,o)},_setZoomTransforms:function(n,o){for(var c in this._levels)this._setZoomTransform(this._levels[c],n,o)},_setZoomTransform:function(n,o,c){var h=this._map.getZoomScale(c,n.zoom),d=n.origin.multiplyBy(h).subtract(this._map._getNewPixelOrigin(o,c)).round();F.any3d?Te(n.el,d,h):ft(n.el,d)},_resetGrid:function(){var n=this._map,o=n.options.crs,c=this._tileSize=this.getTileSize(),h=this._tileZoom,d=this._map.getPixelWorldBounds(this._tileZoom);d&&(this._globalTileRange=this._pxBoundsToTileRange(d)),this._wrapX=o.wrapLng&&!this.options.noWrap&&[Math.floor(n.project([0,o.wrapLng[0]],h).x/c.x),Math.ceil(n.project([0,o.wrapLng[1]],h).x/c.y)],this._wrapY=o.wrapLat&&!this.options.noWrap&&[Math.floor(n.project([o.wrapLat[0],0],h).y/c.x),Math.ceil(n.project([o.wrapLat[1],0],h).y/c.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(n){var o=this._map,c=o._animatingZoom?Math.max(o._animateToZoom,o.getZoom()):o.getZoom(),h=o.getZoomScale(c,this._tileZoom),d=o.project(n,this._tileZoom).floor(),_=o.getSize().divideBy(h*2);return new ot(d.subtract(_),d.add(_))},_update:function(n){var o=this._map;if(o){var c=this._clampZoom(o.getZoom());if(n===void 0&&(n=o.getCenter()),this._tileZoom!==void 0){var h=this._getTiledPixelBounds(n),d=this._pxBoundsToTileRange(h),_=d.getCenter(),y=[],A=this.options.keepBuffer,R=new ot(d.getBottomLeft().subtract([A,-A]),d.getTopRight().add([A,-A]));if(!(isFinite(d.min.x)&&isFinite(d.min.y)&&isFinite(d.max.x)&&isFinite(d.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var P in this._tiles){var x=this._tiles[P].coords;(x.z!==this._tileZoom||!R.contains(new X(x.x,x.y)))&&(this._tiles[P].current=!1)}if(Math.abs(c-this._tileZoom)>1){this._setView(n,c);return}for(var k=d.min.y;k<=d.max.y;k++)for(var Y=d.min.x;Y<=d.max.x;Y++){var bt=new X(Y,k);if(bt.z=this._tileZoom,!!this._isValidTile(bt)){var vt=this._tiles[this._tileCoordsToKey(bt)];vt?vt.current=!0:y.push(bt)}}if(y.sort(function(Mt,Ve){return Mt.distanceTo(_)-Ve.distanceTo(_)}),y.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Dt=document.createDocumentFragment();for(Y=0;Y<y.length;Y++)this._addTile(y[Y],Dt);this._level.el.appendChild(Dt)}}}},_isValidTile:function(n){var o=this._map.options.crs;if(!o.infinite){var c=this._globalTileRange;if(!o.wrapLng&&(n.x<c.min.x||n.x>c.max.x)||!o.wrapLat&&(n.y<c.min.y||n.y>c.max.y))return!1}if(!this.options.bounds)return!0;var h=this._tileCoordsToBounds(n);return ht(this.options.bounds).overlaps(h)},_keyToBounds:function(n){return this._tileCoordsToBounds(this._keyToTileCoords(n))},_tileCoordsToNwSe:function(n){var o=this._map,c=this.getTileSize(),h=n.scaleBy(c),d=h.add(c),_=o.unproject(h,n.z),y=o.unproject(d,n.z);return[_,y]},_tileCoordsToBounds:function(n){var o=this._tileCoordsToNwSe(n),c=new Pt(o[0],o[1]);return this.options.noWrap||(c=this._map.wrapLatLngBounds(c)),c},_tileCoordsToKey:function(n){return n.x+":"+n.y+":"+n.z},_keyToTileCoords:function(n){var o=n.split(":"),c=new X(+o[0],+o[1]);return c.z=+o[2],c},_removeTile:function(n){var o=this._tiles[n];o&&(at(o.el),delete this._tiles[n],this.fire("tileunload",{tile:o.el,coords:this._keyToTileCoords(n)}))},_initTile:function(n){$(n,"leaflet-tile");var o=this.getTileSize();n.style.width=o.x+"px",n.style.height=o.y+"px",n.onselectstart=T,n.onmousemove=T,F.ielt9&&this.options.opacity<1&&xt(n,this.options.opacity)},_addTile:function(n,o){var c=this._getTilePos(n),h=this._tileCoordsToKey(n),d=this.createTile(this._wrapCoords(n),l(this._tileReady,this,n));this._initTile(d),this.createTile.length<2&&U(l(this._tileReady,this,n,null,d)),ft(d,c),this._tiles[h]={el:d,coords:n,current:!0},o.appendChild(d),this.fire("tileloadstart",{tile:d,coords:n})},_tileReady:function(n,o,c){o&&this.fire("tileerror",{error:o,tile:c,coords:n});var h=this._tileCoordsToKey(n);c=this._tiles[h],c&&(c.loaded=+new Date,this._map._fadeAnimated?(xt(c.el,0),K(this._fadeFrame),this._fadeFrame=U(this._updateOpacity,this)):(c.active=!0,this._pruneTiles()),o||($(c.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:c.el,coords:n})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),F.ielt9||!this._map._fadeAnimated?U(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(n){return n.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(n){var o=new X(this._wrapX?g(n.x,this._wrapX):n.x,this._wrapY?g(n.y,this._wrapY):n.y);return o.z=n.z,o},_pxBoundsToTileRange:function(n){var o=this.getTileSize();return new ot(n.min.unscaleBy(o).floor(),n.max.unscaleBy(o).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var n in this._tiles)if(!this._tiles[n].loaded)return!1;return!0}});function Uf(n){return new mi(n)}var ze=mi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(n,o){this._url=n,o=S(this,o),o.detectRetina&&F.retina&&o.maxZoom>0?(o.tileSize=Math.floor(o.tileSize/2),o.zoomReverse?(o.zoomOffset--,o.minZoom=Math.min(o.maxZoom,o.minZoom+1)):(o.zoomOffset++,o.maxZoom=Math.max(o.minZoom,o.maxZoom-1)),o.minZoom=Math.max(0,o.minZoom)):o.zoomReverse?o.minZoom=Math.min(o.maxZoom,o.minZoom):o.maxZoom=Math.max(o.minZoom,o.maxZoom),typeof o.subdomains=="string"&&(o.subdomains=o.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(n,o){return this._url===n&&o===void 0&&(o=!0),this._url=n,o||this.redraw(),this},createTile:function(n,o){var c=document.createElement("img");return Z(c,"load",l(this._tileOnLoad,this,o,c)),Z(c,"error",l(this._tileOnError,this,o,c)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(c.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(c.referrerPolicy=this.options.referrerPolicy),c.alt="",c.src=this.getTileUrl(n),c},getTileUrl:function(n){var o={r:F.retina?"@2x":"",s:this._getSubdomain(n),x:n.x,y:n.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var c=this._globalTileRange.max.y-n.y;this.options.tms&&(o.y=c),o["-y"]=c}return C(this._url,s(o,this.options))},_tileOnLoad:function(n,o){F.ielt9?setTimeout(l(n,this,null,o),0):n(null,o)},_tileOnError:function(n,o,c){var h=this.options.errorTileUrl;h&&o.getAttribute("src")!==h&&(o.src=h),n(c,o)},_onTileRemove:function(n){n.tile.onload=null},_getZoomForUrl:function(){var n=this._tileZoom,o=this.options.maxZoom,c=this.options.zoomReverse,h=this.options.zoomOffset;return c&&(n=o-n),n+h},_getSubdomain:function(n){var o=Math.abs(n.x+n.y)%this.options.subdomains.length;return this.options.subdomains[o]},_abortLoading:function(){var n,o;for(n in this._tiles)if(this._tiles[n].coords.z!==this._tileZoom&&(o=this._tiles[n].el,o.onload=T,o.onerror=T,!o.complete)){o.src=B;var c=this._tiles[n].coords;at(o),delete this._tiles[n],this.fire("tileabort",{tile:o,coords:c})}},_removeTile:function(n){var o=this._tiles[n];if(o)return o.el.setAttribute("src",B),mi.prototype._removeTile.call(this,n)},_tileReady:function(n,o,c){if(!(!this._map||c&&c.getAttribute("src")===B))return mi.prototype._tileReady.call(this,n,o,c)}});function ia(n,o){return new ze(n,o)}var na=ze.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(n,o){this._url=n;var c=s({},this.defaultWmsParams);for(var h in o)h in this.options||(c[h]=o[h]);o=S(this,o);var d=o.detectRetina&&F.retina?2:1,_=this.getTileSize();c.width=_.x*d,c.height=_.y*d,this.wmsParams=c},onAdd:function(n){this._crs=this.options.crs||n.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var o=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[o]=this._crs.code,ze.prototype.onAdd.call(this,n)},getTileUrl:function(n){var o=this._tileCoordsToNwSe(n),c=this._crs,h=wt(c.project(o[0]),c.project(o[1])),d=h.min,_=h.max,y=(this._wmsVersion>=1.3&&this._crs===Ko?[d.y,d.x,_.y,_.x]:[d.x,d.y,_.x,_.y]).join(","),A=ze.prototype.getTileUrl.call(this,n);return A+w(this.wmsParams,A,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+y},setParams:function(n,o){return s(this.wmsParams,n),o||this.redraw(),this}});function Lf(n,o){return new na(n,o)}ze.WMS=na,ia.wms=Lf;var ne=kt.extend({options:{padding:.1},initialize:function(n){S(this,n),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),$(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var n={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(n.zoomanim=this._onAnimZoom),n},_onAnimZoom:function(n){this._updateTransform(n.center,n.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(n,o){var c=this._map.getZoomScale(o,this._zoom),h=this._map.getSize().multiplyBy(.5+this.options.padding),d=this._map.project(this._center,o),_=h.multiplyBy(-c).add(d).subtract(this._map._getNewPixelOrigin(n,o));F.any3d?Te(this._container,_,c):ft(this._container,_)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var n in this._layers)this._layers[n]._reset()},_onZoomEnd:function(){for(var n in this._layers)this._layers[n]._project()},_updatePaths:function(){for(var n in this._layers)this._layers[n]._update()},_update:function(){var n=this.options.padding,o=this._map.getSize(),c=this._map.containerPointToLayerPoint(o.multiplyBy(-n)).round();this._bounds=new ot(c,c.add(o.multiplyBy(1+n*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ra=ne.extend({options:{tolerance:0},getEvents:function(){var n=ne.prototype.getEvents.call(this);return n.viewprereset=this._onViewPreReset,n},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ne.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var n=this._container=document.createElement("canvas");Z(n,"mousemove",this._onMouseMove,this),Z(n,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Z(n,"mouseout",this._handleMouseOut,this),n._leaflet_disable_events=!0,this._ctx=n.getContext("2d")},_destroyContainer:function(){K(this._redrawRequest),delete this._ctx,at(this._container),rt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var n;this._redrawBounds=null;for(var o in this._layers)n=this._layers[o],n._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ne.prototype._update.call(this);var n=this._bounds,o=this._container,c=n.getSize(),h=F.retina?2:1;ft(o,n.min),o.width=h*c.x,o.height=h*c.y,o.style.width=c.x+"px",o.style.height=c.y+"px",F.retina&&this._ctx.scale(2,2),this._ctx.translate(-n.min.x,-n.min.y),this.fire("update")}},_reset:function(){ne.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(n){this._updateDashArray(n),this._layers[u(n)]=n;var o=n._order={layer:n,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=o),this._drawLast=o,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(n){this._requestRedraw(n)},_removePath:function(n){var o=n._order,c=o.next,h=o.prev;c?c.prev=h:this._drawLast=h,h?h.next=c:this._drawFirst=c,delete n._order,delete this._layers[u(n)],this._requestRedraw(n)},_updatePath:function(n){this._extendRedrawBounds(n),n._project(),n._update(),this._requestRedraw(n)},_updateStyle:function(n){this._updateDashArray(n),this._requestRedraw(n)},_updateDashArray:function(n){if(typeof n.options.dashArray=="string"){var o=n.options.dashArray.split(/[, ]+/),c=[],h,d;for(d=0;d<o.length;d++){if(h=Number(o[d]),isNaN(h))return;c.push(h)}n.options._dashArray=c}else n.options._dashArray=n.options.dashArray},_requestRedraw:function(n){this._map&&(this._extendRedrawBounds(n),this._redrawRequest=this._redrawRequest||U(this._redraw,this))},_extendRedrawBounds:function(n){if(n._pxBounds){var o=(n.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ot,this._redrawBounds.extend(n._pxBounds.min.subtract([o,o])),this._redrawBounds.extend(n._pxBounds.max.add([o,o]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var n=this._redrawBounds;if(n){var o=n.getSize();this._ctx.clearRect(n.min.x,n.min.y,o.x,o.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var n,o=this._redrawBounds;if(this._ctx.save(),o){var c=o.getSize();this._ctx.beginPath(),this._ctx.rect(o.min.x,o.min.y,c.x,c.y),this._ctx.clip()}this._drawing=!0;for(var h=this._drawFirst;h;h=h.next)n=h.layer,(!o||n._pxBounds&&n._pxBounds.intersects(o))&&n._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(n,o){if(this._drawing){var c,h,d,_,y=n._parts,A=y.length,R=this._ctx;if(A){for(R.beginPath(),c=0;c<A;c++){for(h=0,d=y[c].length;h<d;h++)_=y[c][h],R[h?"lineTo":"moveTo"](_.x,_.y);o&&R.closePath()}this._fillStroke(R,n)}}},_updateCircle:function(n){if(!(!this._drawing||n._empty())){var o=n._point,c=this._ctx,h=Math.max(Math.round(n._radius),1),d=(Math.max(Math.round(n._radiusY),1)||h)/h;d!==1&&(c.save(),c.scale(1,d)),c.beginPath(),c.arc(o.x,o.y/d,h,0,Math.PI*2,!1),d!==1&&c.restore(),this._fillStroke(c,n)}},_fillStroke:function(n,o){var c=o.options;c.fill&&(n.globalAlpha=c.fillOpacity,n.fillStyle=c.fillColor||c.color,n.fill(c.fillRule||"evenodd")),c.stroke&&c.weight!==0&&(n.setLineDash&&n.setLineDash(o.options&&o.options._dashArray||[]),n.globalAlpha=c.opacity,n.lineWidth=c.weight,n.strokeStyle=c.color,n.lineCap=c.lineCap,n.lineJoin=c.lineJoin,n.stroke())},_onClick:function(n){for(var o=this._map.mouseEventToLayerPoint(n),c,h,d=this._drawFirst;d;d=d.next)c=d.layer,c.options.interactive&&c._containsPoint(o)&&(!(n.type==="click"||n.type==="preclick")||!this._map._draggableMoved(c))&&(h=c);this._fireEvent(h?[h]:!1,n)},_onMouseMove:function(n){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var o=this._map.mouseEventToLayerPoint(n);this._handleMouseHover(n,o)}},_handleMouseOut:function(n){var o=this._hoveredLayer;o&&(lt(this._container,"leaflet-interactive"),this._fireEvent([o],n,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(n,o){if(!this._mouseHoverThrottled){for(var c,h,d=this._drawFirst;d;d=d.next)c=d.layer,c.options.interactive&&c._containsPoint(o)&&(h=c);h!==this._hoveredLayer&&(this._handleMouseOut(n),h&&($(this._container,"leaflet-interactive"),this._fireEvent([h],n,"mouseover"),this._hoveredLayer=h)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,n),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(n,o,c){this._map._fireDOMEvent(o,c||o.type,n)},_bringToFront:function(n){var o=n._order;if(o){var c=o.next,h=o.prev;if(c)c.prev=h;else return;h?h.next=c:c&&(this._drawFirst=c),o.prev=this._drawLast,this._drawLast.next=o,o.next=null,this._drawLast=o,this._requestRedraw(n)}},_bringToBack:function(n){var o=n._order;if(o){var c=o.next,h=o.prev;if(h)h.next=c;else return;c?c.prev=h:h&&(this._drawLast=h),o.prev=null,o.next=this._drawFirst,this._drawFirst.prev=o,this._drawFirst=o,this._requestRedraw(n)}}});function sa(n){return F.canvas?new ra(n):null}var Ti=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(n){return document.createElement("<lvml:"+n+' class="lvml">')}}catch{}return function(n){return document.createElement("<"+n+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),kf={_initContainer:function(){this._container=G("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ne.prototype._update.call(this),this.fire("update"))},_initPath:function(n){var o=n._container=Ti("shape");$(o,"leaflet-vml-shape "+(this.options.className||"")),o.coordsize="1 1",n._path=Ti("path"),o.appendChild(n._path),this._updateStyle(n),this._layers[u(n)]=n},_addPath:function(n){var o=n._container;this._container.appendChild(o),n.options.interactive&&n.addInteractiveTarget(o)},_removePath:function(n){var o=n._container;at(o),n.removeInteractiveTarget(o),delete this._layers[u(n)]},_updateStyle:function(n){var o=n._stroke,c=n._fill,h=n.options,d=n._container;d.stroked=!!h.stroke,d.filled=!!h.fill,h.stroke?(o||(o=n._stroke=Ti("stroke")),d.appendChild(o),o.weight=h.weight+"px",o.color=h.color,o.opacity=h.opacity,h.dashArray?o.dashStyle=M(h.dashArray)?h.dashArray.join(" "):h.dashArray.replace(/( *, *)/g," "):o.dashStyle="",o.endcap=h.lineCap.replace("butt","flat"),o.joinstyle=h.lineJoin):o&&(d.removeChild(o),n._stroke=null),h.fill?(c||(c=n._fill=Ti("fill")),d.appendChild(c),c.color=h.fillColor||h.color,c.opacity=h.fillOpacity):c&&(d.removeChild(c),n._fill=null)},_updateCircle:function(n){var o=n._point.round(),c=Math.round(n._radius),h=Math.round(n._radiusY||c);this._setPath(n,n._empty()?"M0 0":"AL "+o.x+","+o.y+" "+c+","+h+" 0,"+65535*360)},_setPath:function(n,o){n._path.v=o},_bringToFront:function(n){De(n._container)},_bringToBack:function(n){Be(n._container)}},nn=F.vml?Ti:co,vi=ne.extend({_initContainer:function(){this._container=nn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=nn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){at(this._container),rt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ne.prototype._update.call(this);var n=this._bounds,o=n.getSize(),c=this._container;(!this._svgSize||!this._svgSize.equals(o))&&(this._svgSize=o,c.setAttribute("width",o.x),c.setAttribute("height",o.y)),ft(c,n.min),c.setAttribute("viewBox",[n.min.x,n.min.y,o.x,o.y].join(" ")),this.fire("update")}},_initPath:function(n){var o=n._path=nn("path");n.options.className&&$(o,n.options.className),n.options.interactive&&$(o,"leaflet-interactive"),this._updateStyle(n),this._layers[u(n)]=n},_addPath:function(n){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(n._path),n.addInteractiveTarget(n._path)},_removePath:function(n){at(n._path),n.removeInteractiveTarget(n._path),delete this._layers[u(n)]},_updatePath:function(n){n._project(),n._update()},_updateStyle:function(n){var o=n._path,c=n.options;o&&(c.stroke?(o.setAttribute("stroke",c.color),o.setAttribute("stroke-opacity",c.opacity),o.setAttribute("stroke-width",c.weight),o.setAttribute("stroke-linecap",c.lineCap),o.setAttribute("stroke-linejoin",c.lineJoin),c.dashArray?o.setAttribute("stroke-dasharray",c.dashArray):o.removeAttribute("stroke-dasharray"),c.dashOffset?o.setAttribute("stroke-dashoffset",c.dashOffset):o.removeAttribute("stroke-dashoffset")):o.setAttribute("stroke","none"),c.fill?(o.setAttribute("fill",c.fillColor||c.color),o.setAttribute("fill-opacity",c.fillOpacity),o.setAttribute("fill-rule",c.fillRule||"evenodd")):o.setAttribute("fill","none"))},_updatePoly:function(n,o){this._setPath(n,lo(n._parts,o))},_updateCircle:function(n){var o=n._point,c=Math.max(Math.round(n._radius),1),h=Math.max(Math.round(n._radiusY),1)||c,d="a"+c+","+h+" 0 1,0 ",_=n._empty()?"M0 0":"M"+(o.x-c)+","+o.y+d+c*2+",0 "+d+-c*2+",0 ";this._setPath(n,_)},_setPath:function(n,o){n._path.setAttribute("d",o)},_bringToFront:function(n){De(n._path)},_bringToBack:function(n){Be(n._path)}});F.vml&&vi.include(kf);function oa(n){return F.svg||F.vml?new vi(n):null}J.include({getRenderer:function(n){var o=n.options.renderer||this._getPaneRenderer(n.options.pane)||this.options.renderer||this._renderer;return o||(o=this._renderer=this._createRenderer()),this.hasLayer(o)||this.addLayer(o),o},_getPaneRenderer:function(n){if(n==="overlayPane"||n===void 0)return!1;var o=this._paneRenderers[n];return o===void 0&&(o=this._createRenderer({pane:n}),this._paneRenderers[n]=o),o},_createRenderer:function(n){return this.options.preferCanvas&&sa(n)||oa(n)}});var aa=Le.extend({initialize:function(n,o){Le.prototype.initialize.call(this,this._boundsToLatLngs(n),o)},setBounds:function(n){return this.setLatLngs(this._boundsToLatLngs(n))},_boundsToLatLngs:function(n){return n=ht(n),[n.getSouthWest(),n.getNorthWest(),n.getNorthEast(),n.getSouthEast()]}});function zf(n,o){return new aa(n,o)}vi.create=nn,vi.pointsToPath=lo,ie.geometryToLayer=Ki,ie.coordsToLatLng=wr,ie.coordsToLatLngs=qi,ie.latLngToCoords=Pr,ie.latLngsToCoords=Ji,ie.getFeature=ke,ie.asFeature=Qi,J.mergeOptions({boxZoom:!0});var ca=Xt.extend({initialize:function(n){this._map=n,this._container=n._container,this._pane=n._panes.overlayPane,this._resetStateTimeout=0,n.on("unload",this._destroy,this)},addHooks:function(){Z(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){rt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){at(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(n){if(!n.shiftKey||n.which!==1&&n.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),hi(),lr(),this._startPoint=this._map.mouseEventToContainerPoint(n),Z(document,{contextmenu:Ee,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(n){this._moved||(this._moved=!0,this._box=G("div","leaflet-zoom-box",this._container),$(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(n);var o=new ot(this._point,this._startPoint),c=o.getSize();ft(this._box,o.min),this._box.style.width=c.x+"px",this._box.style.height=c.y+"px"},_finish:function(){this._moved&&(at(this._box),lt(this._container,"leaflet-crosshair")),fi(),hr(),rt(document,{contextmenu:Ee,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(n){if(!(n.which!==1&&n.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var o=new Pt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(o).fire("boxzoomend",{boxZoomBounds:o})}},_onKeyDown:function(n){n.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});J.addInitHook("addHandler","boxZoom",ca),J.mergeOptions({doubleClickZoom:!0});var la=Xt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(n){var o=this._map,c=o.getZoom(),h=o.options.zoomDelta,d=n.originalEvent.shiftKey?c-h:c+h;o.options.doubleClickZoom==="center"?o.setZoom(d):o.setZoomAround(n.containerPoint,d)}});J.addInitHook("addHandler","doubleClickZoom",la),J.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ha=Xt.extend({addHooks:function(){if(!this._draggable){var n=this._map;this._draggable=new oe(n._mapPane,n._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),n.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),n.on("zoomend",this._onZoomEnd,this),n.whenReady(this._onZoomEnd,this))}$(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){lt(this._map._container,"leaflet-grab"),lt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var n=this._map;if(n._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var o=ht(this._map.options.maxBounds);this._offsetLimit=wt(this._map.latLngToContainerPoint(o.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(o.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;n.fire("movestart").fire("dragstart"),n.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(n){if(this._map.options.inertia){var o=this._lastTime=+new Date,c=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(c),this._times.push(o),this._prunePositions(o)}this._map.fire("move",n).fire("drag",n)},_prunePositions:function(n){for(;this._positions.length>1&&n-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var n=this._map.getSize().divideBy(2),o=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=o.subtract(n).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(n,o){return n-(n-o)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var n=this._draggable._newPos.subtract(this._draggable._startPos),o=this._offsetLimit;n.x<o.min.x&&(n.x=this._viscousLimit(n.x,o.min.x)),n.y<o.min.y&&(n.y=this._viscousLimit(n.y,o.min.y)),n.x>o.max.x&&(n.x=this._viscousLimit(n.x,o.max.x)),n.y>o.max.y&&(n.y=this._viscousLimit(n.y,o.max.y)),this._draggable._newPos=this._draggable._startPos.add(n)}},_onPreDragWrap:function(){var n=this._worldWidth,o=Math.round(n/2),c=this._initialWorldOffset,h=this._draggable._newPos.x,d=(h-o+c)%n+o-c,_=(h+o+c)%n-o-c,y=Math.abs(d+c)<Math.abs(_+c)?d:_;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=y},_onDragEnd:function(n){var o=this._map,c=o.options,h=!c.inertia||n.noInertia||this._times.length<2;if(o.fire("dragend",n),h)o.fire("moveend");else{this._prunePositions(+new Date);var d=this._lastPos.subtract(this._positions[0]),_=(this._lastTime-this._times[0])/1e3,y=c.easeLinearity,A=d.multiplyBy(y/_),R=A.distanceTo([0,0]),P=Math.min(c.inertiaMaxSpeed,R),x=A.multiplyBy(P/R),k=P/(c.inertiaDeceleration*y),Y=x.multiplyBy(-k/2).round();!Y.x&&!Y.y?o.fire("moveend"):(Y=o._limitOffset(Y,o.options.maxBounds),U(function(){o.panBy(Y,{duration:k,easeLinearity:y,noMoveStart:!0,animate:!0})}))}}});J.addInitHook("addHandler","dragging",ha),J.mergeOptions({keyboard:!0,keyboardPanDelta:80});var fa=Xt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(n){this._map=n,this._setPanDelta(n.options.keyboardPanDelta),this._setZoomDelta(n.options.zoomDelta)},addHooks:function(){var n=this._map._container;n.tabIndex<=0&&(n.tabIndex="0"),Z(n,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),rt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var n=document.body,o=document.documentElement,c=n.scrollTop||o.scrollTop,h=n.scrollLeft||o.scrollLeft;this._map._container.focus(),window.scrollTo(h,c)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(n){var o=this._panKeys={},c=this.keyCodes,h,d;for(h=0,d=c.left.length;h<d;h++)o[c.left[h]]=[-1*n,0];for(h=0,d=c.right.length;h<d;h++)o[c.right[h]]=[n,0];for(h=0,d=c.down.length;h<d;h++)o[c.down[h]]=[0,n];for(h=0,d=c.up.length;h<d;h++)o[c.up[h]]=[0,-1*n]},_setZoomDelta:function(n){var o=this._zoomKeys={},c=this.keyCodes,h,d;for(h=0,d=c.zoomIn.length;h<d;h++)o[c.zoomIn[h]]=n;for(h=0,d=c.zoomOut.length;h<d;h++)o[c.zoomOut[h]]=-n},_addHooks:function(){Z(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){rt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(n){if(!(n.altKey||n.ctrlKey||n.metaKey)){var o=n.keyCode,c=this._map,h;if(o in this._panKeys){if(!c._panAnim||!c._panAnim._inProgress)if(h=this._panKeys[o],n.shiftKey&&(h=V(h).multiplyBy(3)),c.options.maxBounds&&(h=c._limitOffset(V(h),c.options.maxBounds)),c.options.worldCopyJump){var d=c.wrapLatLng(c.unproject(c.project(c.getCenter()).add(h)));c.panTo(d)}else c.panBy(h)}else if(o in this._zoomKeys)c.setZoom(c.getZoom()+(n.shiftKey?3:1)*this._zoomKeys[o]);else if(o===27&&c._popup&&c._popup.options.closeOnEscapeKey)c.closePopup();else return;Ee(n)}}});J.addInitHook("addHandler","keyboard",fa),J.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ua=Xt.extend({addHooks:function(){Z(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){rt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(n){var o=Fo(n),c=this._map.options.wheelDebounceTime;this._delta+=o,this._lastMousePos=this._map.mouseEventToContainerPoint(n),this._startTime||(this._startTime=+new Date);var h=Math.max(c-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),h),Ee(n)},_performZoom:function(){var n=this._map,o=n.getZoom(),c=this._map.options.zoomSnap||0;n._stop();var h=this._delta/(this._map.options.wheelPxPerZoomLevel*4),d=4*Math.log(2/(1+Math.exp(-Math.abs(h))))/Math.LN2,_=c?Math.ceil(d/c)*c:d,y=n._limitZoom(o+(this._delta>0?_:-_))-o;this._delta=0,this._startTime=null,y&&(n.options.scrollWheelZoom==="center"?n.setZoom(o+y):n.setZoomAround(this._lastMousePos,o+y))}});J.addInitHook("addHandler","scrollWheelZoom",ua);var Vf=600;J.mergeOptions({tapHold:F.touchNative&&F.safari&&F.mobile,tapTolerance:15});var da=Xt.extend({addHooks:function(){Z(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){rt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(n){if(clearTimeout(this._holdTimeout),n.touches.length===1){var o=n.touches[0];this._startPos=this._newPos=new X(o.clientX,o.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(Z(document,"touchend",yt),Z(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",o))},this),Vf),Z(document,"touchend touchcancel contextmenu",this._cancel,this),Z(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function n(){rt(document,"touchend",yt),rt(document,"touchend touchcancel",n)},_cancel:function(){clearTimeout(this._holdTimeout),rt(document,"touchend touchcancel contextmenu",this._cancel,this),rt(document,"touchmove",this._onMove,this)},_onMove:function(n){var o=n.touches[0];this._newPos=new X(o.clientX,o.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(n,o){var c=new MouseEvent(n,{bubbles:!0,cancelable:!0,view:window,screenX:o.screenX,screenY:o.screenY,clientX:o.clientX,clientY:o.clientY});c._simulated=!0,o.target.dispatchEvent(c)}});J.addInitHook("addHandler","tapHold",da),J.mergeOptions({touchZoom:F.touch,bounceAtZoomLimits:!0});var _a=Xt.extend({addHooks:function(){$(this._map._container,"leaflet-touch-zoom"),Z(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){lt(this._map._container,"leaflet-touch-zoom"),rt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(n){var o=this._map;if(!(!n.touches||n.touches.length!==2||o._animatingZoom||this._zooming)){var c=o.mouseEventToContainerPoint(n.touches[0]),h=o.mouseEventToContainerPoint(n.touches[1]);this._centerPoint=o.getSize()._divideBy(2),this._startLatLng=o.containerPointToLatLng(this._centerPoint),o.options.touchZoom!=="center"&&(this._pinchStartLatLng=o.containerPointToLatLng(c.add(h)._divideBy(2))),this._startDist=c.distanceTo(h),this._startZoom=o.getZoom(),this._moved=!1,this._zooming=!0,o._stop(),Z(document,"touchmove",this._onTouchMove,this),Z(document,"touchend touchcancel",this._onTouchEnd,this),yt(n)}},_onTouchMove:function(n){if(!(!n.touches||n.touches.length!==2||!this._zooming)){var o=this._map,c=o.mouseEventToContainerPoint(n.touches[0]),h=o.mouseEventToContainerPoint(n.touches[1]),d=c.distanceTo(h)/this._startDist;if(this._zoom=o.getScaleZoom(d,this._startZoom),!o.options.bounceAtZoomLimits&&(this._zoom<o.getMinZoom()&&d<1||this._zoom>o.getMaxZoom()&&d>1)&&(this._zoom=o._limitZoom(this._zoom)),o.options.touchZoom==="center"){if(this._center=this._startLatLng,d===1)return}else{var _=c._add(h)._divideBy(2)._subtract(this._centerPoint);if(d===1&&_.x===0&&_.y===0)return;this._center=o.unproject(o.project(this._pinchStartLatLng,this._zoom).subtract(_),this._zoom)}this._moved||(o._moveStart(!0,!1),this._moved=!0),K(this._animRequest);var y=l(o._move,o,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=U(y,this,!0),yt(n)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,K(this._animRequest),rt(document,"touchmove",this._onTouchMove,this),rt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});J.addInitHook("addHandler","touchZoom",_a),J.BoxZoom=ca,J.DoubleClickZoom=la,J.Drag=ha,J.Keyboard=fa,J.ScrollWheelZoom=ua,J.TapHold=da,J.TouchZoom=_a,i.Bounds=ot,i.Browser=F,i.CRS=Gt,i.Canvas=ra,i.Circle=br,i.CircleMarker=Yi,i.Class=j,i.Control=Lt,i.DivIcon=ea,i.DivOverlay=Zt,i.DomEvent=sf,i.DomUtil=nf,i.Draggable=oe,i.Evented=si,i.FeatureGroup=te,i.GeoJSON=ie,i.GridLayer=mi,i.Handler=Xt,i.Icon=Ue,i.ImageOverlay=Gi,i.LatLng=et,i.LatLngBounds=Pt,i.Layer=kt,i.LayerGroup=Fe,i.LineUtil=Tf,i.Map=J,i.Marker=$i,i.Mixin=uf,i.Path=ae,i.Point=X,i.PolyUtil=df,i.Polygon=Le,i.Polyline=ee,i.Popup=tn,i.PosAnimation=Uo,i.Projection=vf,i.Rectangle=aa,i.Renderer=ne,i.SVG=vi,i.SVGOverlay=ta,i.TileLayer=ze,i.Tooltip=en,i.Transformation=Jn,i.Util=Tt,i.VideoOverlay=Go,i.bind=l,i.bounds=wt,i.canvas=sa,i.circle=Pf,i.circleMarker=wf,i.control=_i,i.divIcon=Ff,i.extend=s,i.featureGroup=Sf,i.geoJSON=Qo,i.geoJson=If,i.gridLayer=Uf,i.icon=Rf,i.imageOverlay=Of,i.latLng=q,i.latLngBounds=ht,i.layerGroup=Af,i.map=of,i.marker=bf,i.point=V,i.polygon=Cf,i.polyline=Mf,i.popup=Df,i.rectangle=zf,i.setOptions=S,i.stamp=u,i.svg=oa,i.svgOverlay=Nf,i.tileLayer=ia,i.tooltip=Bf,i.transformation=oi,i.version=r,i.videoOverlay=xf;var Wf=window.L;i.noConflict=function(){return window.L=Wf,this},window.L=i})}(Si,Si.exports)),Si.exports}var iu=eu();const Us=Gf(iu);function yn(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Ls=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),va=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);va&&parseFloat(va[1]);const sn=globalThis,We=globalThis.process||{},nu=globalThis.navigator||{};function qc(t){var r,s;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Ie(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||qc()}function ru(t){return Ie()?qc()?"Electron":(nu.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Jc="4.1.0";function su(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class ou{constructor(e,i,r="sessionStorage"){this.storage=su(r),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function au(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function cu(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var En;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(En||(En={}));const lu=10;function ya(t){return typeof t!="string"?t:(t=t.toUpperCase(),En[t]||En.WHITE)}function hu(t,e,i){return!Ie&&typeof t=="string"&&(e&&(t=`\x1B[${ya(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${ya(i)+lu}m${t}\x1B[49m`)),t}function fu(t,e=["constructor"]){const i=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(i),s=t;for(const a of r){const l=s[a];typeof l=="function"&&(e.find(f=>a===f)||(s[a]=l.bind(t)))}}function ks(t,e){if(!t)throw new Error("Assertion failed")}function He(){var e,i,r;let t;if(Ie()&&sn.performance)t=(i=(e=sn==null?void 0:sn.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in We){const s=(r=We==null?void 0:We.hrtime)==null?void 0:r.call(We);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const je={debug:Ie()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},uu={enabled:!0,level:0};function Xe(){}const Ea={},Aa={once:!0};class Bi{constructor({id:e}={id:""}){this.VERSION=Jc,this._startTs=He(),this._deltaTs=He(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new ou(`__probe-${this.id}__`,uu),this.timeStamp(`${this.id} started`),fu(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((He()-this._startTs).toPrecision(10))}getDelta(){return Number((He()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,je.warn,arguments,Aa)}error(e){return this._getLogFunction(0,e,je.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,je.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,je.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,je.debug||je.info,arguments,Aa)}table(e,i,r){return i?this._getLogFunction(e,i,console.table||Xe,r&&[r],{tag:_u(i)}):Xe}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||Xe)}group(e,i,r={collapsed:!1}){const s=Sa({logLevel:e,message:i,opts:r}),{collapsed:a}=r;return s.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,i,r={}){return this.group(e,i,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Xe)}withGroup(e,i,r){this.group(e,i)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Qc(e)}_getLogFunction(e,i,r,s,a){if(this._shouldLog(e)){a=Sa({logLevel:e,message:i,args:s,opts:a}),r=r||a.method,ks(r),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=He();const l=a.tag||a.message;if(a.once&&l)if(!Ea[l])Ea[l]=He();else return Xe;return i=du(this.id,a.message,a),r.bind(console,i,...a.args)}return Xe}}Bi.VERSION=Jc;function Qc(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ks(Number.isFinite(e)&&e>=0),e}function Sa(t){const{logLevel:e,message:i}=t;t.logLevel=Qc(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&r.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return ks(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function du(t,e,i){if(typeof e=="string"){const r=i.time?cu(au(i.total)):"";e=i.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=hu(e,i.color,i.background)}return e}function _u(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const Ir="4.3.2",pu=Ir[0]>="0"&&Ir[0]<="9"?`v${Ir}`:"";function gu(){const t=new Bi({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=pu,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const mu=gu();function Tu(t,e){return Gc(t||{},e)}function Gc(t,e,i=0){if(i>3)return e;const r={...t};for(const[s,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?r[s]=Gc(r[s]||{},e[s],i+1):r[s]=e[s];return r}const vu="latest";function yu(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Eu=yu();function me(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const be=typeof process!="object"||String(process)!=="[object process]"||process.browser,Au=typeof window<"u"&&typeof window.orientation<"u",Ra=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ra&&parseFloat(Ra[1]);class Su{constructor(e,i){m(this,"name");m(this,"workerThread");m(this,"isRunning",!0);m(this,"result");m(this,"_resolve",()=>{});m(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){me(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){me(this.isRunning),this.isRunning=!1,this._reject(e)}}class Or{terminate(){}}const xr=new Map;function Ru(t){me(t.source&&!t.url||!t.source&&t.url);let e=xr.get(t.source||t.url);return e||(t.url&&(e=bu(t.url),xr.set(t.url,e)),t.source&&(e=tl(t.source),xr.set(t.source,e))),me(e),e}function bu(t){if(!t.startsWith("http"))return t;const e=wu(t);return tl(e)}function tl(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function wu(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function el(t,e=!0,i){const r=i||new Set;if(t){if(ba(t))r.add(t);else if(ba(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)el(t[s],e,r)}}return i===void 0?Array.from(r):[]}function ba(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Nr=()=>{};class ts{constructor(e){m(this,"name");m(this,"source");m(this,"url");m(this,"terminated",!1);m(this,"worker");m(this,"onMessage");m(this,"onError");m(this,"_loadableURL","");const{name:i,source:r,url:s}=e;me(r||s),this.name=i,this.source=r,this.url=s,this.onMessage=Nr,this.onError=a=>console.log(a),this.worker=be?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&be||typeof Or<"u"&&!be}destroy(){this.onMessage=Nr,this.onError=Nr,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||el(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=Ru({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Or(r,{eval:!1})}else if(this.source)e=new Or(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class Pu{constructor(e){m(this,"name","unnamed");m(this,"source");m(this,"url");m(this,"maxConcurrency",1);m(this,"maxMobileConcurrency",1);m(this,"onDebug",()=>{});m(this,"reuseWorkers",!0);m(this,"props",{});m(this,"jobQueue",[]);m(this,"idleQueue",[]);m(this,"count",0);m(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return ts.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(s,a,l)=>s.done(l),r=(s,a)=>s.error(a)){const s=new Promise(a=>(this.jobQueue.push({name:e,onMessage:i,onError:r,onStart:a}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const r=new Su(i.name,e);e.onMessage=s=>i.onMessage(r,s.type,s.payload),e.onError=s=>i.onError(r,s),i.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!be||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ts({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Au?this.maxMobileConcurrency:this.maxConcurrency}}const Mu={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ue=class ue{constructor(e){m(this,"props");m(this,"workerPools",new Map);this.props={...Mu},this.setProps(e),this.workerPools=new Map}static isSupported(){return ts.isSupported()}static getWorkerFarm(e={}){return ue._workerFarm=ue._workerFarm||new ue({}),ue._workerFarm.setProps(e),ue._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:r,url:s}=e;let a=this.workerPools.get(i);return a||(a=new Pu({name:i,source:r,url:s}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};m(ue,"_workerFarm");let An=ue;function Cu(t,e={}){const i=e[t.id]||{},r=be?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=i.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(be?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let a=t.version;a==="latest"&&(a=vu);const l=a?`@${a}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${l}/dist/${r}`}return me(s),s}function Iu(t,e=Eu){me(t,"no worker provided");const i=t.version;return!(!e||!i)}function Ou(t,e){return!An.isSupported()||!be&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function xu(t,e,i,r,s){const a=t.id,l=Cu(t,i),u=An.getWorkerFarm(i).getWorkerPool({name:a,url:l});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));const p=await u.startJob("process-on-worker",Nu.bind(null,s));return p.postMessage("process",{input:e,options:i,context:r}),await(await p.result).result}async function Nu(t,e,i,r){switch(i){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:a,options:l}=r;try{const f=await t(a,l);e.postMessage("done",{id:s,result:f})}catch(f){const u=f instanceof Error?f.message:"unknown error";e.postMessage("error",{id:s,error:u})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function Du(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let a=0;a<r.length;++a)if(r[a]!==s[a])return!1;return!0}function Bu(...t){return Fu(t)}function Fu(t){const e=t.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),i=e.reduce((a,l)=>a+l.byteLength,0),r=new Uint8Array(i);let s=0;for(const a of e)r.set(a,s),s+=a.byteLength;return r.buffer}async function Uu(t){const e=[];for await(const i of t)e.push(i);return Bu(...e)}function wa(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Pa{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=wa(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(wa()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Xn{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:r}=e;let s=this.stats[i];return s||(e instanceof Pa?s=e:s=new Pa(i,r),this.stats[i]=s),s}}let Lu="";const Ma={};function ku(t){for(const e in Ma)if(t.startsWith(e)){const i=Ma[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${Lu}${t}`),t}function zu(t){return t&&typeof t=="object"&&t.isBuffer}function il(t){if(zu(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function nl(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Vu(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const Wu=t=>typeof t=="boolean",Pi=t=>typeof t=="function",Fi=t=>t!==null&&typeof t=="object",Ca=t=>Fi(t)&&t.constructor==={}.constructor,Hu=t=>!!t&&typeof t[Symbol.iterator]=="function",ju=t=>t&&typeof t[Symbol.asyncIterator]=="function",Oe=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,xe=t=>typeof Blob<"u"&&t instanceof Blob,Xu=t=>t&&typeof t=="object"&&t.isBuffer,Zu=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Fi(t)&&Pi(t.tee)&&Pi(t.cancel)&&Pi(t.getReader),$u=t=>Fi(t)&&Pi(t.read)&&Pi(t.pipe)&&Wu(t.readable),rl=t=>Zu(t)||$u(t);class Yu extends Error{constructor(i,r){super(i);m(this,"reason");m(this,"url");m(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const Ku=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,qu=/^([-\w.]+\/[-\w.+]+)/;function Ia(t,e){return t.toLowerCase()===e.toLowerCase()}function Ju(t){const e=qu.exec(t);return e?e[1]:t}function Oa(t){const e=Ku.exec(t);return e?e[1]:""}const sl=/\?.*/;function Qu(t){const e=t.match(sl);return e&&e[0]}function zs(t){return t.replace(sl,"")}function Gu(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Zn(t){return Oe(t)?t.url:xe(t)?t.name||"":typeof t=="string"?t:""}function Vs(t){if(Oe(t)){const e=t,i=e.headers.get("content-type")||"",r=zs(e.url);return Ju(i)||Oa(r)}return xe(t)?t.type||"":typeof t=="string"?Oa(t):""}function td(t){return Oe(t)?t.headers["content-length"]||-1:xe(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ol(t){if(Oe(t))return t;const e={},i=td(t);i>=0&&(e["content-length"]=String(i));const r=Zn(t),s=Vs(t);s&&(e["content-type"]=s);const a=await nd(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const l=new Response(t,{headers:e});return Object.defineProperty(l,"url",{value:r}),l}async function ed(t){if(!t.ok)throw await id(t)}async function id(t){const e=Gu(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(s!=null&&s.includes("application/json"))?await t.json():await t.text()}catch{}return new Yu(i,r)}async function nd(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=a=>{var l;return r((l=a==null?void 0:a.target)==null?void 0:l.result)},s.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${rd(i)}`}return null}function rd(t){let e="";const i=new Uint8Array(t);for(let r=0;r<i.byteLength;r++)e+=String.fromCharCode(i[r]);return btoa(e)}function sd(t){return!od(t)&&!ad(t)}function od(t){return t.startsWith("http:")||t.startsWith("https:")}function ad(t){return t.startsWith("data:")}async function xa(t,e){var i,r;if(typeof t=="string"){const s=ku(t);return sd(s)&&(i=globalThis.loaders)!=null&&i.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(s,e):await fetch(s,e)}return await ol(t)}const Na=new Bi({id:"loaders.gl"});class cd{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ld{constructor(){m(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const al={fetch:null,mimeType:void 0,nothrow:!1,log:new ld,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ls,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hd={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function cl(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function ll(){const t=cl();return t.globalOptions=t.globalOptions||{...al},t.globalOptions}function fd(t,e,i,r){return i=i||[],i=Array.isArray(i)?i:[i],ud(t,i),_d(e,t,r)}function ud(t,e){Da(t,null,al,hd,e);for(const i of e){const r=t&&t[i.id]||{},s=i.options&&i.options[i.id]||{},a=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Da(r,i.id,s,a,e)}}function Da(t,e,i,r,s){const a=e||"Top level",l=e?`${e}.`:"";for(const f in t){const u=!e&&Fi(t[f]),p=f==="baseUri"&&!e,g=f==="workerUrl"&&e;if(!(f in i)&&!p&&!g){if(f in r)Na.warn(`${a} loader option '${l}${f}' no longer supported, use '${r[f]}'`)();else if(!u){const T=dd(f,s);Na.warn(`${a} loader option '${l}${f}' not recognized. ${T}`)()}}}}function dd(t,e){const i=t.toLowerCase();let r="";for(const s of e)for(const a in s.options){if(t===a)return`Did you mean '${s.id}.${a}'?`;const l=a.toLowerCase();(i.startsWith(l)||l.startsWith(i))&&(r=r||`Did you mean '${s.id}.${a}'?`)}return r}function _d(t,e,i){const s={...t.options||{}};return pd(s,i),s.log===null&&(s.log=new cd),Ba(s,ll()),Ba(s,e),s}function Ba(t,e){for(const i in e)if(i in e){const r=e[i];Ca(r)&&Ca(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function pd(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Ws(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Hs(t){yn(t,"null loader"),yn(Ws(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const hl=()=>{const t=cl();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function gd(t){const e=hl();t=Array.isArray(t)?t:[t];for(const i of t){const r=Hs(i);e.find(s=>r===s)||e.unshift(r)}}function md(){return hl()}const Td=/\.([^.]+)$/;async function vd(t,e=[],i,r){if(!fl(t))return null;let s=Fa(t,e,{...i,nothrow:!0},r);if(s)return s;if(xe(t)&&(t=await t.slice(0,10).arrayBuffer(),s=Fa(t,e,i,r)),!s&&!(i!=null&&i.nothrow))throw new Error(ul(t));return s}function Fa(t,e=[],i,r){if(!fl(t))return null;if(e&&!Array.isArray(e))return Hs(e);let s=[];e&&(s=s.concat(e)),i!=null&&i.ignoreRegisteredLoaders||s.push(...md()),Ed(s);const a=yd(t,s,i,r);if(!a&&!(i!=null&&i.nothrow))throw new Error(ul(t));return a}function yd(t,e,i,r){const s=Zn(t),a=Vs(t),l=zs(s)||(r==null?void 0:r.url);let f=null,u="";return i!=null&&i.mimeType&&(f=Dr(e,i==null?void 0:i.mimeType),u=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),f=f||Ad(e,l),u=u||(f?`matched url ${l}`:""),f=f||Dr(e,a),u=u||(f?`matched MIME type ${a}`:""),f=f||Rd(e,t),u=u||(f?`matched initial data ${dl(t)}`:""),i!=null&&i.fallbackMimeType&&(f=f||Dr(e,i==null?void 0:i.fallbackMimeType),u=u||(f?`matched fallback MIME type ${a}`:"")),u&&mu.log(1,`selectLoader selected ${f==null?void 0:f.name}: ${u}.`),f}function fl(t){return!(t instanceof Response&&t.status===204)}function ul(t){const e=Zn(t),i=Vs(t);let r="No valid loader found (";r+=e?`${nl(e)}, `:"no url provided, ",r+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const s=t?dl(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function Ed(t){for(const e of t)Hs(e)}function Ad(t,e){const i=e&&Td.exec(e),r=i&&i[1];return r?Sd(t,r):null}function Sd(t,e){e=e.toLowerCase();for(const i of t)for(const r of i.extensions)if(r.toLowerCase()===e)return i;return null}function Dr(t,e){var i;for(const r of t)if((i=r.mimeTypes)!=null&&i.some(s=>Ia(e,s))||Ia(e,`application/x.${r.id}`))return r;return null}function Rd(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(bd(e,i))return i}else if(ArrayBuffer.isView(e)){if(Ua(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&Ua(e,0,i))return i;return null}function bd(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Ua(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(s=>wd(t,e,i,s))}function wd(t,e,i,r){if(r instanceof ArrayBuffer)return Du(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=es(t,e,r.length);return r===s;default:return!1}}function dl(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?es(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?es(t,0,e):""}function es(t,e,i){if(t.byteLength<e+i)return"";const r=new DataView(t);let s="";for(let a=0;a<i;a++)s+=String.fromCharCode(r.getUint8(e+a));return s}const Pd=256*1024;function*Md(t,e){const i=(e==null?void 0:e.chunkSize)||Pd;let r=0;const s=new TextEncoder;for(;r<t.length;){const a=Math.min(t.length-r,i),l=t.slice(r,r+a);r+=a,yield s.encode(l)}}const Cd=256*1024;function*Id(t,e={}){const{chunkSize:i=Cd}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,i),a=new ArrayBuffer(s),l=new Uint8Array(t,r,s);new Uint8Array(a).set(l),r+=s,yield a}}const Od=1024*1024;async function*xd(t,e){const i=(e==null?void 0:e.chunkSize)||Od;let r=0;for(;r<t.size;){const s=r+i,a=await t.slice(r,s).arrayBuffer();r=s,yield a}}function La(t,e){return Ls?Nd(t,e):Dd(t)}async function*Nd(t,e){const i=t.getReader();let r;try{for(;;){const s=r||i.read();e!=null&&e._streamReadAhead&&(r=i.read());const{done:a,value:l}=await s;if(a)return;yield il(l)}}catch{i.releaseLock()}}async function*Dd(t,e){for await(const i of t)yield il(i)}function Bd(t,e){if(typeof t=="string")return Md(t,e);if(t instanceof ArrayBuffer)return Id(t,e);if(xe(t))return xd(t,e);if(rl(t))return La(t,e);if(Oe(t))return La(t.body,e);throw new Error("makeIterator")}const _l="Cannot convert supplied data type";function Fd(t,e,i){if(e.text&&typeof t=="string")return t;if(Xu(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(_l)}async function Ud(t,e,i){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return Fd(t,e);if(xe(t)&&(t=await ol(t)),Oe(t)){const s=t;return await ed(s),e.binary?await s.arrayBuffer():await s.text()}if(rl(t)&&(t=Bd(t,i)),Hu(t)||ju(t))return Uu(t);throw new Error(_l)}function pl(t,e){const i=ll(),r=t||i;return typeof r.fetch=="function"?r.fetch:Fi(r.fetch)?s=>xa(s,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:xa}function Ld(t,e,i){if(i)return i;const r={fetch:pl(e,t),...t};if(r.url){const s=zs(r.url);r.baseUrl=s,r.queryString=Qu(r.url),r.filename=nl(s),r.baseUrl=Vu(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function kd(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...r]:r}return i&&i.length?i:void 0}async function Sn(t,e,i,r){e&&!Array.isArray(e)&&!Ws(e)&&(r=void 0,i=e,e=void 0),t=await t,i=i||{};const s=Zn(t),l=kd(e,r),f=await vd(t,l,i);return f?(i=fd(i,f,l,s),r=Ld({url:s,_parse:Sn,loaders:l},i,r||null),await zd(f,t,i,r)):null}async function zd(t,e,i,r){if(Iu(t),i=Tu(t.options,i),Oe(e)){const a=e,{ok:l,redirected:f,status:u,statusText:p,type:g,url:T}=a,v=Object.fromEntries(a.headers.entries());r.response={headers:v,ok:l,redirected:f,status:u,statusText:p,type:g,url:T}}e=await Ud(e,t,i);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,i,r);if(Ou(t,i))return await xu(t,e,i,r,Sn);if(s.parseText&&typeof e=="string")return await s.parseText(e,i,r);if(s.parse)return await s.parse(e,i,r);throw me(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Vd(t,e,i,r){let s,a;!Array.isArray(e)&&!Ws(e)?(s=[],a=e):(s=e,a=i);const l=pl(a);let f=t;return typeof t=="string"&&(f=await l(t)),xe(t)&&(f=await l(t)),Array.isArray(s)?await Sn(f,s,a):await Sn(f,s,a)}const Wd="4.3.2";var Kc;const Hd=(Kc=globalThis.loaders)==null?void 0:Kc.parseImageNode,is=typeof Image<"u",ns=typeof ImageBitmap<"u",jd=!!Hd,rs=Ls?!0:jd;function Xd(t){switch(t){case"auto":return ns||is||rs;case"imagebitmap":return ns;case"image":return is;case"data":return rs;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Zd(){if(ns)return"imagebitmap";if(is)return"image";if(rs)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function $d(t){const e=Kd(t);if(!e)throw new Error("Not an image");return e}function Yd(t){switch($d(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Kd(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const qd=/^data:image\/svg\+xml/,Jd=/\.svg((\?|#).*)?$/;function js(t){return t&&(qd.test(t)||Jd.test(t))}function Qd(t,e){if(js(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return gl(t,e)}function gl(t,e){if(js(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function ml(t,e,i){const r=Qd(t,i),s=self.URL||self.webkitURL,a=typeof r!="string"&&s.createObjectURL(r);try{return await Gd(a||r,e)}finally{a&&s.revokeObjectURL(a)}}async function Gd(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((r,s)=>{try{i.onload=()=>r(i),i.onerror=a=>{const l=a instanceof Error?a.message:"error";s(new Error(l))}}catch(a){s(a)}})}const t_={};let ka=!0;async function e_(t,e,i){let r;js(i)?r=await ml(t,e,i):r=gl(t,i);const s=e&&e.imagebitmap;return await i_(r,s)}async function i_(t,e=null){if((n_(e)||!ka)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),ka=!1}return await createImageBitmap(t)}function n_(t){for(const e in t||t_)return!1;return!0}function r_(t){return!c_(t,"ftyp",4)||(t[8]&96)===0?null:s_(t)}function s_(t){switch(o_(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function o_(t,e,i){return String.fromCharCode(...t.slice(e,i))}function a_(t){return[...t].map(e=>e.charCodeAt(0))}function c_(t,e,i=0){const r=a_(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+i])return!1;return!0}const Kt=!1,Mi=!0;function Tl(t){const e=Ui(t);return h_(e)||d_(e)||f_(e)||u_(e)||l_(e)}function l_(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=r_(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function h_(t){const e=Ui(t);return e.byteLength>=24&&e.getUint32(0,Kt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Kt),height:e.getUint32(20,Kt)}:null}function f_(t){const e=Ui(t);return e.byteLength>=10&&e.getUint32(0,Kt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Mi),height:e.getUint16(8,Mi)}:null}function u_(t){const e=Ui(t);return e.byteLength>=14&&e.getUint16(0,Kt)===16973&&e.getUint32(2,Mi)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Mi),height:e.getUint32(22,Mi)}:null}function d_(t){const e=Ui(t);if(!(e.byteLength>=3&&e.getUint16(0,Kt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=__();let a=2;for(;a+9<e.byteLength;){const l=e.getUint16(a,Kt);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(a+5,Kt),width:e.getUint16(a+7,Kt)};if(!r.has(l))return null;a+=2,a+=e.getUint16(a,Kt)}return null}function __(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ui(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function p_(t,e){var s;const{mimeType:i}=Tl(t)||{},r=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return yn(r),await r(t,i)}async function g_(t,e,i){e=e||{};const s=(e.image||{}).type||"auto",{url:a}=i||{},l=m_(s);let f;switch(l){case"imagebitmap":f=await e_(t,e,a);break;case"image":f=await ml(t,e,a);break;case"data":f=await p_(t);break;default:yn(!1)}return s==="data"&&(f=Yd(f)),f}function m_(t){switch(t){case"auto":case"data":return Zd();default:return Xd(t),t}}const T_=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],v_=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],y_={image:{type:"auto",decode:!0}},E_={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Wd,mimeTypes:v_,extensions:T_,parse:g_,tests:[t=>!!Tl(new DataView(t))],options:y_},St=new Bi({id:"deck"});let ss={};function A_(t){ss=t}function os(t,e,i,r){St.level>0&&ss[t]&&ss[t].call(null,e,i,r)}function S_(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const R_={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:S_,parseTextSync:JSON.parse};function b_(){const t="9.1.7",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(St.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:St,_registerLoggers:A_},gd([R_,[E_,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const w_=b_();function Xs(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Br={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function P_(t){const e={};for(const[i,r]of Object.entries(t))e[i]=M_(r);return e}function M_(t){let e=za(t);if(e!=="object")return{value:t,...Br[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Br[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=za(t.value),{...t,...Br[e],type:e}):{type:"object",value:null};throw new Error("props")}function za(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const C_=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,I_=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,O_={vertex:C_,fragment:I_},Va=/void\s+main\s*\([^)]*\)\s*\{\n?/,Wa=/}\n?[^{}]*$/,Fr=[],mn="__LUMA_INJECT_DECLARATIONS__";function x_(t){const e={vertex:{},fragment:{}};for(const i in t){let r=t[i];const s=N_(i);typeof r=="string"&&(r={order:0,injection:r}),e[s][i]=r}return e}function N_(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Rn(t,e,i,r=!1){const s=e==="vertex";for(const a in i){const l=i[a];l.sort((u,p)=>u.order-p.order),Fr.length=l.length;for(let u=0,p=l.length;u<p;++u)Fr[u]=l[u].injection;const f=`${Fr.join(`
`)}
`;switch(a){case"vs:#decl":s&&(t=t.replace(mn,f));break;case"vs:#main-start":s&&(t=t.replace(Va,u=>u+f));break;case"vs:#main-end":s&&(t=t.replace(Wa,u=>f+u));break;case"fs:#decl":s||(t=t.replace(mn,f));break;case"fs:#main-start":s||(t=t.replace(Va,u=>u+f));break;case"fs:#main-end":s||(t=t.replace(Wa,u=>f+u));break;default:t=t.replace(a,u=>u+f)}}return t=t.replace(mn,""),r&&(t=t.replace(/\}\s*$/,a=>a+O_[e])),t}function bn(t){t.map(e=>D_(e))}function D_(t){if(t.instance)return;bn(t.dependencies||[]);const{propTypes:e={},deprecations:i=[],inject:r={}}=t,s={normalizedInjections:x_(r),parsedDeprecations:B_(i)};e&&(s.propValidators=P_(e)),t.instance=s;let a={};e&&(a=Object.entries(e).reduce((l,[f,u])=>{const p=u==null?void 0:u.value;return p&&(l[f]=p),l},{})),t.defaultUniforms={...t.defaultUniforms,...a}}function vl(t,e,i){var r;(r=t.deprecations)==null||r.forEach(s=>{var a;(a=s.regex)!=null&&a.test(e)&&(s.deprecated?i.deprecated(s.old,s.new)():i.removed(s.old,s.new)())})}function B_(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function yl(t){bn(t);const e={},i={};El({modules:t,level:0,moduleMap:e,moduleDepth:i});const r=Object.keys(i).sort((s,a)=>i[a]-i[s]).map(s=>e[s]);return bn(r),r}function El(t){const{modules:e,level:i,moduleMap:r,moduleDepth:s}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)r[a.name]=a,(s[a.name]===void 0||s[a.name]<i)&&(s[a.name]=i);for(const a of e)a.dependencies&&El({modules:a.dependencies,level:i+1,moduleMap:r,moduleDepth:s})}function F_(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function U_(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Ha(t,L_),t;case"fragment":return t=Ha(t,k_),t;default:throw new Error(e)}}const Al=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],L_=[...Al,[as("attribute"),"in $1"],[as("varying"),"out $1"]],k_=[...Al,[as("varying"),"in $1"]];function Ha(t,e){for(const[i,r]of e)t=t.replace(i,r);return t}function as(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Sl(t,e){let i="";for(const r in t){const s=t[r];if(i+=`void ${s.signature} {
`,s.header&&(i+=`  ${s.header}`),e[r]){const a=e[r];a.sort((l,f)=>l.order-f.order);for(const l of a)i+=`  ${l.injection}
`}s.footer&&(i+=`  ${s.footer}`),i+=`}
`}return i}function Rl(t){const e={vertex:{},fragment:{}};for(const i of t){let r,s;typeof i!="string"?(r=i,s=r.hook):(r={},s=i),s=s.trim();const[a,l]=s.split(":"),f=s.replace(/\(.+/,""),u=Object.assign(r,{signature:l});switch(a){case"vs":e.vertex[f]=u;break;case"fs":e.fragment[f]=u;break;default:throw new Error(a)}}return e}function z_(t,e){return{name:V_(t,e),language:"glsl",version:W_(t)}}function V_(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function W_(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const r=parseInt(i[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const bl=`

${mn}
`,H_=`precision highp float;
`;function j_(t){const e=yl(t.modules||[]);return{source:Z_(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:wl(e)}}function X_(t){const{vs:e,fs:i}=t,r=yl(t.modules||[]);return{vs:ja(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:ja(t.platformInfo,{...t,source:i,stage:"fragment",modules:r}),getUniforms:wl(r)}}function Z_(t,e){var S;const{source:i,stage:r,modules:s,hookFunctions:a=[],inject:l={},log:f}=e;Xs(typeof i=="string","shader source must be a string");const u=i;let p="";const g=Rl(a),T={},v={},E={};for(const w in l){const I=typeof l[w]=="string"?{injection:l[w],order:0}:l[w],C=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(C){const M=C[2],O=C[3];M?O==="decl"?v[w]=[I]:E[w]=[I]:T[w]=[I]}else E[w]=[I]}const b=s;for(const w of b){f&&vl(w,u,f);const I=Pl(w,"wgsl");p+=I;const C=((S=w.injections)==null?void 0:S[r])||{};for(const M in C){const O=/^(v|f)s:#([\w-]+)$/.exec(M);if(O){const D=O[2]==="decl"?v:E;D[M]=D[M]||[],D[M].push(C[M])}else T[M]=T[M]||[],T[M].push(C[M])}}return p+=bl,p=Rn(p,r,v),p+=Sl(g[r],T),p+=u,p=Rn(p,r,E),p}function ja(t,e){var tt;const{id:i,source:r,stage:s,language:a="glsl",modules:l,defines:f={},hookFunctions:u=[],inject:p={},prologue:g=!0,log:T}=e;Xs(typeof r=="string","shader source must be a string");const v=a==="glsl"?z_(r).version:-1,E=t.shaderLanguageVersion,b=v===100?"#version 100":"#version 300 es",w=r.split(`
`).slice(1).join(`
`),I={};l.forEach(z=>{Object.assign(I,z.defines)}),Object.assign(I,f);let C="";switch(a){case"wgsl":break;case"glsl":C=g?`${b}

// ----- PROLOGUE -------------------------
${$_({id:i,source:r,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${F_(t)}
${s==="fragment"?H_:""}

// ----- APPLICATION DEFINES -------------------------

${Y_(I)}

`:`${b}
`;break}const M=Rl(u),O={},B={},D={};for(const z in p){const W=typeof p[z]=="string"?{injection:p[z],order:0}:p[z],Q=/^(v|f)s:(#)?([\w-]+)$/.exec(z);if(Q){const U=Q[2],K=Q[3];U?K==="decl"?B[z]=[W]:D[z]=[W]:O[z]=[W]}else D[z]=[W]}for(const z of l){T&&vl(z,w,T);const W=Pl(z,s);C+=W;const Q=((tt=z.instance)==null?void 0:tt.normalizedInjections[s])||{};for(const U in Q){const K=/^(v|f)s:#([\w-]+)$/.exec(U);if(K){const j=K[2]==="decl"?B:D;j[U]=j[U]||[],j[U].push(Q[U])}else O[U]=O[U]||[],O[U].push(Q[U])}}return C+="// ----- MAIN SHADER SOURCE -------------------------",C+=bl,C=Rn(C,s,B),C+=Sl(M[s],O),C+=w,C=Rn(C,s,D),a==="glsl"&&v!==E&&(C=U_(C,s)),C.trim()}function wl(t){return function(i){var s;const r={};for(const a of t){const l=(s=a.getUniforms)==null?void 0:s.call(a,i,r);Object.assign(r,l)}return r}}function $_(t){const{id:e,source:i,stage:r}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function Y_(t={}){let e="";for(const i in t){const r=t[i];(r||Number.isFinite(r))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}function Pl(t,e){let i;switch(e){case"vertex":i=t.vs||"";break;case"fragment":i=t.fs||"";break;case"wgsl":i=t.source||"";break;default:Xs(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${r}
`),s+=`${i}
`,s}const K_=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,q_=/^\s*\#\s*endif\s*$/;function J_(t,e){var l;const i=t.split(`
`),r=[];let s=!0,a=null;for(const f of i){const u=f.match(K_),p=f.match(q_);u?(a=u[1],s=!!((l=e==null?void 0:e.defines)!=null&&l[a])):p?s=!0:s&&r.push(f)}return r.join(`
`)}const Re=class Re{constructor(){m(this,"_hookFunctions",[]);m(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Re.defaultShaderAssembler=Re.defaultShaderAssembler||new Re,Re.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const i=this._getModuleList(e.modules),r=this._hookFunctions,{source:s,getUniforms:a}=j_({...e,source:e.source,modules:i,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?J_(s):s,getUniforms:a,modules:i}}assembleGLSLShaderPair(e){const i=this._getModuleList(e.modules),r=this._hookFunctions;return{...X_({...e,vs:e.vs,fs:e.fs,modules:i,hookFunctions:r}),modules:i}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),r={};let s=0;for(let a=0,l=this._defaultModules.length;a<l;++a){const f=this._defaultModules[a],u=f.name;i[s++]=f,r[u]=!0}for(let a=0,l=e.length;a<l;++a){const f=e[a],u=f.name;r[u]||(i[s++]=f,r[u]=!0)}return i.length=s,bn(i),i}};m(Re,"defaultShaderAssembler");let cs=Re;class Q_{constructor(){m(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Xn({id:e})),this.stats.get(e)}}const Ml=new Q_,N=new Bi({id:"luma.gl"}),Ur={};function $n(t="id"){Ur[t]=Ur[t]||1;const e=Ur[t]++;return`${t}-${e}`}var Gr;let st=(Gr=class{constructor(e,i,r){m(this,"id");m(this,"props");m(this,"userData",{});m(this,"_device");m(this,"destroyed",!1);m(this,"allocatedBytes",0);m(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=G_(i,r);const s=this.props.id!=="undefined"?this.props.id:$n(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},m(Gr,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Gr);function G_(t,e){const i={...e};for(const r in t)t[r]!==void 0&&(i[r]=t[r]);return i}const Et=class Et extends st{constructor(i,r){const s={...r};(r.usage||0)&Et.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?s.indexType="uint32":r.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(i,s,Et.defaultProps);m(this,"usage");m(this,"indexType");m(this,"updateTimestamp");m(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(i){return this.device.createBuffer({...this.props,...i})}readSyncWebGL(i,r){throw new Error("not implemented")}_setDebugData(i,r,s){const a=ArrayBuffer.isView(i)?i.buffer:i,l=Math.min(i?i.byteLength:s,Et.DEBUG_DATA_MAX_LENGTH);a===null?this.debugData=new ArrayBuffer(l):r===0&&s===a.byteLength?this.debugData=a.slice(0,l):this.debugData=a.slice(r,r+l)}};m(Et,"defaultProps",{...st.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),m(Et,"MAP_READ",1),m(Et,"MAP_WRITE",2),m(Et,"COPY_SRC",4),m(Et,"COPY_DST",8),m(Et,"INDEX",16),m(Et,"VERTEX",32),m(Et,"UNIFORM",64),m(Et,"STORAGE",128),m(Et,"INDIRECT",256),m(Et,"QUERY_RESOLVE",512),m(Et,"DEBUG_DATA_MAX_LENGTH",32);let qt=Et;function Cl(t){const e=Xa[t],i=tp(e),r=t.includes("norm"),s=!r&&!t.startsWith("float"),a=t.startsWith("s");return{dataType:Xa[t],byteLength:i,integer:s,signed:a,normalized:r}}function tp(t){return ep[t]}const Xa={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},ep={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Rt="texture-compression-bc",it="texture-compression-astc",$t="texture-compression-etc2",ip="texture-compression-etc1-webgl",on="texture-compression-pvrtc-webgl",Lr="texture-compression-atc-webgl",an="float32-renderable-webgl",kr="float16-renderable-webgl",np="rgb9e5ufloat-renderable-webgl",zr="snorm8-renderable-webgl",yi="norm16-renderable-webgl",Vr="snorm16-renderable-webgl",cn="float32-filterable",Za="float16-filterable-webgl";function Il(t){const e=rp[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const rp={r8unorm:{},r8snorm:{render:zr},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:zr},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:kr,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:yi},"r16snorm-webgl":{f:Vr},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:zr},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:kr,filter:Za},"rg16unorm-webgl":{render:yi},"rg16snorm-webgl":{render:Vr},r32uint:{},r32sint:{},r32float:{render:an,filter:cn},rgb9e5ufloat:{channels:"rgb",packed:!0,render:np},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:an},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:yi},"rgb16snorm-webgl":{f:yi},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:cn},rgba16uint:{},rgba16sint:{},rgba16float:{render:kr,filter:Za},"rgba16unorm-webgl":{render:yi},"rgba16snorm-webgl":{render:Vr},"rgb32float-webgl":{render:an,filter:cn},rgba32uint:{},rgba32sint:{},rgba32float:{render:an,filter:cn},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Rt},"bc1-rgb-unorm-srgb-webgl":{f:Rt},"bc1-rgba-unorm":{f:Rt},"bc1-rgba-unorm-srgb":{f:Rt},"bc2-rgba-unorm":{f:Rt},"bc2-rgba-unorm-srgb":{f:Rt},"bc3-rgba-unorm":{f:Rt},"bc3-rgba-unorm-srgb":{f:Rt},"bc4-r-unorm":{f:Rt},"bc4-r-snorm":{f:Rt},"bc5-rg-unorm":{f:Rt},"bc5-rg-snorm":{f:Rt},"bc6h-rgb-ufloat":{f:Rt},"bc6h-rgb-float":{f:Rt},"bc7-rgba-unorm":{f:Rt},"bc7-rgba-unorm-srgb":{f:Rt},"etc2-rgb8unorm":{f:$t},"etc2-rgb8unorm-srgb":{f:$t},"etc2-rgb8a1unorm":{f:$t},"etc2-rgb8a1unorm-srgb":{f:$t},"etc2-rgba8unorm":{f:$t},"etc2-rgba8unorm-srgb":{f:$t},"eac-r11unorm":{f:$t},"eac-r11snorm":{f:$t},"eac-rg11unorm":{f:$t},"eac-rg11snorm":{f:$t},"astc-4x4-unorm":{f:it},"astc-4x4-unorm-srgb":{f:it},"astc-5x4-unorm":{f:it},"astc-5x4-unorm-srgb":{f:it},"astc-5x5-unorm":{f:it},"astc-5x5-unorm-srgb":{f:it},"astc-6x5-unorm":{f:it},"astc-6x5-unorm-srgb":{f:it},"astc-6x6-unorm":{f:it},"astc-6x6-unorm-srgb":{f:it},"astc-8x5-unorm":{f:it},"astc-8x5-unorm-srgb":{f:it},"astc-8x6-unorm":{f:it},"astc-8x6-unorm-srgb":{f:it},"astc-8x8-unorm":{f:it},"astc-8x8-unorm-srgb":{f:it},"astc-10x5-unorm":{f:it},"astc-10x5-unorm-srgb":{f:it},"astc-10x6-unorm":{f:it},"astc-10x6-unorm-srgb":{f:it},"astc-10x8-unorm":{f:it},"astc-10x8-unorm-srgb":{f:it},"astc-10x10-unorm":{f:it},"astc-10x10-unorm-srgb":{f:it},"astc-12x10-unorm":{f:it},"astc-12x10-unorm-srgb":{f:it},"astc-12x12-unorm":{f:it},"astc-12x12-unorm-srgb":{f:it},"pvrtc-rgb4unorm-webgl":{f:on},"pvrtc-rgba4unorm-webgl":{f:on},"pvrtc-rbg2unorm-webgl":{f:on},"pvrtc-rgba2unorm-webgl":{f:on},"etc1-rbg-unorm-webgl":{f:ip},"atc-rgb-unorm-webgl":{f:Lr},"atc-rgba-unorm-webgl":{f:Lr},"atc-rgbai-unorm-webgl":{f:Lr}},sp=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],op=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function Ol(t){return sp.some(e=>t.startsWith(e))}function Zs(t){let e=ap(t);if(Ol(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=cp(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const i=op.exec(t);if(i){const[,r,s,a,l,f]=i,u=`${a}${s}`,p=Cl(u),g=p.byteLength*8,T=r.length,v=[g,T>=2?g:0,T>=3?g:0,T>=4?g:0];e={format:t,attachment:e.attachment,dataType:p.dataType,components:T,channels:r,integer:p.integer,signed:p.signed,normalized:p.normalized,bitsPerChannel:v,bytesPerPixel:p.byteLength*r.length,packed:e.packed,srgb:e.srgb},f==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function ap(t){var a;const e=Il(t),i=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((a=e.channels)==null?void 0:a.length)||1,bytesPerPixel:i,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function cp(t){const i=/.*-(\d+)x(\d+)-.*/.exec(t);if(i){const[,r,s]=i;return{blockWidth:Number(r),blockHeight:Number(s)}}return null}function lp(t){const e=Il(t),i={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=Zs(t),s=t.startsWith("depth")||t.startsWith("stencil"),a=r==null?void 0:r.signed,l=r==null?void 0:r.integer,f=r==null?void 0:r.webgl;return i.render&&(i.render=!a),i.filter&&(i.filter=!s&&!a&&!l&&!f),i}class hp{}class fp{constructor(e=[],i){m(this,"features");m(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){var i;return!((i=this.disabledFeatures)!=null&&i[e])&&this.features.has(e)}}const Dn=class Dn{constructor(e){m(this,"id");m(this,"props");m(this,"userData",{});m(this,"statsManager",Ml);m(this,"timestamp",0);m(this,"_reused",!1);m(this,"_lumaData",{});this.props={...Dn.defaultProps,...e},this.id=this.props.id||$n(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const i=lp(e),r=l=>(typeof l=="string"?this.features.has(l):l)??!0,s=r(i.create),a={format:e,create:s,render:s&&r(i.render),filter:s&&r(i.filter),blend:s&&r(i.blend),store:s&&r(i.store)};return this._getDeviceSpecificTextureFormatCapabilities(a)}isTextureFormatSupported(e,i){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Ol(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&qt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":N.warn("indices buffer content must be of integer type")()),i}};m(Dn,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>N.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:N.get("debug")||void 0,debugShaders:N.get("debug-shaders")||void 0,debugFramebuffers:!!N.get("debug-framebuffers"),debugWebGL:!!N.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let ge=Dn;const up=Ie()&&typeof document<"u",dp=()=>up&&document.readyState==="complete",_p="set luma.log.level=1 (or higher) to trace rendering",$a="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",de=class de{constructor(){m(this,"stats",Ml);m(this,"log",N);m(this,"VERSION","9.1.5");m(this,"spector");m(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw N.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),N.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");N.error("This version of luma.gl has already been initialized")()}N.log(1,`${this.VERSION} - ${_p}`)(),globalThis.luma=this}registerAdapters(e){for(const i of e)this.preregisteredAdapters.set(i.type,i)}getSupportedAdapters(e=[]){const i=this.getAdapterMap(e);return Array.from(i).map(([,r])=>r).filter(r=>{var s;return(s=r.isSupported)==null?void 0:s.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,s,a,l;const i=this.getAdapterMap(e);return(s=(r=i.get("webgpu"))==null?void 0:r.isSupported)!=null&&s.call(r)?"webgpu":(l=(a=i.get("webgl"))==null?void 0:a.isSupported)!=null&&l.call(a)?"webgl":null}setDefaultDeviceProps(e){Object.assign(de.defaultProps,e)}async createDevice(e={}){var f;e={...de.defaultProps,...e},e.waitForPageLoad&&await de.pageLoaded;const i=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const a=(this.getAdapterMap(e.adapters)||i).get(r),l=await((f=a==null?void 0:a.create)==null?void 0:f.call(a,e));if(l)return l;throw new Error($a)}async attachDevice(e){var l;const i=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await de.pageLoaded,e.handle===null&&(r="unknown");const s=i.get(r),a=await((l=s==null?void 0:s.attach)==null?void 0:l.call(s,null));if(a)return a;throw new Error($a)}enforceWebGL2(e=!0,i=[]){var a;const s=this.getAdapterMap(i).get("webgl");s||N.warn("enforceWebGL2: webgl adapter not found")(),(a=s==null?void 0:s.enforceWebGL2)==null||a.call(s,e)}getAdapterMap(e=[]){const i=new Map(this.preregisteredAdapters);for(const r of e)i.set(r.type,r);return i}registerDevices(e){N.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const i of e){const r=i.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};m(de,"defaultProps",{...ge.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),m(de,"pageLoaded",pp().then(()=>{N.probe(2,"DOM is loaded")()}));let ls=de;const hs=new ls;function pp(){return dp()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class gp{}const Bn=class Bn{constructor(e){m(this,"id");m(this,"props");m(this,"canvas");m(this,"htmlCanvas");m(this,"offscreenCanvas");m(this,"type");m(this,"width",1);m(this,"height",1);m(this,"resizeObserver");m(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Bn.defaultProps,...e},e=this.props,!Ie()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Tp(e.canvas):this.canvas=e.canvas;else{const i=vp(e),r=mp((e==null?void 0:e.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const r of i)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){var e;try{const[i]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?i/r:1}catch{return 1}}cssToDevicePixels(e,i=!0){const r=this.cssToDeviceRatio(),[s,a]=this.getDrawingBufferSize();return yp(e,r,s,a,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let r="width"in i?i.width:this.htmlCanvas.clientWidth,s="height"in i?i.height:this.htmlCanvas.clientHeight;(!r||!s)&&(N.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==r||a.clientHeight!==s||a.devicePixelRatio!==e){let l=e;const f=Math.floor(r*l),u=Math.floor(s*l);if(this.htmlCanvas.width=f,this.htmlCanvas.height=u,this.device.gl){const[g,T]=this.getDrawingBufferSize();(g!==f||T!==u)&&(l=Math.min(g/r,T/s),this.htmlCanvas.width=Math.floor(r*l),this.htmlCanvas.height=Math.floor(s*l),N.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};m(Bn,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let fs=Bn;function mp(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function Tp(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function vp(t){const{width:e,height:i}=t,r=document.createElement("canvas");return r.id=$n("lumagl-auto-created-canvas"),r.width=e||1,r.height=i||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(i)?`${i}px`:"100%",r}function yp(t,e,i,r,s){const a=t,l=Ya(a[0],e,i);let f=Ka(a[1],e,r,s),u=Ya(a[0]+1,e,i);const p=u===i-1?u:u-1;u=Ka(a[1]+1,e,r,s);let g;return s?(u=u===0?u:u+1,g=f,f=u):g=u===r-1?u:u-1,{x:l,y:f,width:Math.max(p-l+1,1),height:Math.max(g-f+1,1)}}function Ya(t,e,i){return Math.min(Math.round(t*e),i-1)}function Ka(t,e,i,r){return r?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const At=class At extends st{constructor(i,r){r=At.normalizeProps(i,r);super(i,r,At.defaultProps);m(this,"dimension");m(this,"format");m(this,"width");m(this,"height");m(this,"depth");m(this,"mipLevels");m(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=At.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?At.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(i){return this.device.createTexture({...this.props,...i})}static isExternalImage(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}static getExternalImageSize(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(i){const r=i==null?void 0:i.data;return ArrayBuffer.isView(r)}static getTextureDataSize(i){if(!i||ArrayBuffer.isView(i))return null;if(Array.isArray(i))return At.getTextureDataSize(i[0]);if(At.isExternalImage(i))return At.getExternalImageSize(i);if(i&&typeof i=="object"&&i.constructor===Object){const s=Object.values(i)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(i,r){let s;return ArrayBuffer.isView(i)?s=[{data:i,width:r.width,height:r.height}]:Array.isArray(i)?s=i:s=[i],s}static getMipLevelCount(i,r){return Math.floor(Math.log2(Math.max(i,r)))+1}static getCubeFaceDepth(i){switch(i){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(i)}}static normalizeProps(i,r){var u,p;const s={...r},a=((p=(u=i==null?void 0:i.props)==null?void 0:u._resourceDefaults)==null?void 0:p.texture)||{};Object.assign(s,a);const{width:l,height:f}=s;return typeof l=="number"&&(s.width=Math.max(1,Math.ceil(l))),typeof f=="number"&&(s.height=Math.max(1,Math.ceil(f))),s}};m(At,"COPY_SRC",1),m(At,"COPY_DST",2),m(At,"TEXTURE",4),m(At,"STORAGE",8),m(At,"RENDER_ATTACHMENT",16),m(At,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),m(At,"defaultProps",{...st.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),m(At,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let gt=At;const Fn=class Fn extends st{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,Fn.defaultProps)}};m(Fn,"defaultProps",{...st.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let us=Fn;function Ep(t,e,i){let r="";const s=e.split(/\r?\n/),a=t.slice().sort((l,f)=>l.lineNum-f.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let l=0;for(let f=1;f<=s.length;f++)for(r+=xl(s[f-1],f,i);a.length>l&&a[l].lineNum===f;){const u=a[l++];r+=qa(u,s,u.lineNum,{...i,inlineSource:!1})}return r;case"issues":case"no":for(const f of t)r+=qa(f,s,f.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return r}}function qa(t,e,i,r){if(r!=null&&r.inlineSource){const a=Ap(e,i),l=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${a}${l}${t.type.toUpperCase()}: ${t.message}

`}const s=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function Ap(t,e,i){let r="";for(let s=e-2;s<=e;s++){const a=t[s-1];a!==void 0&&(r+=xl(a,e,i))}return r}function xl(t,e,i){const r=i!=null&&i.html?Rp(t):t;return`${Sp(String(e),4)}: ${r}${i!=null&&i.html?"<br/>":`
`}`}function Sp(t,e){let i="";for(let r=t.length;r<e;++r)i+=" ";return i+t}function Rp(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Un=class Un extends st{constructor(i,r){r={...r,debugShaders:r.debugShaders||i.props.debugShaders||"errors"};super(i,{id:bp(r),...r},Un.defaultProps);m(this,"stage");m(this,"source");m(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const i=this.props.debugShaders;switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();i==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(i){var p;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=Nl(this.source),s=`${this.stage} ${r}`;let a=Ep(i,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const f=document.createElement("Button");f.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,f.style.top="10px",f.style.left="10px",f.style.position="absolute",f.style.zIndex="9999",f.style.width="100%",f.style.textAlign="left",document.body.appendChild(f),(p=document.getElementsByClassName("luma-compiler-log-error")[0])==null||p.scrollIntoView(),f.onclick=()=>{const g=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(g)}}};m(Un,"defaultProps",{...st.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let ds=Un;function bp(t){return Nl(t.source)||t.id||$n(`unnamed ${t.stage}-shader`)}function Nl(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const xi=class xi extends st{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){i=xi.normalizeProps(e,i),super(e,i,xi.defaultProps)}static normalizeProps(e,i){var a,l;const r=((l=(a=e==null?void 0:e.props)==null?void 0:a._resourceDefaults)==null?void 0:l.sampler)||{};return{...i,...r}}};m(xi,"defaultProps",{...st.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let _s=xi;const Ln=class Ln extends st{constructor(i,r={}){super(i,r,Ln.defaultProps);m(this,"width");m(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(i){const r=this.colorAttachments.map(a=>a.texture.clone(i)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(i);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:s})}resize(i){let r=!i;if(i){const[s,a]=Array.isArray(i)?i:[i.width,i.height];r=r||a!==this.height||s!==this.width,this.width=s,this.height=a}r&&(N.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,s)=>{if(typeof r=="string"){const a=this.createColorTexture(r,s);return this.attachResource(a),a.view}return r instanceof gt?r.view:r});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const r=this.createDepthStencilTexture(i);this.attachResource(r),this.depthStencilAttachment=r.view}else i instanceof gt?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:gt.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(i){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:gt.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,r){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const a=this.colorAttachments[s].texture.clone({width:i,height:r});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:i,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};m(Ln,"defaultProps",{...st.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let wn=Ln;const kn=class kn extends st{constructor(i,r){super(i,r,kn.defaultProps);m(this,"shaderLayout");m(this,"bufferLayout");m(this,"linkStatus","pending");m(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};m(kn,"defaultProps",{...st.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let ps=kn;const zt=class zt extends st{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){i=zt.normalizeProps(e,i),super(e,i,zt.defaultProps)}static normalizeProps(e,i){var a;return{...(a=e.props._resourceDefaults)==null?void 0:a.renderPass,...i}}};m(zt,"defaultClearColor",[0,0,0,1]),m(zt,"defaultClearDepth",1),m(zt,"defaultClearStencil",0),m(zt,"defaultProps",{...st.defaultProps,framebuffer:null,parameters:void 0,clearColor:zt.defaultClearColor,clearColors:void 0,clearDepth:zt.defaultClearDepth,clearStencil:zt.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let gs=zt;const zn=class zn extends st{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,zn.defaultProps)}};m(zn,"defaultProps",{...st.defaultProps,measureExecutionTime:void 0});let ms=zn;const Vn=class Vn extends st{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,Vn.defaultProps)}};m(Vn,"defaultProps",{...st.defaultProps});let Ts=Vn;function wp(t){const[e,i]=Mp[t],r=e==="i32"||e==="u32",s=e!=="u32",a=Cp[e]*i,l=Pp(e,i);return{dataType:e,components:i,defaultVertexFormat:l,byteLength:a,integer:r,signed:s}}function Pp(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const Mp={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Cp={f32:4,f16:2,i32:4,u32:4};function Dl(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,r]=t.split("x"),s=i,a=r?parseInt(r):1,l=Cl(s),f={type:s,components:a,byteLength:l.byteLength*a,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(f.webglOnly=!0),f}function Ip(t,e){const i={};for(const r of t.attributes){const s=xp(t,e,r.name);s&&(i[r.name]=s)}return i}function Op(t,e,i=16){const r=Ip(t,e),s=new Array(i).fill(null);for(const a of Object.values(r))s[a.location]=a;return s}function xp(t,e,i){const r=Np(t,i),s=Dp(e,i);if(!r)return null;const a=wp(r.type),l=(s==null?void 0:s.vertexFormat)||a.defaultVertexFormat,f=Dl(l);return{attributeName:(s==null?void 0:s.attributeName)||r.name,bufferName:(s==null?void 0:s.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:l,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:a.integer,stepMode:(s==null?void 0:s.stepMode)||r.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function Np(t,e){const i=t.attributes.find(r=>r.name===e);return i||N.warn(`shader layout attribute "${e}" not present in shader`),i||null}function Dp(t,e){Bp(t);let i=Fp(t,e);return i||(i=Up(t,e),i)?i:(N.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Bp(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&N.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Fp(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function Up(t,e){var i;for(const r of t){let s=r.byteStride;if(typeof r.byteStride!="number")for(const l of r.attributes||[]){const f=Dl(l.format);s+=f.byteLength}const a=(i=r.attributes)==null?void 0:i.find(l=>l.attribute===e);if(a)return{attributeName:a.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:s}}return null}const Wn=class Wn extends st{constructor(i,r){super(i,r,Wn.defaultProps);m(this,"maxVertexAttributes");m(this,"attributeInfos");m(this,"indexBuffer",null);m(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:a}=r.renderPipeline||{};if(!s||!a)throw new Error("VertexArray");this.attributeInfos=Op(s,a,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,r){this.device.reportError(new Error("constant attributes not supported"))}};m(Wn,"defaultProps",{...st.defaultProps,renderPipeline:null});let vs=Wn;const Hn=class Hn extends st{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,Hn.defaultProps)}};m(Hn,"defaultProps",{...st.defaultProps,layout:void 0,buffers:{}});let ys=Hn;const jn=class jn extends st{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,jn.defaultProps)}};m(jn,"defaultProps",{...st.defaultProps,type:void 0,count:void 0});let Es=jn,ln;function Lp(t){return(!ln||ln.byteLength<t)&&(ln=new ArrayBuffer(t)),ln}function kp(t,e){const i=Lp(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}const zp={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...zp}};const Ft=globalThis.mathgl.config;function Vp(t,{precision:e=Ft.precision}={}){return t=Wp(t),`${parseFloat(t.toPrecision(e))}`}function Ge(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _e(t,e,i){return jp(t,r=>Math.max(e,Math.min(i,r)))}function As(t,e,i){return Ge(t)?t.map((r,s)=>As(r,e[s],i)):i*e+(1-i)*t}function Ni(t,e,i){const r=Ft.EPSILON;try{if(t===e)return!0;if(Ge(t)&&Ge(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!Ni(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ft.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ft.EPSILON=r}}function Wp(t){return Math.round(t/Ft.EPSILON)*Ft.EPSILON}function Hp(t){return t.clone?t.clone():new Array(t.length)}function jp(t,e,i){if(Ge(t)){const r=t;i=i||Hp(r);for(let s=0;s<i.length&&s<r.length;++s){const a=typeof t=="number"?t:t[s];i[s]=e(a,s,i)}return i}return e(t)}class Bl extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+i];return this.check()}toArray(e=[],i=0){for(let r=0;r<this.ELEMENTS;++r)e[i+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ge(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ft)}formatString(e){let i="";for(let r=0;r<this.ELEMENTS;++r)i+=(r>0?", ":"")+Vp(this[r],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!Ni(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,r){if(r===void 0)return this.lerp(this,e,i);for(let s=0;s<this.ELEMENTS;++s){const a=e[s],l=typeof i=="number"?i:i[s];this[s]=a+r*(l-a)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),i[r]);return this.check()}add(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=i[r];return this.check()}subtract(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=i[r];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Ft.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),i);return this.check()}get elements(){return this}}function Xp(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function Ot(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Wr(t,e,i=""){if(Ft.debug&&!Xp(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function Ja(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Zp extends Bl{get x(){return this[0]}set x(e){this[0]=Ot(e)}get y(){return this[1]}set y(e){this[1]=Ot(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];i+=s*s}return Ot(i)}dot(e){let i=0;for(let r=0;r<this.ELEMENTS;++r)i+=this[r]*e[r];return Ot(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=i[r];return this.check()}divide(...e){for(const i of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=i[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Ja(e>=0&&e<this.ELEMENTS,"index is out of range"),Ot(this[e])}setComponent(e,i){return Ja(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Tn=1e-6;let ti=typeof Float32Array<"u"?Float32Array:Array;function $p(){const t=new ti(2);return ti!=Float32Array&&(t[0]=0,t[1]=0),t}function Qa(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Yp(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Fl(t,e,i,r){const s=e[0],a=e[1];return t[0]=s+r*(i[0]-s),t[1]=a+r*(i[1]-a),t}function Kp(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}(function(){const t=$p();return function(e,i,r,s,a,l){let f,u;for(i||(i=2),r||(r=0),s?u=Math.min(s*i+r,e.length):u=e.length,f=r;f<u;f+=i)t[0]=e[f],t[1]=e[f+1],a(t,t,l),e[f]=t[0],e[f+1]=t[1];return e}})();function qp(t,e,i){const r=e[0],s=e[1],a=i[3]*r+i[7]*s||1;return t[0]=(i[0]*r+i[4]*s)/a,t[1]=(i[1]*r+i[5]*s)/a,t}function Ul(t,e,i){const r=e[0],s=e[1],a=e[2],l=i[3]*r+i[7]*s+i[11]*a||1;return t[0]=(i[0]*r+i[4]*s+i[8]*a)/l,t[1]=(i[1]*r+i[5]*s+i[9]*a)/l,t[2]=(i[2]*r+i[6]*s+i[10]*a)/l,t}function Jp(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t[2]=e[2],t}function Qp(){const t=new ti(3);return ti!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Gp(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function tg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eg(t,e,i){const r=e[0],s=e[1],a=e[2],l=i[0],f=i[1],u=i[2];return t[0]=s*u-a*f,t[1]=a*l-r*u,t[2]=r*f-s*l,t}function Ll(t,e,i){const r=e[0],s=e[1],a=e[2];let l=i[3]*r+i[7]*s+i[11]*a+i[15];return l=l||1,t[0]=(i[0]*r+i[4]*s+i[8]*a+i[12])/l,t[1]=(i[1]*r+i[5]*s+i[9]*a+i[13])/l,t[2]=(i[2]*r+i[6]*s+i[10]*a+i[14])/l,t}function ig(t,e,i){const r=e[0],s=e[1],a=e[2];return t[0]=r*i[0]+s*i[3]+a*i[6],t[1]=r*i[1]+s*i[4]+a*i[7],t[2]=r*i[2]+s*i[5]+a*i[8],t}function ng(t,e,i){const r=i[0],s=i[1],a=i[2],l=i[3],f=e[0],u=e[1],p=e[2];let g=s*p-a*u,T=a*f-r*p,v=r*u-s*f,E=s*v-a*T,b=a*g-r*v,S=r*T-s*g;const w=l*2;return g*=w,T*=w,v*=w,E*=2,b*=2,S*=2,t[0]=f+g+E,t[1]=u+T+b,t[2]=p+v+S,t}function rg(t,e,i,r){const s=[],a=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function sg(t,e,i,r){const s=[],a=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function og(t,e,i,r){const s=[],a=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function ag(t,e){const i=t[0],r=t[1],s=t[2],a=e[0],l=e[1],f=e[2],u=Math.sqrt((i*i+r*r+s*s)*(a*a+l*l+f*f)),p=u&&tg(t,e)/u;return Math.acos(Math.min(Math.max(p,-1),1))}(function(){const t=Qp();return function(e,i,r,s,a,l){let f,u;for(i||(i=3),r||(r=0),s?u=Math.min(s*i+r,e.length):u=e.length,f=r;f<u;f+=i)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],a(t,t,l),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}})();const Hr=[0,0,0];let hn;class Jt extends Zp{static get ZERO(){return hn||(hn=new Jt(0,0,0),Object.freeze(hn)),hn}constructor(e=0,i=0,r=0){super(-0,-0,-0),arguments.length===1&&Ge(e)?this.copy(e):(Ft.debug&&(Ot(e),Ot(i),Ot(r)),this[0]=e,this[1]=i,this[2]=r)}set(e,i,r){return this[0]=e,this[1]=i,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ft.debug&&(Ot(e.x),Ot(e.y),Ot(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ot(e)}angle(e){return ag(this,e)}cross(e){return eg(this,this,e),this.check()}rotateX({radians:e,origin:i=Hr}){return rg(this,this,i,e),this.check()}rotateY({radians:e,origin:i=Hr}){return sg(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=Hr}){return og(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Ll(this,this,e),this.check()}transformAsVector(e){return Ul(this,this,e),this.check()}transformByMatrix3(e){return ig(this,this,e),this.check()}transformByMatrix2(e){return Jp(this,this,e),this.check()}transformByQuaternion(e){return ng(this,this,e),this.check()}}class cg extends Bl{toString(){let e="[";if(Ft.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,r){return this[i*this.RANK+e]=Ot(r),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)i[s]=this[r+s];return i}setColumn(e,i){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=i[s];return this}}function lg(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hg(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],a=e[6],l=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=s,t[13]=l,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ss(t,e){const i=e[0],r=e[1],s=e[2],a=e[3],l=e[4],f=e[5],u=e[6],p=e[7],g=e[8],T=e[9],v=e[10],E=e[11],b=e[12],S=e[13],w=e[14],I=e[15],C=i*f-r*l,M=i*u-s*l,O=i*p-a*l,B=r*u-s*f,D=r*p-a*f,tt=s*p-a*u,z=g*S-T*b,W=g*w-v*b,Q=g*I-E*b,U=T*w-v*S,K=T*I-E*S,Tt=v*I-E*w;let j=C*Tt-M*K+O*U+B*Q-D*W+tt*z;return j?(j=1/j,t[0]=(f*Tt-u*K+p*U)*j,t[1]=(s*K-r*Tt-a*U)*j,t[2]=(S*tt-w*D+I*B)*j,t[3]=(v*D-T*tt-E*B)*j,t[4]=(u*Q-l*Tt-p*W)*j,t[5]=(i*Tt-s*Q+a*W)*j,t[6]=(w*O-b*tt-I*M)*j,t[7]=(g*tt-v*O+E*M)*j,t[8]=(l*K-f*Q+p*z)*j,t[9]=(r*Q-i*K-a*z)*j,t[10]=(b*D-S*O+I*C)*j,t[11]=(T*O-g*D-E*C)*j,t[12]=(f*W-l*U-u*z)*j,t[13]=(i*U-r*W+s*z)*j,t[14]=(S*M-b*B-w*C)*j,t[15]=(g*B-T*M+v*C)*j,t):null}function fg(t){const e=t[0],i=t[1],r=t[2],s=t[3],a=t[4],l=t[5],f=t[6],u=t[7],p=t[8],g=t[9],T=t[10],v=t[11],E=t[12],b=t[13],S=t[14],w=t[15],I=e*l-i*a,C=e*f-r*a,M=i*f-r*l,O=p*b-g*E,B=p*S-T*E,D=g*S-T*b,tt=e*D-i*B+r*O,z=a*D-l*B+f*O,W=p*M-g*C+T*I,Q=E*M-b*C+S*I;return u*tt-s*z+w*W-v*Q}function we(t,e,i){const r=e[0],s=e[1],a=e[2],l=e[3],f=e[4],u=e[5],p=e[6],g=e[7],T=e[8],v=e[9],E=e[10],b=e[11],S=e[12],w=e[13],I=e[14],C=e[15];let M=i[0],O=i[1],B=i[2],D=i[3];return t[0]=M*r+O*f+B*T+D*S,t[1]=M*s+O*u+B*v+D*w,t[2]=M*a+O*p+B*E+D*I,t[3]=M*l+O*g+B*b+D*C,M=i[4],O=i[5],B=i[6],D=i[7],t[4]=M*r+O*f+B*T+D*S,t[5]=M*s+O*u+B*v+D*w,t[6]=M*a+O*p+B*E+D*I,t[7]=M*l+O*g+B*b+D*C,M=i[8],O=i[9],B=i[10],D=i[11],t[8]=M*r+O*f+B*T+D*S,t[9]=M*s+O*u+B*v+D*w,t[10]=M*a+O*p+B*E+D*I,t[11]=M*l+O*g+B*b+D*C,M=i[12],O=i[13],B=i[14],D=i[15],t[12]=M*r+O*f+B*T+D*S,t[13]=M*s+O*u+B*v+D*w,t[14]=M*a+O*p+B*E+D*I,t[15]=M*l+O*g+B*b+D*C,t}function Pn(t,e,i){const r=i[0],s=i[1],a=i[2];let l,f,u,p,g,T,v,E,b,S,w,I;return e===t?(t[12]=e[0]*r+e[4]*s+e[8]*a+e[12],t[13]=e[1]*r+e[5]*s+e[9]*a+e[13],t[14]=e[2]*r+e[6]*s+e[10]*a+e[14],t[15]=e[3]*r+e[7]*s+e[11]*a+e[15]):(l=e[0],f=e[1],u=e[2],p=e[3],g=e[4],T=e[5],v=e[6],E=e[7],b=e[8],S=e[9],w=e[10],I=e[11],t[0]=l,t[1]=f,t[2]=u,t[3]=p,t[4]=g,t[5]=T,t[6]=v,t[7]=E,t[8]=b,t[9]=S,t[10]=w,t[11]=I,t[12]=l*r+g*s+b*a+e[12],t[13]=f*r+T*s+S*a+e[13],t[14]=u*r+v*s+w*a+e[14],t[15]=p*r+E*s+I*a+e[15]),t}function $s(t,e,i){const r=i[0],s=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ug(t,e,i,r){let s=r[0],a=r[1],l=r[2],f=Math.sqrt(s*s+a*a+l*l),u,p,g,T,v,E,b,S,w,I,C,M,O,B,D,tt,z,W,Q,U,K,Tt,j,Wt;return f<Tn?null:(f=1/f,s*=f,a*=f,l*=f,p=Math.sin(i),u=Math.cos(i),g=1-u,T=e[0],v=e[1],E=e[2],b=e[3],S=e[4],w=e[5],I=e[6],C=e[7],M=e[8],O=e[9],B=e[10],D=e[11],tt=s*s*g+u,z=a*s*g+l*p,W=l*s*g-a*p,Q=s*a*g-l*p,U=a*a*g+u,K=l*a*g+s*p,Tt=s*l*g+a*p,j=a*l*g-s*p,Wt=l*l*g+u,t[0]=T*tt+S*z+M*W,t[1]=v*tt+w*z+O*W,t[2]=E*tt+I*z+B*W,t[3]=b*tt+C*z+D*W,t[4]=T*Q+S*U+M*K,t[5]=v*Q+w*U+O*K,t[6]=E*Q+I*U+B*K,t[7]=b*Q+C*U+D*K,t[8]=T*Tt+S*j+M*Wt,t[9]=v*Tt+w*j+O*Wt,t[10]=E*Tt+I*j+B*Wt,t[11]=b*Tt+C*j+D*Wt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function kl(t,e,i){const r=Math.sin(i),s=Math.cos(i),a=e[4],l=e[5],f=e[6],u=e[7],p=e[8],g=e[9],T=e[10],v=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*s+p*r,t[5]=l*s+g*r,t[6]=f*s+T*r,t[7]=u*s+v*r,t[8]=p*s-a*r,t[9]=g*s-l*r,t[10]=T*s-f*r,t[11]=v*s-u*r,t}function dg(t,e,i){const r=Math.sin(i),s=Math.cos(i),a=e[0],l=e[1],f=e[2],u=e[3],p=e[8],g=e[9],T=e[10],v=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s-p*r,t[1]=l*s-g*r,t[2]=f*s-T*r,t[3]=u*s-v*r,t[8]=a*r+p*s,t[9]=l*r+g*s,t[10]=f*r+T*s,t[11]=u*r+v*s,t}function zl(t,e,i){const r=Math.sin(i),s=Math.cos(i),a=e[0],l=e[1],f=e[2],u=e[3],p=e[4],g=e[5],T=e[6],v=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s+p*r,t[1]=l*s+g*r,t[2]=f*s+T*r,t[3]=u*s+v*r,t[4]=p*s-a*r,t[5]=g*s-l*r,t[6]=T*s-f*r,t[7]=v*s-u*r,t}function _g(t,e){const i=e[0],r=e[1],s=e[2],a=e[3],l=i+i,f=r+r,u=s+s,p=i*l,g=r*l,T=r*f,v=s*l,E=s*f,b=s*u,S=a*l,w=a*f,I=a*u;return t[0]=1-T-b,t[1]=g+I,t[2]=v-w,t[3]=0,t[4]=g-I,t[5]=1-p-b,t[6]=E+S,t[7]=0,t[8]=v+w,t[9]=E-S,t[10]=1-p-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pg(t,e,i,r,s,a,l){const f=1/(i-e),u=1/(s-r),p=1/(a-l);return t[0]=a*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(i+e)*f,t[9]=(s+r)*u,t[10]=(l+a)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*a*2*p,t[15]=0,t}function gg(t,e,i,r,s){const a=1/Math.tan(e/2);if(t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const l=1/(r-s);t[10]=(s+r)*l,t[14]=2*s*r*l}else t[10]=-1,t[14]=-2*r;return t}const mg=gg;function Tg(t,e,i,r,s,a,l){const f=1/(e-i),u=1/(r-s),p=1/(a-l);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+i)*f,t[13]=(s+r)*u,t[14]=(l+a)*p,t[15]=1,t}const vg=Tg;function yg(t,e,i,r){let s,a,l,f,u,p,g,T,v,E;const b=e[0],S=e[1],w=e[2],I=r[0],C=r[1],M=r[2],O=i[0],B=i[1],D=i[2];return Math.abs(b-O)<Tn&&Math.abs(S-B)<Tn&&Math.abs(w-D)<Tn?lg(t):(T=b-O,v=S-B,E=w-D,s=1/Math.sqrt(T*T+v*v+E*E),T*=s,v*=s,E*=s,a=C*E-M*v,l=M*T-I*E,f=I*v-C*T,s=Math.sqrt(a*a+l*l+f*f),s?(s=1/s,a*=s,l*=s,f*=s):(a=0,l=0,f=0),u=v*f-E*l,p=E*a-T*f,g=T*l-v*a,s=Math.sqrt(u*u+p*p+g*g),s?(s=1/s,u*=s,p*=s,g*=s):(u=0,p=0,g=0),t[0]=a,t[1]=u,t[2]=T,t[3]=0,t[4]=l,t[5]=p,t[6]=v,t[7]=0,t[8]=f,t[9]=g,t[10]=E,t[11]=0,t[12]=-(a*b+l*S+f*w),t[13]=-(u*b+p*S+g*w),t[14]=-(T*b+v*S+E*w),t[15]=1,t)}function Eg(){const t=new ti(4);return ti!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ag(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Yn(t,e,i){const r=e[0],s=e[1],a=e[2],l=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*a+i[12]*l,t[1]=i[1]*r+i[5]*s+i[9]*a+i[13]*l,t[2]=i[2]*r+i[6]*s+i[10]*a+i[14]*l,t[3]=i[3]*r+i[7]*s+i[11]*a+i[15]*l,t}(function(){const t=Eg();return function(e,i,r,s,a,l){let f,u;for(i||(i=4),r||(r=0),s?u=Math.min(s*i+r,e.length):u=e.length,f=r;f<u;f+=i)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],a(t,t,l),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}})();var Rs;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Rs||(Rs={}));const Sg=45*Math.PI/180,Rg=1,jr=.1,Xr=500,bg=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Qt extends cg{static get IDENTITY(){return Pg()}static get ZERO(){return wg()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Rs}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,r,s,a,l,f,u,p,g,T,v,E,b,S,w){return this[0]=e,this[1]=i,this[2]=r,this[3]=s,this[4]=a,this[5]=l,this[6]=f,this[7]=u,this[8]=p,this[9]=g,this[10]=T,this[11]=v,this[12]=E,this[13]=b,this[14]=S,this[15]=w,this.check()}setRowMajor(e,i,r,s,a,l,f,u,p,g,T,v,E,b,S,w){return this[0]=e,this[1]=a,this[2]=p,this[3]=E,this[4]=i,this[5]=l,this[6]=g,this[7]=b,this[8]=r,this[9]=f,this[10]=T,this[11]=S,this[12]=s,this[13]=u,this[14]=v,this[15]=w,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(bg)}fromObject(e){return this.check()}fromQuaternion(e){return _g(this,e),this.check()}frustum(e){const{left:i,right:r,bottom:s,top:a,near:l=jr,far:f=Xr}=e;return f===1/0?Mg(this,i,r,s,a,l):pg(this,i,r,s,a,l,f),this.check()}lookAt(e){const{eye:i,center:r=[0,0,0],up:s=[0,1,0]}=e;return yg(this,i,r,s),this.check()}ortho(e){const{left:i,right:r,bottom:s,top:a,near:l=jr,far:f=Xr}=e;return vg(this,i,r,s,a,l,f),this.check()}orthographic(e){const{fovy:i=Sg,aspect:r=Rg,focalDistance:s=1,near:a=jr,far:l=Xr}=e;Ga(i);const f=i/2,u=s*Math.tan(f),p=u*r;return this.ortho({left:-p,right:p,bottom:-u,top:u,near:a,far:l})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:r=1,near:s=.1,far:a=500}=e;return Ga(i),mg(this,i,r,s,a),this.check()}determinant(){return fg(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),s=1/r[0],a=1/r[1],l=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*a,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*a,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const r=this.getScale(i),s=1/r[0],a=1/r[1],l=1/r[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*a,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*a,e[8]=this[10]*l,e}transpose(){return hg(this,this),this.check()}invert(){return Ss(this,this),this.check()}multiplyLeft(e){return we(this,e,this),this.check()}multiplyRight(e){return we(this,this,e),this.check()}rotateX(e){return kl(this,this,e),this.check()}rotateY(e){return dg(this,this,e),this.check()}rotateZ(e){return zl(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return ug(this,this,e,i),this.check()}scale(e){return $s(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Pn(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Yn(i||[-0,-0,-0,-0],e,this),Wr(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:r}=e;let s;switch(r){case 2:s=Kp(i||[-0,-0],e,this);break;case 3:s=Ll(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Wr(s,e.length),s}transformAsVector(e,i){let r;switch(e.length){case 2:r=qp(i||[-0,-0],e,this);break;case 3:r=Ul(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Wr(r,e.length),r}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,r){return this.identity().translate([e,i,r])}}let fn,un;function wg(){return fn||(fn=new Qt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(fn)),fn}function Pg(){return un||(un=new Qt,Object.freeze(un)),un}function Ga(t){if(t>Math.PI*2)throw Error("expected radians")}function Mg(t,e,i,r,s,a){const l=2*a/(i-e),f=2*a/(s-r),u=(i+e)/(i-e),p=(s+r)/(s-r),g=-1,T=-1,v=-2*a;return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=u,t[9]=p,t[10]=g,t[11]=T,t[12]=0,t[13]=0,t[14]=v,t[15]=0,t}const Cg=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Ig={name:"fp32",vs:Cg},tc=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Og={name:"layer",vs:tc,fs:tc,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},xg=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Vl="#define SMOOTH_EDGE_RADIUS 0.5",Ng=`${Vl}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Dg=`${Vl}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Wl={name:"geometry",source:xg,vs:Ng,fs:Dg},Bg=25;var pt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(pt||(pt={}));var mt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(mt||(mt={}));var H;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(H||(H={}));const Fg="compute",Ug="auto",bs="manipulation",vn="none",ws="pan-x",Ps="pan-y";function Lg(t){if(t.includes(vn))return vn;const e=t.includes(ws),i=t.includes(Ps);return e&&i?vn:e||i?e?ws:Ps:t.includes(bs)?bs:Ug}class kg{constructor(e,i){this.actions="",this.manager=e,this.set(i)}set(e){e===Fg&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const i of this.manager.recognizers)i.options.enable&&(e=e.concat(i.getTouchAction()));return Lg(e.join(" "))}}function Mn(t){return t.trim().split(/\s+/g)}function Zr(t,e,i){if(t)for(const r of Mn(e))t.addEventListener(r,i,!1)}function $r(t,e,i){if(t)for(const r of Mn(e))t.removeEventListener(r,i,!1)}function ec(t){return(t.ownerDocument||t).defaultView}function zg(t,e){let i=t;for(;i;){if(i===e)return!0;i=i.parentNode}return!1}function Hl(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let i=0,r=0,s=0;for(;s<e;)i+=t[s].clientX,r+=t[s].clientY,s++;return{x:Math.round(i/e),y:Math.round(r/e)}}function ic(t){const e=[];let i=0;for(;i<t.pointers.length;)e[i]={clientX:Math.round(t.pointers[i].clientX),clientY:Math.round(t.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:e,center:Hl(e),deltaX:t.deltaX,deltaY:t.deltaY}}function jl(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function nc(t,e){const i=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(i*i+r*r)}function Vg(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.atan2(r,i)*180/Math.PI}function rc(t,e){const i=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,i)*180/Math.PI}function Xl(t,e){return t===e?mt.None:Math.abs(t)>=Math.abs(e)?t<0?mt.Left:mt.Right:e<0?mt.Up:mt.Down}function Wg(t,e){const i=e.center;let r=t.offsetDelta,s=t.prevDelta;const a=t.prevInput;return(e.eventType===pt.Start||(a==null?void 0:a.eventType)===pt.End)&&(s=t.prevDelta={x:(a==null?void 0:a.deltaX)||0,y:(a==null?void 0:a.deltaY)||0},r=t.offsetDelta={x:i.x,y:i.y}),{deltaX:s.x+(i.x-r.x),deltaY:s.y+(i.y-r.y)}}function Zl(t,e,i){return{x:e/t||0,y:i/t||0}}function Hg(t,e){return nc(e[0],e[1])/nc(t[0],t[1])}function jg(t,e){return rc(e[1],e[0])-rc(t[1],t[0])}function Xg(t,e){const i=t.lastInterval||e,r=e.timeStamp-i.timeStamp;let s,a,l,f;if(e.eventType!==pt.Cancel&&(r>Bg||i.velocity===void 0)){const u=e.deltaX-i.deltaX,p=e.deltaY-i.deltaY,g=Zl(r,u,p);a=g.x,l=g.y,s=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,f=Xl(u,p),t.lastInterval=e}else s=i.velocity,a=i.velocityX,l=i.velocityY,f=i.direction;e.velocity=s,e.velocityX=a,e.velocityY=l,e.direction=f}function Zg(t,e){const{session:i}=t,{pointers:r}=e,{length:s}=r;i.firstInput||(i.firstInput=ic(e)),s>1&&!i.firstMultiple?i.firstMultiple=ic(e):s===1&&(i.firstMultiple=!1);const{firstInput:a,firstMultiple:l}=i,f=l?l.center:a.center,u=e.center=Hl(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=Vg(f,u),e.distance=jl(f,u);const{deltaX:p,deltaY:g}=Wg(i,e);e.deltaX=p,e.deltaY=g,e.offsetDirection=Xl(e.deltaX,e.deltaY);const T=Zl(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=l?Hg(l.pointers,r):1,e.rotation=l?jg(l.pointers,r):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length;let v=t.element;return zg(e.srcEvent.target,v)&&(v=e.srcEvent.target),e.target=v,Xg(i,e),e}function $g(t,e,i){const r=i.pointers.length,s=i.changedPointers.length,a=e&pt.Start&&r-s===0,l=e&(pt.End|pt.Cancel)&&r-s===0;i.isFirst=!!a,i.isFinal=!!l,a&&(t.session={}),i.eventType=e;const f=Zg(t,i);t.emit("hammer.input",f),t.recognize(f),t.session.prevInput=f}let Yg=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=i=>{this.manager.options.enable&&this.handler(i)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,i){$g(this.manager,e,i)}init(){Zr(this.element,this.evEl,this.domHandler),Zr(this.target,this.evTarget,this.domHandler),Zr(ec(this.element),this.evWin,this.domHandler)}destroy(){$r(this.element,this.evEl,this.domHandler),$r(this.target,this.evTarget,this.domHandler),$r(ec(this.element),this.evWin,this.domHandler)}};const Kg={pointerdown:pt.Start,pointermove:pt.Move,pointerup:pt.End,pointercancel:pt.Cancel,pointerout:pt.Cancel},qg="pointerdown",Jg="pointermove pointerup pointercancel";class Qg extends Yg{constructor(e){super(e),this.evEl=qg,this.evWin=Jg,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:i}=this;let r=!1;const s=Kg[e.type],a=e.pointerType,l=a==="touch";let f=i.findIndex(u=>u.pointerId===e.pointerId);s&pt.Start&&(e.buttons||l)?f<0&&(i.push(e),f=i.length-1):s&(pt.End|pt.Cancel)&&(r=!0),!(f<0)&&(i[f]=e,this.callback(s,{pointers:i,changedPointers:[e],eventType:s,pointerType:a,srcEvent:e}),r&&i.splice(f,1))}}const Gg=["","webkit","Moz","MS","ms","o"];function tm(t,e){const i=e[0].toUpperCase()+e.slice(1);for(const r of Gg){const s=r?r+i:e;if(s in t)return s}}const em=1,sc=2,oc={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class im{constructor(e,i){this.options={...oc,...i,cssProps:{...oc.cssProps,...i.cssProps},inputTarget:i.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Qg(this),this.touchAction=new kg(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?sc:em}recognize(e){const{session:i}=this;if(i.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:s}=this;let{curRecognizer:a}=i;(!a||a&&a.state&H.Recognized)&&(a=i.curRecognizer=null);let l=0;for(;l<s.length;)r=s[l],i.stopped!==sc&&(!a||r===a||r.canRecognizeWith(a))?r.recognize(e):r.reset(),!a&&r.state&(H.Began|H.Changed|H.Ended)&&(a=i.curRecognizer=r),l++}get(e){const{recognizers:i}=this;for(let r=0;r<i.length;r++)if(i[r].options.event===e)return i[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const i=this.get(e.options.event);return i&&this.remove(i),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const i=typeof e=="string"?this.get(e):e;if(i){const{recognizers:r}=this,s=r.indexOf(i);s!==-1&&(r.splice(s,1),this.touchAction.update())}return this}on(e,i){if(!e||!i)return;const{handlers:r}=this;for(const s of Mn(e))r[s]=r[s]||[],r[s].push(i)}off(e,i){if(!e)return;const{handlers:r}=this;for(const s of Mn(e))i?r[s]&&r[s].splice(r[s].indexOf(i),1):delete r[s]}emit(e,i){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const s=i;s.type=e,s.preventDefault=function(){i.srcEvent.preventDefault()};let a=0;for(;a<r.length;)r[a](s),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:i}=this;if(i){for(const[r,s]of Object.entries(this.options.cssProps)){const a=tm(i.style,r);e?(this.oldCssProps[a]=i.style[a],i.style[a]=s):i.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let nm=1;function rm(){return nm++}function ac(t){return t&H.Cancelled?"cancel":t&H.Ended?"end":t&H.Changed?"move":t&H.Began?"start":""}class $l{constructor(e){this.options=e,this.id=rm(),this.state=H.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{simultaneous:r}=this;return r[i.id]||(r[i.id]=i,i.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let i;return typeof e=="string"?i=this.manager.get(e):i=e,i&&delete this.simultaneous[i.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{requireFail:r}=this;return r.indexOf(i)===-1&&(r.push(i),i.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let i;if(typeof e=="string"?i=this.manager.get(e):i=e,i){const r=this.requireFail.indexOf(i);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:i}=this;i<H.Ended&&this.manager.emit(this.options.event+ac(i),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),i>=H.Ended&&this.manager.emit(this.options.event+ac(i),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=H.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(H.Failed|H.Possible)))return!1;e++}return!0}recognize(e){const i={...e};if(!this.options.enable){this.reset(),this.state=H.Failed;return}this.state&(H.Recognized|H.Cancelled|H.Failed)&&(this.state=H.Possible),this.state=this.process(i),this.state&(H.Began|H.Changed|H.Ended|H.Cancelled)&&this.tryEmit(i)}getEventNames(){return[this.options.event]}reset(){}}class Yl extends $l{attrTest(e){const i=this.options.pointers;return i===0||e.pointers.length===i}process(e){const{state:i}=this,{eventType:r}=e,s=i&(H.Began|H.Changed),a=this.attrTest(e);return s&&(r&pt.Cancel||!a)?i|H.Cancelled:s||a?r&pt.End?i|H.Ended:i&H.Began?i|H.Changed:H.Began:H.Failed}}class cc extends $l{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[bs]}process(e){const{options:i}=this,r=e.pointers.length===i.pointers,s=e.distance<i.threshold,a=e.deltaTime<i.time;if(this.reset(),e.eventType&pt.Start&&this.count===0)return this.failTimeout();if(s&&a&&r){if(e.eventType!==pt.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<i.interval:!0,f=!this.pCenter||jl(this.pCenter,e.center)<i.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!f||!l?this.count=1:this.count+=1,this._input=e,this.count%i.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=H.Recognized,this.tryEmit(this._input)},i.interval),H.Began):H.Recognized}return H.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=H.Failed},this.options.interval),H.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===H.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const sm=["","start","move","end","cancel","up","down","left","right"];class lc extends Yl{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:mt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,i=[];return e&mt.Horizontal&&i.push(Ps),e&mt.Vertical&&i.push(ws),i}getEventNames(){return sm.map(e=>this.options.event+e)}directionTest(e){const{options:i}=this;let r=!0,{distance:s}=e,{direction:a}=e;const l=e.deltaX,f=e.deltaY;return a&i.direction||(i.direction&mt.Horizontal?(a=l===0?mt.None:l<0?mt.Left:mt.Right,r=l!==this.pX,s=Math.abs(e.deltaX)):(a=f===0?mt.None:f<0?mt.Up:mt.Down,r=f!==this.pY,s=Math.abs(e.deltaY))),e.direction=a,r&&s>i.threshold&&!!(a&i.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&H.Began)||!(this.state&H.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const i=mt[e.direction].toLowerCase();i&&(e.additionalEvent=this.options.event+i),super.emit(e)}}const om=["","start","move","end","cancel","in","out"];class am extends Yl{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[vn]}getEventNames(){return om.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&H.Began))}emit(e){if(e.scale!==1){const i=e.scale<1?"in":"out";e.additionalEvent=this.options.event+i}super.emit(e)}}class Kn{constructor(e,i,r){this.element=e,this.callback=i,this.options=r}}const cm=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lm=cm.indexOf("firefox")!==-1,hc=4.000244140625,hm=40,fm=.25;class um extends Kn{constructor(e,i,r){super(e,i,{enable:!0,...r}),this.handleEvent=s=>{if(!this.options.enable)return;let a=s.deltaY;globalThis.WheelEvent&&(lm&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=hm)),a!==0&&a%hc===0&&(a=Math.floor(a/hc)),s.shiftKey&&a&&(a=a*fm),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-a,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,i){e==="wheel"&&(this.options.enable=i)}}const fc=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class dm extends Kn{constructor(e,i,r){super(e,i,{enable:!0,...r}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,fc.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){fc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){switch(e){case"pointermove":this.enableMoveEvent=i;break;case"pointerover":this.enableOverEvent=i;break;case"pointerout":this.enableOutEvent=i;break;case"pointerenter":this.enableEnterEvent=i;break;case"pointerleave":this.enableLeaveEvent=i;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const uc=["keydown","keyup"];class _m extends Kn{constructor(e,i,r){super(e,i,{enable:!0,tabIndex:0,...r}),this.handleEvent=s=>{const a=s.target||s.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",uc.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){uc.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e==="keydown"&&(this.enableDownEvent=i),e==="keyup"&&(this.enableUpEvent=i)}}class pm extends Kn{constructor(e,i,r){super(e,i,r),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e==="contextmenu"&&(this.options.enable=i)}}const dc=1,Ms=2,_c=4,gm={pointerdown:dc,pointermove:Ms,pointerup:_c,mousedown:dc,mousemove:Ms,mouseup:_c},mm=0,Tm=1,vm=2,ym=1,Em=2,Am=4;function Sm(t){const e=gm[t.srcEvent.type];if(!e)return null;const{buttons:i,button:r}=t.srcEvent;let s=!1,a=!1,l=!1;return e===Ms?(s=!!(i&ym),a=!!(i&Am),l=!!(i&Em)):(s=r===mm,a=r===Tm,l=r===vm),{leftButton:s,middleButton:a,rightButton:l}}function Rm(t,e){const i=t.center;if(!i)return null;const r=e.getBoundingClientRect(),s=r.width/e.offsetWidth||1,a=r.height/e.offsetHeight||1,l={x:(i.x-r.left-e.clientLeft)/s,y:(i.y-r.top-e.clientTop)/a};return{center:i,offsetCenter:l}}const bm={srcElement:"root",priority:0};class wm{constructor(e,i){this.handleEvent=r=>{if(this.isEmpty())return;const s=this._normalizeEvent(r);let a=r.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=i,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,r,s=!1,a=!1){const{handlers:l,handlersByElement:f}=this,u={...bm,...r};let p=f.get(u.srcElement);p||(p=[],f.set(u.srcElement,p));const g={type:e,handler:i,srcElement:u.srcElement,priority:u.priority};s&&(g.once=!0),a&&(g.passive=!0),l.push(g),this._active=this._active||!g.passive;let T=p.length-1;for(;T>=0&&!(p[T].priority>=g.priority);)T--;p.splice(T+1,0,g)}remove(e,i){const{handlers:r,handlersByElement:s}=this;for(let a=r.length-1;a>=0;a--){const l=r[a];if(l.type===e&&l.handler===i){r.splice(a,1);const f=s.get(l.srcElement);f.splice(f.indexOf(l),1),f.length===0&&s.delete(l.srcElement)}}this._active=r.some(a=>!a.passive)}_emit(e,i){const r=this.handlersByElement.get(i);if(r){let s=!1;const a=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},f=[];for(let u=0;u<r.length;u++){const{type:p,handler:g,once:T}=r[u];if(g({...e,type:p,stopPropagation:a,stopImmediatePropagation:l}),T&&f.push(r[u]),s)break}for(let u=0;u<f.length;u++){const{type:p,handler:g}=f[u];this.remove(p,g)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...Sm(e),...Rm(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}function Pm(t){if("recognizer"in t)return t;let e;const i=Array.isArray(t)?[...t]:[t];if(typeof i[0]=="function"){const r=i.shift(),s=i.shift()||{};e=new r(s)}else e=i.shift();return{recognizer:e,recognizeWith:typeof i[0]=="string"?[i[0]]:i[0],requireFailure:typeof i[1]=="string"?[i[1]]:i[1]}}class Mm{constructor(e=null,i={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...i},this.events=new Map,this.element=e,!!e){this.manager=new im(e,this.options);for(const r of this.options.recognizers){const{recognizer:s,recognizeWith:a,requireFailure:l}=Pm(r);this.manager.add(s),a&&s.recognizeWith(a),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new um(e,this._onOtherEvent,{enable:!1}),this.moveInput=new dm(e,this._onOtherEvent,{enable:!1}),this.keyInput=new _m(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new pm(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,i,r){this._addEventHandler(e,i,r,!1)}once(e,i,r){this._addEventHandler(e,i,r,!0)}watch(e,i,r){this._addEventHandler(e,i,r,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){var a,l,f,u;const{manager:r}=this;if(!r)return;const s=r.get(e);s&&(s.set({enable:i}),r.touchAction.update()),(a=this.wheelInput)==null||a.enableEventType(e,i),(l=this.moveInput)==null||l.enableEventType(e,i),(f=this.keyInput)==null||f.enableEventType(e,i),(u=this.contextmenuInput)==null||u.enableEventType(e,i)}_addEventHandler(e,i,r,s,a){if(typeof e!="string"){r=i;for(const[p,g]of Object.entries(e))this._addEventHandler(p,g,r,s,a);return}const{manager:l,events:f}=this;if(!l)return;let u=f.get(e);if(!u){const p=this._getRecognizerName(e)||e;u=new wm(this,p),f.set(e,u),l&&l.on(e,u.handleEvent)}u.add(e,i,r,s,a),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const[a,l]of Object.entries(e))this._removeEventHandler(a,l);return}const{events:r}=this,s=r.get(e);if(s&&(s.remove(e,i),s.isEmpty())){const{recognizerName:a}=s;let l=!1;for(const f of r.values())if(f.recognizerName===a&&!f.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){var i;return(i=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:i.options.event}}const _t={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(_t,"IDENTITY",{get:()=>(St.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Bt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Cn={common:0,meters:1,pixels:2},Cs={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},pc={multipan:[lc,{threshold:10,direction:mt.Vertical,pointers:2}],pinch:[am,{},null,["multipan"]],pan:[lc,{threshold:1},["pinch"],["multipan"]],dblclick:[cc,{event:"dblclick",taps:2}],click:[cc,{event:"click"},null,["dblclick"]]};function Cm(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Ys(t){let e={},i;return r=>{for(const s in r)if(!Cm(r[s],e[s])){i=t(r),e=r;break}return i}}const gc=[0,0,0,0],Im=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Kl=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Om=[0,0,0],ql=[0,0,0],xm=Ys(Fm);function Nm(t,e,i=ql){i.length<3&&(i=[i[0],i[1],0]);let r=i,s,a=!0;switch(e===_t.LNGLAT_OFFSETS||e===_t.METER_OFFSETS?s=i:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Bt.WEB_MERCATOR:(e===_t.LNGLAT||e===_t.CARTESIAN)&&(s=[0,0,0],a=!1);break;case Bt.WEB_MERCATOR_AUTO_OFFSET:e===_t.LNGLAT?r=s:e===_t.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(r),r[0]-=i[0],r[1]-=i[1],r[2]-=i[2]);break;case Bt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Bt.GLOBE:a=!1,s=null;break;default:a=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:r,offsetMode:a}}function Dm(t,e,i){const{viewMatrixUncentered:r,projectionMatrix:s}=t;let{viewMatrix:a,viewProjectionMatrix:l}=t,f=gc,u=gc,p=t.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:T,offsetMode:v}=Nm(t,e,i);return v&&(u=t.projectPosition(g||T),p=[p[0]-u[0],p[1]-u[1],p[2]-u[2]],u[3]=1,f=Yn([],u,l),a=r||a,l=we([],s,a),l=we([],l,Im)),{viewMatrix:a,viewProjectionMatrix:l,projectionCenter:f,originCommon:u,cameraPosCommon:p,shaderCoordinateOrigin:T,geospatialOrigin:g}}function Bm({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:r=_t.DEFAULT,coordinateOrigin:s=ql,autoWrapLongitude:a=!1}){r===_t.DEFAULT&&(r=t.isGeospatial?_t.LNGLAT:_t.CARTESIAN);const l=xm({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:s});return l.wrapLongitude=a,l.modelMatrix=i||Kl,l}function Fm({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r}){const{projectionCenter:s,viewProjectionMatrix:a,originCommon:l,cameraPosCommon:f,shaderCoordinateOrigin:u,geospatialOrigin:p}=Dm(t,i,r),g=t.getDistanceScales(),T=[t.width*e,t.height*e],v=Yn([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,E={coordinateSystem:i,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!t._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:v,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:Om,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:Kl,cameraPosition:f};if(p){const b=t.getDistanceScales(p);switch(i){case _t.METER_OFFSETS:E.commonUnitsPerWorldUnit=b.unitsPerMeter,E.commonUnitsPerWorldUnit2=b.unitsPerMeter2;break;case _t.LNGLAT:case _t.LNGLAT_OFFSETS:t._pseudoMeters||(E.commonUnitsPerMeter=b.unitsPerMeter),E.commonUnitsPerWorldUnit=b.unitsPerDegree,E.commonUnitsPerWorldUnit2=b.unitsPerDegree2;break;case _t.CARTESIAN:E.commonUnitsPerWorldUnit=[1,1,b.unitsPerMeter[2]],E.commonUnitsPerWorldUnit2=[0,0,b.unitsPerMeter2[2]];break}}return E}const Um=Object.keys(_t).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${_t[t]};`).join(""),Lm=Object.keys(Bt).map(t=>`const PROJECTION_MODE_${t}: i32 = ${Bt[t]};`).join(""),km=Object.keys(Cn).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Cn[t]};`).join(""),zm=`${Um}
${Lm}
${km}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Vm=`${zm}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Wm=Object.keys(_t).map(t=>`const int COORDINATE_SYSTEM_${t} = ${_t[t]};`).join(""),Hm=Object.keys(Bt).map(t=>`const int PROJECTION_MODE_${t} = ${Bt[t]};`).join(""),jm=Object.keys(Cn).map(t=>`const int UNIT_${t.toUpperCase()} = ${Cn[t]};`).join(""),Xm=`${Wm}
${Hm}
${jm}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,Zm={};function $m(t=Zm){return"viewport"in t?Bm(t):{}}const Jl={name:"project",dependencies:[Ig,Wl],source:Vm,vs:Xm,getUniforms:$m,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};function Ym(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Qe(t,e){const i=Yn([],e,t);return Ag(i,i,1/i[3]),i}function mc(t,e){const i=t%e;return i<0?e+i:i}function Is(t,e,i){return t<e?e:t>i?i:t}function Km(t){return Math.log(t)*Math.LOG2E}const Ks=Math.log2||Km;function re(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Vt=Math.PI,Ql=Vt/4,Ut=Vt/180,Os=180/Vt,ei=512,In=4003e4,Tc=85.051129,qm=1.5;function Jm(t){return Ks(t)}function On(t){const[e,i]=t;re(Number.isFinite(e)),re(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const r=e*Ut,s=i*Ut,a=ei*(r+Vt)/(2*Vt),l=ei*(Vt+Math.log(Math.tan(Ql+s*.5)))/(2*Vt);return[a,l]}function ii(t){const[e,i]=t,r=e/ei*(2*Vt)-Vt,s=2*(Math.atan(Math.exp(i/ei*(2*Vt)-Vt))-Ql);return[r*Os,s*Os]}function Qm(t){const{latitude:e}=t;re(Number.isFinite(e));const i=Math.cos(e*Ut);return Jm(In*i)-9}function Yr(t){const e=Math.cos(t*Ut);return ei/In/e}function xs(t){const{latitude:e,longitude:i,highPrecision:r=!1}=t;re(Number.isFinite(e)&&Number.isFinite(i));const s=ei,a=Math.cos(e*Ut),l=s/360,f=l/a,u=s/In/a,p={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[l,f,u],degreesPerUnit:[1/l,1/f,1/u]};if(r){const g=Ut*Math.tan(e*Ut)/a,T=l*g/2,v=s/In*g,E=v/f*u;p.unitsPerDegree2=[0,T,v],p.unitsPerMeter2=[E,0,E]}return p}function Gm(t,e){const[i,r,s]=t,[a,l,f]=e,{unitsPerMeter:u,unitsPerMeter2:p}=xs({longitude:i,latitude:r,highPrecision:!0}),g=On(t);g[0]+=a*(u[0]+p[0]*l),g[1]+=l*(u[1]+p[1]*l);const T=ii(g),v=(s||0)+(f||0);return Number.isFinite(s)||Number.isFinite(f)?[T[0],T[1],v]:T}function tT(t){const{height:e,pitch:i,bearing:r,altitude:s,scale:a,center:l}=t,f=Ym();Pn(f,f,[0,0,-s]),kl(f,f,-i*Ut),zl(f,f,r*Ut);const u=a/e;return $s(f,f,[u,u,u]),l&&Pn(f,f,Gp([],l)),f}function eT(t){const{width:e,height:i,altitude:r,pitch:s=0,offset:a,center:l,scale:f,nearZMultiplier:u=1,farZMultiplier:p=1}=t;let{fovy:g=xn(qm)}=t;r!==void 0&&(g=xn(r));const T=g*Ut,v=s*Ut,E=Gl(g);let b=E;l&&(b+=l[2]*f/Math.cos(v)/i);const S=T*(.5+(a?a[1]:0)/i),w=Math.sin(S)*b/Math.sin(Is(Math.PI/2-v-S,.01,Math.PI-.01)),I=Math.sin(v)*w+b,C=b*10,M=Math.min(I*p,C);return{fov:T,aspect:e/i,focalDistance:E,near:u,far:M}}function xn(t){return 2*Math.atan(.5/t)*Os}function Gl(t){return .5/Math.tan(.5*t*Ut)}function iT(t,e){const[i,r,s=0]=t;return re(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(s)),Qe(e,[i,r,s,1])}function qs(t,e,i=0){const[r,s,a]=t;if(re(Number.isFinite(r)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(a))return Qe(e,[r,s,a,1]);const l=Qe(e,[r,s,0,1]),f=Qe(e,[r,s,1,1]),u=l[2],p=f[2],g=u===p?0:((i||0)-u)/(p-u);return Fl([],l,f,g)}function nT(t){const{width:e,height:i,bounds:r,minExtent:s=0,maxZoom:a=24,offset:l=[0,0]}=t,[[f,u],[p,g]]=r,T=rT(t.padding),v=On([f,Is(g,-85.051129,Tc)]),E=On([p,Is(u,-85.051129,Tc)]),b=[Math.max(Math.abs(E[0]-v[0]),s),Math.max(Math.abs(E[1]-v[1]),s)],S=[e-T.left-T.right-Math.abs(l[0])*2,i-T.top-T.bottom-Math.abs(l[1])*2];re(S[0]>0&&S[1]>0);const w=S[0]/b[0],I=S[1]/b[1],C=(T.right-T.left)/2/w,M=(T.top-T.bottom)/2/I,O=[(E[0]+v[0])/2+C,(E[1]+v[1])/2+M],B=ii(O),D=Math.min(a,Ks(Math.abs(Math.min(w,I))));return re(Number.isFinite(D)),{longitude:B[0],latitude:B[1],zoom:D}}function rT(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(re(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const vc=Math.PI/180;function sT(t,e=0){const{width:i,height:r,unproject:s}=t,a={targetZ:e},l=s([0,r],a),f=s([i,r],a);let u,p;const g=t.fovy?.5*t.fovy*vc:Math.atan(.5/t.altitude),T=(90-t.pitch)*vc;return g>T-.01?(u=yc(t,0,e),p=yc(t,i,e)):(u=s([0,0],a),p=s([i,0],a)),[l,f,p,u]}function yc(t,e,i){const{pixelUnprojectionMatrix:r}=t,s=Qe(r,[e,0,1,1]),a=Qe(r,[e,t.height,1,1]),f=(i*t.distanceScales.unitsPerMeter[2]-s[2])/(a[2]-s[2]),u=Fl([],s,a,f),p=ii(u);return p.push(i),p}const Ec=512;function oT(t){const{width:e,height:i,pitch:r=0}=t;let{longitude:s,latitude:a,zoom:l,bearing:f=0}=t;(s<-180||s>180)&&(s=mc(s+180,360)-180),(f<-180||f>180)&&(f=mc(f+180,360)-180);const u=Ks(i/Ec);if(l<=u)l=u,a=0;else{const p=i/2/Math.pow(2,l),g=ii([0,p])[1];if(a<g)a=g;else{const T=ii([0,Ec-p])[1];a>T&&(a=T)}}return{width:e,height:i,longitude:s,latitude:a,zoom:l,pitch:r,bearing:f}}const th=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,aT=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,cT=`
${th}
${aT}
`,lT=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,hT=`
${th}
${lT}
`,fT=Ys(gT),uT=Ys(mT),dT=[0,0,0,1],_T=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function pT(t,e){const[i,r,s]=t,a=qs([i,r,s],e);return Number.isFinite(s)?a:[a[0],a[1],0]}function gT({viewport:t,center:e}){return new Qt(t.viewProjectionMatrix).invert().transform(e)}function mT({viewport:t,shadowMatrices:e}){const i=[],r=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,a=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(l=>pT(l,r));for(const l of e){const f=l.clone().translate(new Jt(t.center).negate()),u=a.map(g=>f.transform(g)),p=new Qt().ortho({left:Math.min(...u.map(g=>g[0])),right:Math.max(...u.map(g=>g[0])),bottom:Math.min(...u.map(g=>g[1])),top:Math.max(...u.map(g=>g[1])),near:Math.min(...u.map(g=>-g[2])),far:Math.max(...u.map(g=>-g[2]))});i.push(p.multiplyRight(l))}return i}function TT(t){const{shadowEnabled:e=!0,project:i}=t;if(!e||!i||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=Jl.getUniforms(i),s=fT({viewport:i.viewport,center:r.center}),a=[],l=uT({shadowMatrices:t.shadowMatrices,viewport:i.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const p=l[u],g=p.clone().translate(new Jt(i.viewport.center).negate());r.coordinateSystem===_t.LNGLAT&&r.projectionMode===Bt.WEB_MERCATOR?(l[u]=g,a[u]=s):(l[u]=p.clone().multiplyRight(_T),a[u]=g.transform(s))}const f={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||dT,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<l.length;u++)f[`viewProjectionMatrix${u}`]=l[u],f[`projectCenter${u}`]=a[u];for(let u=0;u<2;u++)f[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return f}const Ac={name:"shadow",dependencies:[Jl],vs:cT,fs:hT,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:TT,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},vT=[Wl],yT=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],ET=[];function AT(t){const e=cs.getDefaultShaderAssembler();for(const r of vT)e.addDefaultModule(r);const i=t==="glsl"?yT:ET;for(const r of i)e.addShaderHook(r);return e}const ST=[255,255,255],RT=1;let bT=0;class wT{constructor(e={}){this.type="ambient";const{color:i=ST}=e,{intensity:r=RT}=e;this.id=e.id||`ambient-${bT++}`,this.color=i,this.intensity=r}}const PT=[255,255,255],MT=1,CT=[0,0,-1];let IT=0;class Sc{constructor(e={}){this.type="directional";const{color:i=PT}=e,{intensity:r=MT}=e,{direction:s=CT}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${IT++}`,this.color=i,this.intensity=r,this.type="directional",this.direction=new Jt(s).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class OT{constructor(e,i={id:"pass"}){const{id:r}=i;this.id=r,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Js extends OT{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,r]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,a=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,f=s?0:!1,u=e.colorMask??15,p={viewport:[0,0,i,r]};e.colorMask&&(p.colorMask=u),e.scissorRect&&(p.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:p,clearColor:a,clearDepth:l,clearStencil:f});try{return this._drawLayers(g,e)}finally{g.end(),this.device.submit()}}_drawLayers(e,i){const{target:r,shaderModuleProps:s,viewports:a,views:l,onViewportActive:f,clearStack:u=!0}=i;i.pass=i.pass||"unknown",u&&(this._lastRenderIndex=-1);const p=[];for(const g of a){const T=l&&l[g.id];f==null||f(g);const v=this._getDrawLayerParams(g,i),E=g.subViewports||[g];for(const b of E){const S=this._drawLayersInViewport(e,{target:r,shaderModuleProps:s,viewport:b,view:T,pass:i.pass,layers:i.layers},v);p.push(S)}}return p}_getDrawLayerParams(e,{layers:i,pass:r,isPicking:s=!1,layerFilter:a,cullRect:l,effects:f,shaderModuleProps:u},p=!1){var b;const g=[],T=eh(this._lastRenderIndex+1),v={layer:i[0],viewport:e,isPicking:s,renderPass:r,cullRect:l},E={};for(let S=0;S<i.length;S++){const w=i[S],I=this._shouldDrawLayer(w,v,a,E),C={shouldDrawLayer:I};I&&!p&&(C.shouldDrawLayer=!0,C.layerRenderIndex=T(w,I),C.shaderModuleProps=this._getShaderModuleProps(w,f,r,u),C.layerParameters={...(b=w.context.deck)==null?void 0:b.props.parameters,...this.getLayerParameters(w,S,e)}),g[S]=C}return g}_drawLayersInViewport(e,{layers:i,shaderModuleProps:r,pass:s,target:a,viewport:l,view:f},u){const p=xT(this.device,{shaderModuleProps:r,target:a,viewport:l});if(f&&f.props.clear){const T=f.props.clear===!0?{color:!0,depth:!0}:f.props.clear;this.device.beginRenderPass({framebuffer:a,parameters:{viewport:p,scissorRect:p},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}const g={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let T=0;T<i.length;T++){const v=i[T],E=u[T],{shouldDrawLayer:b}=E;if(b&&v.props.pickable&&g.pickableCount++,v.isComposite&&g.compositeCount++,v.isDrawable&&E.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:w,layerParameters:I}=E;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),w.project&&(w.project.viewport=l),v.context.renderPass=e;try{v._drawLayer({renderPass:e,shaderModuleProps:w,uniforms:{layerIndex:S},parameters:I})}catch(C){v.raiseError(C,`drawing ${v} to ${s}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,i,r){return null}getLayerParameters(e,i,r){return e.props.parameters}_shouldDrawLayer(e,i,r,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(i))return!1;i.layer=l,l=l.parent}if(r){const f=i.layer.id;if(f in s||(s[f]=r(i)),!s[f])return!1}return e.activateViewport(i.viewport),!0}_getShaderModuleProps(e,i,r,s){var u,p;const a=this.device.canvasContext.cssToDeviceRatio(),l=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,f={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(i)for(const g of i)Rc(f,(p=g.getShaderModuleProps)==null?void 0:p.call(g,e,f));return Rc(f,this.getShaderModuleProps(e,i,f),s)}}function eh(t=0,e={}){const i={},r=(s,a)=>{const l=s.props._offset,f=s.id,u=s.parent&&s.parent.id;let p;if(u&&!(u in e)&&r(s.parent,!1),u in i){const g=i[u]=i[u]||eh(e[u],e);p=g(s,a),i[f]=g}else Number.isFinite(l)?(p=l+(e[u]||0),i[f]=null):p=t;return a&&p>=t&&(t=p+1),e[f]=p,p};return r}function xT(t,{shaderModuleProps:e,target:i,viewport:r}){var u;const s=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,a]=t.canvasContext.getDrawingBufferSize(),l=i?i.height:a,f=r;return[f.x*s,l-(f.y+f.height)*s,f.width*s,f.height*s,0,1]}function Rc(t,...e){for(const i of e)if(i)for(const r in i)t[r]?Object.assign(t[r],i[r]):t[r]=i[r];return t}class NT extends Js{constructor(e,i){super(e,i);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const i=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],a=s.width*r,l=s.height*r,f=[1,1,1,1];(a!==i.width||l!==i.height)&&i.resize({width:a,height:l}),super.render({...e,clearColor:f,target:i,pass:"shadow"})}getLayerParameters(e,i,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,i,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const DT={color:[255,255,255],intensity:1},bc=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],BT=[0,0,0,200/255];class ih{constructor(e={}){this.id="lighting-effect",this.shadowColor=BT,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),r._addDefaultShaderModule(Ac),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const i in e){const r=e[i];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:i,viewports:r,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,i){const r=this.shadow?{project:i.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:r,lighting:s,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Ac))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const r=new Qt().lookAt({eye:new Jt(i.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const r=new NT(e);this.shadowPasses[i]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:r}=this;!e&&i.length===0&&r.length===0&&(this.ambientLight=new wT(DT),this.directionalLights.push(new Sc(bc[0]),new Sc(bc[1])))}}class FT{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:r=1,type:s,padding:a=0,copy:l=!1,initialize:f=!1,maxCount:u}){const p=s||e&&e.constructor||Float32Array,g=i*r+a;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,g)}let T=1/0;u&&(T=u*r+a);const v=this._allocate(p,g,f,T);return e&&l?v.set(e):f||v.fill(0,0,4),this._release(e),v}release(e){this._release(e)}_allocate(e,i,r,s){let a=Math.max(Math.ceil(i*this.opts.overAlloc),1);a>s&&(a=s);const l=this._pool,f=e.BYTES_PER_ELEMENT*a,u=l.findIndex(p=>p.byteLength>=f);if(u>=0){const p=new e(l.splice(u,1)[0],0,a);return r&&p.fill(0),p}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:r}=e,{byteLength:s}=r,a=i.findIndex(l=>l.byteLength>=s);a<0?i.push(r):(a>0||i.length<this.opts.poolSize)&&i.splice(a,0,r),i.length>this.opts.poolSize&&i.shift()}}const UT=new FT;function Ri(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function LT(t){return[t[12],t[13],t[14]]}function kT(t){return{left:Ze(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Ze(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Ze(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Ze(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Ze(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Ze(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const wc=new Jt;function Ze(t,e,i,r){wc.set(t,e,i);const s=wc.len();return{distance:r/s,normal:new Jt(-t/s,-e/s,-i/s)}}const zT=Math.PI/180,VT=Ri(),Pc=[0,0,0],WT={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function HT({width:t,height:e,orthographic:i,fovyRadians:r,focalDistance:s,padding:a,near:l,far:f}){const u=t/e,p=i?new Qt().orthographic({fovy:r,aspect:u,focalDistance:s,near:l,far:f}):new Qt().perspective({fovy:r,aspect:u,near:l,far:f});if(a){const{left:g=0,right:T=0,top:v=0,bottom:E=0}=a,b=_e((g+t-T)/2,0,t)-t/2,S=_e((v+e-E)/2,0,e)-e/2;p[8]-=b*2/t,p[9]+=S*2/e}return p}class Li{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||WT,this.focalDistance=e.focalDistance||1,this.position=e.position||Pc,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Bt.WEB_MERCATOR:Bt.WEB_MERCATOR_AUTO_OFFSET:Bt.IDENTITY}equals(e){return e instanceof Li?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ni(e.projectionMatrix,this.projectionMatrix)&&Ni(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const r=this.projectPosition(e),s=iT(r,this.pixelProjectionMatrix),[a,l]=s,f=i?l:this.height-l;return e.length===2?[a,f]:[a,f,s[2]]}unproject(e,{topLeft:i=!0,targetZ:r}={}){const[s,a,l]=e,f=i?a:this.height-a,u=r&&r*this.distanceScales.unitsPerMeter[2],p=qs([s,f,l],this.pixelUnprojectionMatrix,u),[g,T,v]=this.unprojectPosition(p);return Number.isFinite(l)?[g,T,v]:Number.isFinite(r)?[g,T,r]:[g,T]}projectPosition(e){const[i,r]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,r,s]}unprojectPosition(e){const[i,r]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,r,s]}projectFlat(e){if(this.isGeospatial){const i=On(e);return i[1]=_e(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?ii(e):e}getBounds(e={}){const i={targetZ:e.z||0},r=this.unproject([0,0],i),s=this.unproject([this.width,0],i),a=this.unproject([0,this.height],i),l=this.unproject([this.width,this.height],i);return[Math.min(r[0],s[0],a[0],l[0]),Math.min(r[1],s[1],a[1],l[1]),Math.max(r[0],s[0],a[0],l[0]),Math.max(r[1],s[1],a[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?xs({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:r=1,height:s=1}){return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,kT(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Qm({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||xs({latitude:r,longitude:i}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:a,modelMatrix:l}=e;let f=Pc;if(a&&(f=l?new Qt(l).transformAsVector(a,[]):a),this.isGeospatial){const u=this.projectPosition([i,r,0]);this.center=new Jt(f).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(f)}_initMatrices(e){const{viewMatrix:i=VT,projectionMatrix:r=null,orthographic:s=!1,fovyRadians:a,fovy:l=75,near:f=.1,far:u=1e3,padding:p=null,focalDistance:g=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new Qt().multiplyRight(i).translate(new Jt(this.center).negate()),this.projectionMatrix=r||HT({width:this.width,height:this.height,orthographic:s,fovyRadians:a||l*zT,focalDistance:g,padding:p,near:f,far:u});const T=Ri();we(T,T,this.projectionMatrix),we(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Ss([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=LT(this.viewMatrixInverse);const v=Ri(),E=Ri();$s(v,v,[this.width/2,-this.height/2,1]),Pn(v,v,[1,-1,0]),we(E,v,this.viewProjectionMatrix),this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=Ss(Ri(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||St.warn("Pixel project matrix not invertible")()}}Li.displayName="Viewport";class Di extends Li{constructor(e={}){const{latitude:i=0,longitude:r=0,zoom:s=0,pitch:a=0,bearing:l=0,nearZMultiplier:f=.1,farZMultiplier:u=1.01,nearZ:p,farZ:g,orthographic:T=!1,projectionMatrix:v,repeat:E=!1,worldOffset:b=0,position:S,padding:w,legacyMeterSizes:I=!1}=e;let{width:C,height:M,altitude:O=1.5}=e;const B=Math.pow(2,s);C=C||1,M=M||1;let D,tt=null;if(v)O=v[5]/2,D=xn(O);else{e.fovy?(D=e.fovy,O=Gl(D)):D=xn(O);let W;if(w){const{top:Q=0,bottom:U=0}=w;W=[0,_e((Q+M-U)/2,0,M)-M/2]}tt=eT({width:C,height:M,scale:B,center:S&&[0,0,S[2]*Yr(i)],offset:W,pitch:a,fovy:D,nearZMultiplier:f,farZMultiplier:u}),Number.isFinite(p)&&(tt.near=p),Number.isFinite(g)&&(tt.far=g)}let z=tT({height:M,pitch:a,bearing:l,scale:B,altitude:O});b&&(z=new Qt().translate([512*b,0,0]).multiplyLeft(z)),super({...e,width:C,height:M,viewMatrix:z,longitude:r,latitude:i,zoom:s,...tt,fovy:D,focalDistance:O}),this.latitude=i,this.longitude=r,this.zoom=s,this.pitch=a,this.bearing=l,this.altitude=O,this.fovy=D,this.orthographic=T,this._subViewports=E?[]:null,this._pseudoMeters=I,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let s=i;s<=r;s++){const a=s?new Di({...this,worldOffset:s}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,r]=this.projectFlat(e),s=(e[2]||0)*Yr(e[1]);return[i,r,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,r]=this.unprojectFlat(e),s=(e[2]||0)/Yr(r);return[i,r,s]}addMetersToLngLat(e,i){return Gm(e,i)}panByPosition(e,i){const r=qs(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),a=Qa([],s,Yp([],r)),l=Qa([],this.center,a),[f,u]=this.unprojectFlat(l);return{longitude:f,latitude:u}}getBounds(e={}){const i=sT(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:r,height:s}=this,{longitude:a,latitude:l,zoom:f}=nT({width:r,height:s,bounds:e,...i});return new Di({width:r,height:s,longitude:a,latitude:l,zoom:f})}}Di.displayName="WebMercatorViewport";let jT=1,XT=1;class nh{constructor(){m(this,"time",0);m(this,"channels",new Map);m(this,"animations",new Map);m(this,"playing",!1);m(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:a=1}=e,l=jT++,f={time:0,delay:i,duration:r,rate:s,repeat:a};return this._setChannelTime(f,this.time),this.channels.set(l,f),l}removeChannel(e){this.channels.delete(e);for(const[i,r]of this.animations)r.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const s of i)this._setChannelTime(s,this.time);const r=this.animations.values();for(const s of r){const{animation:a,channel:l}=s;a.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const r=XT++;return this.animations.set(r,{animation:e,channel:i}),e.setTime(this.getTime(i)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const r=i-e.delay,s=e.duration*e.repeat;r>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function ZT(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function $T(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let YT=0;const KT={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:hs.stats.get(`animation-loop-${YT++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class qT{constructor(e){m(this,"device",null);m(this,"canvas",null);m(this,"props");m(this,"animationProps",null);m(this,"timeline",null);m(this,"stats");m(this,"cpuTime");m(this,"gpuTime");m(this,"frameRate");m(this,"display");m(this,"needsRedraw","initialized");m(this,"_initialized",!1);m(this,"_running",!1);m(this,"_animationFrameId",null);m(this,"_nextFramePromise",null);m(this,"_resolveNextFrame",null);m(this,"_cpuStartTime",0);m(this,"_error",null);if(this.props={...KT,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new Xn({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,s;if(this.props.onError(e),this._error=Error(),((s=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const a=document.createElement("h1");a.innerHTML=e.message,a.style.position="absolute",a.style.top="20%",a.style.left="10px",a.style.color="black",a.style.backgroundColor="red",document.body.appendChild(a)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=ZT(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&($T(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var i;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(i=this.device)==null||i.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var i,r;const e=(r=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const r=this.props.onAddHTML(i);r&&(i.innerHTML=r)}}_getSizeAndAspect(){var a,l,f,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.getPixelSize())||[1,1];let r=1;const s=(u=(f=this.device)==null?void 0:f.canvasContext)==null?void 0:u.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:e>0&&i>0&&(r=e/i),{width:e,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function JT(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function QT(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function GT(t){return JT(t)||QT(t)}const tv={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class rh extends Js{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:r,viewports:s,onViewportActive:a,pickingFBO:l,deviceRect:{x:f,y:u,width:p,height:g},cullRect:T,effects:v,pass:E="picking",pickZ:b,shaderModuleProps:S}){this.pickZ=b;const w=this._resetColorEncoder(b),I=[f,u,p,g],C=super.render({target:l,layers:e,layerFilter:i,views:r,viewports:s,onViewportActive:a,cullRect:T,effects:v==null?void 0:v.filter(O=>O.useInPicking),pass:E,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:I});return this._colorEncoderState=null,{decodePickingColor:w&&iv.bind(null,w),stats:C}}shouldDrawLayer(e){const{pickable:i,operation:r}=e.props;return i&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,i,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,i,r){const s={...e.props.parameters},{pickable:a,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:a&&l.includes("draw")&&(Object.assign(s,tv),s.blend=!0,s.blendColor=ev(this._colorEncoderState,e,r)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function ev(t,e,i){const{byLayer:r,byAlpha:s}=t;let a,l=r.get(e);return l?(l.viewports.push(i),a=l.a):(a=r.size+1,a<=255?(l={a,layer:e,viewports:[i]},r.set(e,l),s[a]=l):(St.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function iv(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const Ei={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"};function sh(t,e=()=>!0){return Array.isArray(t)?oh(t,e,[]):e(t)?[t]:[]}function oh(t,e,i){let r=-1;for(;++r<t.length;){const s=t[r];Array.isArray(s)?oh(s,e,i):e(s)&&i.push(s)}return i}class nv{constructor(e,i,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const r=++this._loadCount;let s=e;typeof e=="string"&&(s=Vd(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(a=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===r&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class rv{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:r=!1,persistent:s=!0}){let a=this._resources[e];a?a.setData(i,r):(a=new nv(e,i,this._context),this._resources[e]=a),a.persistent=s}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const r in i){const s=i[r],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:r,requestId:s="default"}){const{_resources:a,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const f=a[e];if(this._track(r,s,f,i),f)return f.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,r,s){const a=this._consumers,l=a[e]=a[e]||{};let f=l[i];const u=f&&f.resourceId&&this._resources[f.resourceId];u&&(u.unsubscribe(f),this.prune()),r&&(f?(f.onChange=s,f.resourceId=r.id):f={onChange:s,resourceId:r.id},l[i]=f,r.subscribe(f))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const sv="layerManager.setLayers",ov="layerManager.activateViewport";class av{constructor(e,i){var f;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{os(ov,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:s,viewport:a,timeline:l}=i||{};this.layers=[],this.resourceManager=new rv({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:AT(((f=e==null?void 0:e.info)==null?void 0:f.shadingLanguage)||"glsl"),defaultShaderModules:[Og],renderPass:void 0,stats:s||new Xn({id:"deck.gl"}),viewport:a||new Li({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new nh,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const s=r.getNeedsRedraw(e);i=i||s}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(r=>i.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){os(sv,this,i,e),this._lastRenderedLayers=e;const r=sh(e,Boolean);for(const s of r)s.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(r=>r.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,r=i.findIndex(s=>s.name===e.name);r>=0&&(i.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,r){r.raiseError(i,`${e} of ${r}`)}_updateLayers(e,i){const r={};for(const l of e)r[l.id]?St.warn(`Multiple old layers with same id ${l.id}`)():r[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(i,r,s),this._finalizeOldLayers(r);let a=!1;for(const l of s)if(l.hasUniformTransition()){a=`Uniform transition in ${l}`;break}this._needsUpdate=a,this.layers=s}_updateSublayersRecursively(e,i,r){for(const s of e){s.context=this.context;const a=i[s.id];a===null&&St.warn(`Multiple new layers with same id ${s.id}`)(),i[s.id]=null;let l=null;try{this._debug&&a!==s&&s.validateProps(),a?(this._transferLayerState(a,s),this._updateLayer(s)):this._initializeLayer(s),r.push(s),l=s.isComposite?s.getSubLayers():null}catch(f){this._handleError("matching",f,s)}l&&this._updateSublayersRecursively(l,i,r)}}_finalizeOldLayers(e){for(const i in e){const r=e[i];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ei.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=Ei.MATCHED,i!==e&&(e.lifecycle=Ei.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ei.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ei.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function Ce(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Ce(t[r],e[r],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!e.hasOwnProperty(a)||!Ce(t[a],e[a],i-1))return!1;return!0}return!1}class cv{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,r=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,i){const r=this.getViewports(),s={x:e[0],y:e[1]};for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.containsPixel(s)){const f=e.slice();return f[0]-=l.x,f[1]-=l.y,l.unproject(f,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=sh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ce(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):St.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const r=i.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var l;return(l=this.getView(e.id))==null?void 0:l.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,i,r,s){const a=e.controller;if(a&&r){const l={...i,...a,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!s||s.constructor!==a.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let s=e.length;s--;){const a=e[s],l=this.getViewState(a),f=a.makeViewport({viewState:l,width:this.width,height:this.height});let u=i[a.id];const p=!!a.controller;p&&!u&&(r=!0),(r||!p)&&u&&(u.finalize(),u=null),this.controllers[a.id]=this._updateController(a,l,f,u),f&&this._viewports.unshift(f)}for(const s in i){const a=i[s];a&&!this.controllers[s]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((r,s)=>!e[s].equals(i[s]))}}const lv=/([0-9]+\.?[0-9]*)(%|px)/;function ce(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=lv.exec(t);if(e&&e.length>=3){const i=e[2]==="%",r=parseFloat(e[1]);return{position:i?r/100:r,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function le(t,e){return t.relative?Math.round(t.position*e):t.position}class hv{constructor(e){const{id:i,x:r=0,y:s=0,width:a="100%",height:l="100%",padding:f=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ce(r),this._y=ce(s),this._width=ce(a),this._height=ce(l),this._padding=f&&{left:ce(f.left||0),right:ce(f.right||0),top:ce(f.top||0),bottom:ce(f.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Ce(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:r}){r=this.filterViewState(r);const s=this.getDimensions({width:e,height:i});if(!s.height||!s.width)return null;const a=this.getViewportType(r);return new a({...r,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const r in this.props.viewState)r!=="id"&&(i[r]=this.props.viewState[r]);return i}return e}getDimensions({width:e,height:i}){const r={x:le(this._x,e),y:le(this._y,i),width:le(this._width,e),height:le(this._height,i)};return this._padding&&(r.padding={left:le(this._padding.left,e),top:le(this._padding.top,i),right:le(this._padding.right,e),bottom:le(this._padding.bottom,i)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class fv{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(i=this.settings).onStart)==null||r.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:s}=this;this._handle=r.addChannel({delay:r.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Mc=()=>{},Ns={BREAK:1,SNAP_TO_END:2,IGNORE:3},uv=t=>t,dv=Ns.BREAK;class _v{constructor(e){this._onTransitionUpdate=i=>{const{time:r,settings:{interpolator:s,startProps:a,endProps:l,duration:f,easing:u}}=i,p=u(r/f),g=s.interpolateProps(a,l,p);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new fv(e.timeline),this.onViewStateChange=e.onViewStateChange||Mc,this.onStateChange=e.onStateChange||Mc}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let s=r;if(this.transition.inProgress){const{interruption:a,endProps:l}=this.transition.settings;s={...r,...a===Ns.SNAP_TO_END?l:this.propsInTransition||r}}this._triggerTransition(s,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:r}=e;return(i>0||i==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Ns.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const r=this.getControllerState(e),s=this.getControllerState(i).shortestPathFrom(r),a=i.transitionInterpolator,l=a.getDuration?a.getDuration(e,i):i.transitionDuration;if(l===0)return;const f=a.initializeProps(e,s);this.propsInTransition={};const u={duration:l,easing:i.transitionEasing||uv,interpolator:a,interruption:i.transitionInterruption||dv,startProps:f.start,endProps:f.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class pv{constructor(e){const{compare:i,extract:r,required:s}=e;this._propsToCompare=i,this._propsToExtract=r||i,this._requiredProps=s}arePropsEqual(e,i){for(const r of this._propsToCompare)if(!(r in e)||!(r in i)||!Ni(e[r],i[r]))return!1;return!0}initializeProps(e,i){const r={},s={};for(const a of this._propsToExtract)(a in e||a in i)&&(r[a]=e[a],s[a]=i[a]);return this._checkRequiredProps(r),this._checkRequiredProps(s),{start:r,end:s}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const r=e[i];pe(Number.isFinite(r)||Array.isArray(r),`${i} is required for transition`)})}}const gv=["longitude","latitude","zoom","bearing","pitch"],mv=["longitude","latitude","zoom"];class ah extends pv{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:gv,required:mv},super(r.transitionProps),this.opts=r}initializeProps(e,i){const r=super.initializeProps(e,i),{makeViewport:s,around:a}=this.opts;if(s&&a){const l=s(e),f=s(i),u=l.unproject(a);r.start.around=a,Object.assign(r.end,{around:f.project(u),aroundPosition:u,width:i.width,height:i.height})}return r}interpolateProps(e,i,r){const s={};for(const a of this._propsToExtract)s[a]=As(e[a]||0,i[a]||0,r);if(i.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...i,...s});Object.assign(s,a.panByPosition(i.aroundPosition,As(e.around,i.around,r)))}return s}}const he={transitionDuration:0},Tv=300,dn=t=>1-(1-t)*(1-t),$e={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Se={};class vv{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new _v({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return i?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:r}=this.props,{offsetCenter:s}=e;return[s.x-i,s.y-r]}isPointInBounds(e,i){const{width:r,height:s}=this.props;if(i&&i.handled)return!1;const a=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=s;return a&&i&&i.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?Tv:0;const{scrollZoom:r=!0,dragPan:s=!0,dragRotate:a=!0,doubleClickZoom:l=!0,touchZoom:f=!0,touchRotate:u=!1,keyboard:p=!0}=e,g=!!this.onViewStateChange;this.toggleEvents($e.WHEEL,g&&r),this.toggleEvents($e.PAN,g),this.toggleEvents($e.PINCH,g&&(f||u)),this.toggleEvents($e.MULTI_PAN,g&&u),this.toggleEvents($e.DOUBLE_CLICK,g&&l),this.toggleEvents($e.KEYBOARD,g&&p),this.scrollZoom=r,this.dragPan=s,this.dragRotate=a,this.doubleClickZoom=l,this.touchZoom=f,this.touchRotate=u,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(r=>{this._events[r]!==i&&(this._events[r]=i,i?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,i=null,r={}){const s={...e.getViewportProps(),...i},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),a){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const s=this.controllerState[r?"panStart":"rotateStart"]({pos:i});return this._panMove=r,this.updateViewport(s,he,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),r=this.controllerState.pan({pos:i});return this.updateViewport(r,he,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],a=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:dn},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),r=this.controllerState.rotate({pos:i});return this.updateViewport(r,he,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const r=this.getCenter(e),s=[r[0]+e.velocityX*i/2,r[1]+e.velocityY*i/2],a=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:dn},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let l=2/(1+Math.exp(-Math.abs(a*r)));a<0&&l!==0&&(l=1/l);const f=this.controllerState.zoom({pos:i,scale:l});return this.updateViewport(f,{...this._getTransitionProps({around:i}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.rotateStart({pos:i});return this.updateViewport(r,he,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const r=this.controllerState.rotate({pos:i});return this.updateViewport(r,he,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const r=this.getCenter(e),s=[r[0],r[1]+=e.velocityY*i/2],a=this.controllerState.rotate({pos:s});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:dn},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Se._startPinchRotation=e.rotation,Se._lastPinchEvent=e,this.updateViewport(r,he,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:r}=e,s=this.getCenter(e);i=i.zoom({pos:s,scale:r})}if(this.touchRotate){const{rotation:r}=e;i=i.rotate({deltaAngleX:Se._startPinchRotation-r})}return this.updateViewport(i,he,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Se._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:r}=Se;if(this.touchZoom&&i&&r&&e.scale!==r.scale){const s=this.getCenter(e);let a=this.controllerState.rotateEnd();const l=Math.log2(e.scale),f=(l-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,l+f*i/2);a=a.zoom({pos:s,scale:u}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:s}),transitionDuration:i,transitionEasing:dn},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Se._startPinchRotation=null,Se._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const r=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:i,scale:r?.5:2});return this.updateViewport(s,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:s,rotateSpeedX:a,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:f}=this;let u;const p={};switch(e.srcEvent.code){case"Minus":u=i?f.zoomOut(r).zoomOut(r):f.zoomOut(r),p.isZooming=!0;break;case"Equal":u=i?f.zoomIn(r).zoomIn(r):f.zoomIn(r),p.isZooming=!0;break;case"ArrowLeft":i?(u=f.rotateLeft(a),p.isRotating=!0):(u=f.moveLeft(s),p.isPanning=!0);break;case"ArrowRight":i?(u=f.rotateRight(a),p.isRotating=!0):(u=f.moveRight(s),p.isPanning=!0);break;case"ArrowUp":i?(u=f.rotateUp(l),p.isRotating=!0):(u=f.moveUp(s),p.isPanning=!0);break;case"ArrowDown":i?(u=f.rotateDown(l),p.isRotating=!0):(u=f.moveDown(s),p.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),p),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?he:e?{...i,transitionInterpolator:new ah({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class yv{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Cc=5,Ev=1.2;class Av extends yv{constructor(e){const{width:i,height:r,latitude:s,longitude:a,zoom:l,bearing:f=0,pitch:u=0,altitude:p=1.5,position:g=[0,0,0],maxZoom:T=20,minZoom:v=0,maxPitch:E=60,minPitch:b=0,startPanLngLat:S,startZoomLngLat:w,startRotatePos:I,startBearing:C,startPitch:M,startZoom:O,normalize:B=!0}=e;pe(Number.isFinite(a)),pe(Number.isFinite(s)),pe(Number.isFinite(l)),super({width:i,height:r,latitude:s,longitude:a,zoom:l,bearing:f,pitch:u,altitude:p,maxZoom:T,minZoom:v,maxPitch:E,minPitch:b,normalize:B,position:g},{startPanLngLat:S,startZoomLngLat:w,startRotatePos:I,startBearing:C,startPitch:M,startZoom:O}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const r=this.getState().startPanLngLat||this._unproject(i);if(!r)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:r=0}){const{startRotatePos:s,startBearing:a,startPitch:l}=this.getState();if(!s||a===void 0||l===void 0)return this;let f;return e?f=this._getNewRotation(e,s,l,a):f={bearing:a+i,pitch:l+r},this._getUpdatedState(f)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:r}){let{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(i)||this._unproject(e)),!a)return this;const{maxZoom:l,minZoom:f}=this.getViewportProps();let u=s+Math.log2(r);u=_e(u,f,l);const p=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...p.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),r={...this.getViewportProps()},{bearing:s,longitude:a}=r;return Math.abs(s-i.bearing)>180&&(r.bearing=s<0?s+360:s-360),Math.abs(a-i.longitude)>180&&(r.longitude=a<0?a+360:a-360),r}applyConstraints(e){const{maxZoom:i,minZoom:r,zoom:s}=e;e.zoom=_e(s,r,i);const{maxPitch:a,minPitch:l,pitch:f}=e;e.pitch=_e(f,l,a);const{normalize:u=!0}=e;return u&&Object.assign(e,oT(e)),e}_zoomFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.zoom({pos:[i/2,r/2],scale:e})}_panFromCenter(e){const{width:i,height:r}=this.getViewportProps();return this.pan({startPos:[i/2,r/2],pos:[i/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,r,s){const a=e[0]-i[0],l=e[1]-i[1],f=e[1],u=i[1],{width:p,height:g}=this.getViewportProps(),T=a/p;let v=0;l>0?Math.abs(g-u)>Cc&&(v=l/(u-g)*Ev):l<0&&u>Cc&&(v=1-f/u),v=_e(v,-1,1);const{minPitch:E,maxPitch:b}=this.getViewportProps(),S=s+180*T;let w=r;return v>0?w=r+v*(b-r):v<0&&(w=r-v*(E-r)),{pitch:w,bearing:S}}}class Sv extends vv{constructor(){super(...arguments),this.ControllerState=Av,this.transition={transitionDuration:300,transitionInterpolator:new ah({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Qs extends hv{constructor(e={}){super(e)}getViewportType(){return Di}get ControllerType(){return Sv}}Qs.displayName="MapView";const Rv=new ih;function bv(t,e){const i=t.order??1/0,r=e.order??1/0;return i-r}class wv{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(r=>r.id===e.id)){const r=i.findIndex(s=>bv(s,e)>0);r<0?i.push(e):i.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ce(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const s of this.effects)i[s.id]=s;const r=[];for(const s of e){const a=i[s.id];let l=s;a&&a!==s?a.setProps?(a.setProps(s.props),l=a):a.cleanup(this._context):a||s.setup(this._context),r.push(l),delete i[s.id]}for(const s in i)i[s].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(s=>s instanceof ih)||this._resolvedEffects.push(Rv),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Pv extends Js{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const Mv="deckRenderer.renderLayers";class Cv{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Pv(e),this.pickLayersPass=new rh(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const s=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const a=i.render({...r,target:s});r.effects&&this._postRender(r.effects,r),this.renderCount++,os(Mv,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const r of e)i.preRenderStats[r.id]=r.preRender(i),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[s]}))});for(const r of e)r.resize(i)}_postRender(e,i){const{renderBuffers:r}=this,s={...i,inputBuffer:r[0],swapBuffer:r[1]};for(const a of e)if(a.postRender){s.target=a.id===this.lastPostProcessEffect?i.target:void 0;const l=a.postRender(s);s.inputBuffer=l,s.swapBuffer=l===r[0]?r[1]:r[0]}}}const Iv={pickedColor:null,pickedObjectIndex:-1};function Ov({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:r,deviceRadius:s,deviceRect:a}){const{x:l,y:f,width:u,height:p}=a;let g=s*s,T=-1,v=0;for(let E=0;E<p;E++){const b=E+f-r,S=b*b;if(S>g)v+=4*u;else for(let w=0;w<u;w++){if(t[v+3]-1>=0){const C=w+l-i,M=C*C+S;M<=g&&(g=M,T=v)}v+=4}}if(T>=0){const E=t.slice(T,T+4),b=e(E);if(b){const S=Math.floor(T/4/u),w=T/4-S*u;return{...b,pickedColor:E,pickedX:l+w,pickedY:f+S}}St.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Iv}function xv({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const a=t.slice(r,r+4),l=a.join(",");if(!i.has(l)){const f=e(a);f?i.set(l,{...f,color:a}):St.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function ch({pickInfo:t,viewports:e,pixelRatio:i,x:r,y:s,z:a}){let l=e[0];e.length>1&&(l=Dv((t==null?void 0:t.pickedViewports)||e,{x:r,y:s}));let f;if(l){const u=[r-l.x,s-l.y];a!==void 0&&(u[2]=a),f=l.unproject(u)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:r,y:s,pixel:[r,s],coordinate:f,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function Nv(t){const{pickInfo:e,lastPickedInfo:i,mode:r,layers:s}=t,{pickedColor:a,pickedLayer:l,pickedObjectIndex:f}=e,u=l?[l]:[];if(r==="hover"){const T=i.index,v=i.layerId,E=l?l.props.id:null;if(E!==v||f!==T){if(E!==v){const b=s.find(S=>S.props.id===v);b&&u.unshift(b)}i.layerId=E,i.index=f,i.info=null}}const p=ch(t),g=new Map;return g.set(null,p),u.forEach(T=>{let v={...p};T===l&&(v.color=a,v.index=f,v.picked=!0),v=lh({layer:T,info:v,mode:r});const E=v.layer;T===l&&r==="hover"&&(i.info=v),g.set(E.id,v),r==="hover"&&E.updateAutoHighlight(v)}),g}function lh({layer:t,info:e,mode:i}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:r}),t=t.parent}return e}function Dv(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i];if(r.containsPixel(e))return r}return t[0]}class Bv{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new rh(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:r,viewports:s},a=this.lastPickedInfo.info){const l=a&&a.layer&&a.layer.id,f=a&&a.viewport&&a.viewport.id,u=l?r.find(v=>v.id===l):null,p=f&&s.find(v=>v.id===f)||s[0],g=p&&p.unproject([e-p.x,i-p.y]);return{...a,...{x:e,y:i,viewport:p,coordinate:g,layer:u}}}_resizeBuffer(){var i,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:r,x:s,y:a,radius:l=0,depth:f=1,mode:u="query",unproject3D:p,onViewportActive:g,effects:T}){const v=this.device.canvasContext.cssToDeviceRatio(),E=this._getPickable(e);if(!E||r.length===0)return{result:[],emptyInfo:ch({viewports:r,x:s,y:a,pixelRatio:v})};this._resizeBuffer();const b=this.device.canvasContext.cssToDevicePixels([s,a],!0),S=[b.x+Math.floor(b.width/2),b.y+Math.floor(b.height/2)],w=Math.round(l*v),{width:I,height:C}=this.pickingFBO,M=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:w,deviceWidth:I,deviceHeight:C}),O={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let B;const D=[],tt=new Set;for(let z=0;z<f;z++){let W;if(M){const U=this._drawAndSample({layers:E,views:i,viewports:r,onViewportActive:g,deviceRect:M,cullRect:O,effects:T,pass:`picking:${u}`});W=Ov({...U,deviceX:S[0],deviceY:S[1],deviceRadius:w,deviceRect:M})}else W={pickedColor:null,pickedObjectIndex:-1};let Q;if(W.pickedLayer&&p&&this.depthFBO){const{pickedColors:U}=this._drawAndSample({layers:[W.pickedLayer],views:i,viewports:r,onViewportActive:g,deviceRect:{x:W.pickedX,y:W.pickedY,width:1,height:1},cullRect:O,effects:T,pass:`picking:${u}:z`},!0);U[3]&&(Q=U[0])}W.pickedLayer&&z+1<f&&(tt.add(W.pickedLayer),W.pickedLayer.disablePickingIndex(W.pickedObjectIndex)),B=Nv({pickInfo:W,lastPickedInfo:this.lastPickedInfo,mode:u,layers:E,viewports:r,x:s,y:a,z:Q,pixelRatio:v});for(const U of B.values())U.layer&&D.push(U);if(!W.pickedColor)break}for(const z of tt)z.restorePickingColors();return{result:D,emptyInfo:B.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:r,x:s,y:a,width:l=1,height:f=1,mode:u="query",maxObjects:p=null,onViewportActive:g,effects:T}){const v=this._getPickable(e);if(!v||r.length===0)return[];this._resizeBuffer();const E=this.device.canvasContext.cssToDeviceRatio(),b=this.device.canvasContext.cssToDevicePixels([s,a],!0),S=b.x,w=b.y+b.height,I=this.device.canvasContext.cssToDevicePixels([s+l,a+f],!0),C=I.x+I.width,M=I.y,O={x:S,y:M,width:C-S,height:w-M},B=this._drawAndSample({layers:v,views:i,viewports:r,onViewportActive:g,deviceRect:O,cullRect:{x:s,y:a,width:l,height:f},effects:T,pass:`picking:${u}`}),D=xv(B),tt=new Map,z=[],W=Number.isFinite(p);for(let Q=0;Q<D.length&&!(W&&z.length>=p);Q++){const U=D[Q];let K={color:U.pickedColor,layer:null,index:U.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:E};K=lh({layer:U.pickedLayer,info:K,mode:u});const Tt=K.layer.id;tt.has(Tt)||tt.set(Tt,new Set);const j=tt.get(Tt),Wt=K.object??K.index;j.has(Wt)||(j.add(Wt),z.push(K))}return z}_drawAndSample({layers:e,views:i,viewports:r,onViewportActive:s,deviceRect:a,cullRect:l,effects:f,pass:u},p=!1){const g=p?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:i,viewports:r,onViewportActive:s,pickingFBO:g,deviceRect:a,cullRect:l,effects:f,pass:u,pickZ:p,preRenderStats:{},isPicking:!0};for(const C of f)C.useInPicking&&(T.preRenderStats[C.id]=C.preRender(T));const{decodePickingColor:v}=this.pickLayersPass.render(T),{x:E,y:b,width:S,height:w}=a,I=new(p?Float32Array:Uint8Array)(S*w*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:E,sourceY:b,sourceWidth:S,sourceHeight:w,target:I}),{pickedColors:I,decodePickingColor:v}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:r,deviceWidth:s,deviceHeight:a}){const l=Math.max(0,e-r),f=Math.max(0,i-r),u=Math.min(s,e+r+1)-l,p=Math.min(a,i+r+1)-f;return u<=0||p<=0?null:{x:l,y:f,width:u,height:p}}}const Fv={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Uv="top-left",Ic="__root";class Lv{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ce(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const r of this.resolvedWidgets)i[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)i[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const s=i[r.id];s?s.viewId!==r.viewId||s.placement!==r.placement?(this._remove(s),this._add(r)):r!==s&&(s.setProps(r.props),r=s):this._add(r),i[r.id]=null,this.resolvedWidgets.push(r)}for(const r in i){const s=i[r];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:i=null,placement:r=Uv}=e,s=e.onAdd({deck:this.deck,viewId:i});s&&this._getContainer(i,r).append(s),e._element=s}_remove(e){var i;(i=e.onRemove)==null||i.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var l;const r=e||Ic;let s=this.containers[r];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(l=this.parentElement)==null||l.append(s),this.containers[r]=s);let a=s.querySelector(`.${i}`);return a||(a=document.createElement("div"),a.className=i,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,Fv[i]),s.append(a)),a}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const r in this.containers){const s=this.lastViewports[r]||null,a=r===Ic||s,l=this.containers[r];a?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:i}px`):l.style.display="none"}}onRedraw({viewports:e,layers:i}){var s,a;const r=e.reduce((l,f)=>(l[f.id]=f,l),{});for(const l of this.getWidgets()){const{viewId:f}=l;if(f){const u=r[f];u&&(l.onViewportChange&&l.onViewportChange(u),(s=l.onRedraw)==null||s.call(l,{viewports:[u],layers:i}))}else{if(l.onViewportChange)for(const u of e)l.onViewportChange(u);(a=l.onRedraw)==null||a.call(l,{viewports:e,layers:i})}}this.lastViewports=r,this._updateContainers()}onHover(e,i){var r,s;for(const a of this.getWidgets()){const{viewId:l}=a;(!l||l===((r=e.viewport)==null?void 0:r.id))&&((s=a.onHover)==null||s.call(a,e,i))}}onEvent(e,i){var s,a;const r=Cs[i.type];if(r)for(const l of this.getWidgets()){const{viewId:f}=l;(!f||f===((s=e.viewport)==null?void 0:s.id))&&((a=l[r])==null||a.call(l,e,i))}}}const kv={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class zv{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,kv),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,r=i&&i.props.getTooltip;if(!r)return;const s=r(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,i,r){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${i}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Ye;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ye||(Ye={}));const Gs={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},dt=(t,e,i)=>e?t.enable(i):t.disable(i),Oc=(t,e,i)=>t.hint(i,e),It=(t,e,i)=>t.pixelStorei(i,e),xc=(t,e,i)=>{const r=i===36006?36009:36008;return t.bindFramebuffer(r,e)},Ai=(t,e,i)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(s,e)};function Kr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const Vv={3042:dt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:dt,2885:(t,e)=>t.cullFace(e),2929:dt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:dt,35723:Oc,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:xc,36010:xc,34964:Ai,36662:Ai,36663:Ai,35053:Ai,35055:Ai,2886:(t,e)=>t.frontFace(e),33170:Oc,2849:(t,e)=>t.lineWidth(e),32823:dt,32824:"polygonOffset",10752:"polygonOffset",35977:dt,32926:dt,32928:dt,32938:"sampleCoverage",32939:"sampleCoverage",3089:dt,3088:(t,e)=>t.scissor(...e),2960:dt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:dt,10754:dt,12288:dt,12289:dt,12290:dt,12291:dt,12292:dt,12293:dt,12294:dt,12295:dt,3333:It,3317:It,37440:It,37441:It,37443:It,3330:It,3332:It,3331:It,3314:It,32878:It,3316:It,3315:It,32877:It,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Kr(e)?e:[e,e];const[i,r]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Kr(e)&&e.length===3?[...e,...e]:e;const[i,r,s,a,l,f]=e;t.stencilFuncSeparate(1028,i,r,s),t.stencilFuncSeparate(1029,a,l,f)},stencilOp:(t,e)=>{e=Kr(e)&&e.length===3?[...e,...e]:e;const[i,r,s,a,l,f]=e;t.stencilOpSeparate(1028,i,r,s),t.stencilOpSeparate(1029,a,l,f)},viewport:(t,e)=>t.viewport(...e)};function ct(t,e,i){return e[t]!==void 0?e[t]:i[t]}const Wv={blendEquation:(t,e,i)=>t.blendEquationSeparate(ct(32777,e,i),ct(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(ct(32969,e,i),ct(32968,e,i),ct(32971,e,i),ct(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(ct(32824,e,i),ct(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(ct(32938,e,i),ct(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,ct(2962,e,i),ct(2967,e,i),ct(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,ct(34816,e,i),ct(36003,e,i),ct(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,ct(2964,e,i),ct(2965,e,i),ct(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,ct(34817,e,i),ct(34818,e,i),ct(34819,e,i))},Nc={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:i}):{valueChanged:!0}},blendColor:(t,e,i,r,s)=>t({32773:new Float32Array([e,i,r,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,r,s)=>t({32969:e,32968:i,32971:r,32970:s}),clearColor:(t,e,i,r,s)=>t({3106:new Float32Array([e,i,r,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,r,s)=>t({3107:[e,i,r,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,r,s)=>t({3088:new Int32Array([e,i,r,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,r)=>t({2962:e,2967:i,2963:r,34816:e,36003:i,36004:r}),stencilFuncSeparate:(t,e,i,r,s)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:r,[e===1028?2963:36004]:s}),stencilOp:(t,e,i,r)=>t({2964:e,2965:i,2966:r,34817:e,34818:i,34819:r}),stencilOpSeparate:(t,e,i,r,s)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:r,[e===1028?2966:34819]:s}),viewport:(t,e,i,r,s)=>t({2978:[e,i,r,s]})},Yt=(t,e)=>t.isEnabled(e),Dc={3042:Yt,2884:Yt,2929:Yt,3024:Yt,32823:Yt,32926:Yt,32928:Yt,3089:Yt,2960:Yt,35977:Yt},Hv=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ri(t,e){if(Xv(e))return;const i={};for(const s in e){const a=Number(s),l=Vv[s];l&&(typeof l=="string"?i[l]=!0:l(t,e[s],a))}const r=t.state&&t.state.cache;if(r)for(const s in i){const a=Wv[s];a(t,e,r)}}function hh(t,e=Gs){if(typeof e=="number"){const s=e,a=Dc[s];return a?a(t,s):t.getParameter(s)}const i=Array.isArray(e)?e:Object.keys(e),r={};for(const s of i){const a=Dc[s];r[s]=a?a(t,Number(s)):t.getParameter(Number(s))}return r}function jv(t){ri(t,Gs)}function Xv(t){for(const e in t)return!1;return!0}function Zv(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&r&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class Pe{constructor(e,i){m(this,"gl");m(this,"program",null);m(this,"stateStack",[]);m(this,"enable",!0);m(this,"cache",null);m(this,"log");m(this,"initialized",!1);this.gl=e,this.log=(i==null?void 0:i.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ri(this.gl,e),this.stateStack.pop()}trackState(e,i){if(this.cache=i.copyState?hh(e):Object.assign({},Gs),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Yv(e);for(const r in Nc){const s=Nc[r];$v(e,r,s)}Bc(e,"getParameter"),Bc(e,"isEnabled")}_updateCache(e){let i=!1,r;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const l=e[a],f=this.cache[a];Zv(l,f)||(i=!0,r=f,s&&!(a in s)&&(s[a]=f),this.cache[a]=l)}return{valueChanged:i,oldValue:r}}}function Bc(t,e){const i=t[e].bind(t);t[e]=function(s){if(s===void 0||Hv.has(s))return i(s);const a=Pe.get(t);return s in a.cache||(a.cache[s]=i(s)),a.enable?a.cache[s]:i(s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function $v(t,e,i){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...a){const l=Pe.get(t),{valueChanged:f,oldValue:u}=i(l._updateCache,...a);return f&&r(...a),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Yv(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const s=Pe.get(t);s.program!==r&&(e(r),s.program=r)}}function Kv(t,e,i){let r="";const s={preserveDrawingBuffer:!0,...i};let a=null;if(a||(a=t.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!a&&!i.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,a=t.getContext("webgl2",s),a.luma||(a.luma={}),a.luma.softwareRenderer=!0),a||(a=t.getContext("webgl",{}),a&&(a=null,r||(r="Your browser only supports WebGL1"))),!a)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:l,onContextRestored:f}=e;return t.addEventListener("webglcontextlost",u=>l(u),!1),t.addEventListener("webglcontextrestored",u=>f(u),!1),a.luma||(a.luma={}),a}function ni(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function qv(t,e){const i=t.getParameter(7936),r=t.getParameter(7937);ni(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,a=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),f=a||i,u=l||r,p=t.getParameter(7938),g=fh(f,u),T=Jv(f,u),v=Qv(f,u);return{type:"webgl",gpu:g,gpuType:v,gpuBackend:T,vendor:f,renderer:u,version:p,shadingLanguage:"glsl",shadingLanguageVersion:300}}function fh(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function Jv(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Qv(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(fh(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function uh(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const bi="WEBGL_compressed_texture_s3tc",wi="WEBGL_compressed_texture_s3tc_srgb",Ke="EXT_texture_compression_rgtc",qe="EXT_texture_compression_bptc",Gv="WEBGL_compressed_texture_etc",ty="WEBGL_compressed_texture_astc",ey="WEBGL_compressed_texture_etc1",iy="WEBGL_compressed_texture_pvrtc",ny="WEBGL_compressed_texture_atc",Fc="EXT_texture_norm16",Uc="EXT_render_snorm",ry="EXT_color_buffer_float",to={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Uc],"norm16-renderable-webgl":[Fc],"snorm16-renderable-webgl":[Fc,Uc],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[bi,wi,Ke,qe],"texture-compression-bc5-webgl":[Ke],"texture-compression-bc7-webgl":[qe],"texture-compression-etc2":[Gv],"texture-compression-astc":[ty],"texture-compression-etc1-webgl":[ey],"texture-compression-pvrtc-webgl":[iy],"texture-compression-atc-webgl":[ny]};function sy(t){return t in to}function oy(t,e,i){return(to[e]||[]).every(s=>ni(t,s,i))}const eo={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:ry,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:bi},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:wi},"bc1-rgba-unorm":{gl:33777,x:bi},"bc1-rgba-unorm-srgb":{gl:35916,x:wi},"bc2-rgba-unorm":{gl:33778,x:bi},"bc2-rgba-unorm-srgb":{gl:35918,x:wi},"bc3-rgba-unorm":{gl:33779,x:bi},"bc3-rgba-unorm-srgb":{gl:35919,x:wi},"bc4-r-unorm":{gl:36283,x:Ke},"bc4-r-snorm":{gl:36284,x:Ke},"bc5-rg-unorm":{gl:36285,x:Ke},"bc5-rg-snorm":{gl:36286,x:Ke},"bc6h-rgb-ufloat":{gl:36495,x:qe},"bc6h-rgb-float":{gl:36494,x:qe},"bc7-rgba-unorm":{gl:36492,x:qe},"bc7-rgba-unorm-srgb":{gl:36493,x:qe},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function ay(t,e,i){let r=e.create;const s=eo[e.format];return(s==null?void 0:s.gl)===void 0&&(r=!1),s!=null&&s.x&&(r=r&&!!ni(t,s.x,i)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function dh(t){var s;const e=eo[t],i=hy(t),r=Zs(t);return{internalFormat:i,format:(e==null?void 0:e.dataFormat)||ly(r.channels,r.integer,r.normalized,i),type:r.dataType?uh(r.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:r.compressed||!1}}function cy(t){switch(Zs(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function ly(t,e,i,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function hy(t){const e=eo[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}const Lc={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class fy extends fp{constructor(i,r,s){super([],s);m(this,"gl");m(this,"extensions");m(this,"testedFeatures",new Set);this.gl=i,this.extensions=r,ni(i,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const i=this.getFeatures();for(const r of i)this.has(r)&&(yield r);return[]}has(i){var r;return(r=this.disabledFeatures)!=null&&r[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),sy(i)&&oy(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of i)this.has(r)}getFeatures(){return[...Object.keys(Lc),...Object.keys(to)]}getWebGLFeature(i){const r=Lc[i];return typeof r=="string"?!!ni(this.gl,r,this.extensions):!!r}}class uy extends hp{constructor(i){super();m(this,"gl");m(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]||0}}class Ci extends wn{constructor(i,r){super(i,r);m(this,"device");m(this,"gl");m(this,"handle");m(this,"colorAttachments",[]);m(this,"depthStencilAttachment",null);const s=r.handle===null;this.device=i,this.gl=i.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const i=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const s=this.colorAttachments[r];if(s){const a=36064+r;this._attachTextureView(a,s)}}if(this.depthStencilAttachment){const r=cy(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${_y(r)}`)}this.gl.bindFramebuffer(36160,i)}_attachTextureView(i,r){const{gl:s}=this.device,{texture:a}=r,l=r.props.baseMipLevel,f=r.props.baseArrayLayer;switch(s.bindTexture(a.glTarget,a.handle),a.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,i,a.handle,l,f);break;case 34067:const u=dy(f);s.framebufferTexture2D(36160,i,u,a.handle,l);break;case 3553:s.framebufferTexture2D(36160,i,3553,a.handle,l);break;default:throw new Error("Illegal texture type")}s.bindTexture(a.glTarget,null)}}function dy(t){return t<34069?t+34069:t}function _y(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class py extends fs{constructor(i,r){super(r);m(this,"device");m(this,"format","rgba8unorm");m(this,"depthStencilFormat","depth24plus");m(this,"presentationSize");m(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Ci(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(r,i);return}}commit(){}}async function _h(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((s,a)=>{r.onload=s,r.onerror=l=>a(new Error(`Unable to load script '${t}': ${l}`)),i.appendChild(r)})}const gy=1;let nt=null,kc=!1;const io={debugSpectorJS:N.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function my(t){if(!globalThis.SPECTOR)try{await _h(t.debugSpectorJSUrl||io.debugSpectorJSUrl)}catch(e){N.warn(String(e))}}function Ty(t){var e;if(t={...io,...t},!t.debugSpectorJS)return null;if(!nt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){N.probe(gy,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:i}=globalThis.SPECTOR;nt=new i,globalThis.luma&&(globalThis.luma.spector=nt)}if(!nt)return null;if(kc||(kc=!0,nt.spyCanvases(),nt==null||nt.onCaptureStarted.add(i=>N.info("Spector capture started:",i)()),nt==null||nt.onCapture.add(i=>{N.info("Spector capture complete:",i)(),nt==null||nt.getResultUI(),nt==null||nt.resultView.display(),nt==null||nt.resultView.addCapture(i)})),t.gl){const i=t.gl,r=i.device;nt==null||nt.startCapture(t.gl,500),i.device=r,new Promise(s=>setTimeout(s,2e3)).then(s=>{N.info("Spector capture stopped after 2 seconds")(),nt==null||nt.stopCapture()})}return nt}const vy="https://unpkg.com/webgl-debug@2.0.1/index.js";function ph(t){return t.luma=t.luma||{},t.luma}async function yy(){Ie()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await _h(vy))}function Ey(t,e={}){return e.debugWebGL||e.traceWebGL?Sy(t,e):Ay(t)}function Ay(t){const e=ph(t);return e.realContext?e.realContext:t}function Sy(t,e){if(!globalThis.WebGLDebugUtils)return N.warn("webgl-debug not loaded")(),t;const i=ph(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...Ye,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,Ry.bind(null,e),by.bind(null,e));for(const l in Ye)!(l in r)&&typeof Ye[l]=="number"&&(r[l]=Ye[l]);class s{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,r);const a=Object.create(s);return i.realContext=t,i.debugContext=a,a.debug=!0,a}function zc(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function Ry(t,e,i,r){r=Array.from(r).map(f=>f===void 0?"undefined":f);const s=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,r),l=`${s} in gl.${i}(${a})`;N.error(l)();debugger}function by(t,e,i){let r="";N.level>=1&&(r=zc(e,i),t.traceWebGL&&N.log(1,r)());for(const s of i)if(s===void 0){r=r||zc(e,i);debugger}}const qr={};function wy(t="id"){qr[t]=qr[t]||1;const e=qr[t]++;return`${t}-${e}`}class Ii extends qt{constructor(i,r={}){super(i,r);m(this,"device");m(this,"gl");m(this,"handle");m(this,"glTarget");m(this,"glUsage");m(this,"glIndexType",5123);m(this,"byteLength");m(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const s=typeof r=="object"?r.handle:void 0;this.handle=s||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Py(this.props.usage),this.glUsage=My(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(i,r=0,s=i.byteLength+r){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,s,this.glUsage),this.gl.bufferSubData(a,r,i),this.gl.bindBuffer(a,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(i,r,s),this.trackAllocatedMemory(s)}_initWithByteLength(i){let r=i;i===0&&(r=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,r,i.byteLength)}async readAsync(i=0,r){return this.readSyncWebGL(i,r)}readSyncWebGL(i=0,r){r=r??this.byteLength-i;const s=new Uint8Array(r),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,s,a,r),this.gl.bindBuffer(36662,null),this._setDebugData(s,i,r),s}}function Py(t){return t&qt.INDEX?34963:t&qt.VERTEX?34962:t&qt.UNIFORM?35345:34962}function My(t){return t&qt.INDEX||t&qt.VERTEX?35044:t&qt.UNIFORM?35048:35044}function Cy(t){const e=t.split(/\r?\n/),i=[];for(const r of e){if(r.length<=1)continue;const s=r.split(":");if(s.length===2){const[T,v]=s;i.push({message:v.trim(),type:Vc(T),lineNum:0,linePos:0});continue}const[a,l,f,...u]=s;let p=parseInt(f,10);isNaN(p)&&(p=0);let g=parseInt(l,10);isNaN(g)&&(g=0),i.push({message:u.join(":").trim(),type:Vc(a),lineNum:p,linePos:g})}return i}function Vc(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class Iy extends ds{constructor(i,r){super(i,r);m(this,"device");m(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return i?Cy(i):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(i){i=i.startsWith("#version ")?i:`#version 300 es
${i}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,i),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}N.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),N.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Oy(t,e,i,r){if(By(e))return r(t);const s=t;s.pushState();try{return xy(t,e),ri(s.gl,i),r(t)}finally{s.popState()}}function xy(t,e){const i=t,{gl:r}=i;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Me("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const a=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Me("provokingVertex",e.provokingVertex,{first:36429,last:36430});a==null||a.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Me("polygonMode",e.polygonMode,{fill:6914,line:6913});a==null||a.polygonModeWEBGL(1028,l),a==null||a.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(Dy("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Ds("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;r.stencilMaskSeparate(1028,s),r.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&N.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,a=Ds("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,a,0,s),r.stencilFuncSeparate(1029,a,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Jr("stencilPassOperation",e.stencilPassOperation),a=Jr("stencilFailOperation",e.stencilFailOperation),l=Jr("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,a,l,s),r.stencilOpSeparate(1029,a,l,s)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=Wc("blendColorOperation",e.blendColorOperation||"add"),a=Wc("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(s,a);const l=_n("blendColorSrcFactor",e.blendColorSrcFactor||"one"),f=_n("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=_n("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),p=_n("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(l,f,u,p)}}function Ds(t,e){return Me(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Jr(t,e){return Me(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Wc(t,e){return Me(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function _n(t,e){return Me(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Ny(t,e){return`Illegal parameter ${e} for ${t}`}function Me(t,e,i){if(!(e in i))throw new Error(Ny(t,e));return i[e]}function Dy(t,e){return e}function By(t){let e=!0;for(const i in t){e=!1;break}return e}function gh(t){const e={};return t.addressModeU&&(e[10242]=Qr(t.addressModeU)),t.addressModeV&&(e[10243]=Qr(t.addressModeV)),t.addressModeW&&(e[32882]=Qr(t.addressModeW)),t.magFilter&&(e[10240]=Bs(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=Fy(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Ds("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Qr(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Bs(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function Fy(t,e="none"){if(!e)return Bs(t);switch(e){case"none":return Bs(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Fs extends _s{constructor(i,r){super(i,r);m(this,"device");m(this,"handle");m(this,"parameters");this.device=i,this.parameters=gh(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[r,s]of Object.entries(i)){const a=Number(r);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,s);break;default:this.device.gl.samplerParameteri(this.handle,a,s);break}}}}class Je extends us{constructor(i,r){super(i,{...gt.defaultProps,...r});m(this,"device");m(this,"gl");m(this,"handle");m(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const Uy="Failed to deduce GL constant from typed array";function Ly(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Uy)}}function ky(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function mh(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function zy(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Nn(t,e,i){if(Vy(e))return i(t);const{nocatch:r=!0}=e,s=Pe.get(t);s.push(),ri(t,e);let a;if(r)a=i(t),s.pop();else try{a=i(t)}finally{s.pop()}return a}function Vy(t){for(const e in t)return!1;return!0}function Wy(t,e,i){const{dimension:r,width:s,height:a,depth:l=0}=i,{glInternalFormat:f}=i,u=i.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,f,s,a,l);break;default:t.texStorage2D(u,e,f,s,a)}}function Hc(t,e,i,r){const{width:s,height:a}=r,{dimension:l,depth:f=0,mipLevel:u=0}=r,{x:p=0,y:g=0,z:T=0}=r,{glFormat:v,glType:E}=r,b=Th(r.glTarget,l,f),S=r.flipY?{37440:!0}:{};Nn(t,S,()=>{switch(l){case"2d-array":case"3d":t.bindTexture(b,e),t.texSubImage3D(b,u,p,g,T,s,a,f,v,E,i),t.bindTexture(b,null);break;case"2d":case"cube":t.bindTexture(b,e),t.texSubImage2D(b,u,p,g,s,a,v,E,i),t.bindTexture(b,null);break;default:throw new Error(l)}})}function jc(t,e,i){const{dimension:r,width:s,height:a,depth:l=0,mipLevel:f=0,byteOffset:u=0}=i,{x:p=0,y:g=0,z:T=0}=i,{glFormat:v,glType:E,compressed:b}=i,S=Th(i.glTarget,r,l);switch(r){case"2d-array":case"3d":b?t.compressedTexSubImage3D(S,f,p,g,T,s,a,l,v,e,u):t.texSubImage3D(S,f,p,g,T,s,a,l,v,E,e,u);break;case"2d":case"cube":b?t.compressedTexSubImage2D(S,f,p,g,s,a,v,e,u):t.texSubImage2D(S,f,p,g,s,a,v,E,e,u);break;default:throw new Error(r)}}function Hy(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function Th(t,e,i){return e==="cube"?34069+i:t}function jy(t,e){var I;const{sourceX:i=0,sourceY:r=0,sourceAttachment:s=0}=e||{};let{target:a=null,sourceWidth:l,sourceHeight:f,sourceDepth:u,sourceFormat:p,sourceType:g}=e||{};const{framebuffer:T,deleteFramebuffer:v}=vh(t),{gl:E,handle:b}=T;l||(l=T.width),f||(f=T.height);const S=(I=T.colorAttachments[s])==null?void 0:I.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${s}`);u=(S==null?void 0:S.depth)||1,p||(p=(S==null?void 0:S.glFormat)||6408),g||(g=(S==null?void 0:S.glType)||5121),a=$y(a,g,p,l,f),g=g||Ly(a);const w=E.bindFramebuffer(36160,b);return E.readBuffer(36064+s),E.readPixels(i,r,l,f,p,g,a),E.readBuffer(36064),E.bindFramebuffer(36160,w||null),v&&T.destroy(),a}function Xy(t,e){const{target:i,sourceX:r=0,sourceY:s=0,sourceFormat:a=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:f,sourceHeight:u,sourceType:p}=e||{};const{framebuffer:g,deleteFramebuffer:T}=vh(t);f=f||g.width,u=u||g.height;const v=g;p=p||5121;let E=i;if(!E){const S=mh(a),w=zy(p),I=l+f*u*S*w;E=v.device.createBuffer({byteLength:I})}const b=t.device.createCommandEncoder();return b.copyTextureToBuffer({sourceTexture:t,width:f,height:u,origin:[r,s],destinationBuffer:E,byteOffset:l}),b.destroy(),T&&g.destroy(),E}function vh(t){return t instanceof wn?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Zy(t),deleteFramebuffer:!0}}function Zy(t,e){const{device:i,width:r,height:s,id:a}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:r,height:s,colorAttachments:[t]})}function $y(t,e,i,r,s,a){if(t)return t;e||(e=5121);const l=ky(e,{clamped:!1}),f=mh(i);return new l(r*s*f)}class Oi extends gt{constructor(i,r){super(i,r);m(this,"device");m(this,"gl");m(this,"handle");m(this,"sampler");m(this,"view");m(this,"mipmaps");m(this,"compressed");m(this,"glTarget");m(this,"glFormat");m(this,"glType");m(this,"glInternalFormat");m(this,"textureUnit",0);const s={...this.props};s.data=r.data,this.device=i,this.gl=this.device.gl,this.glTarget=Hy(this.props.dimension);const a=dh(this.props.format);this.glInternalFormat=a.internalFormat,this.glFormat=a.format,this.glType=a.type,this.compressed=a.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(i){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:i.data});let{width:r,height:s}=i;if(!r||!s){const a=gt.getTextureDataSize(i.data);r=(a==null?void 0:a.width)||1,s=(a==null?void 0:a.height)||1}if(this.width=r,this.height=s,this.depth=i.depth,this.setSampler(i.sampler),this.view=new Je(this.device,{...this.props,texture:this}),this.bind(),Wy(this.gl,this.mipLevels,this),i.data)switch(i.dimension){case"1d":this.setTexture1DData(i.data);break;case"2d":this.setTexture2DData(i.data);break;case"3d":this.setTexture3DData(i.data);break;case"cube":this.setTextureCubeData(i.data);break;case"2d-array":this.setTextureArrayData(i.data);break;case"cube-array":this.setTextureCubeArrayData(i.data);break;default:throw new Error(i.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(i){return new Je(this.device,{...i,texture:this})}setSampler(i={}){let r;i instanceof Fs?(this.sampler=i,r=i.props):(this.sampler=new Fs(this.device,i),r=i);const s=gh(r);this._setSamplerParameters(s)}generateMipmap(i){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(N.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(i!=null&&i.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){N.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(i){const r=gt.getExternalImageSize(i.image),s={...gt.defaultCopyExternalImageOptions,...r,...i},{image:a,depth:l,mipLevel:f,x:u,y:p,z:g,flipY:T}=s;let{width:v,height:E}=s;const{dimension:b,glTarget:S,glFormat:w,glInternalFormat:I,glType:C}=this;if(v=Math.min(v,this.width-u),E=Math.min(E,this.height-p),i.sourceX||i.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Hc(this.device.gl,this.handle,a,{dimension:b,mipLevel:f,x:u,y:p,z:g,width:v,height:E,depth:l,glFormat:w,glType:C,glTarget:S,flipY:T}),{width:s.width,height:s.height}}setTexture1DData(i){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(i,r=0){this.bind();const s=gt.normalizeTextureData(i,this);s.length>1&&this.props.mipmaps!==!1&&N.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let a=0;a<s.length;a++){const l=s[a];this._setMipLevel(r,a,l)}this.unbind()}setTexture3DData(i){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(i)&&(this.bind(),jc(this.device.gl,i,this),this.unbind())}setTextureCubeData(i,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of gt.CubeFaces)this.setTextureCubeFaceData(i[s],s)}setTextureArrayData(i){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(i){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(i,r,s=0){Array.isArray(i)&&i.length>1&&this.props.mipmaps!==!1&&N.warn(`${this.id} has mipmap and multiple LODs.`)();const a=gt.CubeFaces.indexOf(r);this.setTexture2DData(i,a)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(i){const{face:r,width:s,height:a,pixels:l,data:f,format:u=6408,type:p=5121}=i,{gl:g}=this,T=l||f;this.bind(),T instanceof Promise?T.then(v=>this.setImageDataForFace(Object.assign({},i,{face:r,data:v,pixels:v}))):this.width||this.height?g.texImage2D(r,0,u,s,a,0,u,p,T):g.texImage2D(r,0,u,u,p,T)}_getImageDataMap(i){for(let r=0;r<gt.CubeFaces.length;++r){const s=gt.CubeFaces[r];i[s]&&(i[34069+r]=i[s],delete i[s])}return i}_setSamplerParameters(i){N.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(i))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,s]of Object.entries(i)){const a=Number(r),l=s;switch(a){case 33082:case 33083:this.gl.texParameterf(this.glTarget,a,l);break;case 10241:this.gl.texParameteri(this.glTarget,a,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,a,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,a,l);break;default:this.gl.texParameteri(this.glTarget,a,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(i,r,s,a=this.glTarget){if(gt.isExternalImage(s)){Hc(this.device.gl,this.handle,s,{...this,depth:i,mipLevel:r,glTarget:a,flipY:this.props.flipY});return}if(gt.isTextureLevelData(s)){jc(this.device.gl,s.data,{...this,depth:i,mipLevel:r,glTarget:a});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.glTarget,this.handle),i}unbind(i){const{gl:r}=this;return i!==void 0&&(this.textureUnit=i,r.activeTexture(33984+i)),r.bindTexture(this.glTarget,null),i}}const Yy=[1,2,4,8];class Ky extends gs{constructor(i,r){var l;super(i,r);m(this,"device");m(this,"glParameters");this.device=i;let s;if(!((l=r==null?void 0:r.parameters)!=null&&l.viewport))if(r!=null&&r.framebuffer){const{width:f,height:u}=r.framebuffer;s=[0,0,f,u]}else{const[f,u]=i.getCanvasContext().getDrawingBufferSize();s=[0,0,f,u]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const a=this.props.framebuffer;if(a!=null&&a.handle)if(this.props.framebuffer){const f=this.props.framebuffer.colorAttachments.map((u,p)=>36064+p);this.device.gl.drawBuffers(f)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(r.viewport=i.viewport.slice(0,4),r.depthRange=[i.viewport[4],i.viewport[5]]):r.viewport=i.viewport),i.scissorRect&&(r.scissorTest=!0,r.scissor=i.scissorRect),i.blendConstant&&(r.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(r.colorMask=Yy.map(s=>!!(s&i.colorMask))),this.glParameters=r,ri(this.device.gl,r)}beginOcclusionQuery(i){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((s,a)=>{s&&this.clearColorBuffer(a,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,i.clearStencil=this.props.clearStencil),r!==0&&Nn(this.device.gl,i,()=>{this.device.gl.clear(r)})}clearColorBuffer(i=0,r=[0,0,0,0]){Nn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,i,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,i,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,i,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function qy(t){return Jy.includes(t)}const Jy=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],yh={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Eh(t){const e=yh[t];if(!e)throw new Error("uniform");const[i,r,,s]=e;return{format:s,components:r,glType:i}}function Qy(t){const e=yh[t];if(!e)throw new Error("attribute");const[,i,,r,s]=e;return{attributeType:r,vertexFormat:s,components:i}}function Gy(t,e){const i={attributes:[],bindings:[]};i.attributes=tE(t,e);const r=nE(t,e);for(const f of r){const u=f.uniforms.map(p=>({name:p.name,format:p.format,byteOffset:p.byteOffset,byteStride:p.byteStride,arrayLength:p.arrayLength}));i.bindings.push({type:"uniform",name:f.name,group:0,location:f.location,visibility:(f.vertex?1:0)&(f.fragment?2:0),minBindingSize:f.byteLength,uniforms:u})}const s=iE(t,e);let a=0;for(const f of s)if(qy(f.type)){const{viewDimension:u,sampleType:p}=sE(f.type);i.bindings.push({type:"texture",name:f.name,group:0,location:a,viewDimension:u,sampleType:p}),f.textureUnit=a,a+=1}s.length&&(i.uniforms=s);const l=eE(t,e);return l!=null&&l.length&&(i.varyings=l),i}function tE(t,e){const i=[],r=t.getProgramParameter(e,35721);for(let s=0;s<r;s++){const a=t.getActiveAttrib(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:f}=a,u=t.getAttribLocation(e,l);if(u>=0){const{attributeType:p}=Qy(f),g=/instance/i.test(l)?"instance":"vertex";i.push({name:l,location:u,stepMode:g,type:p})}}return i.sort((s,a)=>s.location-a.location),i}function eE(t,e){const i=[],r=t.getProgramParameter(e,35971);for(let s=0;s<r;s++){const a=t.getTransformFeedbackVarying(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:f,size:u}=a,{glType:p,components:g}=Eh(f),T={location:s,name:l,type:p,size:u*g};i.push(T)}return i.sort((s,a)=>s.location-a.location),i}function iE(t,e){const i=[],r=t.getProgramParameter(e,35718);for(let s=0;s<r;s++){const a=t.getActiveUniform(e,s);if(!a)throw new Error("activeInfo");const{name:l,size:f,type:u}=a,{name:p,isArray:g}=oE(l);let T=t.getUniformLocation(e,p);const v={location:T,name:p,size:f,type:u,isArray:g};if(i.push(v),v.size>1)for(let E=0;E<v.size;E++){const b=`${p}[${E}]`;T=t.getUniformLocation(e,b);const S={...v,name:b,location:T};i.push(S)}}return i}function nE(t,e){const i=(a,l)=>t.getActiveUniformBlockParameter(e,a,l),r=[],s=t.getProgramParameter(e,35382);for(let a=0;a<s;a++){const l={name:t.getActiveUniformBlockName(e,a)||"",location:i(a,35391),byteLength:i(a,35392),vertex:i(a,35396),fragment:i(a,35398),uniformCount:i(a,35394),uniforms:[]},f=i(a,35395)||[],u=t.getActiveUniforms(e,f,35383),p=t.getActiveUniforms(e,f,35384),g=t.getActiveUniforms(e,f,35387),T=t.getActiveUniforms(e,f,35388);for(let v=0;v<l.uniformCount;++v){const E=t.getActiveUniform(e,f[v]);if(!E)throw new Error("activeInfo");l.uniforms.push({name:E.name,format:Eh(u[v]).format,type:u[v],arrayLength:p[v],byteOffset:g[v],byteStride:T[v]})}r.push(l)}return r.sort((a,l)=>a.location-l.location),r}const rE={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function sE(t){const e=rE[t];if(!e)throw new Error("sampler");const[i,r]=e;return{viewDimension:i,sampleType:r}}function oE(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function aE(t,e,i,r){const s=t;let a=r;a===!0&&(a=1),a===!1&&(a=0);const l=typeof a=="number"?[a]:a;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,l);case 35664:return t.uniform2fv(e,l);case 35665:return t.uniform3fv(e,l);case 35666:return t.uniform4fv(e,l);case 5124:return t.uniform1iv(e,l);case 35667:return t.uniform2iv(e,l);case 35668:return t.uniform3iv(e,l);case 35669:return t.uniform4iv(e,l);case 35670:return t.uniform1iv(e,l);case 35671:return t.uniform2iv(e,l);case 35672:return t.uniform3iv(e,l);case 35673:return t.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return t.uniformMatrix2fv(e,!1,l);case 35675:return t.uniformMatrix3fv(e,!1,l);case 35676:return t.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function cE(t){return GT(t)!==null||typeof t=="number"||typeof t=="boolean"}function lE(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const r=t[i];cE(r)?e.uniforms[i]=r:e.bindings[i]=r}),e}function hE(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function fE(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const Xc=4;class uE extends ps{constructor(i,r){super(i,r);m(this,"device");m(this,"handle");m(this,"vs");m(this,"fs");m(this,"introspectedLayout");m(this,"uniforms",{});m(this,"bindings",{});m(this,"varyings",null);m(this,"_uniformCount",0);m(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:s,bufferMode:a=35981}=r;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,a)),this._linkShaders(),N.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Gy(this.device.gl,this.handle),N.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=dE(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,r){for(const[s,a]of Object.entries(i)){const l=this.shaderLayout.bindings.find(f=>f.name===s)||this.shaderLayout.bindings.find(f=>f.name===`${s}Uniforms`);if(!l){const f=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||N.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${f}`,a)();continue}switch(a||N.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(a instanceof Ii)&&!(a.buffer instanceof Ii))throw new Error("buffer value");break;case"texture":if(!(a instanceof Je||a instanceof Oi||a instanceof Ci))throw new Error("texture value");break;case"sampler":N.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(l.type)}this.bindings[s]=a}}draw(i){var w;const{renderPass:r,parameters:s=this.props.parameters,topology:a=this.props.topology,vertexArray:l,vertexCount:f,instanceCount:u,isInstanced:p=!1,firstVertex:g=0,transformFeedback:T}=i,v=hE(a),E=!!l.indexBuffer,b=(w=l.indexBuffer)==null?void 0:w.glIndexType;if(this.linkStatus!=="success")return N.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return N.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(r),T&&T.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=r;return Oy(this.device,s,S.glParameters,()=>{E&&p?this.device.gl.drawElementsInstanced(v,f||0,b,g,u||0):E?this.device.gl.drawElements(v,f||0,b,g):p?this.device.gl.drawArraysInstanced(v,g,f||0,u||0):this.device.gl.drawArrays(v,g,f||0),T&&T.end()}),l.unbindAfterRender(r),!0}setUniformsWebGL(i){const{bindings:r}=lE(i);Object.keys(r).forEach(s=>{N.warn(`Unsupported value "${JSON.stringify(r[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),N.time(Xc,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),N.timeEnd(Xc,`linkProgram for ${this.id}`)(),N.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}N.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),N.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(i){var r;switch(i){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${i}: ${s}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(N.warn(`Binding ${r.name} not found in ${this.id}`)(),i=!1);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let r=0,s=0;for(const a of this.shaderLayout.bindings){const l=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:f}=a,u=i.getUniformBlockIndex(this.handle,f);if(u===4294967295)throw new Error(`Invalid uniform block name ${f}`);i.uniformBlockBinding(this.handle,s,u),l instanceof Ii?i.bindBufferBase(35345,s,l.handle):i.bindBufferRange(35345,s,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),s+=1;break;case"texture":if(!(l instanceof Je||l instanceof Oi||l instanceof Ci))throw new Error("texture");let p;if(l instanceof Je)p=l.texture;else if(l instanceof Oi)p=l;else if(l instanceof Ci&&l.colorAttachments[0]instanceof Je)N.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),p=l.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+r),i.bindTexture(p.glTarget,p.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:r,location:s,type:a,textureUnit:l}=i,f=this.uniforms[r]??l;f!==void 0&&aE(this.device.gl,s,a,f)}}}function dE(t,e){const i={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const s=i.attributes.find(a=>a.name===r.name);s?(s.type=r.type||s.type,s.stepMode=r.stepMode||s.stepMode):N.warn(`shader layout attribute ${r.name} not present in shader`)}return i}class _E extends Ts{constructor(i){super(i,{});m(this,"device");m(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const r of i)switch(r.name){case"copy-buffer-to-buffer":pE(this.device,r.options);break;case"copy-buffer-to-texture":gE(this.device,r.options);break;case"copy-texture-to-buffer":mE(this.device,r.options);break;case"copy-texture-to-texture":TE(this.device,r.options);break;default:throw new Error(r.name)}}}function pE(t,e){const i=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function gE(t,e){throw new Error("Not implemented")}function mE(t,e){const{sourceTexture:i,mipLevel:r=0,aspect:s="all",width:a=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:f=0,origin:u=[0,0],destinationBuffer:p,byteOffset:g=0,bytesPerRow:T,rowsPerImage:v}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||f!==0||T||v)throw new Error("not implemented");const{framebuffer:E,destroyFramebuffer:b}=Ah(i);let S;try{const w=p,I=a||E.width,C=l||E.height,M=dh(E.colorAttachments[0].texture.props.format),O=M.format,B=M.type;t.gl.bindBuffer(35051,w.handle),S=t.gl.bindFramebuffer(36160,E.handle),t.gl.readPixels(u[0],u[1],I,C,O,B,g)}finally{t.gl.bindBuffer(35051,null),S!==void 0&&t.gl.bindFramebuffer(36160,S),b&&E.destroy()}}function TE(t,e){const{sourceTexture:i,destinationMipLevel:r=0,origin:s=[0,0],destinationOrigin:a=[0,0],destinationTexture:l}=e;let{width:f=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:p,destroyFramebuffer:g}=Ah(i),[T,v]=s,[E,b,S]=a,w=t.gl.bindFramebuffer(36160,p.handle);let I=null,C;if(l instanceof Oi)I=l,f=Number.isFinite(f)?f:I.width,u=Number.isFinite(u)?u:I.height,I.bind(0),C=I.glTarget;else throw new Error("invalid destination");switch(C){case 3553:case 34067:t.gl.copyTexSubImage2D(C,r,E,b,T,v,f,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(C,r,E,b,S,T,v,f,u);break}I&&I.unbind(),t.gl.bindFramebuffer(36160,w),g&&p.destroy()}function Ah(t){if(t instanceof gt){const{width:e,height:i,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class vE extends ms{constructor(i,r){super(i,r);m(this,"device");m(this,"commandBuffer");this.device=i,this.commandBuffer=new _E(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,r,s){}}function yE(t){const{target:e,source:i,start:r=0,count:s=1}=t,a=i.length,l=s*a;let f=0;for(let u=r;f<a;f++)e[u++]=i[f];for(;f<l;)f<l-f?(e.copyWithin(r+f,r,r+f),f*=2):(e.copyWithin(r+f,r,r+l-f),f=l);return t.target}class no extends vs{constructor(i,r){super(i,r);m(this,"device");m(this,"handle");m(this,"buffer",null);m(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return ru()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const r=i;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(i,r){const s=r;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:l,stride:f,offset:u,normalized:p,integer:g,divisor:T}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),g?this.device.gl.vertexAttribIPointer(i,a,l,f,u):this.device.gl.vertexAttribPointer(i,a,l,p,f,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,T||0),this.attributes[i]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,r){this._enable(i,!1),this.attributes[i]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const r=this.attributes[i];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(i,r)}}_getAccessor(i){const r=this.attributeInfos[i];if(!r)throw new Error(`Unknown attribute location ${i}`);const s=uh(r.bufferDataType);return{size:r.bufferComponents,type:s,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(i,r=!0){const a=no.isConstantAttributeZeroSupported(this.device)||i!==0;(r||a)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,r){const s=EE(r),a=s.byteLength*i,l=s.length*i;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let f=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),f=f||!AE(s,this.bufferValue),f){const u=kp(r.constructor,l);yE({target:u,source:s,start:0,count:l}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function EE(t){return Array.isArray(t)?new Float32Array(t):t}function AE(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class SE extends ys{constructor(i,r){super(i,r);m(this,"device");m(this,"gl");m(this,"handle");m(this,"layout");m(this,"buffers",{});m(this,"unusedBuffers",{});m(this,"bindOnUse",!0);m(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fE(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in i)this.setBuffer(r,i[r])})}setBuffer(i,r){const s=this._getVaryingIndex(i),{buffer:a,byteLength:l,byteOffset:f}=this._getBufferRange(r);if(s<0){this.unusedBuffers[i]=a,N.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[s]={buffer:a,byteLength:l,byteOffset:f},this.bindOnUse||this._bindBuffer(s,a,f,l)}getBuffer(i){if(Zc(i))return this.buffers[i]||null;const r=this._getVaryingIndex(i);return r>=0?this.buffers[r]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let r;return this._bound?r=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof Ii)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:r,byteOffset:s=0,byteLength:a=i.buffer.byteLength}=i;return{buffer:r,byteOffset:s,byteLength:a}}_getVaryingIndex(i){if(Zc(i))return Number(i);for(const r of this.layout.varyings)if(i===r.name)return r.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:r,byteLength:s,byteOffset:a}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),r,a,s)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,r,s=0,a){const l=r&&r.handle;!l||a===void 0?this.gl.bindBufferBase(35982,i,l):this.gl.bindBufferRange(35982,i,l,s,a)}}function Zc(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class RE extends Es{constructor(i,r){super(i,r);m(this,"device");m(this,"handle");m(this,"target",null);m(this,"_queryPending",!1);m(this,"_pollingPromise",null);if(this.device=i,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((s,a)=>{const l=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):r++>i?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class pn extends ge{constructor(i){var T,v;super({...i,id:i.id||wy("webgl-device")});m(this,"type","webgl");m(this,"handle");m(this,"features");m(this,"limits");m(this,"info");m(this,"canvasContext");m(this,"lost");m(this,"_resolveContextLost");m(this,"gl");m(this,"debug",!1);m(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});m(this,"_extensions",{});m(this,"_polyfilled",!1);m(this,"spectorJS");m(this,"renderPass",null);m(this,"_constants");const r=ge._getCanvasContextProps(i);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(v=(T=r.canvas)==null?void 0:T.gl)==null?void 0:v.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new py(this,r),this.lost=new Promise(E=>{this._resolveContextLost=E});const a={...i.webgl};r.alphaMode==="premultiplied"&&(a.premultipliedAlpha=!0),i.powerPreference!==void 0&&(a.powerPreference=i.powerPreference);const f=this.props._handle||Kv(this.canvasContext.canvas,{onContextLost:E=>{var b;return(b=this._resolveContextLost)==null?void 0:b.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:E=>console.log("WebGL context restored")},a);if(!f)throw new Error("WebGL context creation failed");if(s=f.device,s){if(i._reuseDevices)return N.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=f,this.gl=f,this.spectorJS=Ty({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=qv(this.gl,this._extensions),this.limits=new uy(this.gl),this.features=new fy(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Pe(this.gl,{log:(...E)=>N.log(1,...E)()}).trackState(this.gl,{copyState:!1});const p=i.debugWebGL||i.debug,g=i.debugWebGL;p&&(this.gl=Ey(this.gl,{debugWebGL:p,traceWebGL:g}),N.warn("WebGL debug mode activated. Performance reduced.")(),i.debugWebGL&&(N.level=Math.max(N.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const r=this._normalizeBufferProps(i);return new Ii(this,r)}createTexture(i){return new Oi(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new Fs(this,i)}createShader(i){return new Iy(this,i)}createFramebuffer(i){return new Ci(this,i)}createVertexArray(i){return new no(this,i)}createTransformFeedback(i){return new SE(this,i)}createQuerySet(i){return new RE(this,i)}createRenderPipeline(i){return new uE(this,i)}beginRenderPass(i){return new Ky(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i={}){return new vE(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,r){return jy(i,r)}readPixelsToBufferWebGL(i,r){return Xy(i,r)}setParametersWebGL(i){ri(this.gl,i)}getParametersWebGL(i){return hh(this.gl,i)}withParametersWebGL(i,r){return Nn(this.gl,i,r)}resetWebGL(){N.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),jv(this.gl)}_getDeviceSpecificTextureFormatCapabilities(i){return ay(this.gl,i,this._extensions)}loseDevice(){var a;let i=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(i=!0,s.loseContext()),(a=this._resolveContextLost)==null||a.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){Pe.get(this.gl).push()}popState(){Pe.get(this.gl).pop()}setSpectorMetadata(i,r){i.__SPECTOR_Metadata=r}getGLKey(i,r){const s=Number(i);for(const a in this.gl)if(this.gl[a]===s)return`GL.${a}`;return r!=null&&r.emptyIfUnknown?"":String(i)}getGLKeys(i){const r={emptyIfUnknown:!0};return Object.entries(i).reduce((s,[a,l])=>(s[`${a}:${this.getGLKey(a,r)}`]=`${l}:${this.getGLKey(l,r)}`,s),{})}setConstantAttributeWebGL(i,r){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const a=this._constants[i];switch(a&&ME(a,r)&&N.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=r,r.constructor){case Float32Array:bE(this,i,r);break;case Int32Array:wE(this,i,r);break;case Uint32Array:PE(this,i,r);break;default:throw new Error("constant")}}getExtension(i){return ni(this.gl,i,this._extensions),this._extensions}}function bE(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break}}function wE(t,e,i){t.gl.vertexAttribI4iv(e,i)}function PE(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function ME(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}const CE={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},IE=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),OE=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),xE=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function NE(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(i,r){if(i==="webgl"||i==="experimental-webgl"){const s=this.originalGetContext("webgl2",r);return s instanceof HTMLElement&&DE(s),s}return this.originalGetContext(i,r)}}function DE(t){t.getExtension("EXT_color_buffer_float");const e={...CE,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:IE(t),OES_vertex_array_object:OE(t),ANGLE_instanced_arrays:xE(t)},i=t.getExtension;t.getExtension=function(s){const a=i.call(t,s);return a||(s in e?e[s]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=r.apply(t)||[];return s==null?void 0:s.concat(Object.keys(e))}}const gn=1;class BE extends gp{constructor(){super();m(this,"type","webgl");ge.defaultProps={...ge.defaultProps,...io},pn.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(i){NE(i)}async attach(i){if(i instanceof pn)return i;if((i==null?void 0:i.device)instanceof ge)return i.device;if(!FE(i))throw new Error("Invalid WebGL2RenderingContext");return new pn({_handle:i,createCanvasContext:{canvas:i.canvas,autoResize:!1}})}async create(i={}){N.groupCollapsed(gn,"WebGLDevice created")();const r=[];(i.debugWebGL||i.debug)&&r.push(yy()),i.debugSpectorJS&&r.push(my(i));const s=await Promise.allSettled(r);for(const f of s)f.status==="rejected"&&N.error(`Failed to initialize debug libraries ${f.reason}`)();const a=new pn(i),l=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return N.probe(gn,l)(),N.table(gn,a.info)(),N.groupEnd(gn)(),a}}function FE(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const $c=new BE;function fe(){}const UE=({isDragging:t})=>t?"grabbing":"grab",Sh={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:fe,onWebGLInitialized:fe,onResize:fe,onViewStateChange:fe,onInteractionStateChange:fe,onBeforeRender:fe,onAfterRender:fe,onLoad:fe,onError:t=>St.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:UE,getTooltip:null,debug:!1,drawPickingColors:!1};class ro{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xn({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:s}=this;if(r.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(r.leftButton||r.rightButton)return;{const a=r.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=r},this._onEvent=r=>{const s=Cs[r.type],a=r.offsetCenter;if(!s||!a||!this.layerManager)return;const l=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:l,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:u}=f,p=u&&(u[s]||u.props[s]),g=this.props[s];let T=!1;p&&(T=p.call(u,f,r)),T||(g==null||g(f,r),this.widgetManager.onEvent(f,r))},this._onPointerDown=r=>{var l;if(((l=this.device)==null?void 0:l.type)==="webgpu")return;const s=r.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...Sh,...e},e=this.props,e.viewState&&e.initialViewState&&St.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let i=this.device;!i&&e.gl&&(e.gl instanceof WebGLRenderingContext&&St.error("WebGL1 context not supported.")(),i=$c.attach(e.gl)),i||(i=hs.createDevice({type:"best-available",_reuseDevices:!0,adapters:[$c],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&UT.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,r,s,a,l,f,u,p,g;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(a=this.effectManager)==null||a.finalize(),this.effectManager=null,(l=this.deckRenderer)==null||l.finalize(),this.deckRenderer=null,(f=this.deckPicker)==null||f.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(p=this.widgetManager)==null||p.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((g=this.canvas.parentElement)==null||g.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&St.removed("onLayerHover","onHover")(),"onLayerClick"in e&&St.removed("onLayerClick","onClick")(),e.initialViewState&&!Ce(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return i=i||r||s||a||l,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return pe(this.viewManager),this.viewManager.views}getViewports(e){return pe(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,r){pe(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(i).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return s.get(i).timeEnd(),a}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),pe(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:i,height:r}=e;if(i||i===0){const a=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=a}if(r||r===0){const a=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var s,a;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,r=e.clientHeight??e.height;(i!==this.width||r!==this.height)&&(this.width=i,this.height=r,(s=this.viewManager)==null||s.setProps({width:i,height:r}),(a=this.layerManager)==null||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:r}))}_createAnimationLoop(e,i){const{gl:r,onError:s,useDevicePixels:a}=i;return new qT({device:e,useDevicePixels:a,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new Qs({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,r,s,a;if(((i=this.device)==null?void 0:i.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:f}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let u=f,p=!1;for(const g of l)u=g,p=((r=g.layer)==null?void 0:r.onHover(g,e.event))||p;p||((a=(s=this.props).onHover)==null||a.call(s,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,a;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const i=new nh;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new Mm(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(pc).map(l=>{var E;const[f,u,p,g]=pc[l],T=(E=this.props.eventRecognizerOptions)==null?void 0:E[l],v={...u,...T,event:l};return{recognizer:new f(v),recognizeWith:p,requestFailure:g}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in Cs)this.eventManager.on(l,this._onEvent);this.viewManager=new cv({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new av(this.device,{deck:this,stats:this.stats,viewport:r,timeline:i}),this.effectManager=new wv({deck:this,device:this.device}),this.deckRenderer=new Cv(this.device),this.deckPicker=new Bv(this.device),this.widgetManager=new Lv({deck:this,parentElement:(a=this.canvas)==null?void 0:a.parentElement}),this.widgetManager.addDefault(new zv),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var l;const{device:r,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:s});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(l=this.deckRenderer)==null||l.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:r,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),St.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const r=hs.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}ro.defaultProps=Sh;ro.VERSION=w_;async function LE(){const e=`https://query.wikidata.org/sparql?format=json&query=${encodeURIComponent(`
    SELECT ?country ?countryLabel ?iso3166_3 ?coord WHERE {
      ?country wdt:P31 wd:Q3624078;  # Sovereign state
               wdt:P298 ?iso3166_3;   # ISO 3166-1 alpha-3 code
               wdt:P625 ?coord.       # Coordinates

      SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
    }`)}`;try{return await(await fetch(e,{headers:{Accept:"application/json"}})).json()}catch(i){return console.error("Error fetching data:",i),null}}const kE=t=>({type:"FeatureCollection",features:t.results.bindings.map(i=>{const r=i.coord.value.match(/Point\(([^ ]+) ([^ ]+)\)/);if(!r)return null;const[s,a,l]=r.map(Number);return{type:"Feature",properties:{name:i.countryLabel.value,iso3166_3:i.iso3166_3.value},geometry:{type:"Point",coordinates:[a,l]}}}).filter(i=>i!==null)});function Rh(t=8){return[...["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","CPV","KHM","CMR","CAN","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","SWZ","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MKD","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]].sort(()=>.5-Math.random()).slice(0,t)}const zE=Rh();console.log("Random ISO3 codes:",zE);function VE(t){for(let e of countryCentroids.features)if(e.properties.iso3166_3===t)return e.geometry.coordinates;return null}const bh={fillColor:"#cbc9e2",color:"#9e9ac8",weight:1,fillOpacity:.6},WE={fillColor:"#9e9ac8",color:"#9e9ac8",weight:1,fillOpacity:.8},HE={fillColor:"#54278f",weight:1};let so=Us.map("map").setView([2.5,20],3);const jE="pk.eyJ1IjoibXdpc2NnIiwiYSI6ImNtN2VtbGEzNzBnaTgyam9vZXl3YzM2Ym4ifQ.YJe4CFT-CEYhl0D98Wk8aw";Us.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/light-v11/tiles/{z}/{x}/{y}?access_token=${jE}`,{attribution:'© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',tileSize:512,zoomOffset:-1}).addTo(so);new ro({parent:so.getPanes().overlayPane,views:[new Qs({repeat:!0})],controller:!1,layers:[]});let Yc=null;LE().then(t=>{Yc=kE(t),console.log("Fetched centroids once:",Yc)}).catch(t=>console.error("Error fetching centroids:",t));fetch("/GEOG778-vite/WorldPoly.geojson").then(t=>t.json()).then(t=>{Us.geoJson(t,{style:bh,onEachFeature:XE}).addTo(so)}).catch(t=>console.error("Error loading GeoJSON:",t));function XE(t,e){e.on({mouseover:function(i){i.target.setStyle(WE)},mouseout:function(i){i.target.setStyle(bh)},click:function(i){const s=i.target.feature.properties.adm0_a3_us;console.log("Selected Country ISO3:",s),VE(s),i.target.setStyle(HE);const a=Rh();console.log("Random ISO3 codes:",a)}})}
